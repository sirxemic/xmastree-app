var sy=Object.defineProperty;var hp=Object.getOwnPropertySymbols;var ay=Object.prototype.hasOwnProperty,oy=Object.prototype.propertyIsEnumerable;var fp=(r,e,t)=>e in r?sy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,dp=(r,e)=>{for(var t in e||(e={}))ay.call(e,t)&&fp(r,t,e[t]);if(hp)for(var t of hp(e))oy.call(e,t)&&fp(r,t,e[t]);return r};var ly=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},_c={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(ly,function(){var t=navigator.userAgent,i=navigator.platform,a=/gecko\/\d/i.test(t),o=/MSIE \d/.test(t),h=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),f=/Edge\/(\d+)/.exec(t),p=o||h||f,d=p&&(o?document.documentMode||6:+(f||h)[1]),g=!f&&/WebKit\//.test(t),y=g&&/Qt\/\d+\.\d+/.test(t),x=!f&&/Chrome\//.test(t),_=/Opera\//.test(t),T=/Apple Computer/.test(navigator.vendor),L=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),P=/PhantomJS/.test(t),M=T&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),w=/Android/.test(t),N=M||w||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),C=M||/Mac/.test(i),k=/\bCrOS\b/.test(t),q=/win/i.test(i),R=_&&t.match(/Version\/(\d*\.\d*)/);R&&(R=Number(R[1])),R&&R>=15&&(_=!1,g=!0);var J=C&&(y||_&&(R==null||R<12.11)),oe=a||p&&d>=9;function Q(n){return new RegExp("(^|\\s)"+n+"(?:$|\\s)\\s*")}var X=function(n,s){var u=n.className,l=Q(s).exec(u);if(l){var c=u.slice(l.index+l[0].length);n.className=u.slice(0,l.index)+(c?l[1]+c:"")}};function Se(n){for(var s=n.childNodes.length;s>0;--s)n.removeChild(n.firstChild);return n}function H(n,s){return Se(n).appendChild(s)}function W(n,s,u,l){var c=document.createElement(n);if(u&&(c.className=u),l&&(c.style.cssText=l),typeof s=="string")c.appendChild(document.createTextNode(s));else if(s)for(var m=0;m<s.length;++m)c.appendChild(s[m]);return c}function D(n,s,u,l){var c=W(n,s,u,l);return c.setAttribute("role","presentation"),c}var ee;document.createRange?ee=function(n,s,u,l){var c=document.createRange();return c.setEnd(l||n,u),c.setStart(n,s),c}:ee=function(n,s,u){var l=document.body.createTextRange();try{l.moveToElementText(n.parentNode)}catch{return l}return l.collapse(!0),l.moveEnd("character",u),l.moveStart("character",s),l};function te(n,s){if(s.nodeType==3&&(s=s.parentNode),n.contains)return n.contains(s);do if(s.nodeType==11&&(s=s.host),s==n)return!0;while(s=s.parentNode)}function Me(){var n;try{n=document.activeElement}catch{n=document.body||null}for(;n&&n.shadowRoot&&n.shadowRoot.activeElement;)n=n.shadowRoot.activeElement;return n}function Oe(n,s){var u=n.className;Q(s).test(u)||(n.className+=(u?" ":"")+s)}function ce(n,s){for(var u=n.split(" "),l=0;l<u.length;l++)u[l]&&!Q(u[l]).test(s)&&(s+=" "+u[l]);return s}var ue=function(n){n.select()};M?ue=function(n){n.selectionStart=0,n.selectionEnd=n.value.length}:p&&(ue=function(n){try{n.select()}catch{}});function We(n){var s=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,s)}}function Pe(n,s,u){s||(s={});for(var l in n)n.hasOwnProperty(l)&&(u!==!1||!s.hasOwnProperty(l))&&(s[l]=n[l]);return s}function ze(n,s,u,l,c){s==null&&(s=n.search(/[^\s\u00a0]/),s==-1&&(s=n.length));for(var m=l||0,v=c||0;;){var b=n.indexOf("	",m);if(b<0||b>=s)return v+(s-m);v+=b-m,v+=u-v%u,m=b+1}}var $e=function(){this.id=null,this.f=null,this.time=0,this.handler=We(this.onTimeout,this)};$e.prototype.onTimeout=function(n){n.id=0,n.time<=+new Date?n.f():setTimeout(n.handler,n.time-+new Date)},$e.prototype.set=function(n,s){this.f=s;var u=+new Date+n;(!this.id||u<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,n),this.time=u)};function K(n,s){for(var u=0;u<n.length;++u)if(n[u]==s)return u;return-1}var Ae=50,Re={toString:function(){return"CodeMirror.Pass"}},Ee={scroll:!1},Je={origin:"*mouse"},Ze={origin:"+move"};function se(n,s,u){for(var l=0,c=0;;){var m=n.indexOf("	",l);m==-1&&(m=n.length);var v=m-l;if(m==n.length||c+v>=s)return l+Math.min(v,s-c);if(c+=m-l,c+=u-c%u,l=m+1,c>=s)return l}}var be=[""];function Le(n){for(;be.length<=n;)be.push(me(be)+" ");return be[n]}function me(n){return n[n.length-1]}function Ce(n,s){for(var u=[],l=0;l<n.length;l++)u[l]=s(n[l],l);return u}function tt(n,s,u){for(var l=0,c=u(s);l<n.length&&u(n[l])<=c;)l++;n.splice(l,0,s)}function rt(){}function ht(n,s){var u;return Object.create?u=Object.create(n):(rt.prototype=n,u=new rt),s&&Pe(s,u),u}var bt=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function G(n){return/\w/.test(n)||n>"\x80"&&(n.toUpperCase()!=n.toLowerCase()||bt.test(n))}function O(n,s){return s?s.source.indexOf("\\w")>-1&&G(n)?!0:s.test(n):G(n)}function pe(n){for(var s in n)if(n.hasOwnProperty(s)&&n[s])return!1;return!0}var de=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function qe(n){return n.charCodeAt(0)>=768&&de.test(n)}function Xe(n,s,u){for(;(u<0?s>0:s<n.length)&&qe(n.charAt(s));)s+=u;return s}function Y(n,s,u){for(var l=s>u?-1:1;;){if(s==u)return s;var c=(s+u)/2,m=l<0?Math.ceil(c):Math.floor(c);if(m==s)return n(m)?s:u;n(m)?u=m:s=m+l}}function ke(n,s,u,l){if(!n)return l(s,u,"ltr",0);for(var c=!1,m=0;m<n.length;++m){var v=n[m];(v.from<u&&v.to>s||s==u&&v.to==s)&&(l(Math.max(v.from,s),Math.min(v.to,u),v.level==1?"rtl":"ltr",m),c=!0)}c||l(s,u,"ltr")}var z=null;function ne(n,s,u){var l;z=null;for(var c=0;c<n.length;++c){var m=n[c];if(m.from<s&&m.to>s)return c;m.to==s&&(m.from!=m.to&&u=="before"?l=c:z=c),m.from==s&&(m.from!=m.to&&u!="before"?l=c:z=c)}return l!=null?l:z}var ve=function(){var n="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",s="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function u(E){return E<=247?n.charAt(E):1424<=E&&E<=1524?"R":1536<=E&&E<=1785?s.charAt(E-1536):1774<=E&&E<=2220?"r":8192<=E&&E<=8203?"w":E==8204?"b":"L"}var l=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,c=/[stwN]/,m=/[LRr]/,v=/[Lb1n]/,b=/[1n]/;function S(E,I,B){this.level=E,this.from=I,this.to=B}return function(E,I){var B=I=="ltr"?"L":"R";if(E.length==0||I=="ltr"&&!l.test(E))return!1;for(var j=E.length,Z=[],ie=0;ie<j;++ie)Z.push(u(E.charCodeAt(ie)));for(var he=0,we=B;he<j;++he){var De=Z[he];De=="m"?Z[he]=we:we=De}for(var Fe=0,Ie=B;Fe<j;++Fe){var Ge=Z[Fe];Ge=="1"&&Ie=="r"?Z[Fe]="n":m.test(Ge)&&(Ie=Ge,Ge=="r"&&(Z[Fe]="R"))}for(var Qe=1,je=Z[0];Qe<j-1;++Qe){var pt=Z[Qe];pt=="+"&&je=="1"&&Z[Qe+1]=="1"?Z[Qe]="1":pt==","&&je==Z[Qe+1]&&(je=="1"||je=="n")&&(Z[Qe]=je),je=pt}for(var Lt=0;Lt<j;++Lt){var en=Z[Lt];if(en==",")Z[Lt]="N";else if(en=="%"){var Nt=void 0;for(Nt=Lt+1;Nt<j&&Z[Nt]=="%";++Nt);for(var Fn=Lt&&Z[Lt-1]=="!"||Nt<j&&Z[Nt]=="1"?"1":"N",Rn=Lt;Rn<Nt;++Rn)Z[Rn]=Fn;Lt=Nt-1}}for(var Vt=0,Pn=B;Vt<j;++Vt){var ln=Z[Vt];Pn=="L"&&ln=="1"?Z[Vt]="L":m.test(ln)&&(Pn=ln)}for(var qt=0;qt<j;++qt)if(c.test(Z[qt])){var Xt=void 0;for(Xt=qt+1;Xt<j&&c.test(Z[Xt]);++Xt);for(var Bt=(qt?Z[qt-1]:B)=="L",Dn=(Xt<j?Z[Xt]:B)=="L",xs=Bt==Dn?Bt?"L":"R":B,Qi=qt;Qi<Xt;++Qi)Z[Qi]=xs;qt=Xt-1}for(var pn=[],gi,tn=0;tn<j;)if(v.test(Z[tn])){var xc=tn;for(++tn;tn<j&&v.test(Z[tn]);++tn);pn.push(new S(0,xc,tn))}else{var Di=tn,Ir=pn.length,kr=I=="rtl"?1:0;for(++tn;tn<j&&Z[tn]!="L";++tn);for(var wn=Di;wn<tn;)if(b.test(Z[wn])){Di<wn&&(pn.splice(Ir,0,new S(1,Di,wn)),Ir+=kr);var ys=wn;for(++wn;wn<tn&&b.test(Z[wn]);++wn);pn.splice(Ir,0,new S(2,ys,wn)),Ir+=kr,Di=wn}else++wn;Di<tn&&pn.splice(Ir,0,new S(1,Di,tn))}return I=="ltr"&&(pn[0].level==1&&(gi=E.match(/^\s+/))&&(pn[0].from=gi[0].length,pn.unshift(new S(0,0,gi[0].length))),me(pn).level==1&&(gi=E.match(/\s+$/))&&(me(pn).to-=gi[0].length,pn.push(new S(0,j-gi[0].length,j)))),I=="rtl"?pn.reverse():pn}}();function Te(n,s){var u=n.order;return u==null&&(u=n.order=ve(n.text,s)),u}var Ne=[],xe=function(n,s,u){if(n.addEventListener)n.addEventListener(s,u,!1);else if(n.attachEvent)n.attachEvent("on"+s,u);else{var l=n._handlers||(n._handlers={});l[s]=(l[s]||Ne).concat(u)}};function wt(n,s){return n._handlers&&n._handlers[s]||Ne}function st(n,s,u){if(n.removeEventListener)n.removeEventListener(s,u,!1);else if(n.detachEvent)n.detachEvent("on"+s,u);else{var l=n._handlers,c=l&&l[s];if(c){var m=K(c,u);m>-1&&(l[s]=c.slice(0,m).concat(c.slice(m+1)))}}}function Ve(n,s){var u=wt(n,s);if(!!u.length)for(var l=Array.prototype.slice.call(arguments,2),c=0;c<u.length;++c)u[c].apply(null,l)}function ft(n,s,u){return typeof s=="string"&&(s={type:s,preventDefault:function(){this.defaultPrevented=!0}}),Ve(n,u||s.type,n,s),yn(s)||s.codemirrorIgnore}function Gi(n){var s=n._handlers&&n._handlers.cursorActivity;if(!!s)for(var u=n.curOp.cursorActivityHandlers||(n.curOp.cursorActivityHandlers=[]),l=0;l<s.length;++l)K(u,s[l])==-1&&u.push(s[l])}function Wt(n,s){return wt(n,s).length>0}function Un(n){n.prototype.on=function(s,u){xe(this,s,u)},n.prototype.off=function(s,u){st(this,s,u)}}function Dt(n){n.preventDefault?n.preventDefault():n.returnValue=!1}function Si(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function yn(n){return n.defaultPrevented!=null?n.defaultPrevented:n.returnValue==!1}function Ti(n){Dt(n),Si(n)}function Wn(n){return n.target||n.srcElement}function Qr(n){var s=n.which;return s==null&&(n.button&1?s=1:n.button&2?s=3:n.button&4&&(s=2)),C&&n.ctrlKey&&s==1&&(s=3),s}var Ei=function(){if(p&&d<9)return!1;var n=W("div");return"draggable"in n||"dragDrop"in n}(),an;function $r(n){if(an==null){var s=W("span","\u200B");H(n,W("span",[s,document.createTextNode("x")])),n.firstChild.offsetHeight!=0&&(an=s.offsetWidth<=1&&s.offsetHeight>2&&!(p&&d<8))}var u=an?W("span","\u200B"):W("span","\xA0",null,"display: inline-block; width: 1px; margin-right: -1px");return u.setAttribute("cm-text",""),u}var Sr;function jn(n){if(Sr!=null)return Sr;var s=H(n,document.createTextNode("A\u062EA")),u=ee(s,0,1).getBoundingClientRect(),l=ee(s,1,2).getBoundingClientRect();return Se(n),!u||u.left==u.right?!1:Sr=l.right-u.right<3}var F=`

b`.split(/\n/).length!=3?function(n){for(var s=0,u=[],l=n.length;s<=l;){var c=n.indexOf(`
`,s);c==-1&&(c=n.length);var m=n.slice(s,n.charAt(c-1)=="\r"?c-1:c),v=m.indexOf("\r");v!=-1?(u.push(m.slice(0,v)),s+=v+1):(u.push(m),s=c+1)}return u}:function(n){return n.split(/\r\n?|\n/)},$=window.getSelection?function(n){try{return n.selectionStart!=n.selectionEnd}catch{return!1}}:function(n){var s;try{s=n.ownerDocument.selection.createRange()}catch{}return!s||s.parentElement()!=n?!1:s.compareEndPoints("StartToEnd",s)!=0},ae=function(){var n=W("div");return"oncopy"in n?!0:(n.setAttribute("oncopy","return;"),typeof n.oncopy=="function")}(),re=null;function fe(n){if(re!=null)return re;var s=H(n,W("span","x")),u=s.getBoundingClientRect(),l=ee(s,0,1).getBoundingClientRect();return re=Math.abs(u.left-l.left)>1}var Ke={},Ye={};function dt(n,s){arguments.length>2&&(s.dependencies=Array.prototype.slice.call(arguments,2)),Ke[n]=s}function it(n,s){Ye[n]=s}function mt(n){if(typeof n=="string"&&Ye.hasOwnProperty(n))n=Ye[n];else if(n&&typeof n.name=="string"&&Ye.hasOwnProperty(n.name)){var s=Ye[n.name];typeof s=="string"&&(s={name:s}),n=ht(s,n),n.name=s.name}else{if(typeof n=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(n))return mt("application/xml");if(typeof n=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(n))return mt("application/json")}return typeof n=="string"?{name:n}:n||{name:"null"}}function ct(n,s){s=mt(s);var u=Ke[s.name];if(!u)return ct(n,"text/plain");var l=u(n,s);if(ut.hasOwnProperty(s.name)){var c=ut[s.name];for(var m in c)!c.hasOwnProperty(m)||(l.hasOwnProperty(m)&&(l["_"+m]=l[m]),l[m]=c[m])}if(l.name=s.name,s.helperType&&(l.helperType=s.helperType),s.modeProps)for(var v in s.modeProps)l[v]=s.modeProps[v];return l}var ut={};function _t(n,s){var u=ut.hasOwnProperty(n)?ut[n]:ut[n]={};Pe(s,u)}function Gt(n,s){if(s===!0)return s;if(n.copyState)return n.copyState(s);var u={};for(var l in s){var c=s[l];c instanceof Array&&(c=c.concat([])),u[l]=c}return u}function gt(n,s){for(var u;n.innerMode&&(u=n.innerMode(s),!(!u||u.mode==n));)s=u.state,n=u.mode;return u||{mode:n,state:s}}function ni(n,s,u){return n.startState?n.startState(s,u):!0}var lt=function(n,s,u){this.pos=this.start=0,this.string=n,this.tabSize=s||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=u};lt.prototype.eol=function(){return this.pos>=this.string.length},lt.prototype.sol=function(){return this.pos==this.lineStart},lt.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},lt.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},lt.prototype.eat=function(n){var s=this.string.charAt(this.pos),u;if(typeof n=="string"?u=s==n:u=s&&(n.test?n.test(s):n(s)),u)return++this.pos,s},lt.prototype.eatWhile=function(n){for(var s=this.pos;this.eat(n););return this.pos>s},lt.prototype.eatSpace=function(){for(var n=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>n},lt.prototype.skipToEnd=function(){this.pos=this.string.length},lt.prototype.skipTo=function(n){var s=this.string.indexOf(n,this.pos);if(s>-1)return this.pos=s,!0},lt.prototype.backUp=function(n){this.pos-=n},lt.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ze(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?ze(this.string,this.lineStart,this.tabSize):0)},lt.prototype.indentation=function(){return ze(this.string,null,this.tabSize)-(this.lineStart?ze(this.string,this.lineStart,this.tabSize):0)},lt.prototype.match=function(n,s,u){if(typeof n=="string"){var l=function(v){return u?v.toLowerCase():v},c=this.string.substr(this.pos,n.length);if(l(c)==l(n))return s!==!1&&(this.pos+=n.length),!0}else{var m=this.string.slice(this.pos).match(n);return m&&m.index>0?null:(m&&s!==!1&&(this.pos+=m[0].length),m)}},lt.prototype.current=function(){return this.string.slice(this.start,this.pos)},lt.prototype.hideFirstChars=function(n,s){this.lineStart+=n;try{return s()}finally{this.lineStart-=n}},lt.prototype.lookAhead=function(n){var s=this.lineOracle;return s&&s.lookAhead(n)},lt.prototype.baseToken=function(){var n=this.lineOracle;return n&&n.baseToken(this.pos)};function Ue(n,s){if(s-=n.first,s<0||s>=n.size)throw new Error("There is no line "+(s+n.first)+" in the document.");for(var u=n;!u.lines;)for(var l=0;;++l){var c=u.children[l],m=c.chunkSize();if(s<m){u=c;break}s-=m}return u.lines[s]}function on(n,s,u){var l=[],c=s.line;return n.iter(s.line,u.line+1,function(m){var v=m.text;c==u.line&&(v=v.slice(0,u.ch)),c==s.line&&(v=v.slice(s.ch)),l.push(v),++c}),l}function Gn(n,s,u){var l=[];return n.iter(s,u,function(c){l.push(c.text)}),l}function zt(n,s){var u=s-n.height;if(u)for(var l=n;l;l=l.parent)l.height+=u}function nt(n){if(n.parent==null)return null;for(var s=n.parent,u=K(s.lines,n),l=s.parent;l;s=l,l=l.parent)for(var c=0;l.children[c]!=s;++c)u+=l.children[c].chunkSize();return u+s.first}function _n(n,s){var u=n.first;e:do{for(var l=0;l<n.children.length;++l){var c=n.children[l],m=c.height;if(s<m){n=c;continue e}s-=m,u+=c.chunkSize()}return u}while(!n.lines);for(var v=0;v<n.lines.length;++v){var b=n.lines[v],S=b.height;if(s<S)break;s-=S}return u+v}function Jt(n,s){return s>=n.first&&s<n.first+n.size}function da(n,s){return String(n.lineNumberFormatter(s+n.firstLineNumber))}function ge(n,s,u){if(u===void 0&&(u=null),!(this instanceof ge))return new ge(n,s,u);this.line=n,this.ch=s,this.sticky=u}function A(n,s){return n.line-s.line||n.ch-s.ch}function U(n,s){return n.sticky==s.sticky&&A(n,s)==0}function le(n){return ge(n.line,n.ch)}function _e(n,s){return A(n,s)<0?s:n}function at(n,s){return A(n,s)<0?n:s}function xt(n,s){return Math.max(n.first,Math.min(s,n.first+n.size-1))}function Be(n,s){if(s.line<n.first)return ge(n.first,0);var u=n.first+n.size-1;return s.line>u?ge(u,Ue(n,u).text.length):fn(s,Ue(n,s.line).text.length)}function fn(n,s){var u=n.ch;return u==null||u>s?ge(n.line,s):u<0?ge(n.line,0):n}function Vn(n,s){for(var u=[],l=0;l<s.length;l++)u[l]=Be(n,s[l]);return u}var es=function(n,s){this.state=n,this.lookAhead=s},fi=function(n,s,u,l){this.state=s,this.doc=n,this.line=u,this.maxLookAhead=l||0,this.baseTokens=null,this.baseTokenPos=1};fi.prototype.lookAhead=function(n){var s=this.doc.getLine(this.line+n);return s!=null&&n>this.maxLookAhead&&(this.maxLookAhead=n),s},fi.prototype.baseToken=function(n){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=n;)this.baseTokenPos+=2;var s=this.baseTokens[this.baseTokenPos+1];return{type:s&&s.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-n}},fi.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},fi.fromSaved=function(n,s,u){return s instanceof es?new fi(n,Gt(n.mode,s.state),u,s.lookAhead):new fi(n,Gt(n.mode,s),u)},fi.prototype.save=function(n){var s=n!==!1?Gt(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new es(s,this.maxLookAhead):s};function df(n,s,u,l){var c=[n.state.modeGen],m={};yf(n,s.text,n.doc.mode,u,function(E,I){return c.push(E,I)},m,l);for(var v=u.state,b=function(E){u.baseTokens=c;var I=n.state.overlays[E],B=1,j=0;u.state=!0,yf(n,s.text,I.mode,u,function(Z,ie){for(var he=B;j<Z;){var we=c[B];we>Z&&c.splice(B,1,Z,c[B+1],we),B+=2,j=Math.min(Z,we)}if(!!ie)if(I.opaque)c.splice(he,B-he,Z,"overlay "+ie),B=he+2;else for(;he<B;he+=2){var De=c[he+1];c[he+1]=(De?De+" ":"")+"overlay "+ie}},m),u.state=v,u.baseTokens=null,u.baseTokenPos=1},S=0;S<n.state.overlays.length;++S)b(S);return{styles:c,classes:m.bgClass||m.textClass?m:null}}function pf(n,s,u){if(!s.styles||s.styles[0]!=n.state.modeGen){var l=pa(n,nt(s)),c=s.text.length>n.options.maxHighlightLength&&Gt(n.doc.mode,l.state),m=df(n,s,l);c&&(l.state=c),s.stateAfter=l.save(!c),s.styles=m.styles,m.classes?s.styleClasses=m.classes:s.styleClasses&&(s.styleClasses=null),u===n.doc.highlightFrontier&&(n.doc.modeFrontier=Math.max(n.doc.modeFrontier,++n.doc.highlightFrontier))}return s.styles}function pa(n,s,u){var l=n.doc,c=n.display;if(!l.mode.startState)return new fi(l,!0,s);var m=o0(n,s,u),v=m>l.first&&Ue(l,m-1).stateAfter,b=v?fi.fromSaved(l,v,m):new fi(l,ni(l.mode),m);return l.iter(m,s,function(S){Lu(n,S.text,b);var E=b.line;S.stateAfter=E==s-1||E%5==0||E>=c.viewFrom&&E<c.viewTo?b.save():null,b.nextLine()}),u&&(l.modeFrontier=b.line),b}function Lu(n,s,u,l){var c=n.doc.mode,m=new lt(s,n.options.tabSize,u);for(m.start=m.pos=l||0,s==""&&mf(c,u.state);!m.eol();)Cu(c,m,u.state),m.start=m.pos}function mf(n,s){if(n.blankLine)return n.blankLine(s);if(!!n.innerMode){var u=gt(n,s);if(u.mode.blankLine)return u.mode.blankLine(u.state)}}function Cu(n,s,u,l){for(var c=0;c<10;c++){l&&(l[0]=gt(n,u).mode);var m=n.token(s,u);if(s.pos>s.start)return m}throw new Error("Mode "+n.name+" failed to advance stream.")}var gf=function(n,s,u){this.start=n.start,this.end=n.pos,this.string=n.current(),this.type=s||null,this.state=u};function vf(n,s,u,l){var c=n.doc,m=c.mode,v;s=Be(c,s);var b=Ue(c,s.line),S=pa(n,s.line,u),E=new lt(b.text,n.options.tabSize,S),I;for(l&&(I=[]);(l||E.pos<s.ch)&&!E.eol();)E.start=E.pos,v=Cu(m,E,S.state),l&&I.push(new gf(E,v,Gt(c.mode,S.state)));return l?I:new gf(E,v,S.state)}function xf(n,s){if(n)for(;;){var u=n.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!u)break;n=n.slice(0,u.index)+n.slice(u.index+u[0].length);var l=u[1]?"bgClass":"textClass";s[l]==null?s[l]=u[2]:new RegExp("(?:^|\\s)"+u[2]+"(?:$|\\s)").test(s[l])||(s[l]+=" "+u[2])}return n}function yf(n,s,u,l,c,m,v){var b=u.flattenSpans;b==null&&(b=n.options.flattenSpans);var S=0,E=null,I=new lt(s,n.options.tabSize,l),B,j=n.options.addModeClass&&[null];for(s==""&&xf(mf(u,l.state),m);!I.eol();){if(I.pos>n.options.maxHighlightLength?(b=!1,v&&Lu(n,s,l,I.pos),I.pos=s.length,B=null):B=xf(Cu(u,I,l.state,j),m),j){var Z=j[0].name;Z&&(B="m-"+(B?Z+" "+B:Z))}if(!b||E!=B){for(;S<I.start;)S=Math.min(I.start,S+5e3),c(S,E);E=B}I.start=I.pos}for(;S<I.pos;){var ie=Math.min(I.pos,S+5e3);c(ie,E),S=ie}}function o0(n,s,u){for(var l,c,m=n.doc,v=u?-1:s-(n.doc.mode.innerMode?1e3:100),b=s;b>v;--b){if(b<=m.first)return m.first;var S=Ue(m,b-1),E=S.stateAfter;if(E&&(!u||b+(E instanceof es?E.lookAhead:0)<=m.modeFrontier))return b;var I=ze(S.text,null,n.options.tabSize);(c==null||l>I)&&(c=b-1,l=I)}return c}function l0(n,s){if(n.modeFrontier=Math.min(n.modeFrontier,s),!(n.highlightFrontier<s-10)){for(var u=n.first,l=s-1;l>u;l--){var c=Ue(n,l).stateAfter;if(c&&(!(c instanceof es)||l+c.lookAhead<s)){u=l+1;break}}n.highlightFrontier=Math.min(n.highlightFrontier,u)}}var _f=!1,Ai=!1;function u0(){_f=!0}function c0(){Ai=!0}function Bo(n,s,u){this.marker=n,this.from=s,this.to=u}function ma(n,s){if(n)for(var u=0;u<n.length;++u){var l=n[u];if(l.marker==s)return l}}function h0(n,s){for(var u,l=0;l<n.length;++l)n[l]!=s&&(u||(u=[])).push(n[l]);return u}function f0(n,s,u){var l=u&&window.WeakSet&&(u.markedSpans||(u.markedSpans=new WeakSet));l&&l.has(n.markedSpans)?n.markedSpans.push(s):(n.markedSpans=n.markedSpans?n.markedSpans.concat([s]):[s],l&&l.add(n.markedSpans)),s.marker.attachLine(n)}function d0(n,s,u){var l;if(n)for(var c=0;c<n.length;++c){var m=n[c],v=m.marker,b=m.from==null||(v.inclusiveLeft?m.from<=s:m.from<s);if(b||m.from==s&&v.type=="bookmark"&&(!u||!m.marker.insertLeft)){var S=m.to==null||(v.inclusiveRight?m.to>=s:m.to>s);(l||(l=[])).push(new Bo(v,m.from,S?null:m.to))}}return l}function p0(n,s,u){var l;if(n)for(var c=0;c<n.length;++c){var m=n[c],v=m.marker,b=m.to==null||(v.inclusiveRight?m.to>=s:m.to>s);if(b||m.from==s&&v.type=="bookmark"&&(!u||m.marker.insertLeft)){var S=m.from==null||(v.inclusiveLeft?m.from<=s:m.from<s);(l||(l=[])).push(new Bo(v,S?null:m.from-s,m.to==null?null:m.to-s))}}return l}function Ru(n,s){if(s.full)return null;var u=Jt(n,s.from.line)&&Ue(n,s.from.line).markedSpans,l=Jt(n,s.to.line)&&Ue(n,s.to.line).markedSpans;if(!u&&!l)return null;var c=s.from.ch,m=s.to.ch,v=A(s.from,s.to)==0,b=d0(u,c,v),S=p0(l,m,v),E=s.text.length==1,I=me(s.text).length+(E?c:0);if(b)for(var B=0;B<b.length;++B){var j=b[B];if(j.to==null){var Z=ma(S,j.marker);Z?E&&(j.to=Z.to==null?null:Z.to+I):j.to=c}}if(S)for(var ie=0;ie<S.length;++ie){var he=S[ie];if(he.to!=null&&(he.to+=I),he.from==null){var we=ma(b,he.marker);we||(he.from=I,E&&(b||(b=[])).push(he))}else he.from+=I,E&&(b||(b=[])).push(he)}b&&(b=bf(b)),S&&S!=b&&(S=bf(S));var De=[b];if(!E){var Fe=s.text.length-2,Ie;if(Fe>0&&b)for(var Ge=0;Ge<b.length;++Ge)b[Ge].to==null&&(Ie||(Ie=[])).push(new Bo(b[Ge].marker,null,null));for(var Qe=0;Qe<Fe;++Qe)De.push(Ie);De.push(S)}return De}function bf(n){for(var s=0;s<n.length;++s){var u=n[s];u.from!=null&&u.from==u.to&&u.marker.clearWhenEmpty!==!1&&n.splice(s--,1)}return n.length?n:null}function m0(n,s,u){var l=null;if(n.iter(s.line,u.line+1,function(Z){if(Z.markedSpans)for(var ie=0;ie<Z.markedSpans.length;++ie){var he=Z.markedSpans[ie].marker;he.readOnly&&(!l||K(l,he)==-1)&&(l||(l=[])).push(he)}}),!l)return null;for(var c=[{from:s,to:u}],m=0;m<l.length;++m)for(var v=l[m],b=v.find(0),S=0;S<c.length;++S){var E=c[S];if(!(A(E.to,b.from)<0||A(E.from,b.to)>0)){var I=[S,1],B=A(E.from,b.from),j=A(E.to,b.to);(B<0||!v.inclusiveLeft&&!B)&&I.push({from:E.from,to:b.from}),(j>0||!v.inclusiveRight&&!j)&&I.push({from:b.to,to:E.to}),c.splice.apply(c,I),S+=I.length-3}}return c}function wf(n){var s=n.markedSpans;if(!!s){for(var u=0;u<s.length;++u)s[u].marker.detachLine(n);n.markedSpans=null}}function Mf(n,s){if(!!s){for(var u=0;u<s.length;++u)s[u].marker.attachLine(n);n.markedSpans=s}}function Ho(n){return n.inclusiveLeft?-1:0}function Uo(n){return n.inclusiveRight?1:0}function Pu(n,s){var u=n.lines.length-s.lines.length;if(u!=0)return u;var l=n.find(),c=s.find(),m=A(l.from,c.from)||Ho(n)-Ho(s);if(m)return-m;var v=A(l.to,c.to)||Uo(n)-Uo(s);return v||s.id-n.id}function Sf(n,s){var u=Ai&&n.markedSpans,l;if(u)for(var c=void 0,m=0;m<u.length;++m)c=u[m],c.marker.collapsed&&(s?c.from:c.to)==null&&(!l||Pu(l,c.marker)<0)&&(l=c.marker);return l}function Tf(n){return Sf(n,!0)}function Wo(n){return Sf(n,!1)}function g0(n,s){var u=Ai&&n.markedSpans,l;if(u)for(var c=0;c<u.length;++c){var m=u[c];m.marker.collapsed&&(m.from==null||m.from<s)&&(m.to==null||m.to>s)&&(!l||Pu(l,m.marker)<0)&&(l=m.marker)}return l}function Ef(n,s,u,l,c){var m=Ue(n,s),v=Ai&&m.markedSpans;if(v)for(var b=0;b<v.length;++b){var S=v[b];if(!!S.marker.collapsed){var E=S.marker.find(0),I=A(E.from,u)||Ho(S.marker)-Ho(c),B=A(E.to,l)||Uo(S.marker)-Uo(c);if(!(I>=0&&B<=0||I<=0&&B>=0)&&(I<=0&&(S.marker.inclusiveRight&&c.inclusiveLeft?A(E.to,u)>=0:A(E.to,u)>0)||I>=0&&(S.marker.inclusiveRight&&c.inclusiveLeft?A(E.from,l)<=0:A(E.from,l)<0)))return!0}}}function di(n){for(var s;s=Tf(n);)n=s.find(-1,!0).line;return n}function v0(n){for(var s;s=Wo(n);)n=s.find(1,!0).line;return n}function x0(n){for(var s,u;s=Wo(n);)n=s.find(1,!0).line,(u||(u=[])).push(n);return u}function Du(n,s){var u=Ue(n,s),l=di(u);return u==l?s:nt(l)}function Af(n,s){if(s>n.lastLine())return s;var u=Ue(n,s),l;if(!Vi(n,u))return s;for(;l=Wo(u);)u=l.find(1,!0).line;return nt(u)+1}function Vi(n,s){var u=Ai&&s.markedSpans;if(u){for(var l=void 0,c=0;c<u.length;++c)if(l=u[c],!!l.marker.collapsed){if(l.from==null)return!0;if(!l.marker.widgetNode&&l.from==0&&l.marker.inclusiveLeft&&Iu(n,s,l))return!0}}}function Iu(n,s,u){if(u.to==null){var l=u.marker.find(1,!0);return Iu(n,l.line,ma(l.line.markedSpans,u.marker))}if(u.marker.inclusiveRight&&u.to==s.text.length)return!0;for(var c=void 0,m=0;m<s.markedSpans.length;++m)if(c=s.markedSpans[m],c.marker.collapsed&&!c.marker.widgetNode&&c.from==u.to&&(c.to==null||c.to!=u.from)&&(c.marker.inclusiveLeft||u.marker.inclusiveRight)&&Iu(n,s,c))return!0}function Li(n){n=di(n);for(var s=0,u=n.parent,l=0;l<u.lines.length;++l){var c=u.lines[l];if(c==n)break;s+=c.height}for(var m=u.parent;m;u=m,m=u.parent)for(var v=0;v<m.children.length;++v){var b=m.children[v];if(b==u)break;s+=b.height}return s}function Go(n){if(n.height==0)return 0;for(var s=n.text.length,u,l=n;u=Tf(l);){var c=u.find(0,!0);l=c.from.line,s+=c.from.ch-c.to.ch}for(l=n;u=Wo(l);){var m=u.find(0,!0);s-=l.text.length-m.from.ch,l=m.to.line,s+=l.text.length-m.to.ch}return s}function ku(n){var s=n.display,u=n.doc;s.maxLine=Ue(u,u.first),s.maxLineLength=Go(s.maxLine),s.maxLineChanged=!0,u.iter(function(l){var c=Go(l);c>s.maxLineLength&&(s.maxLineLength=c,s.maxLine=l)})}var ts=function(n,s,u){this.text=n,Mf(this,s),this.height=u?u(this):1};ts.prototype.lineNo=function(){return nt(this)},Un(ts);function y0(n,s,u,l){n.text=s,n.stateAfter&&(n.stateAfter=null),n.styles&&(n.styles=null),n.order!=null&&(n.order=null),wf(n),Mf(n,u);var c=l?l(n):1;c!=n.height&&zt(n,c)}function _0(n){n.parent=null,wf(n)}var b0={},w0={};function Lf(n,s){if(!n||/^\s*$/.test(n))return null;var u=s.addModeClass?w0:b0;return u[n]||(u[n]=n.replace(/\S+/g,"cm-$&"))}function Cf(n,s){var u=D("span",null,null,g?"padding-right: .1px":null),l={pre:D("pre",[u],"CodeMirror-line"),content:u,col:0,pos:0,cm:n,trailingSpace:!1,splitSpaces:n.getOption("lineWrapping")};s.measure={};for(var c=0;c<=(s.rest?s.rest.length:0);c++){var m=c?s.rest[c-1]:s.line,v=void 0;l.pos=0,l.addToken=S0,jn(n.display.measure)&&(v=Te(m,n.doc.direction))&&(l.addToken=E0(l.addToken,v)),l.map=[];var b=s!=n.display.externalMeasured&&nt(m);A0(m,l,pf(n,m,b)),m.styleClasses&&(m.styleClasses.bgClass&&(l.bgClass=ce(m.styleClasses.bgClass,l.bgClass||"")),m.styleClasses.textClass&&(l.textClass=ce(m.styleClasses.textClass,l.textClass||""))),l.map.length==0&&l.map.push(0,0,l.content.appendChild($r(n.display.measure))),c==0?(s.measure.map=l.map,s.measure.cache={}):((s.measure.maps||(s.measure.maps=[])).push(l.map),(s.measure.caches||(s.measure.caches=[])).push({}))}if(g){var S=l.content.lastChild;(/\bcm-tab\b/.test(S.className)||S.querySelector&&S.querySelector(".cm-tab"))&&(l.content.className="cm-tab-wrap-hack")}return Ve(n,"renderLine",n,s.line,l.pre),l.pre.className&&(l.textClass=ce(l.pre.className,l.textClass||"")),l}function M0(n){var s=W("span","\u2022","cm-invalidchar");return s.title="\\u"+n.charCodeAt(0).toString(16),s.setAttribute("aria-label",s.title),s}function S0(n,s,u,l,c,m,v){if(!!s){var b=n.splitSpaces?T0(s,n.trailingSpace):s,S=n.cm.state.specialChars,E=!1,I;if(!S.test(s))n.col+=s.length,I=document.createTextNode(b),n.map.push(n.pos,n.pos+s.length,I),p&&d<9&&(E=!0),n.pos+=s.length;else{I=document.createDocumentFragment();for(var B=0;;){S.lastIndex=B;var j=S.exec(s),Z=j?j.index-B:s.length-B;if(Z){var ie=document.createTextNode(b.slice(B,B+Z));p&&d<9?I.appendChild(W("span",[ie])):I.appendChild(ie),n.map.push(n.pos,n.pos+Z,ie),n.col+=Z,n.pos+=Z}if(!j)break;B+=Z+1;var he=void 0;if(j[0]=="	"){var we=n.cm.options.tabSize,De=we-n.col%we;he=I.appendChild(W("span",Le(De),"cm-tab")),he.setAttribute("role","presentation"),he.setAttribute("cm-text","	"),n.col+=De}else j[0]=="\r"||j[0]==`
`?(he=I.appendChild(W("span",j[0]=="\r"?"\u240D":"\u2424","cm-invalidchar")),he.setAttribute("cm-text",j[0]),n.col+=1):(he=n.cm.options.specialCharPlaceholder(j[0]),he.setAttribute("cm-text",j[0]),p&&d<9?I.appendChild(W("span",[he])):I.appendChild(he),n.col+=1);n.map.push(n.pos,n.pos+1,he),n.pos++}}if(n.trailingSpace=b.charCodeAt(s.length-1)==32,u||l||c||E||m||v){var Fe=u||"";l&&(Fe+=l),c&&(Fe+=c);var Ie=W("span",[I],Fe,m);if(v)for(var Ge in v)v.hasOwnProperty(Ge)&&Ge!="style"&&Ge!="class"&&Ie.setAttribute(Ge,v[Ge]);return n.content.appendChild(Ie)}n.content.appendChild(I)}}function T0(n,s){if(n.length>1&&!/  /.test(n))return n;for(var u=s,l="",c=0;c<n.length;c++){var m=n.charAt(c);m==" "&&u&&(c==n.length-1||n.charCodeAt(c+1)==32)&&(m="\xA0"),l+=m,u=m==" "}return l}function E0(n,s){return function(u,l,c,m,v,b,S){c=c?c+" cm-force-border":"cm-force-border";for(var E=u.pos,I=E+l.length;;){for(var B=void 0,j=0;j<s.length&&(B=s[j],!(B.to>E&&B.from<=E));j++);if(B.to>=I)return n(u,l,c,m,v,b,S);n(u,l.slice(0,B.to-E),c,m,null,b,S),m=null,l=l.slice(B.to-E),E=B.to}}}function Rf(n,s,u,l){var c=!l&&u.widgetNode;c&&n.map.push(n.pos,n.pos+s,c),!l&&n.cm.display.input.needsContentAttribute&&(c||(c=n.content.appendChild(document.createElement("span"))),c.setAttribute("cm-marker",u.id)),c&&(n.cm.display.input.setUneditable(c),n.content.appendChild(c)),n.pos+=s,n.trailingSpace=!1}function A0(n,s,u){var l=n.markedSpans,c=n.text,m=0;if(!l){for(var v=1;v<u.length;v+=2)s.addToken(s,c.slice(m,m=u[v]),Lf(u[v+1],s.cm.options));return}for(var b=c.length,S=0,E=1,I="",B,j,Z=0,ie,he,we,De,Fe;;){if(Z==S){ie=he=we=j="",Fe=null,De=null,Z=1/0;for(var Ie=[],Ge=void 0,Qe=0;Qe<l.length;++Qe){var je=l[Qe],pt=je.marker;if(pt.type=="bookmark"&&je.from==S&&pt.widgetNode)Ie.push(pt);else if(je.from<=S&&(je.to==null||je.to>S||pt.collapsed&&je.to==S&&je.from==S)){if(je.to!=null&&je.to!=S&&Z>je.to&&(Z=je.to,he=""),pt.className&&(ie+=" "+pt.className),pt.css&&(j=(j?j+";":"")+pt.css),pt.startStyle&&je.from==S&&(we+=" "+pt.startStyle),pt.endStyle&&je.to==Z&&(Ge||(Ge=[])).push(pt.endStyle,je.to),pt.title&&((Fe||(Fe={})).title=pt.title),pt.attributes)for(var Lt in pt.attributes)(Fe||(Fe={}))[Lt]=pt.attributes[Lt];pt.collapsed&&(!De||Pu(De.marker,pt)<0)&&(De=je)}else je.from>S&&Z>je.from&&(Z=je.from)}if(Ge)for(var en=0;en<Ge.length;en+=2)Ge[en+1]==Z&&(he+=" "+Ge[en]);if(!De||De.from==S)for(var Nt=0;Nt<Ie.length;++Nt)Rf(s,0,Ie[Nt]);if(De&&(De.from||0)==S){if(Rf(s,(De.to==null?b+1:De.to)-S,De.marker,De.from==null),De.to==null)return;De.to==S&&(De=!1)}}if(S>=b)break;for(var Fn=Math.min(b,Z);;){if(I){var Rn=S+I.length;if(!De){var Vt=Rn>Fn?I.slice(0,Fn-S):I;s.addToken(s,Vt,B?B+ie:ie,we,S+Vt.length==Z?he:"",j,Fe)}if(Rn>=Fn){I=I.slice(Fn-S),S=Fn;break}S=Rn,we=""}I=c.slice(m,m=u[E++]),B=Lf(u[E++],s.cm.options)}}}function Pf(n,s,u){this.line=s,this.rest=x0(s),this.size=this.rest?nt(me(this.rest))-u+1:1,this.node=this.text=null,this.hidden=Vi(n,s)}function Vo(n,s,u){for(var l=[],c,m=s;m<u;m=c){var v=new Pf(n.doc,Ue(n.doc,m),m);c=m+v.size,l.push(v)}return l}var ns=null;function L0(n){ns?ns.ops.push(n):n.ownsGroup=ns={ops:[n],delayedCallbacks:[]}}function C0(n){var s=n.delayedCallbacks,u=0;do{for(;u<s.length;u++)s[u].call(null);for(var l=0;l<n.ops.length;l++){var c=n.ops[l];if(c.cursorActivityHandlers)for(;c.cursorActivityCalled<c.cursorActivityHandlers.length;)c.cursorActivityHandlers[c.cursorActivityCalled++].call(null,c.cm)}}while(u<s.length)}function R0(n,s){var u=n.ownsGroup;if(!!u)try{C0(u)}finally{ns=null,s(u)}}var ga=null;function Kt(n,s){var u=wt(n,s);if(!!u.length){var l=Array.prototype.slice.call(arguments,2),c;ns?c=ns.delayedCallbacks:ga?c=ga:(c=ga=[],setTimeout(P0,0));for(var m=function(b){c.push(function(){return u[b].apply(null,l)})},v=0;v<u.length;++v)m(v)}}function P0(){var n=ga;ga=null;for(var s=0;s<n.length;++s)n[s]()}function Df(n,s,u,l){for(var c=0;c<s.changes.length;c++){var m=s.changes[c];m=="text"?I0(n,s):m=="gutter"?kf(n,s,u,l):m=="class"?Nu(n,s):m=="widget"&&k0(n,s,l)}s.changes=null}function va(n){return n.node==n.text&&(n.node=W("div",null,null,"position: relative"),n.text.parentNode&&n.text.parentNode.replaceChild(n.node,n.text),n.node.appendChild(n.text),p&&d<8&&(n.node.style.zIndex=2)),n.node}function D0(n,s){var u=s.bgClass?s.bgClass+" "+(s.line.bgClass||""):s.line.bgClass;if(u&&(u+=" CodeMirror-linebackground"),s.background)u?s.background.className=u:(s.background.parentNode.removeChild(s.background),s.background=null);else if(u){var l=va(s);s.background=l.insertBefore(W("div",null,u),l.firstChild),n.display.input.setUneditable(s.background)}}function If(n,s){var u=n.display.externalMeasured;return u&&u.line==s.line?(n.display.externalMeasured=null,s.measure=u.measure,u.built):Cf(n,s)}function I0(n,s){var u=s.text.className,l=If(n,s);s.text==s.node&&(s.node=l.pre),s.text.parentNode.replaceChild(l.pre,s.text),s.text=l.pre,l.bgClass!=s.bgClass||l.textClass!=s.textClass?(s.bgClass=l.bgClass,s.textClass=l.textClass,Nu(n,s)):u&&(s.text.className=u)}function Nu(n,s){D0(n,s),s.line.wrapClass?va(s).className=s.line.wrapClass:s.node!=s.text&&(s.node.className="");var u=s.textClass?s.textClass+" "+(s.line.textClass||""):s.line.textClass;s.text.className=u||""}function kf(n,s,u,l){if(s.gutter&&(s.node.removeChild(s.gutter),s.gutter=null),s.gutterBackground&&(s.node.removeChild(s.gutterBackground),s.gutterBackground=null),s.line.gutterClass){var c=va(s);s.gutterBackground=W("div",null,"CodeMirror-gutter-background "+s.line.gutterClass,"left: "+(n.options.fixedGutter?l.fixedPos:-l.gutterTotalWidth)+"px; width: "+l.gutterTotalWidth+"px"),n.display.input.setUneditable(s.gutterBackground),c.insertBefore(s.gutterBackground,s.text)}var m=s.line.gutterMarkers;if(n.options.lineNumbers||m){var v=va(s),b=s.gutter=W("div",null,"CodeMirror-gutter-wrapper","left: "+(n.options.fixedGutter?l.fixedPos:-l.gutterTotalWidth)+"px");if(b.setAttribute("aria-hidden","true"),n.display.input.setUneditable(b),v.insertBefore(b,s.text),s.line.gutterClass&&(b.className+=" "+s.line.gutterClass),n.options.lineNumbers&&(!m||!m["CodeMirror-linenumbers"])&&(s.lineNumber=b.appendChild(W("div",da(n.options,u),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+l.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+n.display.lineNumInnerWidth+"px"))),m)for(var S=0;S<n.display.gutterSpecs.length;++S){var E=n.display.gutterSpecs[S].className,I=m.hasOwnProperty(E)&&m[E];I&&b.appendChild(W("div",[I],"CodeMirror-gutter-elt","left: "+l.gutterLeft[E]+"px; width: "+l.gutterWidth[E]+"px"))}}}function k0(n,s,u){s.alignable&&(s.alignable=null);for(var l=Q("CodeMirror-linewidget"),c=s.node.firstChild,m=void 0;c;c=m)m=c.nextSibling,l.test(c.className)&&s.node.removeChild(c);Nf(n,s,u)}function N0(n,s,u,l){var c=If(n,s);return s.text=s.node=c.pre,c.bgClass&&(s.bgClass=c.bgClass),c.textClass&&(s.textClass=c.textClass),Nu(n,s),kf(n,s,u,l),Nf(n,s,l),s.node}function Nf(n,s,u){if(Ff(n,s.line,s,u,!0),s.rest)for(var l=0;l<s.rest.length;l++)Ff(n,s.rest[l],s,u,!1)}function Ff(n,s,u,l,c){if(!!s.widgets)for(var m=va(u),v=0,b=s.widgets;v<b.length;++v){var S=b[v],E=W("div",[S.node],"CodeMirror-linewidget"+(S.className?" "+S.className:""));S.handleMouseEvents||E.setAttribute("cm-ignore-events","true"),F0(S,E,u,l),n.display.input.setUneditable(E),c&&S.above?m.insertBefore(E,u.gutter||u.text):m.appendChild(E),Kt(S,"redraw")}}function F0(n,s,u,l){if(n.noHScroll){(u.alignable||(u.alignable=[])).push(s);var c=l.wrapperWidth;s.style.left=l.fixedPos+"px",n.coverGutter||(c-=l.gutterTotalWidth,s.style.paddingLeft=l.gutterTotalWidth+"px"),s.style.width=c+"px"}n.coverGutter&&(s.style.zIndex=5,s.style.position="relative",n.noHScroll||(s.style.marginLeft=-l.gutterTotalWidth+"px"))}function xa(n){if(n.height!=null)return n.height;var s=n.doc.cm;if(!s)return 0;if(!te(document.body,n.node)){var u="position: relative;";n.coverGutter&&(u+="margin-left: -"+s.display.gutters.offsetWidth+"px;"),n.noHScroll&&(u+="width: "+s.display.wrapper.clientWidth+"px;"),H(s.display.measure,W("div",[n.node],null,u))}return n.height=n.node.parentNode.offsetHeight}function Ci(n,s){for(var u=Wn(s);u!=n.wrapper;u=u.parentNode)if(!u||u.nodeType==1&&u.getAttribute("cm-ignore-events")=="true"||u.parentNode==n.sizer&&u!=n.mover)return!0}function Xo(n){return n.lineSpace.offsetTop}function Fu(n){return n.mover.offsetHeight-n.lineSpace.offsetHeight}function Of(n){if(n.cachedPaddingH)return n.cachedPaddingH;var s=H(n.measure,W("pre","x","CodeMirror-line-like")),u=window.getComputedStyle?window.getComputedStyle(s):s.currentStyle,l={left:parseInt(u.paddingLeft),right:parseInt(u.paddingRight)};return!isNaN(l.left)&&!isNaN(l.right)&&(n.cachedPaddingH=l),l}function pi(n){return Ae-n.display.nativeBarWidth}function Tr(n){return n.display.scroller.clientWidth-pi(n)-n.display.barWidth}function Ou(n){return n.display.scroller.clientHeight-pi(n)-n.display.barHeight}function O0(n,s,u){var l=n.options.lineWrapping,c=l&&Tr(n);if(!s.measure.heights||l&&s.measure.width!=c){var m=s.measure.heights=[];if(l){s.measure.width=c;for(var v=s.text.firstChild.getClientRects(),b=0;b<v.length-1;b++){var S=v[b],E=v[b+1];Math.abs(S.bottom-E.bottom)>2&&m.push((S.bottom+E.top)/2-u.top)}}m.push(u.bottom-u.top)}}function zf(n,s,u){if(n.line==s)return{map:n.measure.map,cache:n.measure.cache};if(n.rest){for(var l=0;l<n.rest.length;l++)if(n.rest[l]==s)return{map:n.measure.maps[l],cache:n.measure.caches[l]};for(var c=0;c<n.rest.length;c++)if(nt(n.rest[c])>u)return{map:n.measure.maps[c],cache:n.measure.caches[c],before:!0}}}function z0(n,s){s=di(s);var u=nt(s),l=n.display.externalMeasured=new Pf(n.doc,s,u);l.lineN=u;var c=l.built=Cf(n,l);return l.text=c.pre,H(n.display.lineMeasure,c.pre),l}function Bf(n,s,u,l){return mi(n,is(n,s),u,l)}function zu(n,s){if(s>=n.display.viewFrom&&s<n.display.viewTo)return n.display.view[Lr(n,s)];var u=n.display.externalMeasured;if(u&&s>=u.lineN&&s<u.lineN+u.size)return u}function is(n,s){var u=nt(s),l=zu(n,u);l&&!l.text?l=null:l&&l.changes&&(Df(n,l,u,Gu(n)),n.curOp.forceUpdate=!0),l||(l=z0(n,s));var c=zf(l,s,u);return{line:s,view:l,rect:null,map:c.map,cache:c.cache,before:c.before,hasHeights:!1}}function mi(n,s,u,l,c){s.before&&(u=-1);var m=u+(l||""),v;return s.cache.hasOwnProperty(m)?v=s.cache[m]:(s.rect||(s.rect=s.view.text.getBoundingClientRect()),s.hasHeights||(O0(n,s.view,s.rect),s.hasHeights=!0),v=H0(n,s,u,l),v.bogus||(s.cache[m]=v)),{left:v.left,right:v.right,top:c?v.rtop:v.top,bottom:c?v.rbottom:v.bottom}}var Hf={left:0,right:0,top:0,bottom:0};function Uf(n,s,u){for(var l,c,m,v,b,S,E=0;E<n.length;E+=3)if(b=n[E],S=n[E+1],s<b?(c=0,m=1,v="left"):s<S?(c=s-b,m=c+1):(E==n.length-3||s==S&&n[E+3]>s)&&(m=S-b,c=m-1,s>=S&&(v="right")),c!=null){if(l=n[E+2],b==S&&u==(l.insertLeft?"left":"right")&&(v=u),u=="left"&&c==0)for(;E&&n[E-2]==n[E-3]&&n[E-1].insertLeft;)l=n[(E-=3)+2],v="left";if(u=="right"&&c==S-b)for(;E<n.length-3&&n[E+3]==n[E+4]&&!n[E+5].insertLeft;)l=n[(E+=3)+2],v="right";break}return{node:l,start:c,end:m,collapse:v,coverStart:b,coverEnd:S}}function B0(n,s){var u=Hf;if(s=="left")for(var l=0;l<n.length&&(u=n[l]).left==u.right;l++);else for(var c=n.length-1;c>=0&&(u=n[c]).left==u.right;c--);return u}function H0(n,s,u,l){var c=Uf(s.map,u,l),m=c.node,v=c.start,b=c.end,S=c.collapse,E;if(m.nodeType==3){for(var I=0;I<4;I++){for(;v&&qe(s.line.text.charAt(c.coverStart+v));)--v;for(;c.coverStart+b<c.coverEnd&&qe(s.line.text.charAt(c.coverStart+b));)++b;if(p&&d<9&&v==0&&b==c.coverEnd-c.coverStart?E=m.parentNode.getBoundingClientRect():E=B0(ee(m,v,b).getClientRects(),l),E.left||E.right||v==0)break;b=v,v=v-1,S="right"}p&&d<11&&(E=U0(n.display.measure,E))}else{v>0&&(S=l="right");var B;n.options.lineWrapping&&(B=m.getClientRects()).length>1?E=B[l=="right"?B.length-1:0]:E=m.getBoundingClientRect()}if(p&&d<9&&!v&&(!E||!E.left&&!E.right)){var j=m.parentNode.getClientRects()[0];j?E={left:j.left,right:j.left+ss(n.display),top:j.top,bottom:j.bottom}:E=Hf}for(var Z=E.top-s.rect.top,ie=E.bottom-s.rect.top,he=(Z+ie)/2,we=s.view.measure.heights,De=0;De<we.length-1&&!(he<we[De]);De++);var Fe=De?we[De-1]:0,Ie=we[De],Ge={left:(S=="right"?E.right:E.left)-s.rect.left,right:(S=="left"?E.left:E.right)-s.rect.left,top:Fe,bottom:Ie};return!E.left&&!E.right&&(Ge.bogus=!0),n.options.singleCursorHeightPerLine||(Ge.rtop=Z,Ge.rbottom=ie),Ge}function U0(n,s){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!fe(n))return s;var u=screen.logicalXDPI/screen.deviceXDPI,l=screen.logicalYDPI/screen.deviceYDPI;return{left:s.left*u,right:s.right*u,top:s.top*l,bottom:s.bottom*l}}function Wf(n){if(n.measure&&(n.measure.cache={},n.measure.heights=null,n.rest))for(var s=0;s<n.rest.length;s++)n.measure.caches[s]={}}function Gf(n){n.display.externalMeasure=null,Se(n.display.lineMeasure);for(var s=0;s<n.display.view.length;s++)Wf(n.display.view[s])}function ya(n){Gf(n),n.display.cachedCharWidth=n.display.cachedTextHeight=n.display.cachedPaddingH=null,n.options.lineWrapping||(n.display.maxLineChanged=!0),n.display.lineNumChars=null}function Vf(){return x&&w?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Xf(){return x&&w?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function Bu(n){var s=0;if(n.widgets)for(var u=0;u<n.widgets.length;++u)n.widgets[u].above&&(s+=xa(n.widgets[u]));return s}function Zo(n,s,u,l,c){if(!c){var m=Bu(s);u.top+=m,u.bottom+=m}if(l=="line")return u;l||(l="local");var v=Li(s);if(l=="local"?v+=Xo(n.display):v-=n.display.viewOffset,l=="page"||l=="window"){var b=n.display.lineSpace.getBoundingClientRect();v+=b.top+(l=="window"?0:Xf());var S=b.left+(l=="window"?0:Vf());u.left+=S,u.right+=S}return u.top+=v,u.bottom+=v,u}function Zf(n,s,u){if(u=="div")return s;var l=s.left,c=s.top;if(u=="page")l-=Vf(),c-=Xf();else if(u=="local"||!u){var m=n.display.sizer.getBoundingClientRect();l+=m.left,c+=m.top}var v=n.display.lineSpace.getBoundingClientRect();return{left:l-v.left,top:c-v.top}}function qo(n,s,u,l,c){return l||(l=Ue(n.doc,s.line)),Zo(n,l,Bf(n,l,s.ch,c),u)}function ii(n,s,u,l,c,m){l=l||Ue(n.doc,s.line),c||(c=is(n,l));function v(ie,he){var we=mi(n,c,ie,he?"right":"left",m);return he?we.left=we.right:we.right=we.left,Zo(n,l,we,u)}var b=Te(l,n.doc.direction),S=s.ch,E=s.sticky;if(S>=l.text.length?(S=l.text.length,E="before"):S<=0&&(S=0,E="after"),!b)return v(E=="before"?S-1:S,E=="before");function I(ie,he,we){var De=b[he],Fe=De.level==1;return v(we?ie-1:ie,Fe!=we)}var B=ne(b,S,E),j=z,Z=I(S,B,E=="before");return j!=null&&(Z.other=I(S,j,E!="before")),Z}function qf(n,s){var u=0;s=Be(n.doc,s),n.options.lineWrapping||(u=ss(n.display)*s.ch);var l=Ue(n.doc,s.line),c=Li(l)+Xo(n.display);return{left:u,right:u,top:c,bottom:c+l.height}}function Hu(n,s,u,l,c){var m=ge(n,s,u);return m.xRel=c,l&&(m.outside=l),m}function Uu(n,s,u){var l=n.doc;if(u+=n.display.viewOffset,u<0)return Hu(l.first,0,null,-1,-1);var c=_n(l,u),m=l.first+l.size-1;if(c>m)return Hu(l.first+l.size-1,Ue(l,m).text.length,null,1,1);s<0&&(s=0);for(var v=Ue(l,c);;){var b=W0(n,v,c,s,u),S=g0(v,b.ch+(b.xRel>0||b.outside>0?1:0));if(!S)return b;var E=S.find(1);if(E.line==c)return E;v=Ue(l,c=E.line)}}function Yf(n,s,u,l){l-=Bu(s);var c=s.text.length,m=Y(function(v){return mi(n,u,v-1).bottom<=l},c,0);return c=Y(function(v){return mi(n,u,v).top>l},m,c),{begin:m,end:c}}function jf(n,s,u,l){u||(u=is(n,s));var c=Zo(n,s,mi(n,u,l),"line").top;return Yf(n,s,u,c)}function Wu(n,s,u,l){return n.bottom<=u?!1:n.top>u?!0:(l?n.left:n.right)>s}function W0(n,s,u,l,c){c-=Li(s);var m=is(n,s),v=Bu(s),b=0,S=s.text.length,E=!0,I=Te(s,n.doc.direction);if(I){var B=(n.options.lineWrapping?V0:G0)(n,s,u,m,I,l,c);E=B.level!=1,b=E?B.from:B.to-1,S=E?B.to:B.from-1}var j=null,Z=null,ie=Y(function(Qe){var je=mi(n,m,Qe);return je.top+=v,je.bottom+=v,Wu(je,l,c,!1)?(je.top<=c&&je.left<=l&&(j=Qe,Z=je),!0):!1},b,S),he,we,De=!1;if(Z){var Fe=l-Z.left<Z.right-l,Ie=Fe==E;ie=j+(Ie?0:1),we=Ie?"after":"before",he=Fe?Z.left:Z.right}else{!E&&(ie==S||ie==b)&&ie++,we=ie==0?"after":ie==s.text.length?"before":mi(n,m,ie-(E?1:0)).bottom+v<=c==E?"after":"before";var Ge=ii(n,ge(u,ie,we),"line",s,m);he=Ge.left,De=c<Ge.top?-1:c>=Ge.bottom?1:0}return ie=Xe(s.text,ie,1),Hu(u,ie,we,De,l-he)}function G0(n,s,u,l,c,m,v){var b=Y(function(B){var j=c[B],Z=j.level!=1;return Wu(ii(n,ge(u,Z?j.to:j.from,Z?"before":"after"),"line",s,l),m,v,!0)},0,c.length-1),S=c[b];if(b>0){var E=S.level!=1,I=ii(n,ge(u,E?S.from:S.to,E?"after":"before"),"line",s,l);Wu(I,m,v,!0)&&I.top>v&&(S=c[b-1])}return S}function V0(n,s,u,l,c,m,v){var b=Yf(n,s,l,v),S=b.begin,E=b.end;/\s/.test(s.text.charAt(E-1))&&E--;for(var I=null,B=null,j=0;j<c.length;j++){var Z=c[j];if(!(Z.from>=E||Z.to<=S)){var ie=Z.level!=1,he=mi(n,l,ie?Math.min(E,Z.to)-1:Math.max(S,Z.from)).right,we=he<m?m-he+1e9:he-m;(!I||B>we)&&(I=Z,B=we)}}return I||(I=c[c.length-1]),I.from<S&&(I={from:S,to:I.to,level:I.level}),I.to>E&&(I={from:I.from,to:E,level:I.level}),I}var Er;function rs(n){if(n.cachedTextHeight!=null)return n.cachedTextHeight;if(Er==null){Er=W("pre",null,"CodeMirror-line-like");for(var s=0;s<49;++s)Er.appendChild(document.createTextNode("x")),Er.appendChild(W("br"));Er.appendChild(document.createTextNode("x"))}H(n.measure,Er);var u=Er.offsetHeight/50;return u>3&&(n.cachedTextHeight=u),Se(n.measure),u||1}function ss(n){if(n.cachedCharWidth!=null)return n.cachedCharWidth;var s=W("span","xxxxxxxxxx"),u=W("pre",[s],"CodeMirror-line-like");H(n.measure,u);var l=s.getBoundingClientRect(),c=(l.right-l.left)/10;return c>2&&(n.cachedCharWidth=c),c||10}function Gu(n){for(var s=n.display,u={},l={},c=s.gutters.clientLeft,m=s.gutters.firstChild,v=0;m;m=m.nextSibling,++v){var b=n.display.gutterSpecs[v].className;u[b]=m.offsetLeft+m.clientLeft+c,l[b]=m.clientWidth}return{fixedPos:Vu(s),gutterTotalWidth:s.gutters.offsetWidth,gutterLeft:u,gutterWidth:l,wrapperWidth:s.wrapper.clientWidth}}function Vu(n){return n.scroller.getBoundingClientRect().left-n.sizer.getBoundingClientRect().left}function Jf(n){var s=rs(n.display),u=n.options.lineWrapping,l=u&&Math.max(5,n.display.scroller.clientWidth/ss(n.display)-3);return function(c){if(Vi(n.doc,c))return 0;var m=0;if(c.widgets)for(var v=0;v<c.widgets.length;v++)c.widgets[v].height&&(m+=c.widgets[v].height);return u?m+(Math.ceil(c.text.length/l)||1)*s:m+s}}function Xu(n){var s=n.doc,u=Jf(n);s.iter(function(l){var c=u(l);c!=l.height&&zt(l,c)})}function Ar(n,s,u,l){var c=n.display;if(!u&&Wn(s).getAttribute("cm-not-content")=="true")return null;var m,v,b=c.lineSpace.getBoundingClientRect();try{m=s.clientX-b.left,v=s.clientY-b.top}catch{return null}var S=Uu(n,m,v),E;if(l&&S.xRel>0&&(E=Ue(n.doc,S.line).text).length==S.ch){var I=ze(E,E.length,n.options.tabSize)-E.length;S=ge(S.line,Math.max(0,Math.round((m-Of(n.display).left)/ss(n.display))-I))}return S}function Lr(n,s){if(s>=n.display.viewTo||(s-=n.display.viewFrom,s<0))return null;for(var u=n.display.view,l=0;l<u.length;l++)if(s-=u[l].size,s<0)return l}function Ln(n,s,u,l){s==null&&(s=n.doc.first),u==null&&(u=n.doc.first+n.doc.size),l||(l=0);var c=n.display;if(l&&u<c.viewTo&&(c.updateLineNumbers==null||c.updateLineNumbers>s)&&(c.updateLineNumbers=s),n.curOp.viewChanged=!0,s>=c.viewTo)Ai&&Du(n.doc,s)<c.viewTo&&Zi(n);else if(u<=c.viewFrom)Ai&&Af(n.doc,u+l)>c.viewFrom?Zi(n):(c.viewFrom+=l,c.viewTo+=l);else if(s<=c.viewFrom&&u>=c.viewTo)Zi(n);else if(s<=c.viewFrom){var m=Yo(n,u,u+l,1);m?(c.view=c.view.slice(m.index),c.viewFrom=m.lineN,c.viewTo+=l):Zi(n)}else if(u>=c.viewTo){var v=Yo(n,s,s,-1);v?(c.view=c.view.slice(0,v.index),c.viewTo=v.lineN):Zi(n)}else{var b=Yo(n,s,s,-1),S=Yo(n,u,u+l,1);b&&S?(c.view=c.view.slice(0,b.index).concat(Vo(n,b.lineN,S.lineN)).concat(c.view.slice(S.index)),c.viewTo+=l):Zi(n)}var E=c.externalMeasured;E&&(u<E.lineN?E.lineN+=l:s<E.lineN+E.size&&(c.externalMeasured=null))}function Xi(n,s,u){n.curOp.viewChanged=!0;var l=n.display,c=n.display.externalMeasured;if(c&&s>=c.lineN&&s<c.lineN+c.size&&(l.externalMeasured=null),!(s<l.viewFrom||s>=l.viewTo)){var m=l.view[Lr(n,s)];if(m.node!=null){var v=m.changes||(m.changes=[]);K(v,u)==-1&&v.push(u)}}}function Zi(n){n.display.viewFrom=n.display.viewTo=n.doc.first,n.display.view=[],n.display.viewOffset=0}function Yo(n,s,u,l){var c=Lr(n,s),m,v=n.display.view;if(!Ai||u==n.doc.first+n.doc.size)return{index:c,lineN:u};for(var b=n.display.viewFrom,S=0;S<c;S++)b+=v[S].size;if(b!=s){if(l>0){if(c==v.length-1)return null;m=b+v[c].size-s,c++}else m=b-s;s+=m,u+=m}for(;Du(n.doc,u)!=u;){if(c==(l<0?0:v.length-1))return null;u+=l*v[c-(l<0?1:0)].size,c+=l}return{index:c,lineN:u}}function X0(n,s,u){var l=n.display,c=l.view;c.length==0||s>=l.viewTo||u<=l.viewFrom?(l.view=Vo(n,s,u),l.viewFrom=s):(l.viewFrom>s?l.view=Vo(n,s,l.viewFrom).concat(l.view):l.viewFrom<s&&(l.view=l.view.slice(Lr(n,s))),l.viewFrom=s,l.viewTo<u?l.view=l.view.concat(Vo(n,l.viewTo,u)):l.viewTo>u&&(l.view=l.view.slice(0,Lr(n,u)))),l.viewTo=u}function Kf(n){for(var s=n.display.view,u=0,l=0;l<s.length;l++){var c=s[l];!c.hidden&&(!c.node||c.changes)&&++u}return u}function _a(n){n.display.input.showSelection(n.display.input.prepareSelection())}function Qf(n,s){s===void 0&&(s=!0);var u=n.doc,l={},c=l.cursors=document.createDocumentFragment(),m=l.selection=document.createDocumentFragment(),v=n.options.$customCursor;v&&(s=!0);for(var b=0;b<u.sel.ranges.length;b++)if(!(!s&&b==u.sel.primIndex)){var S=u.sel.ranges[b];if(!(S.from().line>=n.display.viewTo||S.to().line<n.display.viewFrom)){var E=S.empty();if(v){var I=v(n,S);I&&Zu(n,I,c)}else(E||n.options.showCursorWhenSelecting)&&Zu(n,S.head,c);E||Z0(n,S,m)}}return l}function Zu(n,s,u){var l=ii(n,s,"div",null,null,!n.options.singleCursorHeightPerLine),c=u.appendChild(W("div","\xA0","CodeMirror-cursor"));if(c.style.left=l.left+"px",c.style.top=l.top+"px",c.style.height=Math.max(0,l.bottom-l.top)*n.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(n.getWrapperElement().className)){var m=qo(n,s,"div",null,null),v=m.right-m.left;c.style.width=(v>0?v:n.defaultCharWidth())+"px"}if(l.other){var b=u.appendChild(W("div","\xA0","CodeMirror-cursor CodeMirror-secondarycursor"));b.style.display="",b.style.left=l.other.left+"px",b.style.top=l.other.top+"px",b.style.height=(l.other.bottom-l.other.top)*.85+"px"}}function jo(n,s){return n.top-s.top||n.left-s.left}function Z0(n,s,u){var l=n.display,c=n.doc,m=document.createDocumentFragment(),v=Of(n.display),b=v.left,S=Math.max(l.sizerWidth,Tr(n)-l.sizer.offsetLeft)-v.right,E=c.direction=="ltr";function I(Ie,Ge,Qe,je){Ge<0&&(Ge=0),Ge=Math.round(Ge),je=Math.round(je),m.appendChild(W("div",null,"CodeMirror-selected","position: absolute; left: "+Ie+`px;
                             top: `+Ge+"px; width: "+(Qe==null?S-Ie:Qe)+`px;
                             height: `+(je-Ge)+"px"))}function B(Ie,Ge,Qe){var je=Ue(c,Ie),pt=je.text.length,Lt,en;function Nt(Vt,Pn){return qo(n,ge(Ie,Vt),"div",je,Pn)}function Fn(Vt,Pn,ln){var qt=jf(n,je,null,Vt),Xt=Pn=="ltr"==(ln=="after")?"left":"right",Bt=ln=="after"?qt.begin:qt.end-(/\s/.test(je.text.charAt(qt.end-1))?2:1);return Nt(Bt,Xt)[Xt]}var Rn=Te(je,c.direction);return ke(Rn,Ge||0,Qe==null?pt:Qe,function(Vt,Pn,ln,qt){var Xt=ln=="ltr",Bt=Nt(Vt,Xt?"left":"right"),Dn=Nt(Pn-1,Xt?"right":"left"),xs=Ge==null&&Vt==0,Qi=Qe==null&&Pn==pt,pn=qt==0,gi=!Rn||qt==Rn.length-1;if(Dn.top-Bt.top<=3){var tn=(E?xs:Qi)&&pn,xc=(E?Qi:xs)&&gi,Di=tn?b:(Xt?Bt:Dn).left,Ir=xc?S:(Xt?Dn:Bt).right;I(Di,Bt.top,Ir-Di,Bt.bottom)}else{var kr,wn,ys,yc;Xt?(kr=E&&xs&&pn?b:Bt.left,wn=E?S:Fn(Vt,ln,"before"),ys=E?b:Fn(Pn,ln,"after"),yc=E&&Qi&&gi?S:Dn.right):(kr=E?Fn(Vt,ln,"before"):b,wn=!E&&xs&&pn?S:Bt.right,ys=!E&&Qi&&gi?b:Dn.left,yc=E?Fn(Pn,ln,"after"):S),I(kr,Bt.top,wn-kr,Bt.bottom),Bt.bottom<Dn.top&&I(b,Bt.bottom,null,Dn.top),I(ys,Dn.top,yc-ys,Dn.bottom)}(!Lt||jo(Bt,Lt)<0)&&(Lt=Bt),jo(Dn,Lt)<0&&(Lt=Dn),(!en||jo(Bt,en)<0)&&(en=Bt),jo(Dn,en)<0&&(en=Dn)}),{start:Lt,end:en}}var j=s.from(),Z=s.to();if(j.line==Z.line)B(j.line,j.ch,Z.ch);else{var ie=Ue(c,j.line),he=Ue(c,Z.line),we=di(ie)==di(he),De=B(j.line,j.ch,we?ie.text.length+1:null).end,Fe=B(Z.line,we?0:null,Z.ch).start;we&&(De.top<Fe.top-2?(I(De.right,De.top,null,De.bottom),I(b,Fe.top,Fe.left,Fe.bottom)):I(De.right,De.top,Fe.left-De.right,De.bottom)),De.bottom<Fe.top&&I(b,De.bottom,null,Fe.top)}u.appendChild(m)}function qu(n){if(!!n.state.focused){var s=n.display;clearInterval(s.blinker);var u=!0;s.cursorDiv.style.visibility="",n.options.cursorBlinkRate>0?s.blinker=setInterval(function(){n.hasFocus()||as(n),s.cursorDiv.style.visibility=(u=!u)?"":"hidden"},n.options.cursorBlinkRate):n.options.cursorBlinkRate<0&&(s.cursorDiv.style.visibility="hidden")}}function $f(n){n.hasFocus()||(n.display.input.focus(),n.state.focused||ju(n))}function Yu(n){n.state.delayingBlurEvent=!0,setTimeout(function(){n.state.delayingBlurEvent&&(n.state.delayingBlurEvent=!1,n.state.focused&&as(n))},100)}function ju(n,s){n.state.delayingBlurEvent&&!n.state.draggingText&&(n.state.delayingBlurEvent=!1),n.options.readOnly!="nocursor"&&(n.state.focused||(Ve(n,"focus",n,s),n.state.focused=!0,Oe(n.display.wrapper,"CodeMirror-focused"),!n.curOp&&n.display.selForContextMenu!=n.doc.sel&&(n.display.input.reset(),g&&setTimeout(function(){return n.display.input.reset(!0)},20)),n.display.input.receivedFocus()),qu(n))}function as(n,s){n.state.delayingBlurEvent||(n.state.focused&&(Ve(n,"blur",n,s),n.state.focused=!1,X(n.display.wrapper,"CodeMirror-focused")),clearInterval(n.display.blinker),setTimeout(function(){n.state.focused||(n.display.shift=!1)},150))}function Jo(n){for(var s=n.display,u=s.lineDiv.offsetTop,l=Math.max(0,s.scroller.getBoundingClientRect().top),c=s.lineDiv.getBoundingClientRect().top,m=0,v=0;v<s.view.length;v++){var b=s.view[v],S=n.options.lineWrapping,E=void 0,I=0;if(!b.hidden){if(c+=b.line.height,p&&d<8){var B=b.node.offsetTop+b.node.offsetHeight;E=B-u,u=B}else{var j=b.node.getBoundingClientRect();E=j.bottom-j.top,!S&&b.text.firstChild&&(I=b.text.firstChild.getBoundingClientRect().right-j.left-1)}var Z=b.line.height-E;if((Z>.005||Z<-.005)&&(c<l&&(m-=Z),zt(b.line,E),ed(b.line),b.rest))for(var ie=0;ie<b.rest.length;ie++)ed(b.rest[ie]);if(I>n.display.sizerWidth){var he=Math.ceil(I/ss(n.display));he>n.display.maxLineLength&&(n.display.maxLineLength=he,n.display.maxLine=b.line,n.display.maxLineChanged=!0)}}}Math.abs(m)>2&&(s.scroller.scrollTop+=m)}function ed(n){if(n.widgets)for(var s=0;s<n.widgets.length;++s){var u=n.widgets[s],l=u.node.parentNode;l&&(u.height=l.offsetHeight)}}function Ko(n,s,u){var l=u&&u.top!=null?Math.max(0,u.top):n.scroller.scrollTop;l=Math.floor(l-Xo(n));var c=u&&u.bottom!=null?u.bottom:l+n.wrapper.clientHeight,m=_n(s,l),v=_n(s,c);if(u&&u.ensure){var b=u.ensure.from.line,S=u.ensure.to.line;b<m?(m=b,v=_n(s,Li(Ue(s,b))+n.wrapper.clientHeight)):Math.min(S,s.lastLine())>=v&&(m=_n(s,Li(Ue(s,S))-n.wrapper.clientHeight),v=S)}return{from:m,to:Math.max(v,m+1)}}function q0(n,s){if(!ft(n,"scrollCursorIntoView")){var u=n.display,l=u.sizer.getBoundingClientRect(),c=null;if(s.top+l.top<0?c=!0:s.bottom+l.top>(window.innerHeight||document.documentElement.clientHeight)&&(c=!1),c!=null&&!P){var m=W("div","\u200B",null,`position: absolute;
                         top: `+(s.top-u.viewOffset-Xo(n.display))+`px;
                         height: `+(s.bottom-s.top+pi(n)+u.barHeight)+`px;
                         left: `+s.left+"px; width: "+Math.max(2,s.right-s.left)+"px;");n.display.lineSpace.appendChild(m),m.scrollIntoView(c),n.display.lineSpace.removeChild(m)}}}function Y0(n,s,u,l){l==null&&(l=0);var c;!n.options.lineWrapping&&s==u&&(u=s.sticky=="before"?ge(s.line,s.ch+1,"before"):s,s=s.ch?ge(s.line,s.sticky=="before"?s.ch-1:s.ch,"after"):s);for(var m=0;m<5;m++){var v=!1,b=ii(n,s),S=!u||u==s?b:ii(n,u);c={left:Math.min(b.left,S.left),top:Math.min(b.top,S.top)-l,right:Math.max(b.left,S.left),bottom:Math.max(b.bottom,S.bottom)+l};var E=Ju(n,c),I=n.doc.scrollTop,B=n.doc.scrollLeft;if(E.scrollTop!=null&&(wa(n,E.scrollTop),Math.abs(n.doc.scrollTop-I)>1&&(v=!0)),E.scrollLeft!=null&&(Cr(n,E.scrollLeft),Math.abs(n.doc.scrollLeft-B)>1&&(v=!0)),!v)break}return c}function j0(n,s){var u=Ju(n,s);u.scrollTop!=null&&wa(n,u.scrollTop),u.scrollLeft!=null&&Cr(n,u.scrollLeft)}function Ju(n,s){var u=n.display,l=rs(n.display);s.top<0&&(s.top=0);var c=n.curOp&&n.curOp.scrollTop!=null?n.curOp.scrollTop:u.scroller.scrollTop,m=Ou(n),v={};s.bottom-s.top>m&&(s.bottom=s.top+m);var b=n.doc.height+Fu(u),S=s.top<l,E=s.bottom>b-l;if(s.top<c)v.scrollTop=S?0:s.top;else if(s.bottom>c+m){var I=Math.min(s.top,(E?b:s.bottom)-m);I!=c&&(v.scrollTop=I)}var B=n.options.fixedGutter?0:u.gutters.offsetWidth,j=n.curOp&&n.curOp.scrollLeft!=null?n.curOp.scrollLeft:u.scroller.scrollLeft-B,Z=Tr(n)-u.gutters.offsetWidth,ie=s.right-s.left>Z;return ie&&(s.right=s.left+Z),s.left<10?v.scrollLeft=0:s.left<j?v.scrollLeft=Math.max(0,s.left+B-(ie?0:10)):s.right>Z+j-3&&(v.scrollLeft=s.right+(ie?0:10)-Z),v}function Ku(n,s){s!=null&&(Qo(n),n.curOp.scrollTop=(n.curOp.scrollTop==null?n.doc.scrollTop:n.curOp.scrollTop)+s)}function os(n){Qo(n);var s=n.getCursor();n.curOp.scrollToPos={from:s,to:s,margin:n.options.cursorScrollMargin}}function ba(n,s,u){(s!=null||u!=null)&&Qo(n),s!=null&&(n.curOp.scrollLeft=s),u!=null&&(n.curOp.scrollTop=u)}function J0(n,s){Qo(n),n.curOp.scrollToPos=s}function Qo(n){var s=n.curOp.scrollToPos;if(s){n.curOp.scrollToPos=null;var u=qf(n,s.from),l=qf(n,s.to);td(n,u,l,s.margin)}}function td(n,s,u,l){var c=Ju(n,{left:Math.min(s.left,u.left),top:Math.min(s.top,u.top)-l,right:Math.max(s.right,u.right),bottom:Math.max(s.bottom,u.bottom)+l});ba(n,c.scrollLeft,c.scrollTop)}function wa(n,s){Math.abs(n.doc.scrollTop-s)<2||(a||$u(n,{top:s}),nd(n,s,!0),a&&$u(n),Ta(n,100))}function nd(n,s,u){s=Math.max(0,Math.min(n.display.scroller.scrollHeight-n.display.scroller.clientHeight,s)),!(n.display.scroller.scrollTop==s&&!u)&&(n.doc.scrollTop=s,n.display.scrollbars.setScrollTop(s),n.display.scroller.scrollTop!=s&&(n.display.scroller.scrollTop=s))}function Cr(n,s,u,l){s=Math.max(0,Math.min(s,n.display.scroller.scrollWidth-n.display.scroller.clientWidth)),!((u?s==n.doc.scrollLeft:Math.abs(n.doc.scrollLeft-s)<2)&&!l)&&(n.doc.scrollLeft=s,od(n),n.display.scroller.scrollLeft!=s&&(n.display.scroller.scrollLeft=s),n.display.scrollbars.setScrollLeft(s))}function Ma(n){var s=n.display,u=s.gutters.offsetWidth,l=Math.round(n.doc.height+Fu(n.display));return{clientHeight:s.scroller.clientHeight,viewHeight:s.wrapper.clientHeight,scrollWidth:s.scroller.scrollWidth,clientWidth:s.scroller.clientWidth,viewWidth:s.wrapper.clientWidth,barLeft:n.options.fixedGutter?u:0,docHeight:l,scrollHeight:l+pi(n)+s.barHeight,nativeBarWidth:s.nativeBarWidth,gutterWidth:u}}var Rr=function(n,s,u){this.cm=u;var l=this.vert=W("div",[W("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),c=this.horiz=W("div",[W("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");l.tabIndex=c.tabIndex=-1,n(l),n(c),xe(l,"scroll",function(){l.clientHeight&&s(l.scrollTop,"vertical")}),xe(c,"scroll",function(){c.clientWidth&&s(c.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,p&&d<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Rr.prototype.update=function(n){var s=n.scrollWidth>n.clientWidth+1,u=n.scrollHeight>n.clientHeight+1,l=n.nativeBarWidth;if(u){this.vert.style.display="block",this.vert.style.bottom=s?l+"px":"0";var c=n.viewHeight-(s?l:0);this.vert.firstChild.style.height=Math.max(0,n.scrollHeight-n.clientHeight+c)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(s){this.horiz.style.display="block",this.horiz.style.right=u?l+"px":"0",this.horiz.style.left=n.barLeft+"px";var m=n.viewWidth-n.barLeft-(u?l:0);this.horiz.firstChild.style.width=Math.max(0,n.scrollWidth-n.clientWidth+m)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&n.clientHeight>0&&(l==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:u?l:0,bottom:s?l:0}},Rr.prototype.setScrollLeft=function(n){this.horiz.scrollLeft!=n&&(this.horiz.scrollLeft=n),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Rr.prototype.setScrollTop=function(n){this.vert.scrollTop!=n&&(this.vert.scrollTop=n),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Rr.prototype.zeroWidthHack=function(){var n=C&&!L?"12px":"18px";this.horiz.style.height=this.vert.style.width=n,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new $e,this.disableVert=new $e},Rr.prototype.enableZeroWidthBar=function(n,s,u){n.style.pointerEvents="auto";function l(){var c=n.getBoundingClientRect(),m=u=="vert"?document.elementFromPoint(c.right-1,(c.top+c.bottom)/2):document.elementFromPoint((c.right+c.left)/2,c.bottom-1);m!=n?n.style.pointerEvents="none":s.set(1e3,l)}s.set(1e3,l)},Rr.prototype.clear=function(){var n=this.horiz.parentNode;n.removeChild(this.horiz),n.removeChild(this.vert)};var Sa=function(){};Sa.prototype.update=function(){return{bottom:0,right:0}},Sa.prototype.setScrollLeft=function(){},Sa.prototype.setScrollTop=function(){},Sa.prototype.clear=function(){};function ls(n,s){s||(s=Ma(n));var u=n.display.barWidth,l=n.display.barHeight;id(n,s);for(var c=0;c<4&&u!=n.display.barWidth||l!=n.display.barHeight;c++)u!=n.display.barWidth&&n.options.lineWrapping&&Jo(n),id(n,Ma(n)),u=n.display.barWidth,l=n.display.barHeight}function id(n,s){var u=n.display,l=u.scrollbars.update(s);u.sizer.style.paddingRight=(u.barWidth=l.right)+"px",u.sizer.style.paddingBottom=(u.barHeight=l.bottom)+"px",u.heightForcer.style.borderBottom=l.bottom+"px solid transparent",l.right&&l.bottom?(u.scrollbarFiller.style.display="block",u.scrollbarFiller.style.height=l.bottom+"px",u.scrollbarFiller.style.width=l.right+"px"):u.scrollbarFiller.style.display="",l.bottom&&n.options.coverGutterNextToScrollbar&&n.options.fixedGutter?(u.gutterFiller.style.display="block",u.gutterFiller.style.height=l.bottom+"px",u.gutterFiller.style.width=s.gutterWidth+"px"):u.gutterFiller.style.display=""}var rd={native:Rr,null:Sa};function sd(n){n.display.scrollbars&&(n.display.scrollbars.clear(),n.display.scrollbars.addClass&&X(n.display.wrapper,n.display.scrollbars.addClass)),n.display.scrollbars=new rd[n.options.scrollbarStyle](function(s){n.display.wrapper.insertBefore(s,n.display.scrollbarFiller),xe(s,"mousedown",function(){n.state.focused&&setTimeout(function(){return n.display.input.focus()},0)}),s.setAttribute("cm-not-content","true")},function(s,u){u=="horizontal"?Cr(n,s):wa(n,s)},n),n.display.scrollbars.addClass&&Oe(n.display.wrapper,n.display.scrollbars.addClass)}var K0=0;function Pr(n){n.curOp={cm:n,viewChanged:!1,startHeight:n.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++K0,markArrays:null},L0(n.curOp)}function Dr(n){var s=n.curOp;s&&R0(s,function(u){for(var l=0;l<u.ops.length;l++)u.ops[l].cm.curOp=null;Q0(u)})}function Q0(n){for(var s=n.ops,u=0;u<s.length;u++)$0(s[u]);for(var l=0;l<s.length;l++)ex(s[l]);for(var c=0;c<s.length;c++)tx(s[c]);for(var m=0;m<s.length;m++)nx(s[m]);for(var v=0;v<s.length;v++)ix(s[v])}function $0(n){var s=n.cm,u=s.display;sx(s),n.updateMaxLine&&ku(s),n.mustUpdate=n.viewChanged||n.forceUpdate||n.scrollTop!=null||n.scrollToPos&&(n.scrollToPos.from.line<u.viewFrom||n.scrollToPos.to.line>=u.viewTo)||u.maxLineChanged&&s.options.lineWrapping,n.update=n.mustUpdate&&new $o(s,n.mustUpdate&&{top:n.scrollTop,ensure:n.scrollToPos},n.forceUpdate)}function ex(n){n.updatedDisplay=n.mustUpdate&&Qu(n.cm,n.update)}function tx(n){var s=n.cm,u=s.display;n.updatedDisplay&&Jo(s),n.barMeasure=Ma(s),u.maxLineChanged&&!s.options.lineWrapping&&(n.adjustWidthTo=Bf(s,u.maxLine,u.maxLine.text.length).left+3,s.display.sizerWidth=n.adjustWidthTo,n.barMeasure.scrollWidth=Math.max(u.scroller.clientWidth,u.sizer.offsetLeft+n.adjustWidthTo+pi(s)+s.display.barWidth),n.maxScrollLeft=Math.max(0,u.sizer.offsetLeft+n.adjustWidthTo-Tr(s))),(n.updatedDisplay||n.selectionChanged)&&(n.preparedSelection=u.input.prepareSelection())}function nx(n){var s=n.cm;n.adjustWidthTo!=null&&(s.display.sizer.style.minWidth=n.adjustWidthTo+"px",n.maxScrollLeft<s.doc.scrollLeft&&Cr(s,Math.min(s.display.scroller.scrollLeft,n.maxScrollLeft),!0),s.display.maxLineChanged=!1);var u=n.focus&&n.focus==Me();n.preparedSelection&&s.display.input.showSelection(n.preparedSelection,u),(n.updatedDisplay||n.startHeight!=s.doc.height)&&ls(s,n.barMeasure),n.updatedDisplay&&tc(s,n.barMeasure),n.selectionChanged&&qu(s),s.state.focused&&n.updateInput&&s.display.input.reset(n.typing),u&&$f(n.cm)}function ix(n){var s=n.cm,u=s.display,l=s.doc;if(n.updatedDisplay&&ad(s,n.update),u.wheelStartX!=null&&(n.scrollTop!=null||n.scrollLeft!=null||n.scrollToPos)&&(u.wheelStartX=u.wheelStartY=null),n.scrollTop!=null&&nd(s,n.scrollTop,n.forceScroll),n.scrollLeft!=null&&Cr(s,n.scrollLeft,!0,!0),n.scrollToPos){var c=Y0(s,Be(l,n.scrollToPos.from),Be(l,n.scrollToPos.to),n.scrollToPos.margin);q0(s,c)}var m=n.maybeHiddenMarkers,v=n.maybeUnhiddenMarkers;if(m)for(var b=0;b<m.length;++b)m[b].lines.length||Ve(m[b],"hide");if(v)for(var S=0;S<v.length;++S)v[S].lines.length&&Ve(v[S],"unhide");u.wrapper.offsetHeight&&(l.scrollTop=s.display.scroller.scrollTop),n.changeObjs&&Ve(s,"changes",s,n.changeObjs),n.update&&n.update.finish()}function Nn(n,s){if(n.curOp)return s();Pr(n);try{return s()}finally{Dr(n)}}function Qt(n,s){return function(){if(n.curOp)return s.apply(n,arguments);Pr(n);try{return s.apply(n,arguments)}finally{Dr(n)}}}function bn(n){return function(){if(this.curOp)return n.apply(this,arguments);Pr(this);try{return n.apply(this,arguments)}finally{Dr(this)}}}function $t(n){return function(){var s=this.cm;if(!s||s.curOp)return n.apply(this,arguments);Pr(s);try{return n.apply(this,arguments)}finally{Dr(s)}}}function Ta(n,s){n.doc.highlightFrontier<n.display.viewTo&&n.state.highlight.set(s,We(rx,n))}function rx(n){var s=n.doc;if(!(s.highlightFrontier>=n.display.viewTo)){var u=+new Date+n.options.workTime,l=pa(n,s.highlightFrontier),c=[];s.iter(l.line,Math.min(s.first+s.size,n.display.viewTo+500),function(m){if(l.line>=n.display.viewFrom){var v=m.styles,b=m.text.length>n.options.maxHighlightLength?Gt(s.mode,l.state):null,S=df(n,m,l,!0);b&&(l.state=b),m.styles=S.styles;var E=m.styleClasses,I=S.classes;I?m.styleClasses=I:E&&(m.styleClasses=null);for(var B=!v||v.length!=m.styles.length||E!=I&&(!E||!I||E.bgClass!=I.bgClass||E.textClass!=I.textClass),j=0;!B&&j<v.length;++j)B=v[j]!=m.styles[j];B&&c.push(l.line),m.stateAfter=l.save(),l.nextLine()}else m.text.length<=n.options.maxHighlightLength&&Lu(n,m.text,l),m.stateAfter=l.line%5==0?l.save():null,l.nextLine();if(+new Date>u)return Ta(n,n.options.workDelay),!0}),s.highlightFrontier=l.line,s.modeFrontier=Math.max(s.modeFrontier,l.line),c.length&&Nn(n,function(){for(var m=0;m<c.length;m++)Xi(n,c[m],"text")})}}var $o=function(n,s,u){var l=n.display;this.viewport=s,this.visible=Ko(l,n.doc,s),this.editorIsHidden=!l.wrapper.offsetWidth,this.wrapperHeight=l.wrapper.clientHeight,this.wrapperWidth=l.wrapper.clientWidth,this.oldDisplayWidth=Tr(n),this.force=u,this.dims=Gu(n),this.events=[]};$o.prototype.signal=function(n,s){Wt(n,s)&&this.events.push(arguments)},$o.prototype.finish=function(){for(var n=0;n<this.events.length;n++)Ve.apply(null,this.events[n])};function sx(n){var s=n.display;!s.scrollbarsClipped&&s.scroller.offsetWidth&&(s.nativeBarWidth=s.scroller.offsetWidth-s.scroller.clientWidth,s.heightForcer.style.height=pi(n)+"px",s.sizer.style.marginBottom=-s.nativeBarWidth+"px",s.sizer.style.borderRightWidth=pi(n)+"px",s.scrollbarsClipped=!0)}function ax(n){if(n.hasFocus())return null;var s=Me();if(!s||!te(n.display.lineDiv,s))return null;var u={activeElt:s};if(window.getSelection){var l=window.getSelection();l.anchorNode&&l.extend&&te(n.display.lineDiv,l.anchorNode)&&(u.anchorNode=l.anchorNode,u.anchorOffset=l.anchorOffset,u.focusNode=l.focusNode,u.focusOffset=l.focusOffset)}return u}function ox(n){if(!(!n||!n.activeElt||n.activeElt==Me())&&(n.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(n.activeElt.nodeName)&&n.anchorNode&&te(document.body,n.anchorNode)&&te(document.body,n.focusNode))){var s=window.getSelection(),u=document.createRange();u.setEnd(n.anchorNode,n.anchorOffset),u.collapse(!1),s.removeAllRanges(),s.addRange(u),s.extend(n.focusNode,n.focusOffset)}}function Qu(n,s){var u=n.display,l=n.doc;if(s.editorIsHidden)return Zi(n),!1;if(!s.force&&s.visible.from>=u.viewFrom&&s.visible.to<=u.viewTo&&(u.updateLineNumbers==null||u.updateLineNumbers>=u.viewTo)&&u.renderedView==u.view&&Kf(n)==0)return!1;ld(n)&&(Zi(n),s.dims=Gu(n));var c=l.first+l.size,m=Math.max(s.visible.from-n.options.viewportMargin,l.first),v=Math.min(c,s.visible.to+n.options.viewportMargin);u.viewFrom<m&&m-u.viewFrom<20&&(m=Math.max(l.first,u.viewFrom)),u.viewTo>v&&u.viewTo-v<20&&(v=Math.min(c,u.viewTo)),Ai&&(m=Du(n.doc,m),v=Af(n.doc,v));var b=m!=u.viewFrom||v!=u.viewTo||u.lastWrapHeight!=s.wrapperHeight||u.lastWrapWidth!=s.wrapperWidth;X0(n,m,v),u.viewOffset=Li(Ue(n.doc,u.viewFrom)),n.display.mover.style.top=u.viewOffset+"px";var S=Kf(n);if(!b&&S==0&&!s.force&&u.renderedView==u.view&&(u.updateLineNumbers==null||u.updateLineNumbers>=u.viewTo))return!1;var E=ax(n);return S>4&&(u.lineDiv.style.display="none"),lx(n,u.updateLineNumbers,s.dims),S>4&&(u.lineDiv.style.display=""),u.renderedView=u.view,ox(E),Se(u.cursorDiv),Se(u.selectionDiv),u.gutters.style.height=u.sizer.style.minHeight=0,b&&(u.lastWrapHeight=s.wrapperHeight,u.lastWrapWidth=s.wrapperWidth,Ta(n,400)),u.updateLineNumbers=null,!0}function ad(n,s){for(var u=s.viewport,l=!0;;l=!1){if(!l||!n.options.lineWrapping||s.oldDisplayWidth==Tr(n)){if(u&&u.top!=null&&(u={top:Math.min(n.doc.height+Fu(n.display)-Ou(n),u.top)}),s.visible=Ko(n.display,n.doc,u),s.visible.from>=n.display.viewFrom&&s.visible.to<=n.display.viewTo)break}else l&&(s.visible=Ko(n.display,n.doc,u));if(!Qu(n,s))break;Jo(n);var c=Ma(n);_a(n),ls(n,c),tc(n,c),s.force=!1}s.signal(n,"update",n),(n.display.viewFrom!=n.display.reportedViewFrom||n.display.viewTo!=n.display.reportedViewTo)&&(s.signal(n,"viewportChange",n,n.display.viewFrom,n.display.viewTo),n.display.reportedViewFrom=n.display.viewFrom,n.display.reportedViewTo=n.display.viewTo)}function $u(n,s){var u=new $o(n,s);if(Qu(n,u)){Jo(n),ad(n,u);var l=Ma(n);_a(n),ls(n,l),tc(n,l),u.finish()}}function lx(n,s,u){var l=n.display,c=n.options.lineNumbers,m=l.lineDiv,v=m.firstChild;function b(ie){var he=ie.nextSibling;return g&&C&&n.display.currentWheelTarget==ie?ie.style.display="none":ie.parentNode.removeChild(ie),he}for(var S=l.view,E=l.viewFrom,I=0;I<S.length;I++){var B=S[I];if(!B.hidden)if(!B.node||B.node.parentNode!=m){var j=N0(n,B,E,u);m.insertBefore(j,v)}else{for(;v!=B.node;)v=b(v);var Z=c&&s!=null&&s<=E&&B.lineNumber;B.changes&&(K(B.changes,"gutter")>-1&&(Z=!1),Df(n,B,E,u)),Z&&(Se(B.lineNumber),B.lineNumber.appendChild(document.createTextNode(da(n.options,E)))),v=B.node.nextSibling}E+=B.size}for(;v;)v=b(v)}function ec(n){var s=n.gutters.offsetWidth;n.sizer.style.marginLeft=s+"px",Kt(n,"gutterChanged",n)}function tc(n,s){n.display.sizer.style.minHeight=s.docHeight+"px",n.display.heightForcer.style.top=s.docHeight+"px",n.display.gutters.style.height=s.docHeight+n.display.barHeight+pi(n)+"px"}function od(n){var s=n.display,u=s.view;if(!(!s.alignWidgets&&(!s.gutters.firstChild||!n.options.fixedGutter))){for(var l=Vu(s)-s.scroller.scrollLeft+n.doc.scrollLeft,c=s.gutters.offsetWidth,m=l+"px",v=0;v<u.length;v++)if(!u[v].hidden){n.options.fixedGutter&&(u[v].gutter&&(u[v].gutter.style.left=m),u[v].gutterBackground&&(u[v].gutterBackground.style.left=m));var b=u[v].alignable;if(b)for(var S=0;S<b.length;S++)b[S].style.left=m}n.options.fixedGutter&&(s.gutters.style.left=l+c+"px")}}function ld(n){if(!n.options.lineNumbers)return!1;var s=n.doc,u=da(n.options,s.first+s.size-1),l=n.display;if(u.length!=l.lineNumChars){var c=l.measure.appendChild(W("div",[W("div",u)],"CodeMirror-linenumber CodeMirror-gutter-elt")),m=c.firstChild.offsetWidth,v=c.offsetWidth-m;return l.lineGutter.style.width="",l.lineNumInnerWidth=Math.max(m,l.lineGutter.offsetWidth-v)+1,l.lineNumWidth=l.lineNumInnerWidth+v,l.lineNumChars=l.lineNumInnerWidth?u.length:-1,l.lineGutter.style.width=l.lineNumWidth+"px",ec(n.display),!0}return!1}function nc(n,s){for(var u=[],l=!1,c=0;c<n.length;c++){var m=n[c],v=null;if(typeof m!="string"&&(v=m.style,m=m.className),m=="CodeMirror-linenumbers")if(s)l=!0;else continue;u.push({className:m,style:v})}return s&&!l&&u.push({className:"CodeMirror-linenumbers",style:null}),u}function ud(n){var s=n.gutters,u=n.gutterSpecs;Se(s),n.lineGutter=null;for(var l=0;l<u.length;++l){var c=u[l],m=c.className,v=c.style,b=s.appendChild(W("div",null,"CodeMirror-gutter "+m));v&&(b.style.cssText=v),m=="CodeMirror-linenumbers"&&(n.lineGutter=b,b.style.width=(n.lineNumWidth||1)+"px")}s.style.display=u.length?"":"none",ec(n)}function Ea(n){ud(n.display),Ln(n),od(n)}function ux(n,s,u,l){var c=this;this.input=u,c.scrollbarFiller=W("div",null,"CodeMirror-scrollbar-filler"),c.scrollbarFiller.setAttribute("cm-not-content","true"),c.gutterFiller=W("div",null,"CodeMirror-gutter-filler"),c.gutterFiller.setAttribute("cm-not-content","true"),c.lineDiv=D("div",null,"CodeMirror-code"),c.selectionDiv=W("div",null,null,"position: relative; z-index: 1"),c.cursorDiv=W("div",null,"CodeMirror-cursors"),c.measure=W("div",null,"CodeMirror-measure"),c.lineMeasure=W("div",null,"CodeMirror-measure"),c.lineSpace=D("div",[c.measure,c.lineMeasure,c.selectionDiv,c.cursorDiv,c.lineDiv],null,"position: relative; outline: none");var m=D("div",[c.lineSpace],"CodeMirror-lines");c.mover=W("div",[m],null,"position: relative"),c.sizer=W("div",[c.mover],"CodeMirror-sizer"),c.sizerWidth=null,c.heightForcer=W("div",null,null,"position: absolute; height: "+Ae+"px; width: 1px;"),c.gutters=W("div",null,"CodeMirror-gutters"),c.lineGutter=null,c.scroller=W("div",[c.sizer,c.heightForcer,c.gutters],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=W("div",[c.scrollbarFiller,c.gutterFiller,c.scroller],"CodeMirror"),c.wrapper.setAttribute("translate","no"),p&&d<8&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),!g&&!(a&&N)&&(c.scroller.draggable=!0),n&&(n.appendChild?n.appendChild(c.wrapper):n(c.wrapper)),c.viewFrom=c.viewTo=s.first,c.reportedViewFrom=c.reportedViewTo=s.first,c.view=[],c.renderedView=null,c.externalMeasured=null,c.viewOffset=0,c.lastWrapHeight=c.lastWrapWidth=0,c.updateLineNumbers=null,c.nativeBarWidth=c.barHeight=c.barWidth=0,c.scrollbarsClipped=!1,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.alignWidgets=!1,c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c.shift=!1,c.selForContextMenu=null,c.activeTouch=null,c.gutterSpecs=nc(l.gutters,l.lineNumbers),ud(c),u.init(c)}var el=0,Ri=null;p?Ri=-.53:a?Ri=15:x?Ri=-.7:T&&(Ri=-1/3);function cd(n){var s=n.wheelDeltaX,u=n.wheelDeltaY;return s==null&&n.detail&&n.axis==n.HORIZONTAL_AXIS&&(s=n.detail),u==null&&n.detail&&n.axis==n.VERTICAL_AXIS?u=n.detail:u==null&&(u=n.wheelDelta),{x:s,y:u}}function cx(n){var s=cd(n);return s.x*=Ri,s.y*=Ri,s}function hd(n,s){var u=cd(s),l=u.x,c=u.y,m=Ri;s.deltaMode===0&&(l=s.deltaX,c=s.deltaY,m=1);var v=n.display,b=v.scroller,S=b.scrollWidth>b.clientWidth,E=b.scrollHeight>b.clientHeight;if(!!(l&&S||c&&E)){if(c&&C&&g){e:for(var I=s.target,B=v.view;I!=b;I=I.parentNode)for(var j=0;j<B.length;j++)if(B[j].node==I){n.display.currentWheelTarget=I;break e}}if(l&&!a&&!_&&m!=null){c&&E&&wa(n,Math.max(0,b.scrollTop+c*m)),Cr(n,Math.max(0,b.scrollLeft+l*m)),(!c||c&&E)&&Dt(s),v.wheelStartX=null;return}if(c&&m!=null){var Z=c*m,ie=n.doc.scrollTop,he=ie+v.wrapper.clientHeight;Z<0?ie=Math.max(0,ie+Z-50):he=Math.min(n.doc.height,he+Z+50),$u(n,{top:ie,bottom:he})}el<20&&s.deltaMode!==0&&(v.wheelStartX==null?(v.wheelStartX=b.scrollLeft,v.wheelStartY=b.scrollTop,v.wheelDX=l,v.wheelDY=c,setTimeout(function(){if(v.wheelStartX!=null){var we=b.scrollLeft-v.wheelStartX,De=b.scrollTop-v.wheelStartY,Fe=De&&v.wheelDY&&De/v.wheelDY||we&&v.wheelDX&&we/v.wheelDX;v.wheelStartX=v.wheelStartY=null,!!Fe&&(Ri=(Ri*el+Fe)/(el+1),++el)}},200)):(v.wheelDX+=l,v.wheelDY+=c))}}var Xn=function(n,s){this.ranges=n,this.primIndex=s};Xn.prototype.primary=function(){return this.ranges[this.primIndex]},Xn.prototype.equals=function(n){if(n==this)return!0;if(n.primIndex!=this.primIndex||n.ranges.length!=this.ranges.length)return!1;for(var s=0;s<this.ranges.length;s++){var u=this.ranges[s],l=n.ranges[s];if(!U(u.anchor,l.anchor)||!U(u.head,l.head))return!1}return!0},Xn.prototype.deepCopy=function(){for(var n=[],s=0;s<this.ranges.length;s++)n[s]=new Mt(le(this.ranges[s].anchor),le(this.ranges[s].head));return new Xn(n,this.primIndex)},Xn.prototype.somethingSelected=function(){for(var n=0;n<this.ranges.length;n++)if(!this.ranges[n].empty())return!0;return!1},Xn.prototype.contains=function(n,s){s||(s=n);for(var u=0;u<this.ranges.length;u++){var l=this.ranges[u];if(A(s,l.from())>=0&&A(n,l.to())<=0)return u}return-1};var Mt=function(n,s){this.anchor=n,this.head=s};Mt.prototype.from=function(){return at(this.anchor,this.head)},Mt.prototype.to=function(){return _e(this.anchor,this.head)},Mt.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function ri(n,s,u){var l=n&&n.options.selectionsMayTouch,c=s[u];s.sort(function(j,Z){return A(j.from(),Z.from())}),u=K(s,c);for(var m=1;m<s.length;m++){var v=s[m],b=s[m-1],S=A(b.to(),v.from());if(l&&!v.empty()?S>0:S>=0){var E=at(b.from(),v.from()),I=_e(b.to(),v.to()),B=b.empty()?v.from()==v.head:b.from()==b.head;m<=u&&--u,s.splice(--m,2,new Mt(B?I:E,B?E:I))}}return new Xn(s,u)}function qi(n,s){return new Xn([new Mt(n,s||n)],0)}function Yi(n){return n.text?ge(n.from.line+n.text.length-1,me(n.text).length+(n.text.length==1?n.from.ch:0)):n.to}function fd(n,s){if(A(n,s.from)<0)return n;if(A(n,s.to)<=0)return Yi(s);var u=n.line+s.text.length-(s.to.line-s.from.line)-1,l=n.ch;return n.line==s.to.line&&(l+=Yi(s).ch-s.to.ch),ge(u,l)}function ic(n,s){for(var u=[],l=0;l<n.sel.ranges.length;l++){var c=n.sel.ranges[l];u.push(new Mt(fd(c.anchor,s),fd(c.head,s)))}return ri(n.cm,u,n.sel.primIndex)}function dd(n,s,u){return n.line==s.line?ge(u.line,n.ch-s.ch+u.ch):ge(u.line+(n.line-s.line),n.ch)}function hx(n,s,u){for(var l=[],c=ge(n.first,0),m=c,v=0;v<s.length;v++){var b=s[v],S=dd(b.from,c,m),E=dd(Yi(b),c,m);if(c=b.to,m=E,u=="around"){var I=n.sel.ranges[v],B=A(I.head,I.anchor)<0;l[v]=new Mt(B?E:S,B?S:E)}else l[v]=new Mt(S,S)}return new Xn(l,n.sel.primIndex)}function rc(n){n.doc.mode=ct(n.options,n.doc.modeOption),Aa(n)}function Aa(n){n.doc.iter(function(s){s.stateAfter&&(s.stateAfter=null),s.styles&&(s.styles=null)}),n.doc.modeFrontier=n.doc.highlightFrontier=n.doc.first,Ta(n,100),n.state.modeGen++,n.curOp&&Ln(n)}function pd(n,s){return s.from.ch==0&&s.to.ch==0&&me(s.text)==""&&(!n.cm||n.cm.options.wholeLineUpdateBefore)}function sc(n,s,u,l){function c(Fe){return u?u[Fe]:null}function m(Fe,Ie,Ge){y0(Fe,Ie,Ge,l),Kt(Fe,"change",Fe,s)}function v(Fe,Ie){for(var Ge=[],Qe=Fe;Qe<Ie;++Qe)Ge.push(new ts(E[Qe],c(Qe),l));return Ge}var b=s.from,S=s.to,E=s.text,I=Ue(n,b.line),B=Ue(n,S.line),j=me(E),Z=c(E.length-1),ie=S.line-b.line;if(s.full)n.insert(0,v(0,E.length)),n.remove(E.length,n.size-E.length);else if(pd(n,s)){var he=v(0,E.length-1);m(B,B.text,Z),ie&&n.remove(b.line,ie),he.length&&n.insert(b.line,he)}else if(I==B)if(E.length==1)m(I,I.text.slice(0,b.ch)+j+I.text.slice(S.ch),Z);else{var we=v(1,E.length-1);we.push(new ts(j+I.text.slice(S.ch),Z,l)),m(I,I.text.slice(0,b.ch)+E[0],c(0)),n.insert(b.line+1,we)}else if(E.length==1)m(I,I.text.slice(0,b.ch)+E[0]+B.text.slice(S.ch),c(0)),n.remove(b.line+1,ie);else{m(I,I.text.slice(0,b.ch)+E[0],c(0)),m(B,j+B.text.slice(S.ch),Z);var De=v(1,E.length-1);ie>1&&n.remove(b.line+1,ie-1),n.insert(b.line+1,De)}Kt(n,"change",n,s)}function ji(n,s,u){function l(c,m,v){if(c.linked)for(var b=0;b<c.linked.length;++b){var S=c.linked[b];if(S.doc!=m){var E=v&&S.sharedHist;u&&!E||(s(S.doc,E),l(S.doc,c,E))}}}l(n,null,!0)}function md(n,s){if(s.cm)throw new Error("This document is already in use.");n.doc=s,s.cm=n,Xu(n),rc(n),gd(n),n.options.direction=s.direction,n.options.lineWrapping||ku(n),n.options.mode=s.modeOption,Ln(n)}function gd(n){(n.doc.direction=="rtl"?Oe:X)(n.display.lineDiv,"CodeMirror-rtl")}function fx(n){Nn(n,function(){gd(n),Ln(n)})}function tl(n){this.done=[],this.undone=[],this.undoDepth=n?n.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=n?n.maxGeneration:1}function ac(n,s){var u={from:le(s.from),to:Yi(s),text:on(n,s.from,s.to)};return yd(n,u,s.from.line,s.to.line+1),ji(n,function(l){return yd(l,u,s.from.line,s.to.line+1)},!0),u}function vd(n){for(;n.length;){var s=me(n);if(s.ranges)n.pop();else break}}function dx(n,s){if(s)return vd(n.done),me(n.done);if(n.done.length&&!me(n.done).ranges)return me(n.done);if(n.done.length>1&&!n.done[n.done.length-2].ranges)return n.done.pop(),me(n.done)}function xd(n,s,u,l){var c=n.history;c.undone.length=0;var m=+new Date,v,b;if((c.lastOp==l||c.lastOrigin==s.origin&&s.origin&&(s.origin.charAt(0)=="+"&&c.lastModTime>m-(n.cm?n.cm.options.historyEventDelay:500)||s.origin.charAt(0)=="*"))&&(v=dx(c,c.lastOp==l)))b=me(v.changes),A(s.from,s.to)==0&&A(s.from,b.to)==0?b.to=Yi(s):v.changes.push(ac(n,s));else{var S=me(c.done);for((!S||!S.ranges)&&nl(n.sel,c.done),v={changes:[ac(n,s)],generation:c.generation},c.done.push(v);c.done.length>c.undoDepth;)c.done.shift(),c.done[0].ranges||c.done.shift()}c.done.push(u),c.generation=++c.maxGeneration,c.lastModTime=c.lastSelTime=m,c.lastOp=c.lastSelOp=l,c.lastOrigin=c.lastSelOrigin=s.origin,b||Ve(n,"historyAdded")}function px(n,s,u,l){var c=s.charAt(0);return c=="*"||c=="+"&&u.ranges.length==l.ranges.length&&u.somethingSelected()==l.somethingSelected()&&new Date-n.history.lastSelTime<=(n.cm?n.cm.options.historyEventDelay:500)}function mx(n,s,u,l){var c=n.history,m=l&&l.origin;u==c.lastSelOp||m&&c.lastSelOrigin==m&&(c.lastModTime==c.lastSelTime&&c.lastOrigin==m||px(n,m,me(c.done),s))?c.done[c.done.length-1]=s:nl(s,c.done),c.lastSelTime=+new Date,c.lastSelOrigin=m,c.lastSelOp=u,l&&l.clearRedo!==!1&&vd(c.undone)}function nl(n,s){var u=me(s);u&&u.ranges&&u.equals(n)||s.push(n)}function yd(n,s,u,l){var c=s["spans_"+n.id],m=0;n.iter(Math.max(n.first,u),Math.min(n.first+n.size,l),function(v){v.markedSpans&&((c||(c=s["spans_"+n.id]={}))[m]=v.markedSpans),++m})}function gx(n){if(!n)return null;for(var s,u=0;u<n.length;++u)n[u].marker.explicitlyCleared?s||(s=n.slice(0,u)):s&&s.push(n[u]);return s?s.length?s:null:n}function vx(n,s){var u=s["spans_"+n.id];if(!u)return null;for(var l=[],c=0;c<s.text.length;++c)l.push(gx(u[c]));return l}function _d(n,s){var u=vx(n,s),l=Ru(n,s);if(!u)return l;if(!l)return u;for(var c=0;c<u.length;++c){var m=u[c],v=l[c];if(m&&v){e:for(var b=0;b<v.length;++b){for(var S=v[b],E=0;E<m.length;++E)if(m[E].marker==S.marker)continue e;m.push(S)}}else v&&(u[c]=v)}return u}function us(n,s,u){for(var l=[],c=0;c<n.length;++c){var m=n[c];if(m.ranges){l.push(u?Xn.prototype.deepCopy.call(m):m);continue}var v=m.changes,b=[];l.push({changes:b});for(var S=0;S<v.length;++S){var E=v[S],I=void 0;if(b.push({from:E.from,to:E.to,text:E.text}),s)for(var B in E)(I=B.match(/^spans_(\d+)$/))&&K(s,Number(I[1]))>-1&&(me(b)[B]=E[B],delete E[B])}}return l}function oc(n,s,u,l){if(l){var c=n.anchor;if(u){var m=A(s,c)<0;m!=A(u,c)<0?(c=s,s=u):m!=A(s,u)<0&&(s=u)}return new Mt(c,s)}else return new Mt(u||s,s)}function il(n,s,u,l,c){c==null&&(c=n.cm&&(n.cm.display.shift||n.extend)),dn(n,new Xn([oc(n.sel.primary(),s,u,c)],0),l)}function bd(n,s,u){for(var l=[],c=n.cm&&(n.cm.display.shift||n.extend),m=0;m<n.sel.ranges.length;m++)l[m]=oc(n.sel.ranges[m],s[m],null,c);var v=ri(n.cm,l,n.sel.primIndex);dn(n,v,u)}function lc(n,s,u,l){var c=n.sel.ranges.slice(0);c[s]=u,dn(n,ri(n.cm,c,n.sel.primIndex),l)}function wd(n,s,u,l){dn(n,qi(s,u),l)}function xx(n,s,u){var l={ranges:s.ranges,update:function(c){this.ranges=[];for(var m=0;m<c.length;m++)this.ranges[m]=new Mt(Be(n,c[m].anchor),Be(n,c[m].head))},origin:u&&u.origin};return Ve(n,"beforeSelectionChange",n,l),n.cm&&Ve(n.cm,"beforeSelectionChange",n.cm,l),l.ranges!=s.ranges?ri(n.cm,l.ranges,l.ranges.length-1):s}function Md(n,s,u){var l=n.history.done,c=me(l);c&&c.ranges?(l[l.length-1]=s,rl(n,s,u)):dn(n,s,u)}function dn(n,s,u){rl(n,s,u),mx(n,n.sel,n.cm?n.cm.curOp.id:NaN,u)}function rl(n,s,u){(Wt(n,"beforeSelectionChange")||n.cm&&Wt(n.cm,"beforeSelectionChange"))&&(s=xx(n,s,u));var l=u&&u.bias||(A(s.primary().head,n.sel.primary().head)<0?-1:1);Sd(n,Ed(n,s,l,!0)),!(u&&u.scroll===!1)&&n.cm&&n.cm.getOption("readOnly")!="nocursor"&&os(n.cm)}function Sd(n,s){s.equals(n.sel)||(n.sel=s,n.cm&&(n.cm.curOp.updateInput=1,n.cm.curOp.selectionChanged=!0,Gi(n.cm)),Kt(n,"cursorActivity",n))}function Td(n){Sd(n,Ed(n,n.sel,null,!1))}function Ed(n,s,u,l){for(var c,m=0;m<s.ranges.length;m++){var v=s.ranges[m],b=s.ranges.length==n.sel.ranges.length&&n.sel.ranges[m],S=sl(n,v.anchor,b&&b.anchor,u,l),E=sl(n,v.head,b&&b.head,u,l);(c||S!=v.anchor||E!=v.head)&&(c||(c=s.ranges.slice(0,m)),c[m]=new Mt(S,E))}return c?ri(n.cm,c,s.primIndex):s}function cs(n,s,u,l,c){var m=Ue(n,s.line);if(m.markedSpans)for(var v=0;v<m.markedSpans.length;++v){var b=m.markedSpans[v],S=b.marker,E="selectLeft"in S?!S.selectLeft:S.inclusiveLeft,I="selectRight"in S?!S.selectRight:S.inclusiveRight;if((b.from==null||(E?b.from<=s.ch:b.from<s.ch))&&(b.to==null||(I?b.to>=s.ch:b.to>s.ch))){if(c&&(Ve(S,"beforeCursorEnter"),S.explicitlyCleared))if(m.markedSpans){--v;continue}else break;if(!S.atomic)continue;if(u){var B=S.find(l<0?1:-1),j=void 0;if((l<0?I:E)&&(B=Ad(n,B,-l,B&&B.line==s.line?m:null)),B&&B.line==s.line&&(j=A(B,u))&&(l<0?j<0:j>0))return cs(n,B,s,l,c)}var Z=S.find(l<0?-1:1);return(l<0?E:I)&&(Z=Ad(n,Z,l,Z.line==s.line?m:null)),Z?cs(n,Z,s,l,c):null}}return s}function sl(n,s,u,l,c){var m=l||1,v=cs(n,s,u,m,c)||!c&&cs(n,s,u,m,!0)||cs(n,s,u,-m,c)||!c&&cs(n,s,u,-m,!0);return v||(n.cantEdit=!0,ge(n.first,0))}function Ad(n,s,u,l){return u<0&&s.ch==0?s.line>n.first?Be(n,ge(s.line-1)):null:u>0&&s.ch==(l||Ue(n,s.line)).text.length?s.line<n.first+n.size-1?ge(s.line+1,0):null:new ge(s.line,s.ch+u)}function Ld(n){n.setSelection(ge(n.firstLine(),0),ge(n.lastLine()),Ee)}function Cd(n,s,u){var l={canceled:!1,from:s.from,to:s.to,text:s.text,origin:s.origin,cancel:function(){return l.canceled=!0}};return u&&(l.update=function(c,m,v,b){c&&(l.from=Be(n,c)),m&&(l.to=Be(n,m)),v&&(l.text=v),b!==void 0&&(l.origin=b)}),Ve(n,"beforeChange",n,l),n.cm&&Ve(n.cm,"beforeChange",n.cm,l),l.canceled?(n.cm&&(n.cm.curOp.updateInput=2),null):{from:l.from,to:l.to,text:l.text,origin:l.origin}}function hs(n,s,u){if(n.cm){if(!n.cm.curOp)return Qt(n.cm,hs)(n,s,u);if(n.cm.state.suppressEdits)return}if(!((Wt(n,"beforeChange")||n.cm&&Wt(n.cm,"beforeChange"))&&(s=Cd(n,s,!0),!s))){var l=_f&&!u&&m0(n,s.from,s.to);if(l)for(var c=l.length-1;c>=0;--c)Rd(n,{from:l[c].from,to:l[c].to,text:c?[""]:s.text,origin:s.origin});else Rd(n,s)}}function Rd(n,s){if(!(s.text.length==1&&s.text[0]==""&&A(s.from,s.to)==0)){var u=ic(n,s);xd(n,s,u,n.cm?n.cm.curOp.id:NaN),La(n,s,u,Ru(n,s));var l=[];ji(n,function(c,m){!m&&K(l,c.history)==-1&&(kd(c.history,s),l.push(c.history)),La(c,s,null,Ru(c,s))})}}function al(n,s,u){var l=n.cm&&n.cm.state.suppressEdits;if(!(l&&!u)){for(var c=n.history,m,v=n.sel,b=s=="undo"?c.done:c.undone,S=s=="undo"?c.undone:c.done,E=0;E<b.length&&(m=b[E],!(u?m.ranges&&!m.equals(n.sel):!m.ranges));E++);if(E!=b.length){for(c.lastOrigin=c.lastSelOrigin=null;;)if(m=b.pop(),m.ranges){if(nl(m,S),u&&!m.equals(n.sel)){dn(n,m,{clearRedo:!1});return}v=m}else if(l){b.push(m);return}else break;var I=[];nl(v,S),S.push({changes:I,generation:c.generation}),c.generation=m.generation||++c.maxGeneration;for(var B=Wt(n,"beforeChange")||n.cm&&Wt(n.cm,"beforeChange"),j=function(he){var we=m.changes[he];if(we.origin=s,B&&!Cd(n,we,!1))return b.length=0,{};I.push(ac(n,we));var De=he?ic(n,we):me(b);La(n,we,De,_d(n,we)),!he&&n.cm&&n.cm.scrollIntoView({from:we.from,to:Yi(we)});var Fe=[];ji(n,function(Ie,Ge){!Ge&&K(Fe,Ie.history)==-1&&(kd(Ie.history,we),Fe.push(Ie.history)),La(Ie,we,null,_d(Ie,we))})},Z=m.changes.length-1;Z>=0;--Z){var ie=j(Z);if(ie)return ie.v}}}}function Pd(n,s){if(s!=0&&(n.first+=s,n.sel=new Xn(Ce(n.sel.ranges,function(c){return new Mt(ge(c.anchor.line+s,c.anchor.ch),ge(c.head.line+s,c.head.ch))}),n.sel.primIndex),n.cm)){Ln(n.cm,n.first,n.first-s,s);for(var u=n.cm.display,l=u.viewFrom;l<u.viewTo;l++)Xi(n.cm,l,"gutter")}}function La(n,s,u,l){if(n.cm&&!n.cm.curOp)return Qt(n.cm,La)(n,s,u,l);if(s.to.line<n.first){Pd(n,s.text.length-1-(s.to.line-s.from.line));return}if(!(s.from.line>n.lastLine())){if(s.from.line<n.first){var c=s.text.length-1-(n.first-s.from.line);Pd(n,c),s={from:ge(n.first,0),to:ge(s.to.line+c,s.to.ch),text:[me(s.text)],origin:s.origin}}var m=n.lastLine();s.to.line>m&&(s={from:s.from,to:ge(m,Ue(n,m).text.length),text:[s.text[0]],origin:s.origin}),s.removed=on(n,s.from,s.to),u||(u=ic(n,s)),n.cm?yx(n.cm,s,l):sc(n,s,l),rl(n,u,Ee),n.cantEdit&&sl(n,ge(n.firstLine(),0))&&(n.cantEdit=!1)}}function yx(n,s,u){var l=n.doc,c=n.display,m=s.from,v=s.to,b=!1,S=m.line;n.options.lineWrapping||(S=nt(di(Ue(l,m.line))),l.iter(S,v.line+1,function(Z){if(Z==c.maxLine)return b=!0,!0})),l.sel.contains(s.from,s.to)>-1&&Gi(n),sc(l,s,u,Jf(n)),n.options.lineWrapping||(l.iter(S,m.line+s.text.length,function(Z){var ie=Go(Z);ie>c.maxLineLength&&(c.maxLine=Z,c.maxLineLength=ie,c.maxLineChanged=!0,b=!1)}),b&&(n.curOp.updateMaxLine=!0)),l0(l,m.line),Ta(n,400);var E=s.text.length-(v.line-m.line)-1;s.full?Ln(n):m.line==v.line&&s.text.length==1&&!pd(n.doc,s)?Xi(n,m.line,"text"):Ln(n,m.line,v.line+1,E);var I=Wt(n,"changes"),B=Wt(n,"change");if(B||I){var j={from:m,to:v,text:s.text,removed:s.removed,origin:s.origin};B&&Kt(n,"change",n,j),I&&(n.curOp.changeObjs||(n.curOp.changeObjs=[])).push(j)}n.display.selForContextMenu=null}function fs(n,s,u,l,c){var m;l||(l=u),A(l,u)<0&&(m=[l,u],u=m[0],l=m[1]),typeof s=="string"&&(s=n.splitLines(s)),hs(n,{from:u,to:l,text:s,origin:c})}function Dd(n,s,u,l){u<n.line?n.line+=l:s<n.line&&(n.line=s,n.ch=0)}function Id(n,s,u,l){for(var c=0;c<n.length;++c){var m=n[c],v=!0;if(m.ranges){m.copied||(m=n[c]=m.deepCopy(),m.copied=!0);for(var b=0;b<m.ranges.length;b++)Dd(m.ranges[b].anchor,s,u,l),Dd(m.ranges[b].head,s,u,l);continue}for(var S=0;S<m.changes.length;++S){var E=m.changes[S];if(u<E.from.line)E.from=ge(E.from.line+l,E.from.ch),E.to=ge(E.to.line+l,E.to.ch);else if(s<=E.to.line){v=!1;break}}v||(n.splice(0,c+1),c=0)}}function kd(n,s){var u=s.from.line,l=s.to.line,c=s.text.length-(l-u)-1;Id(n.done,u,l,c),Id(n.undone,u,l,c)}function Ca(n,s,u,l){var c=s,m=s;return typeof s=="number"?m=Ue(n,xt(n,s)):c=nt(s),c==null?null:(l(m,c)&&n.cm&&Xi(n.cm,c,u),m)}function Ra(n){this.lines=n,this.parent=null;for(var s=0,u=0;u<n.length;++u)n[u].parent=this,s+=n[u].height;this.height=s}Ra.prototype={chunkSize:function(){return this.lines.length},removeInner:function(n,s){for(var u=n,l=n+s;u<l;++u){var c=this.lines[u];this.height-=c.height,_0(c),Kt(c,"delete")}this.lines.splice(n,s)},collapse:function(n){n.push.apply(n,this.lines)},insertInner:function(n,s,u){this.height+=u,this.lines=this.lines.slice(0,n).concat(s).concat(this.lines.slice(n));for(var l=0;l<s.length;++l)s[l].parent=this},iterN:function(n,s,u){for(var l=n+s;n<l;++n)if(u(this.lines[n]))return!0}};function Pa(n){this.children=n;for(var s=0,u=0,l=0;l<n.length;++l){var c=n[l];s+=c.chunkSize(),u+=c.height,c.parent=this}this.size=s,this.height=u,this.parent=null}Pa.prototype={chunkSize:function(){return this.size},removeInner:function(n,s){this.size-=s;for(var u=0;u<this.children.length;++u){var l=this.children[u],c=l.chunkSize();if(n<c){var m=Math.min(s,c-n),v=l.height;if(l.removeInner(n,m),this.height-=v-l.height,c==m&&(this.children.splice(u--,1),l.parent=null),(s-=m)==0)break;n=0}else n-=c}if(this.size-s<25&&(this.children.length>1||!(this.children[0]instanceof Ra))){var b=[];this.collapse(b),this.children=[new Ra(b)],this.children[0].parent=this}},collapse:function(n){for(var s=0;s<this.children.length;++s)this.children[s].collapse(n)},insertInner:function(n,s,u){this.size+=s.length,this.height+=u;for(var l=0;l<this.children.length;++l){var c=this.children[l],m=c.chunkSize();if(n<=m){if(c.insertInner(n,s,u),c.lines&&c.lines.length>50){for(var v=c.lines.length%25+25,b=v;b<c.lines.length;){var S=new Ra(c.lines.slice(b,b+=25));c.height-=S.height,this.children.splice(++l,0,S),S.parent=this}c.lines=c.lines.slice(0,v),this.maybeSpill()}break}n-=m}},maybeSpill:function(){if(!(this.children.length<=10)){var n=this;do{var s=n.children.splice(n.children.length-5,5),u=new Pa(s);if(n.parent){n.size-=u.size,n.height-=u.height;var c=K(n.parent.children,n);n.parent.children.splice(c+1,0,u)}else{var l=new Pa(n.children);l.parent=n,n.children=[l,u],n=l}u.parent=n.parent}while(n.children.length>10);n.parent.maybeSpill()}},iterN:function(n,s,u){for(var l=0;l<this.children.length;++l){var c=this.children[l],m=c.chunkSize();if(n<m){var v=Math.min(s,m-n);if(c.iterN(n,v,u))return!0;if((s-=v)==0)break;n=0}else n-=m}}};var Da=function(n,s,u){if(u)for(var l in u)u.hasOwnProperty(l)&&(this[l]=u[l]);this.doc=n,this.node=s};Da.prototype.clear=function(){var n=this.doc.cm,s=this.line.widgets,u=this.line,l=nt(u);if(!(l==null||!s)){for(var c=0;c<s.length;++c)s[c]==this&&s.splice(c--,1);s.length||(u.widgets=null);var m=xa(this);zt(u,Math.max(0,u.height-m)),n&&(Nn(n,function(){Nd(n,u,-m),Xi(n,l,"widget")}),Kt(n,"lineWidgetCleared",n,this,l))}},Da.prototype.changed=function(){var n=this,s=this.height,u=this.doc.cm,l=this.line;this.height=null;var c=xa(this)-s;!c||(Vi(this.doc,l)||zt(l,l.height+c),u&&Nn(u,function(){u.curOp.forceUpdate=!0,Nd(u,l,c),Kt(u,"lineWidgetChanged",u,n,nt(l))}))},Un(Da);function Nd(n,s,u){Li(s)<(n.curOp&&n.curOp.scrollTop||n.doc.scrollTop)&&Ku(n,u)}function _x(n,s,u,l){var c=new Da(n,u,l),m=n.cm;return m&&c.noHScroll&&(m.display.alignWidgets=!0),Ca(n,s,"widget",function(v){var b=v.widgets||(v.widgets=[]);if(c.insertAt==null?b.push(c):b.splice(Math.min(b.length,Math.max(0,c.insertAt)),0,c),c.line=v,m&&!Vi(n,v)){var S=Li(v)<n.scrollTop;zt(v,v.height+xa(c)),S&&Ku(m,c.height),m.curOp.forceUpdate=!0}return!0}),m&&Kt(m,"lineWidgetAdded",m,c,typeof s=="number"?s:nt(s)),c}var Fd=0,Ji=function(n,s){this.lines=[],this.type=s,this.doc=n,this.id=++Fd};Ji.prototype.clear=function(){if(!this.explicitlyCleared){var n=this.doc.cm,s=n&&!n.curOp;if(s&&Pr(n),Wt(this,"clear")){var u=this.find();u&&Kt(this,"clear",u.from,u.to)}for(var l=null,c=null,m=0;m<this.lines.length;++m){var v=this.lines[m],b=ma(v.markedSpans,this);n&&!this.collapsed?Xi(n,nt(v),"text"):n&&(b.to!=null&&(c=nt(v)),b.from!=null&&(l=nt(v))),v.markedSpans=h0(v.markedSpans,b),b.from==null&&this.collapsed&&!Vi(this.doc,v)&&n&&zt(v,rs(n.display))}if(n&&this.collapsed&&!n.options.lineWrapping)for(var S=0;S<this.lines.length;++S){var E=di(this.lines[S]),I=Go(E);I>n.display.maxLineLength&&(n.display.maxLine=E,n.display.maxLineLength=I,n.display.maxLineChanged=!0)}l!=null&&n&&this.collapsed&&Ln(n,l,c+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,n&&Td(n.doc)),n&&Kt(n,"markerCleared",n,this,l,c),s&&Dr(n),this.parent&&this.parent.clear()}},Ji.prototype.find=function(n,s){n==null&&this.type=="bookmark"&&(n=1);for(var u,l,c=0;c<this.lines.length;++c){var m=this.lines[c],v=ma(m.markedSpans,this);if(v.from!=null&&(u=ge(s?m:nt(m),v.from),n==-1))return u;if(v.to!=null&&(l=ge(s?m:nt(m),v.to),n==1))return l}return u&&{from:u,to:l}},Ji.prototype.changed=function(){var n=this,s=this.find(-1,!0),u=this,l=this.doc.cm;!s||!l||Nn(l,function(){var c=s.line,m=nt(s.line),v=zu(l,m);if(v&&(Wf(v),l.curOp.selectionChanged=l.curOp.forceUpdate=!0),l.curOp.updateMaxLine=!0,!Vi(u.doc,c)&&u.height!=null){var b=u.height;u.height=null;var S=xa(u)-b;S&&zt(c,c.height+S)}Kt(l,"markerChanged",l,n)})},Ji.prototype.attachLine=function(n){if(!this.lines.length&&this.doc.cm){var s=this.doc.cm.curOp;(!s.maybeHiddenMarkers||K(s.maybeHiddenMarkers,this)==-1)&&(s.maybeUnhiddenMarkers||(s.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(n)},Ji.prototype.detachLine=function(n){if(this.lines.splice(K(this.lines,n),1),!this.lines.length&&this.doc.cm){var s=this.doc.cm.curOp;(s.maybeHiddenMarkers||(s.maybeHiddenMarkers=[])).push(this)}},Un(Ji);function ds(n,s,u,l,c){if(l&&l.shared)return bx(n,s,u,l,c);if(n.cm&&!n.cm.curOp)return Qt(n.cm,ds)(n,s,u,l,c);var m=new Ji(n,c),v=A(s,u);if(l&&Pe(l,m,!1),v>0||v==0&&m.clearWhenEmpty!==!1)return m;if(m.replacedWith&&(m.collapsed=!0,m.widgetNode=D("span",[m.replacedWith],"CodeMirror-widget"),l.handleMouseEvents||m.widgetNode.setAttribute("cm-ignore-events","true"),l.insertLeft&&(m.widgetNode.insertLeft=!0)),m.collapsed){if(Ef(n,s.line,s,u,m)||s.line!=u.line&&Ef(n,u.line,s,u,m))throw new Error("Inserting collapsed marker partially overlapping an existing one");c0()}m.addToHistory&&xd(n,{from:s,to:u,origin:"markText"},n.sel,NaN);var b=s.line,S=n.cm,E;if(n.iter(b,u.line+1,function(B){S&&m.collapsed&&!S.options.lineWrapping&&di(B)==S.display.maxLine&&(E=!0),m.collapsed&&b!=s.line&&zt(B,0),f0(B,new Bo(m,b==s.line?s.ch:null,b==u.line?u.ch:null),n.cm&&n.cm.curOp),++b}),m.collapsed&&n.iter(s.line,u.line+1,function(B){Vi(n,B)&&zt(B,0)}),m.clearOnEnter&&xe(m,"beforeCursorEnter",function(){return m.clear()}),m.readOnly&&(u0(),(n.history.done.length||n.history.undone.length)&&n.clearHistory()),m.collapsed&&(m.id=++Fd,m.atomic=!0),S){if(E&&(S.curOp.updateMaxLine=!0),m.collapsed)Ln(S,s.line,u.line+1);else if(m.className||m.startStyle||m.endStyle||m.css||m.attributes||m.title)for(var I=s.line;I<=u.line;I++)Xi(S,I,"text");m.atomic&&Td(S.doc),Kt(S,"markerAdded",S,m)}return m}var Ia=function(n,s){this.markers=n,this.primary=s;for(var u=0;u<n.length;++u)n[u].parent=this};Ia.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var n=0;n<this.markers.length;++n)this.markers[n].clear();Kt(this,"clear")}},Ia.prototype.find=function(n,s){return this.primary.find(n,s)},Un(Ia);function bx(n,s,u,l,c){l=Pe(l),l.shared=!1;var m=[ds(n,s,u,l,c)],v=m[0],b=l.widgetNode;return ji(n,function(S){b&&(l.widgetNode=b.cloneNode(!0)),m.push(ds(S,Be(S,s),Be(S,u),l,c));for(var E=0;E<S.linked.length;++E)if(S.linked[E].isParent)return;v=me(m)}),new Ia(m,v)}function Od(n){return n.findMarks(ge(n.first,0),n.clipPos(ge(n.lastLine())),function(s){return s.parent})}function wx(n,s){for(var u=0;u<s.length;u++){var l=s[u],c=l.find(),m=n.clipPos(c.from),v=n.clipPos(c.to);if(A(m,v)){var b=ds(n,m,v,l.primary,l.primary.type);l.markers.push(b),b.parent=l}}}function Mx(n){for(var s=function(l){var c=n[l],m=[c.primary.doc];ji(c.primary.doc,function(S){return m.push(S)});for(var v=0;v<c.markers.length;v++){var b=c.markers[v];K(m,b.doc)==-1&&(b.parent=null,c.markers.splice(v--,1))}},u=0;u<n.length;u++)s(u)}var Sx=0,Cn=function(n,s,u,l,c){if(!(this instanceof Cn))return new Cn(n,s,u,l,c);u==null&&(u=0),Pa.call(this,[new Ra([new ts("",null)])]),this.first=u,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=u;var m=ge(u,0);this.sel=qi(m),this.history=new tl(null),this.id=++Sx,this.modeOption=s,this.lineSep=l,this.direction=c=="rtl"?"rtl":"ltr",this.extend=!1,typeof n=="string"&&(n=this.splitLines(n)),sc(this,{from:m,to:m,text:n}),dn(this,qi(m),Ee)};Cn.prototype=ht(Pa.prototype,{constructor:Cn,iter:function(n,s,u){u?this.iterN(n-this.first,s-n,u):this.iterN(this.first,this.first+this.size,n)},insert:function(n,s){for(var u=0,l=0;l<s.length;++l)u+=s[l].height;this.insertInner(n-this.first,s,u)},remove:function(n,s){this.removeInner(n-this.first,s)},getValue:function(n){var s=Gn(this,this.first,this.first+this.size);return n===!1?s:s.join(n||this.lineSeparator())},setValue:$t(function(n){var s=ge(this.first,0),u=this.first+this.size-1;hs(this,{from:s,to:ge(u,Ue(this,u).text.length),text:this.splitLines(n),origin:"setValue",full:!0},!0),this.cm&&ba(this.cm,0,0),dn(this,qi(s),Ee)}),replaceRange:function(n,s,u,l){s=Be(this,s),u=u?Be(this,u):s,fs(this,n,s,u,l)},getRange:function(n,s,u){var l=on(this,Be(this,n),Be(this,s));return u===!1?l:u===""?l.join(""):l.join(u||this.lineSeparator())},getLine:function(n){var s=this.getLineHandle(n);return s&&s.text},getLineHandle:function(n){if(Jt(this,n))return Ue(this,n)},getLineNumber:function(n){return nt(n)},getLineHandleVisualStart:function(n){return typeof n=="number"&&(n=Ue(this,n)),di(n)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(n){return Be(this,n)},getCursor:function(n){var s=this.sel.primary(),u;return n==null||n=="head"?u=s.head:n=="anchor"?u=s.anchor:n=="end"||n=="to"||n===!1?u=s.to():u=s.from(),u},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:$t(function(n,s,u){wd(this,Be(this,typeof n=="number"?ge(n,s||0):n),null,u)}),setSelection:$t(function(n,s,u){wd(this,Be(this,n),Be(this,s||n),u)}),extendSelection:$t(function(n,s,u){il(this,Be(this,n),s&&Be(this,s),u)}),extendSelections:$t(function(n,s){bd(this,Vn(this,n),s)}),extendSelectionsBy:$t(function(n,s){var u=Ce(this.sel.ranges,n);bd(this,Vn(this,u),s)}),setSelections:$t(function(n,s,u){if(!!n.length){for(var l=[],c=0;c<n.length;c++)l[c]=new Mt(Be(this,n[c].anchor),Be(this,n[c].head||n[c].anchor));s==null&&(s=Math.min(n.length-1,this.sel.primIndex)),dn(this,ri(this.cm,l,s),u)}}),addSelection:$t(function(n,s,u){var l=this.sel.ranges.slice(0);l.push(new Mt(Be(this,n),Be(this,s||n))),dn(this,ri(this.cm,l,l.length-1),u)}),getSelection:function(n){for(var s=this.sel.ranges,u,l=0;l<s.length;l++){var c=on(this,s[l].from(),s[l].to());u=u?u.concat(c):c}return n===!1?u:u.join(n||this.lineSeparator())},getSelections:function(n){for(var s=[],u=this.sel.ranges,l=0;l<u.length;l++){var c=on(this,u[l].from(),u[l].to());n!==!1&&(c=c.join(n||this.lineSeparator())),s[l]=c}return s},replaceSelection:function(n,s,u){for(var l=[],c=0;c<this.sel.ranges.length;c++)l[c]=n;this.replaceSelections(l,s,u||"+input")},replaceSelections:$t(function(n,s,u){for(var l=[],c=this.sel,m=0;m<c.ranges.length;m++){var v=c.ranges[m];l[m]={from:v.from(),to:v.to(),text:this.splitLines(n[m]),origin:u}}for(var b=s&&s!="end"&&hx(this,l,s),S=l.length-1;S>=0;S--)hs(this,l[S]);b?Md(this,b):this.cm&&os(this.cm)}),undo:$t(function(){al(this,"undo")}),redo:$t(function(){al(this,"redo")}),undoSelection:$t(function(){al(this,"undo",!0)}),redoSelection:$t(function(){al(this,"redo",!0)}),setExtending:function(n){this.extend=n},getExtending:function(){return this.extend},historySize:function(){for(var n=this.history,s=0,u=0,l=0;l<n.done.length;l++)n.done[l].ranges||++s;for(var c=0;c<n.undone.length;c++)n.undone[c].ranges||++u;return{undo:s,redo:u}},clearHistory:function(){var n=this;this.history=new tl(this.history),ji(this,function(s){return s.history=n.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(n){return n&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(n){return this.history.generation==(n||this.cleanGeneration)},getHistory:function(){return{done:us(this.history.done),undone:us(this.history.undone)}},setHistory:function(n){var s=this.history=new tl(this.history);s.done=us(n.done.slice(0),null,!0),s.undone=us(n.undone.slice(0),null,!0)},setGutterMarker:$t(function(n,s,u){return Ca(this,n,"gutter",function(l){var c=l.gutterMarkers||(l.gutterMarkers={});return c[s]=u,!u&&pe(c)&&(l.gutterMarkers=null),!0})}),clearGutter:$t(function(n){var s=this;this.iter(function(u){u.gutterMarkers&&u.gutterMarkers[n]&&Ca(s,u,"gutter",function(){return u.gutterMarkers[n]=null,pe(u.gutterMarkers)&&(u.gutterMarkers=null),!0})})}),lineInfo:function(n){var s;if(typeof n=="number"){if(!Jt(this,n)||(s=n,n=Ue(this,n),!n))return null}else if(s=nt(n),s==null)return null;return{line:s,handle:n,text:n.text,gutterMarkers:n.gutterMarkers,textClass:n.textClass,bgClass:n.bgClass,wrapClass:n.wrapClass,widgets:n.widgets}},addLineClass:$t(function(n,s,u){return Ca(this,n,s=="gutter"?"gutter":"class",function(l){var c=s=="text"?"textClass":s=="background"?"bgClass":s=="gutter"?"gutterClass":"wrapClass";if(!l[c])l[c]=u;else{if(Q(u).test(l[c]))return!1;l[c]+=" "+u}return!0})}),removeLineClass:$t(function(n,s,u){return Ca(this,n,s=="gutter"?"gutter":"class",function(l){var c=s=="text"?"textClass":s=="background"?"bgClass":s=="gutter"?"gutterClass":"wrapClass",m=l[c];if(m)if(u==null)l[c]=null;else{var v=m.match(Q(u));if(!v)return!1;var b=v.index+v[0].length;l[c]=m.slice(0,v.index)+(!v.index||b==m.length?"":" ")+m.slice(b)||null}else return!1;return!0})}),addLineWidget:$t(function(n,s,u){return _x(this,n,s,u)}),removeLineWidget:function(n){n.clear()},markText:function(n,s,u){return ds(this,Be(this,n),Be(this,s),u,u&&u.type||"range")},setBookmark:function(n,s){var u={replacedWith:s&&(s.nodeType==null?s.widget:s),insertLeft:s&&s.insertLeft,clearWhenEmpty:!1,shared:s&&s.shared,handleMouseEvents:s&&s.handleMouseEvents};return n=Be(this,n),ds(this,n,n,u,"bookmark")},findMarksAt:function(n){n=Be(this,n);var s=[],u=Ue(this,n.line).markedSpans;if(u)for(var l=0;l<u.length;++l){var c=u[l];(c.from==null||c.from<=n.ch)&&(c.to==null||c.to>=n.ch)&&s.push(c.marker.parent||c.marker)}return s},findMarks:function(n,s,u){n=Be(this,n),s=Be(this,s);var l=[],c=n.line;return this.iter(n.line,s.line+1,function(m){var v=m.markedSpans;if(v)for(var b=0;b<v.length;b++){var S=v[b];!(S.to!=null&&c==n.line&&n.ch>=S.to||S.from==null&&c!=n.line||S.from!=null&&c==s.line&&S.from>=s.ch)&&(!u||u(S.marker))&&l.push(S.marker.parent||S.marker)}++c}),l},getAllMarks:function(){var n=[];return this.iter(function(s){var u=s.markedSpans;if(u)for(var l=0;l<u.length;++l)u[l].from!=null&&n.push(u[l].marker)}),n},posFromIndex:function(n){var s,u=this.first,l=this.lineSeparator().length;return this.iter(function(c){var m=c.text.length+l;if(m>n)return s=n,!0;n-=m,++u}),Be(this,ge(u,s))},indexFromPos:function(n){n=Be(this,n);var s=n.ch;if(n.line<this.first||n.ch<0)return 0;var u=this.lineSeparator().length;return this.iter(this.first,n.line,function(l){s+=l.text.length+u}),s},copy:function(n){var s=new Cn(Gn(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return s.scrollTop=this.scrollTop,s.scrollLeft=this.scrollLeft,s.sel=this.sel,s.extend=!1,n&&(s.history.undoDepth=this.history.undoDepth,s.setHistory(this.getHistory())),s},linkedDoc:function(n){n||(n={});var s=this.first,u=this.first+this.size;n.from!=null&&n.from>s&&(s=n.from),n.to!=null&&n.to<u&&(u=n.to);var l=new Cn(Gn(this,s,u),n.mode||this.modeOption,s,this.lineSep,this.direction);return n.sharedHist&&(l.history=this.history),(this.linked||(this.linked=[])).push({doc:l,sharedHist:n.sharedHist}),l.linked=[{doc:this,isParent:!0,sharedHist:n.sharedHist}],wx(l,Od(this)),l},unlinkDoc:function(n){if(n instanceof It&&(n=n.doc),this.linked)for(var s=0;s<this.linked.length;++s){var u=this.linked[s];if(u.doc==n){this.linked.splice(s,1),n.unlinkDoc(this),Mx(Od(this));break}}if(n.history==this.history){var l=[n.id];ji(n,function(c){return l.push(c.id)},!0),n.history=new tl(null),n.history.done=us(this.history.done,l),n.history.undone=us(this.history.undone,l)}},iterLinkedDocs:function(n){ji(this,n)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(n){return this.lineSep?n.split(this.lineSep):F(n)},lineSeparator:function(){return this.lineSep||`
`},setDirection:$t(function(n){n!="rtl"&&(n="ltr"),n!=this.direction&&(this.direction=n,this.iter(function(s){return s.order=null}),this.cm&&fx(this.cm))})}),Cn.prototype.eachLine=Cn.prototype.iter;var zd=0;function Tx(n){var s=this;if(Bd(s),!(ft(s,n)||Ci(s.display,n))){Dt(n),p&&(zd=+new Date);var u=Ar(s,n,!0),l=n.dataTransfer.files;if(!(!u||s.isReadOnly()))if(l&&l.length&&window.FileReader&&window.File)for(var c=l.length,m=Array(c),v=0,b=function(){++v==c&&Qt(s,function(){u=Be(s.doc,u);var Z={from:u,to:u,text:s.doc.splitLines(m.filter(function(ie){return ie!=null}).join(s.doc.lineSeparator())),origin:"paste"};hs(s.doc,Z),Md(s.doc,qi(Be(s.doc,u),Be(s.doc,Yi(Z))))})()},S=function(Z,ie){if(s.options.allowDropFileTypes&&K(s.options.allowDropFileTypes,Z.type)==-1){b();return}var he=new FileReader;he.onerror=function(){return b()},he.onload=function(){var we=he.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(we)){b();return}m[ie]=we,b()},he.readAsText(Z)},E=0;E<l.length;E++)S(l[E],E);else{if(s.state.draggingText&&s.doc.sel.contains(u)>-1){s.state.draggingText(n),setTimeout(function(){return s.display.input.focus()},20);return}try{var I=n.dataTransfer.getData("Text");if(I){var B;if(s.state.draggingText&&!s.state.draggingText.copy&&(B=s.listSelections()),rl(s.doc,qi(u,u)),B)for(var j=0;j<B.length;++j)fs(s.doc,"",B[j].anchor,B[j].head,"drag");s.replaceSelection(I,"around","paste"),s.display.input.focus()}}catch{}}}}function Ex(n,s){if(p&&(!n.state.draggingText||+new Date-zd<100)){Ti(s);return}if(!(ft(n,s)||Ci(n.display,s))&&(s.dataTransfer.setData("Text",n.getSelection()),s.dataTransfer.effectAllowed="copyMove",s.dataTransfer.setDragImage&&!T)){var u=W("img",null,null,"position: fixed; left: 0; top: 0;");u.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",_&&(u.width=u.height=1,n.display.wrapper.appendChild(u),u._top=u.offsetTop),s.dataTransfer.setDragImage(u,0,0),_&&u.parentNode.removeChild(u)}}function Ax(n,s){var u=Ar(n,s);if(!!u){var l=document.createDocumentFragment();Zu(n,u,l),n.display.dragCursor||(n.display.dragCursor=W("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),n.display.lineSpace.insertBefore(n.display.dragCursor,n.display.cursorDiv)),H(n.display.dragCursor,l)}}function Bd(n){n.display.dragCursor&&(n.display.lineSpace.removeChild(n.display.dragCursor),n.display.dragCursor=null)}function Hd(n){if(!!document.getElementsByClassName){for(var s=document.getElementsByClassName("CodeMirror"),u=[],l=0;l<s.length;l++){var c=s[l].CodeMirror;c&&u.push(c)}u.length&&u[0].operation(function(){for(var m=0;m<u.length;m++)n(u[m])})}}var Ud=!1;function Lx(){Ud||(Cx(),Ud=!0)}function Cx(){var n;xe(window,"resize",function(){n==null&&(n=setTimeout(function(){n=null,Hd(Rx)},100))}),xe(window,"blur",function(){return Hd(as)})}function Rx(n){var s=n.display;s.cachedCharWidth=s.cachedTextHeight=s.cachedPaddingH=null,s.scrollbarsClipped=!1,n.setSize()}for(var Ki={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},ka=0;ka<10;ka++)Ki[ka+48]=Ki[ka+96]=String(ka);for(var ol=65;ol<=90;ol++)Ki[ol]=String.fromCharCode(ol);for(var Na=1;Na<=12;Na++)Ki[Na+111]=Ki[Na+63235]="F"+Na;var Pi={};Pi.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Pi.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Pi.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Pi.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Pi.default=C?Pi.macDefault:Pi.pcDefault;function Px(n){var s=n.split(/-(?!$)/);n=s[s.length-1];for(var u,l,c,m,v=0;v<s.length-1;v++){var b=s[v];if(/^(cmd|meta|m)$/i.test(b))m=!0;else if(/^a(lt)?$/i.test(b))u=!0;else if(/^(c|ctrl|control)$/i.test(b))l=!0;else if(/^s(hift)?$/i.test(b))c=!0;else throw new Error("Unrecognized modifier name: "+b)}return u&&(n="Alt-"+n),l&&(n="Ctrl-"+n),m&&(n="Cmd-"+n),c&&(n="Shift-"+n),n}function Dx(n){var s={};for(var u in n)if(n.hasOwnProperty(u)){var l=n[u];if(/^(name|fallthrough|(de|at)tach)$/.test(u))continue;if(l=="..."){delete n[u];continue}for(var c=Ce(u.split(" "),Px),m=0;m<c.length;m++){var v=void 0,b=void 0;m==c.length-1?(b=c.join(" "),v=l):(b=c.slice(0,m+1).join(" "),v="...");var S=s[b];if(!S)s[b]=v;else if(S!=v)throw new Error("Inconsistent bindings for "+b)}delete n[u]}for(var E in s)n[E]=s[E];return n}function ps(n,s,u,l){s=ll(s);var c=s.call?s.call(n,l):s[n];if(c===!1)return"nothing";if(c==="...")return"multi";if(c!=null&&u(c))return"handled";if(s.fallthrough){if(Object.prototype.toString.call(s.fallthrough)!="[object Array]")return ps(n,s.fallthrough,u,l);for(var m=0;m<s.fallthrough.length;m++){var v=ps(n,s.fallthrough[m],u,l);if(v)return v}}}function Wd(n){var s=typeof n=="string"?n:Ki[n.keyCode];return s=="Ctrl"||s=="Alt"||s=="Shift"||s=="Mod"}function Gd(n,s,u){var l=n;return s.altKey&&l!="Alt"&&(n="Alt-"+n),(J?s.metaKey:s.ctrlKey)&&l!="Ctrl"&&(n="Ctrl-"+n),(J?s.ctrlKey:s.metaKey)&&l!="Mod"&&(n="Cmd-"+n),!u&&s.shiftKey&&l!="Shift"&&(n="Shift-"+n),n}function Vd(n,s){if(_&&n.keyCode==34&&n.char)return!1;var u=Ki[n.keyCode];return u==null||n.altGraphKey?!1:(n.keyCode==3&&n.code&&(u=n.code),Gd(u,n,s))}function ll(n){return typeof n=="string"?Pi[n]:n}function ms(n,s){for(var u=n.doc.sel.ranges,l=[],c=0;c<u.length;c++){for(var m=s(u[c]);l.length&&A(m.from,me(l).to)<=0;){var v=l.pop();if(A(v.from,m.from)<0){m.from=v.from;break}}l.push(m)}Nn(n,function(){for(var b=l.length-1;b>=0;b--)fs(n.doc,"",l[b].from,l[b].to,"+delete");os(n)})}function uc(n,s,u){var l=Xe(n.text,s+u,u);return l<0||l>n.text.length?null:l}function cc(n,s,u){var l=uc(n,s.ch,u);return l==null?null:new ge(s.line,l,u<0?"after":"before")}function hc(n,s,u,l,c){if(n){s.doc.direction=="rtl"&&(c=-c);var m=Te(u,s.doc.direction);if(m){var v=c<0?me(m):m[0],b=c<0==(v.level==1),S=b?"after":"before",E;if(v.level>0||s.doc.direction=="rtl"){var I=is(s,u);E=c<0?u.text.length-1:0;var B=mi(s,I,E).top;E=Y(function(j){return mi(s,I,j).top==B},c<0==(v.level==1)?v.from:v.to-1,E),S=="before"&&(E=uc(u,E,1))}else E=c<0?v.to:v.from;return new ge(l,E,S)}}return new ge(l,c<0?u.text.length:0,c<0?"before":"after")}function Ix(n,s,u,l){var c=Te(s,n.doc.direction);if(!c)return cc(s,u,l);u.ch>=s.text.length?(u.ch=s.text.length,u.sticky="before"):u.ch<=0&&(u.ch=0,u.sticky="after");var m=ne(c,u.ch,u.sticky),v=c[m];if(n.doc.direction=="ltr"&&v.level%2==0&&(l>0?v.to>u.ch:v.from<u.ch))return cc(s,u,l);var b=function(De,Fe){return uc(s,De instanceof ge?De.ch:De,Fe)},S,E=function(De){return n.options.lineWrapping?(S=S||is(n,s),jf(n,s,S,De)):{begin:0,end:s.text.length}},I=E(u.sticky=="before"?b(u,-1):u.ch);if(n.doc.direction=="rtl"||v.level==1){var B=v.level==1==l<0,j=b(u,B?1:-1);if(j!=null&&(B?j<=v.to&&j<=I.end:j>=v.from&&j>=I.begin)){var Z=B?"before":"after";return new ge(u.line,j,Z)}}var ie=function(De,Fe,Ie){for(var Ge=function(Lt,en){return en?new ge(u.line,b(Lt,1),"before"):new ge(u.line,Lt,"after")};De>=0&&De<c.length;De+=Fe){var Qe=c[De],je=Fe>0==(Qe.level!=1),pt=je?Ie.begin:b(Ie.end,-1);if(Qe.from<=pt&&pt<Qe.to||(pt=je?Qe.from:b(Qe.to,-1),Ie.begin<=pt&&pt<Ie.end))return Ge(pt,je)}},he=ie(m+l,l,I);if(he)return he;var we=l>0?I.end:b(I.begin,-1);return we!=null&&!(l>0&&we==s.text.length)&&(he=ie(l>0?0:c.length-1,l,E(we)),he)?he:null}var Fa={selectAll:Ld,singleSelection:function(n){return n.setSelection(n.getCursor("anchor"),n.getCursor("head"),Ee)},killLine:function(n){return ms(n,function(s){if(s.empty()){var u=Ue(n.doc,s.head.line).text.length;return s.head.ch==u&&s.head.line<n.lastLine()?{from:s.head,to:ge(s.head.line+1,0)}:{from:s.head,to:ge(s.head.line,u)}}else return{from:s.from(),to:s.to()}})},deleteLine:function(n){return ms(n,function(s){return{from:ge(s.from().line,0),to:Be(n.doc,ge(s.to().line+1,0))}})},delLineLeft:function(n){return ms(n,function(s){return{from:ge(s.from().line,0),to:s.from()}})},delWrappedLineLeft:function(n){return ms(n,function(s){var u=n.charCoords(s.head,"div").top+5,l=n.coordsChar({left:0,top:u},"div");return{from:l,to:s.from()}})},delWrappedLineRight:function(n){return ms(n,function(s){var u=n.charCoords(s.head,"div").top+5,l=n.coordsChar({left:n.display.lineDiv.offsetWidth+100,top:u},"div");return{from:s.from(),to:l}})},undo:function(n){return n.undo()},redo:function(n){return n.redo()},undoSelection:function(n){return n.undoSelection()},redoSelection:function(n){return n.redoSelection()},goDocStart:function(n){return n.extendSelection(ge(n.firstLine(),0))},goDocEnd:function(n){return n.extendSelection(ge(n.lastLine()))},goLineStart:function(n){return n.extendSelectionsBy(function(s){return Xd(n,s.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(n){return n.extendSelectionsBy(function(s){return Zd(n,s.head)},{origin:"+move",bias:1})},goLineEnd:function(n){return n.extendSelectionsBy(function(s){return kx(n,s.head.line)},{origin:"+move",bias:-1})},goLineRight:function(n){return n.extendSelectionsBy(function(s){var u=n.cursorCoords(s.head,"div").top+5;return n.coordsChar({left:n.display.lineDiv.offsetWidth+100,top:u},"div")},Ze)},goLineLeft:function(n){return n.extendSelectionsBy(function(s){var u=n.cursorCoords(s.head,"div").top+5;return n.coordsChar({left:0,top:u},"div")},Ze)},goLineLeftSmart:function(n){return n.extendSelectionsBy(function(s){var u=n.cursorCoords(s.head,"div").top+5,l=n.coordsChar({left:0,top:u},"div");return l.ch<n.getLine(l.line).search(/\S/)?Zd(n,s.head):l},Ze)},goLineUp:function(n){return n.moveV(-1,"line")},goLineDown:function(n){return n.moveV(1,"line")},goPageUp:function(n){return n.moveV(-1,"page")},goPageDown:function(n){return n.moveV(1,"page")},goCharLeft:function(n){return n.moveH(-1,"char")},goCharRight:function(n){return n.moveH(1,"char")},goColumnLeft:function(n){return n.moveH(-1,"column")},goColumnRight:function(n){return n.moveH(1,"column")},goWordLeft:function(n){return n.moveH(-1,"word")},goGroupRight:function(n){return n.moveH(1,"group")},goGroupLeft:function(n){return n.moveH(-1,"group")},goWordRight:function(n){return n.moveH(1,"word")},delCharBefore:function(n){return n.deleteH(-1,"codepoint")},delCharAfter:function(n){return n.deleteH(1,"char")},delWordBefore:function(n){return n.deleteH(-1,"word")},delWordAfter:function(n){return n.deleteH(1,"word")},delGroupBefore:function(n){return n.deleteH(-1,"group")},delGroupAfter:function(n){return n.deleteH(1,"group")},indentAuto:function(n){return n.indentSelection("smart")},indentMore:function(n){return n.indentSelection("add")},indentLess:function(n){return n.indentSelection("subtract")},insertTab:function(n){return n.replaceSelection("	")},insertSoftTab:function(n){for(var s=[],u=n.listSelections(),l=n.options.tabSize,c=0;c<u.length;c++){var m=u[c].from(),v=ze(n.getLine(m.line),m.ch,l);s.push(Le(l-v%l))}n.replaceSelections(s)},defaultTab:function(n){n.somethingSelected()?n.indentSelection("add"):n.execCommand("insertTab")},transposeChars:function(n){return Nn(n,function(){for(var s=n.listSelections(),u=[],l=0;l<s.length;l++)if(!!s[l].empty()){var c=s[l].head,m=Ue(n.doc,c.line).text;if(m){if(c.ch==m.length&&(c=new ge(c.line,c.ch-1)),c.ch>0)c=new ge(c.line,c.ch+1),n.replaceRange(m.charAt(c.ch-1)+m.charAt(c.ch-2),ge(c.line,c.ch-2),c,"+transpose");else if(c.line>n.doc.first){var v=Ue(n.doc,c.line-1).text;v&&(c=new ge(c.line,1),n.replaceRange(m.charAt(0)+n.doc.lineSeparator()+v.charAt(v.length-1),ge(c.line-1,v.length-1),c,"+transpose"))}}u.push(new Mt(c,c))}n.setSelections(u)})},newlineAndIndent:function(n){return Nn(n,function(){for(var s=n.listSelections(),u=s.length-1;u>=0;u--)n.replaceRange(n.doc.lineSeparator(),s[u].anchor,s[u].head,"+input");s=n.listSelections();for(var l=0;l<s.length;l++)n.indentLine(s[l].from().line,null,!0);os(n)})},openLine:function(n){return n.replaceSelection(`
`,"start")},toggleOverwrite:function(n){return n.toggleOverwrite()}};function Xd(n,s){var u=Ue(n.doc,s),l=di(u);return l!=u&&(s=nt(l)),hc(!0,n,l,s,1)}function kx(n,s){var u=Ue(n.doc,s),l=v0(u);return l!=u&&(s=nt(l)),hc(!0,n,u,s,-1)}function Zd(n,s){var u=Xd(n,s.line),l=Ue(n.doc,u.line),c=Te(l,n.doc.direction);if(!c||c[0].level==0){var m=Math.max(u.ch,l.text.search(/\S/)),v=s.line==u.line&&s.ch<=m&&s.ch;return ge(u.line,v?0:m,u.sticky)}return u}function ul(n,s,u){if(typeof s=="string"&&(s=Fa[s],!s))return!1;n.display.input.ensurePolled();var l=n.display.shift,c=!1;try{n.isReadOnly()&&(n.state.suppressEdits=!0),u&&(n.display.shift=!1),c=s(n)!=Re}finally{n.display.shift=l,n.state.suppressEdits=!1}return c}function Nx(n,s,u){for(var l=0;l<n.state.keyMaps.length;l++){var c=ps(s,n.state.keyMaps[l],u,n);if(c)return c}return n.options.extraKeys&&ps(s,n.options.extraKeys,u,n)||ps(s,n.options.keyMap,u,n)}var Fx=new $e;function Oa(n,s,u,l){var c=n.state.keySeq;if(c){if(Wd(s))return"handled";if(/\'$/.test(s)?n.state.keySeq=null:Fx.set(50,function(){n.state.keySeq==c&&(n.state.keySeq=null,n.display.input.reset())}),qd(n,c+" "+s,u,l))return!0}return qd(n,s,u,l)}function qd(n,s,u,l){var c=Nx(n,s,l);return c=="multi"&&(n.state.keySeq=s),c=="handled"&&Kt(n,"keyHandled",n,s,u),(c=="handled"||c=="multi")&&(Dt(u),qu(n)),!!c}function Yd(n,s){var u=Vd(s,!0);return u?s.shiftKey&&!n.state.keySeq?Oa(n,"Shift-"+u,s,function(l){return ul(n,l,!0)})||Oa(n,u,s,function(l){if(typeof l=="string"?/^go[A-Z]/.test(l):l.motion)return ul(n,l)}):Oa(n,u,s,function(l){return ul(n,l)}):!1}function Ox(n,s,u){return Oa(n,"'"+u+"'",s,function(l){return ul(n,l,!0)})}var fc=null;function jd(n){var s=this;if(!(n.target&&n.target!=s.display.input.getField())&&(s.curOp.focus=Me(),!ft(s,n))){p&&d<11&&n.keyCode==27&&(n.returnValue=!1);var u=n.keyCode;s.display.shift=u==16||n.shiftKey;var l=Yd(s,n);_&&(fc=l?u:null,!l&&u==88&&!ae&&(C?n.metaKey:n.ctrlKey)&&s.replaceSelection("",null,"cut")),a&&!C&&!l&&u==46&&n.shiftKey&&!n.ctrlKey&&document.execCommand&&document.execCommand("cut"),u==18&&!/\bCodeMirror-crosshair\b/.test(s.display.lineDiv.className)&&zx(s)}}function zx(n){var s=n.display.lineDiv;Oe(s,"CodeMirror-crosshair");function u(l){(l.keyCode==18||!l.altKey)&&(X(s,"CodeMirror-crosshair"),st(document,"keyup",u),st(document,"mouseover",u))}xe(document,"keyup",u),xe(document,"mouseover",u)}function Jd(n){n.keyCode==16&&(this.doc.sel.shift=!1),ft(this,n)}function Kd(n){var s=this;if(!(n.target&&n.target!=s.display.input.getField())&&!(Ci(s.display,n)||ft(s,n)||n.ctrlKey&&!n.altKey||C&&n.metaKey)){var u=n.keyCode,l=n.charCode;if(_&&u==fc){fc=null,Dt(n);return}if(!(_&&(!n.which||n.which<10)&&Yd(s,n))){var c=String.fromCharCode(l==null?u:l);c!="\b"&&(Ox(s,n,c)||s.display.input.onKeyPress(n))}}}var Bx=400,dc=function(n,s,u){this.time=n,this.pos=s,this.button=u};dc.prototype.compare=function(n,s,u){return this.time+Bx>n&&A(s,this.pos)==0&&u==this.button};var za,Ba;function Hx(n,s){var u=+new Date;return Ba&&Ba.compare(u,n,s)?(za=Ba=null,"triple"):za&&za.compare(u,n,s)?(Ba=new dc(u,n,s),za=null,"double"):(za=new dc(u,n,s),Ba=null,"single")}function Qd(n){var s=this,u=s.display;if(!(ft(s,n)||u.activeTouch&&u.input.supportsTouch())){if(u.input.ensurePolled(),u.shift=n.shiftKey,Ci(u,n)){g||(u.scroller.draggable=!1,setTimeout(function(){return u.scroller.draggable=!0},100));return}if(!pc(s,n)){var l=Ar(s,n),c=Qr(n),m=l?Hx(l,c):"single";window.focus(),c==1&&s.state.selectingText&&s.state.selectingText(n),!(l&&Ux(s,c,l,m,n))&&(c==1?l?Gx(s,l,m,n):Wn(n)==u.scroller&&Dt(n):c==2?(l&&il(s.doc,l),setTimeout(function(){return u.input.focus()},20)):c==3&&(oe?s.display.input.onContextMenu(n):Yu(s)))}}}function Ux(n,s,u,l,c){var m="Click";return l=="double"?m="Double"+m:l=="triple"&&(m="Triple"+m),m=(s==1?"Left":s==2?"Middle":"Right")+m,Oa(n,Gd(m,c),c,function(v){if(typeof v=="string"&&(v=Fa[v]),!v)return!1;var b=!1;try{n.isReadOnly()&&(n.state.suppressEdits=!0),b=v(n,u)!=Re}finally{n.state.suppressEdits=!1}return b})}function Wx(n,s,u){var l=n.getOption("configureMouse"),c=l?l(n,s,u):{};if(c.unit==null){var m=k?u.shiftKey&&u.metaKey:u.altKey;c.unit=m?"rectangle":s=="single"?"char":s=="double"?"word":"line"}return(c.extend==null||n.doc.extend)&&(c.extend=n.doc.extend||u.shiftKey),c.addNew==null&&(c.addNew=C?u.metaKey:u.ctrlKey),c.moveOnDrag==null&&(c.moveOnDrag=!(C?u.altKey:u.ctrlKey)),c}function Gx(n,s,u,l){p?setTimeout(We($f,n),0):n.curOp.focus=Me();var c=Wx(n,u,l),m=n.doc.sel,v;n.options.dragDrop&&Ei&&!n.isReadOnly()&&u=="single"&&(v=m.contains(s))>-1&&(A((v=m.ranges[v]).from(),s)<0||s.xRel>0)&&(A(v.to(),s)>0||s.xRel<0)?Vx(n,l,s,c):Xx(n,l,s,c)}function Vx(n,s,u,l){var c=n.display,m=!1,v=Qt(n,function(E){g&&(c.scroller.draggable=!1),n.state.draggingText=!1,n.state.delayingBlurEvent&&(n.hasFocus()?n.state.delayingBlurEvent=!1:Yu(n)),st(c.wrapper.ownerDocument,"mouseup",v),st(c.wrapper.ownerDocument,"mousemove",b),st(c.scroller,"dragstart",S),st(c.scroller,"drop",v),m||(Dt(E),l.addNew||il(n.doc,u,null,null,l.extend),g&&!T||p&&d==9?setTimeout(function(){c.wrapper.ownerDocument.body.focus({preventScroll:!0}),c.input.focus()},20):c.input.focus())}),b=function(E){m=m||Math.abs(s.clientX-E.clientX)+Math.abs(s.clientY-E.clientY)>=10},S=function(){return m=!0};g&&(c.scroller.draggable=!0),n.state.draggingText=v,v.copy=!l.moveOnDrag,xe(c.wrapper.ownerDocument,"mouseup",v),xe(c.wrapper.ownerDocument,"mousemove",b),xe(c.scroller,"dragstart",S),xe(c.scroller,"drop",v),n.state.delayingBlurEvent=!0,setTimeout(function(){return c.input.focus()},20),c.scroller.dragDrop&&c.scroller.dragDrop()}function $d(n,s,u){if(u=="char")return new Mt(s,s);if(u=="word")return n.findWordAt(s);if(u=="line")return new Mt(ge(s.line,0),Be(n.doc,ge(s.line+1,0)));var l=u(n,s);return new Mt(l.from,l.to)}function Xx(n,s,u,l){p&&Yu(n);var c=n.display,m=n.doc;Dt(s);var v,b,S=m.sel,E=S.ranges;if(l.addNew&&!l.extend?(b=m.sel.contains(u),b>-1?v=E[b]:v=new Mt(u,u)):(v=m.sel.primary(),b=m.sel.primIndex),l.unit=="rectangle")l.addNew||(v=new Mt(u,u)),u=Ar(n,s,!0,!0),b=-1;else{var I=$d(n,u,l.unit);l.extend?v=oc(v,I.anchor,I.head,l.extend):v=I}l.addNew?b==-1?(b=E.length,dn(m,ri(n,E.concat([v]),b),{scroll:!1,origin:"*mouse"})):E.length>1&&E[b].empty()&&l.unit=="char"&&!l.extend?(dn(m,ri(n,E.slice(0,b).concat(E.slice(b+1)),0),{scroll:!1,origin:"*mouse"}),S=m.sel):lc(m,b,v,Je):(b=0,dn(m,new Xn([v],0),Je),S=m.sel);var B=u;function j(Ie){if(A(B,Ie)!=0)if(B=Ie,l.unit=="rectangle"){for(var Ge=[],Qe=n.options.tabSize,je=ze(Ue(m,u.line).text,u.ch,Qe),pt=ze(Ue(m,Ie.line).text,Ie.ch,Qe),Lt=Math.min(je,pt),en=Math.max(je,pt),Nt=Math.min(u.line,Ie.line),Fn=Math.min(n.lastLine(),Math.max(u.line,Ie.line));Nt<=Fn;Nt++){var Rn=Ue(m,Nt).text,Vt=se(Rn,Lt,Qe);Lt==en?Ge.push(new Mt(ge(Nt,Vt),ge(Nt,Vt))):Rn.length>Vt&&Ge.push(new Mt(ge(Nt,Vt),ge(Nt,se(Rn,en,Qe))))}Ge.length||Ge.push(new Mt(u,u)),dn(m,ri(n,S.ranges.slice(0,b).concat(Ge),b),{origin:"*mouse",scroll:!1}),n.scrollIntoView(Ie)}else{var Pn=v,ln=$d(n,Ie,l.unit),qt=Pn.anchor,Xt;A(ln.anchor,qt)>0?(Xt=ln.head,qt=at(Pn.from(),ln.anchor)):(Xt=ln.anchor,qt=_e(Pn.to(),ln.head));var Bt=S.ranges.slice(0);Bt[b]=Zx(n,new Mt(Be(m,qt),Xt)),dn(m,ri(n,Bt,b),Je)}}var Z=c.wrapper.getBoundingClientRect(),ie=0;function he(Ie){var Ge=++ie,Qe=Ar(n,Ie,!0,l.unit=="rectangle");if(!!Qe)if(A(Qe,B)!=0){n.curOp.focus=Me(),j(Qe);var je=Ko(c,m);(Qe.line>=je.to||Qe.line<je.from)&&setTimeout(Qt(n,function(){ie==Ge&&he(Ie)}),150)}else{var pt=Ie.clientY<Z.top?-20:Ie.clientY>Z.bottom?20:0;pt&&setTimeout(Qt(n,function(){ie==Ge&&(c.scroller.scrollTop+=pt,he(Ie))}),50)}}function we(Ie){n.state.selectingText=!1,ie=1/0,Ie&&(Dt(Ie),c.input.focus()),st(c.wrapper.ownerDocument,"mousemove",De),st(c.wrapper.ownerDocument,"mouseup",Fe),m.history.lastSelOrigin=null}var De=Qt(n,function(Ie){Ie.buttons===0||!Qr(Ie)?we(Ie):he(Ie)}),Fe=Qt(n,we);n.state.selectingText=Fe,xe(c.wrapper.ownerDocument,"mousemove",De),xe(c.wrapper.ownerDocument,"mouseup",Fe)}function Zx(n,s){var u=s.anchor,l=s.head,c=Ue(n.doc,u.line);if(A(u,l)==0&&u.sticky==l.sticky)return s;var m=Te(c);if(!m)return s;var v=ne(m,u.ch,u.sticky),b=m[v];if(b.from!=u.ch&&b.to!=u.ch)return s;var S=v+(b.from==u.ch==(b.level!=1)?0:1);if(S==0||S==m.length)return s;var E;if(l.line!=u.line)E=(l.line-u.line)*(n.doc.direction=="ltr"?1:-1)>0;else{var I=ne(m,l.ch,l.sticky),B=I-v||(l.ch-u.ch)*(b.level==1?-1:1);I==S-1||I==S?E=B<0:E=B>0}var j=m[S+(E?-1:0)],Z=E==(j.level==1),ie=Z?j.from:j.to,he=Z?"after":"before";return u.ch==ie&&u.sticky==he?s:new Mt(new ge(u.line,ie,he),l)}function ep(n,s,u,l){var c,m;if(s.touches)c=s.touches[0].clientX,m=s.touches[0].clientY;else try{c=s.clientX,m=s.clientY}catch{return!1}if(c>=Math.floor(n.display.gutters.getBoundingClientRect().right))return!1;l&&Dt(s);var v=n.display,b=v.lineDiv.getBoundingClientRect();if(m>b.bottom||!Wt(n,u))return yn(s);m-=b.top-v.viewOffset;for(var S=0;S<n.display.gutterSpecs.length;++S){var E=v.gutters.childNodes[S];if(E&&E.getBoundingClientRect().right>=c){var I=_n(n.doc,m),B=n.display.gutterSpecs[S];return Ve(n,u,n,I,B.className,s),yn(s)}}}function pc(n,s){return ep(n,s,"gutterClick",!0)}function tp(n,s){Ci(n.display,s)||qx(n,s)||ft(n,s,"contextmenu")||oe||n.display.input.onContextMenu(s)}function qx(n,s){return Wt(n,"gutterContextMenu")?ep(n,s,"gutterContextMenu",!1):!1}function np(n){n.display.wrapper.className=n.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+n.options.theme.replace(/(^|\s)\s*/g," cm-s-"),ya(n)}var gs={toString:function(){return"CodeMirror.Init"}},ip={},cl={};function Yx(n){var s=n.optionHandlers;function u(l,c,m,v){n.defaults[l]=c,m&&(s[l]=v?function(b,S,E){E!=gs&&m(b,S,E)}:m)}n.defineOption=u,n.Init=gs,u("value","",function(l,c){return l.setValue(c)},!0),u("mode",null,function(l,c){l.doc.modeOption=c,rc(l)},!0),u("indentUnit",2,rc,!0),u("indentWithTabs",!1),u("smartIndent",!0),u("tabSize",4,function(l){Aa(l),ya(l),Ln(l)},!0),u("lineSeparator",null,function(l,c){if(l.doc.lineSep=c,!!c){var m=[],v=l.doc.first;l.doc.iter(function(S){for(var E=0;;){var I=S.text.indexOf(c,E);if(I==-1)break;E=I+c.length,m.push(ge(v,I))}v++});for(var b=m.length-1;b>=0;b--)fs(l.doc,c,m[b],ge(m[b].line,m[b].ch+c.length))}}),u("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,function(l,c,m){l.state.specialChars=new RegExp(c.source+(c.test("	")?"":"|	"),"g"),m!=gs&&l.refresh()}),u("specialCharPlaceholder",M0,function(l){return l.refresh()},!0),u("electricChars",!0),u("inputStyle",N?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),u("spellcheck",!1,function(l,c){return l.getInputField().spellcheck=c},!0),u("autocorrect",!1,function(l,c){return l.getInputField().autocorrect=c},!0),u("autocapitalize",!1,function(l,c){return l.getInputField().autocapitalize=c},!0),u("rtlMoveVisually",!q),u("wholeLineUpdateBefore",!0),u("theme","default",function(l){np(l),Ea(l)},!0),u("keyMap","default",function(l,c,m){var v=ll(c),b=m!=gs&&ll(m);b&&b.detach&&b.detach(l,v),v.attach&&v.attach(l,b||null)}),u("extraKeys",null),u("configureMouse",null),u("lineWrapping",!1,Jx,!0),u("gutters",[],function(l,c){l.display.gutterSpecs=nc(c,l.options.lineNumbers),Ea(l)},!0),u("fixedGutter",!0,function(l,c){l.display.gutters.style.left=c?Vu(l.display)+"px":"0",l.refresh()},!0),u("coverGutterNextToScrollbar",!1,function(l){return ls(l)},!0),u("scrollbarStyle","native",function(l){sd(l),ls(l),l.display.scrollbars.setScrollTop(l.doc.scrollTop),l.display.scrollbars.setScrollLeft(l.doc.scrollLeft)},!0),u("lineNumbers",!1,function(l,c){l.display.gutterSpecs=nc(l.options.gutters,c),Ea(l)},!0),u("firstLineNumber",1,Ea,!0),u("lineNumberFormatter",function(l){return l},Ea,!0),u("showCursorWhenSelecting",!1,_a,!0),u("resetSelectionOnContextMenu",!0),u("lineWiseCopyCut",!0),u("pasteLinesPerSelection",!0),u("selectionsMayTouch",!1),u("readOnly",!1,function(l,c){c=="nocursor"&&(as(l),l.display.input.blur()),l.display.input.readOnlyChanged(c)}),u("screenReaderLabel",null,function(l,c){c=c===""?null:c,l.display.input.screenReaderLabelChanged(c)}),u("disableInput",!1,function(l,c){c||l.display.input.reset()},!0),u("dragDrop",!0,jx),u("allowDropFileTypes",null),u("cursorBlinkRate",530),u("cursorScrollMargin",0),u("cursorHeight",1,_a,!0),u("singleCursorHeightPerLine",!0,_a,!0),u("workTime",100),u("workDelay",100),u("flattenSpans",!0,Aa,!0),u("addModeClass",!1,Aa,!0),u("pollInterval",100),u("undoDepth",200,function(l,c){return l.doc.history.undoDepth=c}),u("historyEventDelay",1250),u("viewportMargin",10,function(l){return l.refresh()},!0),u("maxHighlightLength",1e4,Aa,!0),u("moveInputWithCursor",!0,function(l,c){c||l.display.input.resetPosition()}),u("tabindex",null,function(l,c){return l.display.input.getField().tabIndex=c||""}),u("autofocus",null),u("direction","ltr",function(l,c){return l.doc.setDirection(c)},!0),u("phrases",null)}function jx(n,s,u){var l=u&&u!=gs;if(!s!=!l){var c=n.display.dragFunctions,m=s?xe:st;m(n.display.scroller,"dragstart",c.start),m(n.display.scroller,"dragenter",c.enter),m(n.display.scroller,"dragover",c.over),m(n.display.scroller,"dragleave",c.leave),m(n.display.scroller,"drop",c.drop)}}function Jx(n){n.options.lineWrapping?(Oe(n.display.wrapper,"CodeMirror-wrap"),n.display.sizer.style.minWidth="",n.display.sizerWidth=null):(X(n.display.wrapper,"CodeMirror-wrap"),ku(n)),Xu(n),Ln(n),ya(n),setTimeout(function(){return ls(n)},100)}function It(n,s){var u=this;if(!(this instanceof It))return new It(n,s);this.options=s=s?Pe(s):{},Pe(ip,s,!1);var l=s.value;typeof l=="string"?l=new Cn(l,s.mode,null,s.lineSeparator,s.direction):s.mode&&(l.modeOption=s.mode),this.doc=l;var c=new It.inputStyles[s.inputStyle](this),m=this.display=new ux(n,l,c,s);m.wrapper.CodeMirror=this,np(this),s.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),sd(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new $e,keySeq:null,specialChars:null},s.autofocus&&!N&&m.input.focus(),p&&d<11&&setTimeout(function(){return u.display.input.reset(!0)},20),Kx(this),Lx(),Pr(this),this.curOp.forceUpdate=!0,md(this,l),s.autofocus&&!N||this.hasFocus()?setTimeout(function(){u.hasFocus()&&!u.state.focused&&ju(u)},20):as(this);for(var v in cl)cl.hasOwnProperty(v)&&cl[v](this,s[v],gs);ld(this),s.finishInit&&s.finishInit(this);for(var b=0;b<mc.length;++b)mc[b](this);Dr(this),g&&s.lineWrapping&&getComputedStyle(m.lineDiv).textRendering=="optimizelegibility"&&(m.lineDiv.style.textRendering="auto")}It.defaults=ip,It.optionHandlers=cl;function Kx(n){var s=n.display;xe(s.scroller,"mousedown",Qt(n,Qd)),p&&d<11?xe(s.scroller,"dblclick",Qt(n,function(S){if(!ft(n,S)){var E=Ar(n,S);if(!(!E||pc(n,S)||Ci(n.display,S))){Dt(S);var I=n.findWordAt(E);il(n.doc,I.anchor,I.head)}}})):xe(s.scroller,"dblclick",function(S){return ft(n,S)||Dt(S)}),xe(s.scroller,"contextmenu",function(S){return tp(n,S)}),xe(s.input.getField(),"contextmenu",function(S){s.scroller.contains(S.target)||tp(n,S)});var u,l={end:0};function c(){s.activeTouch&&(u=setTimeout(function(){return s.activeTouch=null},1e3),l=s.activeTouch,l.end=+new Date)}function m(S){if(S.touches.length!=1)return!1;var E=S.touches[0];return E.radiusX<=1&&E.radiusY<=1}function v(S,E){if(E.left==null)return!0;var I=E.left-S.left,B=E.top-S.top;return I*I+B*B>20*20}xe(s.scroller,"touchstart",function(S){if(!ft(n,S)&&!m(S)&&!pc(n,S)){s.input.ensurePolled(),clearTimeout(u);var E=+new Date;s.activeTouch={start:E,moved:!1,prev:E-l.end<=300?l:null},S.touches.length==1&&(s.activeTouch.left=S.touches[0].pageX,s.activeTouch.top=S.touches[0].pageY)}}),xe(s.scroller,"touchmove",function(){s.activeTouch&&(s.activeTouch.moved=!0)}),xe(s.scroller,"touchend",function(S){var E=s.activeTouch;if(E&&!Ci(s,S)&&E.left!=null&&!E.moved&&new Date-E.start<300){var I=n.coordsChar(s.activeTouch,"page"),B;!E.prev||v(E,E.prev)?B=new Mt(I,I):!E.prev.prev||v(E,E.prev.prev)?B=n.findWordAt(I):B=new Mt(ge(I.line,0),Be(n.doc,ge(I.line+1,0))),n.setSelection(B.anchor,B.head),n.focus(),Dt(S)}c()}),xe(s.scroller,"touchcancel",c),xe(s.scroller,"scroll",function(){s.scroller.clientHeight&&(wa(n,s.scroller.scrollTop),Cr(n,s.scroller.scrollLeft,!0),Ve(n,"scroll",n))}),xe(s.scroller,"mousewheel",function(S){return hd(n,S)}),xe(s.scroller,"DOMMouseScroll",function(S){return hd(n,S)}),xe(s.wrapper,"scroll",function(){return s.wrapper.scrollTop=s.wrapper.scrollLeft=0}),s.dragFunctions={enter:function(S){ft(n,S)||Ti(S)},over:function(S){ft(n,S)||(Ax(n,S),Ti(S))},start:function(S){return Ex(n,S)},drop:Qt(n,Tx),leave:function(S){ft(n,S)||Bd(n)}};var b=s.input.getField();xe(b,"keyup",function(S){return Jd.call(n,S)}),xe(b,"keydown",Qt(n,jd)),xe(b,"keypress",Qt(n,Kd)),xe(b,"focus",function(S){return ju(n,S)}),xe(b,"blur",function(S){return as(n,S)})}var mc=[];It.defineInitHook=function(n){return mc.push(n)};function Ha(n,s,u,l){var c=n.doc,m;u==null&&(u="add"),u=="smart"&&(c.mode.indent?m=pa(n,s).state:u="prev");var v=n.options.tabSize,b=Ue(c,s),S=ze(b.text,null,v);b.stateAfter&&(b.stateAfter=null);var E=b.text.match(/^\s*/)[0],I;if(!l&&!/\S/.test(b.text))I=0,u="not";else if(u=="smart"&&(I=c.mode.indent(m,b.text.slice(E.length),b.text),I==Re||I>150)){if(!l)return;u="prev"}u=="prev"?s>c.first?I=ze(Ue(c,s-1).text,null,v):I=0:u=="add"?I=S+n.options.indentUnit:u=="subtract"?I=S-n.options.indentUnit:typeof u=="number"&&(I=S+u),I=Math.max(0,I);var B="",j=0;if(n.options.indentWithTabs)for(var Z=Math.floor(I/v);Z;--Z)j+=v,B+="	";if(j<I&&(B+=Le(I-j)),B!=E)return fs(c,B,ge(s,0),ge(s,E.length),"+input"),b.stateAfter=null,!0;for(var ie=0;ie<c.sel.ranges.length;ie++){var he=c.sel.ranges[ie];if(he.head.line==s&&he.head.ch<E.length){var we=ge(s,E.length);lc(c,ie,new Mt(we,we));break}}}var si=null;function hl(n){si=n}function gc(n,s,u,l,c){var m=n.doc;n.display.shift=!1,l||(l=m.sel);var v=+new Date-200,b=c=="paste"||n.state.pasteIncoming>v,S=F(s),E=null;if(b&&l.ranges.length>1)if(si&&si.text.join(`
`)==s){if(l.ranges.length%si.text.length==0){E=[];for(var I=0;I<si.text.length;I++)E.push(m.splitLines(si.text[I]))}}else S.length==l.ranges.length&&n.options.pasteLinesPerSelection&&(E=Ce(S,function(De){return[De]}));for(var B=n.curOp.updateInput,j=l.ranges.length-1;j>=0;j--){var Z=l.ranges[j],ie=Z.from(),he=Z.to();Z.empty()&&(u&&u>0?ie=ge(ie.line,ie.ch-u):n.state.overwrite&&!b?he=ge(he.line,Math.min(Ue(m,he.line).text.length,he.ch+me(S).length)):b&&si&&si.lineWise&&si.text.join(`
`)==S.join(`
`)&&(ie=he=ge(ie.line,0)));var we={from:ie,to:he,text:E?E[j%E.length]:S,origin:c||(b?"paste":n.state.cutIncoming>v?"cut":"+input")};hs(n.doc,we),Kt(n,"inputRead",n,we)}s&&!b&&sp(n,s),os(n),n.curOp.updateInput<2&&(n.curOp.updateInput=B),n.curOp.typing=!0,n.state.pasteIncoming=n.state.cutIncoming=-1}function rp(n,s){var u=n.clipboardData&&n.clipboardData.getData("Text");if(u)return n.preventDefault(),!s.isReadOnly()&&!s.options.disableInput&&Nn(s,function(){return gc(s,u,0,null,"paste")}),!0}function sp(n,s){if(!(!n.options.electricChars||!n.options.smartIndent))for(var u=n.doc.sel,l=u.ranges.length-1;l>=0;l--){var c=u.ranges[l];if(!(c.head.ch>100||l&&u.ranges[l-1].head.line==c.head.line)){var m=n.getModeAt(c.head),v=!1;if(m.electricChars){for(var b=0;b<m.electricChars.length;b++)if(s.indexOf(m.electricChars.charAt(b))>-1){v=Ha(n,c.head.line,"smart");break}}else m.electricInput&&m.electricInput.test(Ue(n.doc,c.head.line).text.slice(0,c.head.ch))&&(v=Ha(n,c.head.line,"smart"));v&&Kt(n,"electricInput",n,c.head.line)}}}function ap(n){for(var s=[],u=[],l=0;l<n.doc.sel.ranges.length;l++){var c=n.doc.sel.ranges[l].head.line,m={anchor:ge(c,0),head:ge(c+1,0)};u.push(m),s.push(n.getRange(m.anchor,m.head))}return{text:s,ranges:u}}function op(n,s,u,l){n.setAttribute("autocorrect",u?"":"off"),n.setAttribute("autocapitalize",l?"":"off"),n.setAttribute("spellcheck",!!s)}function lp(){var n=W("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),s=W("div",[n],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return g?n.style.width="1000px":n.setAttribute("wrap","off"),M&&(n.style.border="1px solid black"),op(n),s}function Qx(n){var s=n.optionHandlers,u=n.helpers={};n.prototype={constructor:n,focus:function(){window.focus(),this.display.input.focus()},setOption:function(l,c){var m=this.options,v=m[l];m[l]==c&&l!="mode"||(m[l]=c,s.hasOwnProperty(l)&&Qt(this,s[l])(this,c,v),Ve(this,"optionChange",this,l))},getOption:function(l){return this.options[l]},getDoc:function(){return this.doc},addKeyMap:function(l,c){this.state.keyMaps[c?"push":"unshift"](ll(l))},removeKeyMap:function(l){for(var c=this.state.keyMaps,m=0;m<c.length;++m)if(c[m]==l||c[m].name==l)return c.splice(m,1),!0},addOverlay:bn(function(l,c){var m=l.token?l:n.getMode(this.options,l);if(m.startState)throw new Error("Overlays may not be stateful.");tt(this.state.overlays,{mode:m,modeSpec:l,opaque:c&&c.opaque,priority:c&&c.priority||0},function(v){return v.priority}),this.state.modeGen++,Ln(this)}),removeOverlay:bn(function(l){for(var c=this.state.overlays,m=0;m<c.length;++m){var v=c[m].modeSpec;if(v==l||typeof l=="string"&&v.name==l){c.splice(m,1),this.state.modeGen++,Ln(this);return}}}),indentLine:bn(function(l,c,m){typeof c!="string"&&typeof c!="number"&&(c==null?c=this.options.smartIndent?"smart":"prev":c=c?"add":"subtract"),Jt(this.doc,l)&&Ha(this,l,c,m)}),indentSelection:bn(function(l){for(var c=this.doc.sel.ranges,m=-1,v=0;v<c.length;v++){var b=c[v];if(b.empty())b.head.line>m&&(Ha(this,b.head.line,l,!0),m=b.head.line,v==this.doc.sel.primIndex&&os(this));else{var S=b.from(),E=b.to(),I=Math.max(m,S.line);m=Math.min(this.lastLine(),E.line-(E.ch?0:1))+1;for(var B=I;B<m;++B)Ha(this,B,l);var j=this.doc.sel.ranges;S.ch==0&&c.length==j.length&&j[v].from().ch>0&&lc(this.doc,v,new Mt(S,j[v].to()),Ee)}}}),getTokenAt:function(l,c){return vf(this,l,c)},getLineTokens:function(l,c){return vf(this,ge(l),c,!0)},getTokenTypeAt:function(l){l=Be(this.doc,l);var c=pf(this,Ue(this.doc,l.line)),m=0,v=(c.length-1)/2,b=l.ch,S;if(b==0)S=c[2];else for(;;){var E=m+v>>1;if((E?c[E*2-1]:0)>=b)v=E;else if(c[E*2+1]<b)m=E+1;else{S=c[E*2+2];break}}var I=S?S.indexOf("overlay "):-1;return I<0?S:I==0?null:S.slice(0,I-1)},getModeAt:function(l){var c=this.doc.mode;return c.innerMode?n.innerMode(c,this.getTokenAt(l).state).mode:c},getHelper:function(l,c){return this.getHelpers(l,c)[0]},getHelpers:function(l,c){var m=[];if(!u.hasOwnProperty(c))return m;var v=u[c],b=this.getModeAt(l);if(typeof b[c]=="string")v[b[c]]&&m.push(v[b[c]]);else if(b[c])for(var S=0;S<b[c].length;S++){var E=v[b[c][S]];E&&m.push(E)}else b.helperType&&v[b.helperType]?m.push(v[b.helperType]):v[b.name]&&m.push(v[b.name]);for(var I=0;I<v._global.length;I++){var B=v._global[I];B.pred(b,this)&&K(m,B.val)==-1&&m.push(B.val)}return m},getStateAfter:function(l,c){var m=this.doc;return l=xt(m,l==null?m.first+m.size-1:l),pa(this,l+1,c).state},cursorCoords:function(l,c){var m,v=this.doc.sel.primary();return l==null?m=v.head:typeof l=="object"?m=Be(this.doc,l):m=l?v.from():v.to(),ii(this,m,c||"page")},charCoords:function(l,c){return qo(this,Be(this.doc,l),c||"page")},coordsChar:function(l,c){return l=Zf(this,l,c||"page"),Uu(this,l.left,l.top)},lineAtHeight:function(l,c){return l=Zf(this,{top:l,left:0},c||"page").top,_n(this.doc,l+this.display.viewOffset)},heightAtLine:function(l,c,m){var v=!1,b;if(typeof l=="number"){var S=this.doc.first+this.doc.size-1;l<this.doc.first?l=this.doc.first:l>S&&(l=S,v=!0),b=Ue(this.doc,l)}else b=l;return Zo(this,b,{top:0,left:0},c||"page",m||v).top+(v?this.doc.height-Li(b):0)},defaultTextHeight:function(){return rs(this.display)},defaultCharWidth:function(){return ss(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(l,c,m,v,b){var S=this.display;l=ii(this,Be(this.doc,l));var E=l.bottom,I=l.left;if(c.style.position="absolute",c.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(c),S.sizer.appendChild(c),v=="over")E=l.top;else if(v=="above"||v=="near"){var B=Math.max(S.wrapper.clientHeight,this.doc.height),j=Math.max(S.sizer.clientWidth,S.lineSpace.clientWidth);(v=="above"||l.bottom+c.offsetHeight>B)&&l.top>c.offsetHeight?E=l.top-c.offsetHeight:l.bottom+c.offsetHeight<=B&&(E=l.bottom),I+c.offsetWidth>j&&(I=j-c.offsetWidth)}c.style.top=E+"px",c.style.left=c.style.right="",b=="right"?(I=S.sizer.clientWidth-c.offsetWidth,c.style.right="0px"):(b=="left"?I=0:b=="middle"&&(I=(S.sizer.clientWidth-c.offsetWidth)/2),c.style.left=I+"px"),m&&j0(this,{left:I,top:E,right:I+c.offsetWidth,bottom:E+c.offsetHeight})},triggerOnKeyDown:bn(jd),triggerOnKeyPress:bn(Kd),triggerOnKeyUp:Jd,triggerOnMouseDown:bn(Qd),execCommand:function(l){if(Fa.hasOwnProperty(l))return Fa[l].call(null,this)},triggerElectric:bn(function(l){sp(this,l)}),findPosH:function(l,c,m,v){var b=1;c<0&&(b=-1,c=-c);for(var S=Be(this.doc,l),E=0;E<c&&(S=vc(this.doc,S,b,m,v),!S.hitSide);++E);return S},moveH:bn(function(l,c){var m=this;this.extendSelectionsBy(function(v){return m.display.shift||m.doc.extend||v.empty()?vc(m.doc,v.head,l,c,m.options.rtlMoveVisually):l<0?v.from():v.to()},Ze)}),deleteH:bn(function(l,c){var m=this.doc.sel,v=this.doc;m.somethingSelected()?v.replaceSelection("",null,"+delete"):ms(this,function(b){var S=vc(v,b.head,l,c,!1);return l<0?{from:S,to:b.head}:{from:b.head,to:S}})}),findPosV:function(l,c,m,v){var b=1,S=v;c<0&&(b=-1,c=-c);for(var E=Be(this.doc,l),I=0;I<c;++I){var B=ii(this,E,"div");if(S==null?S=B.left:B.left=S,E=up(this,B,b,m),E.hitSide)break}return E},moveV:bn(function(l,c){var m=this,v=this.doc,b=[],S=!this.display.shift&&!v.extend&&v.sel.somethingSelected();if(v.extendSelectionsBy(function(I){if(S)return l<0?I.from():I.to();var B=ii(m,I.head,"div");I.goalColumn!=null&&(B.left=I.goalColumn),b.push(B.left);var j=up(m,B,l,c);return c=="page"&&I==v.sel.primary()&&Ku(m,qo(m,j,"div").top-B.top),j},Ze),b.length)for(var E=0;E<v.sel.ranges.length;E++)v.sel.ranges[E].goalColumn=b[E]}),findWordAt:function(l){var c=this.doc,m=Ue(c,l.line).text,v=l.ch,b=l.ch;if(m){var S=this.getHelper(l,"wordChars");(l.sticky=="before"||b==m.length)&&v?--v:++b;for(var E=m.charAt(v),I=O(E,S)?function(B){return O(B,S)}:/\s/.test(E)?function(B){return/\s/.test(B)}:function(B){return!/\s/.test(B)&&!O(B)};v>0&&I(m.charAt(v-1));)--v;for(;b<m.length&&I(m.charAt(b));)++b}return new Mt(ge(l.line,v),ge(l.line,b))},toggleOverwrite:function(l){l!=null&&l==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Oe(this.display.cursorDiv,"CodeMirror-overwrite"):X(this.display.cursorDiv,"CodeMirror-overwrite"),Ve(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==Me()},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:bn(function(l,c){ba(this,l,c)}),getScrollInfo:function(){var l=this.display.scroller;return{left:l.scrollLeft,top:l.scrollTop,height:l.scrollHeight-pi(this)-this.display.barHeight,width:l.scrollWidth-pi(this)-this.display.barWidth,clientHeight:Ou(this),clientWidth:Tr(this)}},scrollIntoView:bn(function(l,c){l==null?(l={from:this.doc.sel.primary().head,to:null},c==null&&(c=this.options.cursorScrollMargin)):typeof l=="number"?l={from:ge(l,0),to:null}:l.from==null&&(l={from:l,to:null}),l.to||(l.to=l.from),l.margin=c||0,l.from.line!=null?J0(this,l):td(this,l.from,l.to,l.margin)}),setSize:bn(function(l,c){var m=this,v=function(S){return typeof S=="number"||/^\d+$/.test(String(S))?S+"px":S};l!=null&&(this.display.wrapper.style.width=v(l)),c!=null&&(this.display.wrapper.style.height=v(c)),this.options.lineWrapping&&Gf(this);var b=this.display.viewFrom;this.doc.iter(b,this.display.viewTo,function(S){if(S.widgets){for(var E=0;E<S.widgets.length;E++)if(S.widgets[E].noHScroll){Xi(m,b,"widget");break}}++b}),this.curOp.forceUpdate=!0,Ve(this,"refresh",this)}),operation:function(l){return Nn(this,l)},startOperation:function(){return Pr(this)},endOperation:function(){return Dr(this)},refresh:bn(function(){var l=this.display.cachedTextHeight;Ln(this),this.curOp.forceUpdate=!0,ya(this),ba(this,this.doc.scrollLeft,this.doc.scrollTop),ec(this.display),(l==null||Math.abs(l-rs(this.display))>.5||this.options.lineWrapping)&&Xu(this),Ve(this,"refresh",this)}),swapDoc:bn(function(l){var c=this.doc;return c.cm=null,this.state.selectingText&&this.state.selectingText(),md(this,l),ya(this),this.display.input.reset(),ba(this,l.scrollLeft,l.scrollTop),this.curOp.forceScroll=!0,Kt(this,"swapDoc",this,c),c}),phrase:function(l){var c=this.options.phrases;return c&&Object.prototype.hasOwnProperty.call(c,l)?c[l]:l},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Un(n),n.registerHelper=function(l,c,m){u.hasOwnProperty(l)||(u[l]=n[l]={_global:[]}),u[l][c]=m},n.registerGlobalHelper=function(l,c,m,v){n.registerHelper(l,c,v),u[l]._global.push({pred:m,val:v})}}function vc(n,s,u,l,c){var m=s,v=u,b=Ue(n,s.line),S=c&&n.direction=="rtl"?-u:u;function E(){var Fe=s.line+S;return Fe<n.first||Fe>=n.first+n.size?!1:(s=new ge(Fe,s.ch,s.sticky),b=Ue(n,Fe))}function I(Fe){var Ie;if(l=="codepoint"){var Ge=b.text.charCodeAt(s.ch+(u>0?0:-1));if(isNaN(Ge))Ie=null;else{var Qe=u>0?Ge>=55296&&Ge<56320:Ge>=56320&&Ge<57343;Ie=new ge(s.line,Math.max(0,Math.min(b.text.length,s.ch+u*(Qe?2:1))),-u)}}else c?Ie=Ix(n.cm,b,s,u):Ie=cc(b,s,u);if(Ie==null)if(!Fe&&E())s=hc(c,n.cm,b,s.line,S);else return!1;else s=Ie;return!0}if(l=="char"||l=="codepoint")I();else if(l=="column")I(!0);else if(l=="word"||l=="group")for(var B=null,j=l=="group",Z=n.cm&&n.cm.getHelper(s,"wordChars"),ie=!0;!(u<0&&!I(!ie));ie=!1){var he=b.text.charAt(s.ch)||`
`,we=O(he,Z)?"w":j&&he==`
`?"n":!j||/\s/.test(he)?null:"p";if(j&&!ie&&!we&&(we="s"),B&&B!=we){u<0&&(u=1,I(),s.sticky="after");break}if(we&&(B=we),u>0&&!I(!ie))break}var De=sl(n,s,m,v,!0);return U(m,De)&&(De.hitSide=!0),De}function up(n,s,u,l){var c=n.doc,m=s.left,v;if(l=="page"){var b=Math.min(n.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),S=Math.max(b-.5*rs(n.display),3);v=(u>0?s.bottom:s.top)+u*S}else l=="line"&&(v=u>0?s.bottom+3:s.top-3);for(var E;E=Uu(n,m,v),!!E.outside;){if(u<0?v<=0:v>=c.height){E.hitSide=!0;break}v+=u*5}return E}var Tt=function(n){this.cm=n,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new $e,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Tt.prototype.init=function(n){var s=this,u=this,l=u.cm,c=u.div=n.lineDiv;c.contentEditable=!0,op(c,l.options.spellcheck,l.options.autocorrect,l.options.autocapitalize);function m(b){for(var S=b.target;S;S=S.parentNode){if(S==c)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(S.className))break}return!1}xe(c,"paste",function(b){!m(b)||ft(l,b)||rp(b,l)||d<=11&&setTimeout(Qt(l,function(){return s.updateFromDOM()}),20)}),xe(c,"compositionstart",function(b){s.composing={data:b.data,done:!1}}),xe(c,"compositionupdate",function(b){s.composing||(s.composing={data:b.data,done:!1})}),xe(c,"compositionend",function(b){s.composing&&(b.data!=s.composing.data&&s.readFromDOMSoon(),s.composing.done=!0)}),xe(c,"touchstart",function(){return u.forceCompositionEnd()}),xe(c,"input",function(){s.composing||s.readFromDOMSoon()});function v(b){if(!(!m(b)||ft(l,b))){if(l.somethingSelected())hl({lineWise:!1,text:l.getSelections()}),b.type=="cut"&&l.replaceSelection("",null,"cut");else if(l.options.lineWiseCopyCut){var S=ap(l);hl({lineWise:!0,text:S.text}),b.type=="cut"&&l.operation(function(){l.setSelections(S.ranges,0,Ee),l.replaceSelection("",null,"cut")})}else return;if(b.clipboardData){b.clipboardData.clearData();var E=si.text.join(`
`);if(b.clipboardData.setData("Text",E),b.clipboardData.getData("Text")==E){b.preventDefault();return}}var I=lp(),B=I.firstChild;l.display.lineSpace.insertBefore(I,l.display.lineSpace.firstChild),B.value=si.text.join(`
`);var j=Me();ue(B),setTimeout(function(){l.display.lineSpace.removeChild(I),j.focus(),j==c&&u.showPrimarySelection()},50)}}xe(c,"copy",v),xe(c,"cut",v)},Tt.prototype.screenReaderLabelChanged=function(n){n?this.div.setAttribute("aria-label",n):this.div.removeAttribute("aria-label")},Tt.prototype.prepareSelection=function(){var n=Qf(this.cm,!1);return n.focus=Me()==this.div,n},Tt.prototype.showSelection=function(n,s){!n||!this.cm.display.view.length||((n.focus||s)&&this.showPrimarySelection(),this.showMultipleSelections(n))},Tt.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},Tt.prototype.showPrimarySelection=function(){var n=this.getSelection(),s=this.cm,u=s.doc.sel.primary(),l=u.from(),c=u.to();if(s.display.viewTo==s.display.viewFrom||l.line>=s.display.viewTo||c.line<s.display.viewFrom){n.removeAllRanges();return}var m=fl(s,n.anchorNode,n.anchorOffset),v=fl(s,n.focusNode,n.focusOffset);if(!(m&&!m.bad&&v&&!v.bad&&A(at(m,v),l)==0&&A(_e(m,v),c)==0)){var b=s.display.view,S=l.line>=s.display.viewFrom&&cp(s,l)||{node:b[0].measure.map[2],offset:0},E=c.line<s.display.viewTo&&cp(s,c);if(!E){var I=b[b.length-1].measure,B=I.maps?I.maps[I.maps.length-1]:I.map;E={node:B[B.length-1],offset:B[B.length-2]-B[B.length-3]}}if(!S||!E){n.removeAllRanges();return}var j=n.rangeCount&&n.getRangeAt(0),Z;try{Z=ee(S.node,S.offset,E.offset,E.node)}catch{}Z&&(!a&&s.state.focused?(n.collapse(S.node,S.offset),Z.collapsed||(n.removeAllRanges(),n.addRange(Z))):(n.removeAllRanges(),n.addRange(Z)),j&&n.anchorNode==null?n.addRange(j):a&&this.startGracePeriod()),this.rememberSelection()}},Tt.prototype.startGracePeriod=function(){var n=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){n.gracePeriod=!1,n.selectionChanged()&&n.cm.operation(function(){return n.cm.curOp.selectionChanged=!0})},20)},Tt.prototype.showMultipleSelections=function(n){H(this.cm.display.cursorDiv,n.cursors),H(this.cm.display.selectionDiv,n.selection)},Tt.prototype.rememberSelection=function(){var n=this.getSelection();this.lastAnchorNode=n.anchorNode,this.lastAnchorOffset=n.anchorOffset,this.lastFocusNode=n.focusNode,this.lastFocusOffset=n.focusOffset},Tt.prototype.selectionInEditor=function(){var n=this.getSelection();if(!n.rangeCount)return!1;var s=n.getRangeAt(0).commonAncestorContainer;return te(this.div,s)},Tt.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||Me()!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},Tt.prototype.blur=function(){this.div.blur()},Tt.prototype.getField=function(){return this.div},Tt.prototype.supportsTouch=function(){return!0},Tt.prototype.receivedFocus=function(){var n=this,s=this;this.selectionInEditor()?setTimeout(function(){return n.pollSelection()},20):Nn(this.cm,function(){return s.cm.curOp.selectionChanged=!0});function u(){s.cm.state.focused&&(s.pollSelection(),s.polling.set(s.cm.options.pollInterval,u))}this.polling.set(this.cm.options.pollInterval,u)},Tt.prototype.selectionChanged=function(){var n=this.getSelection();return n.anchorNode!=this.lastAnchorNode||n.anchorOffset!=this.lastAnchorOffset||n.focusNode!=this.lastFocusNode||n.focusOffset!=this.lastFocusOffset},Tt.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var n=this.getSelection(),s=this.cm;if(w&&x&&this.cm.display.gutterSpecs.length&&$x(n.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var u=fl(s,n.anchorNode,n.anchorOffset),l=fl(s,n.focusNode,n.focusOffset);u&&l&&Nn(s,function(){dn(s.doc,qi(u,l),Ee),(u.bad||l.bad)&&(s.curOp.selectionChanged=!0)})}}},Tt.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var n=this.cm,s=n.display,u=n.doc.sel.primary(),l=u.from(),c=u.to();if(l.ch==0&&l.line>n.firstLine()&&(l=ge(l.line-1,Ue(n.doc,l.line-1).length)),c.ch==Ue(n.doc,c.line).text.length&&c.line<n.lastLine()&&(c=ge(c.line+1,0)),l.line<s.viewFrom||c.line>s.viewTo-1)return!1;var m,v,b;l.line==s.viewFrom||(m=Lr(n,l.line))==0?(v=nt(s.view[0].line),b=s.view[0].node):(v=nt(s.view[m].line),b=s.view[m-1].node.nextSibling);var S=Lr(n,c.line),E,I;if(S==s.view.length-1?(E=s.viewTo-1,I=s.lineDiv.lastChild):(E=nt(s.view[S+1].line)-1,I=s.view[S+1].node.previousSibling),!b)return!1;for(var B=n.doc.splitLines(ey(n,b,I,v,E)),j=on(n.doc,ge(v,0),ge(E,Ue(n.doc,E).text.length));B.length>1&&j.length>1;)if(me(B)==me(j))B.pop(),j.pop(),E--;else if(B[0]==j[0])B.shift(),j.shift(),v++;else break;for(var Z=0,ie=0,he=B[0],we=j[0],De=Math.min(he.length,we.length);Z<De&&he.charCodeAt(Z)==we.charCodeAt(Z);)++Z;for(var Fe=me(B),Ie=me(j),Ge=Math.min(Fe.length-(B.length==1?Z:0),Ie.length-(j.length==1?Z:0));ie<Ge&&Fe.charCodeAt(Fe.length-ie-1)==Ie.charCodeAt(Ie.length-ie-1);)++ie;if(B.length==1&&j.length==1&&v==l.line)for(;Z&&Z>l.ch&&Fe.charCodeAt(Fe.length-ie-1)==Ie.charCodeAt(Ie.length-ie-1);)Z--,ie++;B[B.length-1]=Fe.slice(0,Fe.length-ie).replace(/^\u200b+/,""),B[0]=B[0].slice(Z).replace(/\u200b+$/,"");var Qe=ge(v,Z),je=ge(E,j.length?me(j).length-ie:0);if(B.length>1||B[0]||A(Qe,je))return fs(n.doc,B,Qe,je,"+input"),!0},Tt.prototype.ensurePolled=function(){this.forceCompositionEnd()},Tt.prototype.reset=function(){this.forceCompositionEnd()},Tt.prototype.forceCompositionEnd=function(){!this.composing||(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Tt.prototype.readFromDOMSoon=function(){var n=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(n.readDOMTimeout=null,n.composing)if(n.composing.done)n.composing=null;else return;n.updateFromDOM()},80))},Tt.prototype.updateFromDOM=function(){var n=this;(this.cm.isReadOnly()||!this.pollContent())&&Nn(this.cm,function(){return Ln(n.cm)})},Tt.prototype.setUneditable=function(n){n.contentEditable="false"},Tt.prototype.onKeyPress=function(n){n.charCode==0||this.composing||(n.preventDefault(),this.cm.isReadOnly()||Qt(this.cm,gc)(this.cm,String.fromCharCode(n.charCode==null?n.keyCode:n.charCode),0))},Tt.prototype.readOnlyChanged=function(n){this.div.contentEditable=String(n!="nocursor")},Tt.prototype.onContextMenu=function(){},Tt.prototype.resetPosition=function(){},Tt.prototype.needsContentAttribute=!0;function cp(n,s){var u=zu(n,s.line);if(!u||u.hidden)return null;var l=Ue(n.doc,s.line),c=zf(u,l,s.line),m=Te(l,n.doc.direction),v="left";if(m){var b=ne(m,s.ch);v=b%2?"right":"left"}var S=Uf(c.map,s.ch,v);return S.offset=S.collapse=="right"?S.end:S.start,S}function $x(n){for(var s=n;s;s=s.parentNode)if(/CodeMirror-gutter-wrapper/.test(s.className))return!0;return!1}function vs(n,s){return s&&(n.bad=!0),n}function ey(n,s,u,l,c){var m="",v=!1,b=n.doc.lineSeparator(),S=!1;function E(Z){return function(ie){return ie.id==Z}}function I(){v&&(m+=b,S&&(m+=b),v=S=!1)}function B(Z){Z&&(I(),m+=Z)}function j(Z){if(Z.nodeType==1){var ie=Z.getAttribute("cm-text");if(ie){B(ie);return}var he=Z.getAttribute("cm-marker"),we;if(he){var De=n.findMarks(ge(l,0),ge(c+1,0),E(+he));De.length&&(we=De[0].find(0))&&B(on(n.doc,we.from,we.to).join(b));return}if(Z.getAttribute("contenteditable")=="false")return;var Fe=/^(pre|div|p|li|table|br)$/i.test(Z.nodeName);if(!/^br$/i.test(Z.nodeName)&&Z.textContent.length==0)return;Fe&&I();for(var Ie=0;Ie<Z.childNodes.length;Ie++)j(Z.childNodes[Ie]);/^(pre|p)$/i.test(Z.nodeName)&&(S=!0),Fe&&(v=!0)}else Z.nodeType==3&&B(Z.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;j(s),s!=u;)s=s.nextSibling,S=!1;return m}function fl(n,s,u){var l;if(s==n.display.lineDiv){if(l=n.display.lineDiv.childNodes[u],!l)return vs(n.clipPos(ge(n.display.viewTo-1)),!0);s=null,u=0}else for(l=s;;l=l.parentNode){if(!l||l==n.display.lineDiv)return null;if(l.parentNode&&l.parentNode==n.display.lineDiv)break}for(var c=0;c<n.display.view.length;c++){var m=n.display.view[c];if(m.node==l)return ty(m,s,u)}}function ty(n,s,u){var l=n.text.firstChild,c=!1;if(!s||!te(l,s))return vs(ge(nt(n.line),0),!0);if(s==l&&(c=!0,s=l.childNodes[u],u=0,!s)){var m=n.rest?me(n.rest):n.line;return vs(ge(nt(m),m.text.length),c)}var v=s.nodeType==3?s:null,b=s;for(!v&&s.childNodes.length==1&&s.firstChild.nodeType==3&&(v=s.firstChild,u&&(u=v.nodeValue.length));b.parentNode!=l;)b=b.parentNode;var S=n.measure,E=S.maps;function I(we,De,Fe){for(var Ie=-1;Ie<(E?E.length:0);Ie++)for(var Ge=Ie<0?S.map:E[Ie],Qe=0;Qe<Ge.length;Qe+=3){var je=Ge[Qe+2];if(je==we||je==De){var pt=nt(Ie<0?n.line:n.rest[Ie]),Lt=Ge[Qe]+Fe;return(Fe<0||je!=we)&&(Lt=Ge[Qe+(Fe?1:0)]),ge(pt,Lt)}}}var B=I(v,b,u);if(B)return vs(B,c);for(var j=b.nextSibling,Z=v?v.nodeValue.length-u:0;j;j=j.nextSibling){if(B=I(j,j.firstChild,0),B)return vs(ge(B.line,B.ch-Z),c);Z+=j.textContent.length}for(var ie=b.previousSibling,he=u;ie;ie=ie.previousSibling){if(B=I(ie,ie.firstChild,-1),B)return vs(ge(B.line,B.ch+he),c);he+=ie.textContent.length}}var Ut=function(n){this.cm=n,this.prevInput="",this.pollingFast=!1,this.polling=new $e,this.hasSelection=!1,this.composing=null};Ut.prototype.init=function(n){var s=this,u=this,l=this.cm;this.createField(n);var c=this.textarea;n.wrapper.insertBefore(this.wrapper,n.wrapper.firstChild),M&&(c.style.width="0px"),xe(c,"input",function(){p&&d>=9&&s.hasSelection&&(s.hasSelection=null),u.poll()}),xe(c,"paste",function(v){ft(l,v)||rp(v,l)||(l.state.pasteIncoming=+new Date,u.fastPoll())});function m(v){if(!ft(l,v)){if(l.somethingSelected())hl({lineWise:!1,text:l.getSelections()});else if(l.options.lineWiseCopyCut){var b=ap(l);hl({lineWise:!0,text:b.text}),v.type=="cut"?l.setSelections(b.ranges,null,Ee):(u.prevInput="",c.value=b.text.join(`
`),ue(c))}else return;v.type=="cut"&&(l.state.cutIncoming=+new Date)}}xe(c,"cut",m),xe(c,"copy",m),xe(n.scroller,"paste",function(v){if(!(Ci(n,v)||ft(l,v))){if(!c.dispatchEvent){l.state.pasteIncoming=+new Date,u.focus();return}var b=new Event("paste");b.clipboardData=v.clipboardData,c.dispatchEvent(b)}}),xe(n.lineSpace,"selectstart",function(v){Ci(n,v)||Dt(v)}),xe(c,"compositionstart",function(){var v=l.getCursor("from");u.composing&&u.composing.range.clear(),u.composing={start:v,range:l.markText(v,l.getCursor("to"),{className:"CodeMirror-composing"})}}),xe(c,"compositionend",function(){u.composing&&(u.poll(),u.composing.range.clear(),u.composing=null)})},Ut.prototype.createField=function(n){this.wrapper=lp(),this.textarea=this.wrapper.firstChild},Ut.prototype.screenReaderLabelChanged=function(n){n?this.textarea.setAttribute("aria-label",n):this.textarea.removeAttribute("aria-label")},Ut.prototype.prepareSelection=function(){var n=this.cm,s=n.display,u=n.doc,l=Qf(n);if(n.options.moveInputWithCursor){var c=ii(n,u.sel.primary().head,"div"),m=s.wrapper.getBoundingClientRect(),v=s.lineDiv.getBoundingClientRect();l.teTop=Math.max(0,Math.min(s.wrapper.clientHeight-10,c.top+v.top-m.top)),l.teLeft=Math.max(0,Math.min(s.wrapper.clientWidth-10,c.left+v.left-m.left))}return l},Ut.prototype.showSelection=function(n){var s=this.cm,u=s.display;H(u.cursorDiv,n.cursors),H(u.selectionDiv,n.selection),n.teTop!=null&&(this.wrapper.style.top=n.teTop+"px",this.wrapper.style.left=n.teLeft+"px")},Ut.prototype.reset=function(n){if(!(this.contextMenuPending||this.composing)){var s=this.cm;if(s.somethingSelected()){this.prevInput="";var u=s.getSelection();this.textarea.value=u,s.state.focused&&ue(this.textarea),p&&d>=9&&(this.hasSelection=u)}else n||(this.prevInput=this.textarea.value="",p&&d>=9&&(this.hasSelection=null))}},Ut.prototype.getField=function(){return this.textarea},Ut.prototype.supportsTouch=function(){return!1},Ut.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!N||Me()!=this.textarea))try{this.textarea.focus()}catch{}},Ut.prototype.blur=function(){this.textarea.blur()},Ut.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Ut.prototype.receivedFocus=function(){this.slowPoll()},Ut.prototype.slowPoll=function(){var n=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){n.poll(),n.cm.state.focused&&n.slowPoll()})},Ut.prototype.fastPoll=function(){var n=!1,s=this;s.pollingFast=!0;function u(){var l=s.poll();!l&&!n?(n=!0,s.polling.set(60,u)):(s.pollingFast=!1,s.slowPoll())}s.polling.set(20,u)},Ut.prototype.poll=function(){var n=this,s=this.cm,u=this.textarea,l=this.prevInput;if(this.contextMenuPending||!s.state.focused||$(u)&&!l&&!this.composing||s.isReadOnly()||s.options.disableInput||s.state.keySeq)return!1;var c=u.value;if(c==l&&!s.somethingSelected())return!1;if(p&&d>=9&&this.hasSelection===c||C&&/[\uf700-\uf7ff]/.test(c))return s.display.input.reset(),!1;if(s.doc.sel==s.display.selForContextMenu){var m=c.charCodeAt(0);if(m==8203&&!l&&(l="\u200B"),m==8666)return this.reset(),this.cm.execCommand("undo")}for(var v=0,b=Math.min(l.length,c.length);v<b&&l.charCodeAt(v)==c.charCodeAt(v);)++v;return Nn(s,function(){gc(s,c.slice(v),l.length-v,null,n.composing?"*compose":null),c.length>1e3||c.indexOf(`
`)>-1?u.value=n.prevInput="":n.prevInput=c,n.composing&&(n.composing.range.clear(),n.composing.range=s.markText(n.composing.start,s.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Ut.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Ut.prototype.onKeyPress=function(){p&&d>=9&&(this.hasSelection=null),this.fastPoll()},Ut.prototype.onContextMenu=function(n){var s=this,u=s.cm,l=u.display,c=s.textarea;s.contextMenuPending&&s.contextMenuPending();var m=Ar(u,n),v=l.scroller.scrollTop;if(!m||_)return;var b=u.options.resetSelectionOnContextMenu;b&&u.doc.sel.contains(m)==-1&&Qt(u,dn)(u.doc,qi(m),Ee);var S=c.style.cssText,E=s.wrapper.style.cssText,I=s.wrapper.offsetParent.getBoundingClientRect();s.wrapper.style.cssText="position: static",c.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(n.clientY-I.top-5)+"px; left: "+(n.clientX-I.left-5)+`px;
      z-index: 1000; background: `+(p?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var B;g&&(B=window.scrollY),l.input.focus(),g&&window.scrollTo(null,B),l.input.reset(),u.somethingSelected()||(c.value=s.prevInput=" "),s.contextMenuPending=Z,l.selForContextMenu=u.doc.sel,clearTimeout(l.detectingSelectAll);function j(){if(c.selectionStart!=null){var he=u.somethingSelected(),we="\u200B"+(he?c.value:"");c.value="\u21DA",c.value=we,s.prevInput=he?"":"\u200B",c.selectionStart=1,c.selectionEnd=we.length,l.selForContextMenu=u.doc.sel}}function Z(){if(s.contextMenuPending==Z&&(s.contextMenuPending=!1,s.wrapper.style.cssText=E,c.style.cssText=S,p&&d<9&&l.scrollbars.setScrollTop(l.scroller.scrollTop=v),c.selectionStart!=null)){(!p||p&&d<9)&&j();var he=0,we=function(){l.selForContextMenu==u.doc.sel&&c.selectionStart==0&&c.selectionEnd>0&&s.prevInput=="\u200B"?Qt(u,Ld)(u):he++<10?l.detectingSelectAll=setTimeout(we,500):(l.selForContextMenu=null,l.input.reset())};l.detectingSelectAll=setTimeout(we,200)}}if(p&&d>=9&&j(),oe){Ti(n);var ie=function(){st(window,"mouseup",ie),setTimeout(Z,20)};xe(window,"mouseup",ie)}else setTimeout(Z,50)},Ut.prototype.readOnlyChanged=function(n){n||this.reset(),this.textarea.disabled=n=="nocursor",this.textarea.readOnly=!!n},Ut.prototype.setUneditable=function(){},Ut.prototype.needsContentAttribute=!1;function ny(n,s){if(s=s?Pe(s):{},s.value=n.value,!s.tabindex&&n.tabIndex&&(s.tabindex=n.tabIndex),!s.placeholder&&n.placeholder&&(s.placeholder=n.placeholder),s.autofocus==null){var u=Me();s.autofocus=u==n||n.getAttribute("autofocus")!=null&&u==document.body}function l(){n.value=b.getValue()}var c;if(n.form&&(xe(n.form,"submit",l),!s.leaveSubmitMethodAlone)){var m=n.form;c=m.submit;try{var v=m.submit=function(){l(),m.submit=c,m.submit(),m.submit=v}}catch{}}s.finishInit=function(S){S.save=l,S.getTextArea=function(){return n},S.toTextArea=function(){S.toTextArea=isNaN,l(),n.parentNode.removeChild(S.getWrapperElement()),n.style.display="",n.form&&(st(n.form,"submit",l),!s.leaveSubmitMethodAlone&&typeof n.form.submit=="function"&&(n.form.submit=c))}},n.style.display="none";var b=It(function(S){return n.parentNode.insertBefore(S,n.nextSibling)},s);return b}function iy(n){n.off=st,n.on=xe,n.wheelEventPixels=cx,n.Doc=Cn,n.splitLines=F,n.countColumn=ze,n.findColumn=se,n.isWordChar=G,n.Pass=Re,n.signal=Ve,n.Line=ts,n.changeEnd=Yi,n.scrollbarModel=rd,n.Pos=ge,n.cmpPos=A,n.modes=Ke,n.mimeModes=Ye,n.resolveMode=mt,n.getMode=ct,n.modeExtensions=ut,n.extendMode=_t,n.copyState=Gt,n.startState=ni,n.innerMode=gt,n.commands=Fa,n.keyMap=Pi,n.keyName=Vd,n.isModifierKey=Wd,n.lookupKey=ps,n.normalizeKeyMap=Dx,n.StringStream=lt,n.SharedTextMarker=Ia,n.TextMarker=Ji,n.LineWidget=Da,n.e_preventDefault=Dt,n.e_stopPropagation=Si,n.e_stop=Ti,n.addClass=Oe,n.contains=te,n.rmClass=X,n.keyNames=Ki}Yx(It),Qx(It);var ry="iter insert remove copy getEditor constructor".split(" ");for(var dl in Cn.prototype)Cn.prototype.hasOwnProperty(dl)&&K(ry,dl)<0&&(It.prototype[dl]=function(n){return function(){return n.apply(this.doc,arguments)}}(Cn.prototype[dl]));return Un(Cn),It.inputStyles={textarea:Ut,contenteditable:Tt},It.defineMode=function(n){!It.defaults.mode&&n!="null"&&(It.defaults.mode=n),dt.apply(this,arguments)},It.defineMIME=it,It.defineMode("null",function(){return{token:function(n){return n.skipToEnd()}}}),It.defineMIME("text/plain","null"),It.defineExtension=function(n,s){It.prototype[n]=s},It.defineDocExtension=function(n,s){Cn.prototype[n]=s},It.fromTextArea=ny,iy(It),It.version="5.65.0",It})})(_c);var vC=_c.exports;(function(r,e){(function(t){t(_c.exports)})(function(t){t.defineMode("javascript",function(i,a){var o=i.indentUnit,h=a.statementIndent,f=a.jsonld,p=a.json||f,d=a.trackScope!==!1,g=a.typescript,y=a.wordCharacters||/[\w$\xa1-\uffff]/,x=function(){function A(fn){return{type:fn,style:"keyword"}}var U=A("keyword a"),le=A("keyword b"),_e=A("keyword c"),at=A("keyword d"),xt=A("operator"),Be={type:"atom",style:"atom"};return{if:A("if"),while:U,with:U,else:le,do:le,try:le,finally:le,return:at,break:at,continue:at,new:A("new"),delete:_e,void:_e,throw:_e,debugger:A("debugger"),var:A("var"),const:A("var"),let:A("var"),function:A("function"),catch:A("catch"),for:A("for"),switch:A("switch"),case:A("case"),default:A("default"),in:xt,typeof:xt,instanceof:xt,true:Be,false:Be,null:Be,undefined:Be,NaN:Be,Infinity:Be,this:A("this"),class:A("class"),super:A("atom"),yield:_e,export:A("export"),import:A("import"),extends:_e,await:_e}}(),_=/[+\-*&%=<>!?|~^@]/,T=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function L(A){for(var U=!1,le,_e=!1;(le=A.next())!=null;){if(!U){if(le=="/"&&!_e)return;le=="["?_e=!0:_e&&le=="]"&&(_e=!1)}U=!U&&le=="\\"}}var P,M;function w(A,U,le){return P=A,M=le,U}function N(A,U){var le=A.next();if(le=='"'||le=="'")return U.tokenize=C(le),U.tokenize(A,U);if(le=="."&&A.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return w("number","number");if(le=="."&&A.match(".."))return w("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(le))return w(le);if(le=="="&&A.eat(">"))return w("=>","operator");if(le=="0"&&A.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return w("number","number");if(/\d/.test(le))return A.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),w("number","number");if(le=="/")return A.eat("*")?(U.tokenize=k,k(A,U)):A.eat("/")?(A.skipToEnd(),w("comment","comment")):ge(A,U,1)?(L(A),A.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),w("regexp","string-2")):(A.eat("="),w("operator","operator",A.current()));if(le=="`")return U.tokenize=q,q(A,U);if(le=="#"&&A.peek()=="!")return A.skipToEnd(),w("meta","meta");if(le=="#"&&A.eatWhile(y))return w("variable","property");if(le=="<"&&A.match("!--")||le=="-"&&A.match("->")&&!/\S/.test(A.string.slice(0,A.start)))return A.skipToEnd(),w("comment","comment");if(_.test(le))return(le!=">"||!U.lexical||U.lexical.type!=">")&&(A.eat("=")?(le=="!"||le=="=")&&A.eat("="):/[<>*+\-|&?]/.test(le)&&(A.eat(le),le==">"&&A.eat(le))),le=="?"&&A.eat(".")?w("."):w("operator","operator",A.current());if(y.test(le)){A.eatWhile(y);var _e=A.current();if(U.lastType!="."){if(x.propertyIsEnumerable(_e)){var at=x[_e];return w(at.type,at.style,_e)}if(_e=="async"&&A.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return w("async","keyword",_e)}return w("variable","variable",_e)}}function C(A){return function(U,le){var _e=!1,at;if(f&&U.peek()=="@"&&U.match(T))return le.tokenize=N,w("jsonld-keyword","meta");for(;(at=U.next())!=null&&!(at==A&&!_e);)_e=!_e&&at=="\\";return _e||(le.tokenize=N),w("string","string")}}function k(A,U){for(var le=!1,_e;_e=A.next();){if(_e=="/"&&le){U.tokenize=N;break}le=_e=="*"}return w("comment","comment")}function q(A,U){for(var le=!1,_e;(_e=A.next())!=null;){if(!le&&(_e=="`"||_e=="$"&&A.eat("{"))){U.tokenize=N;break}le=!le&&_e=="\\"}return w("quasi","string-2",A.current())}var R="([{}])";function J(A,U){U.fatArrowAt&&(U.fatArrowAt=null);var le=A.string.indexOf("=>",A.start);if(!(le<0)){if(g){var _e=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(A.string.slice(A.start,le));_e&&(le=_e.index)}for(var at=0,xt=!1,Be=le-1;Be>=0;--Be){var fn=A.string.charAt(Be),Vn=R.indexOf(fn);if(Vn>=0&&Vn<3){if(!at){++Be;break}if(--at==0){fn=="("&&(xt=!0);break}}else if(Vn>=3&&Vn<6)++at;else if(y.test(fn))xt=!0;else if(/["'\/`]/.test(fn))for(;;--Be){if(Be==0)return;var es=A.string.charAt(Be-1);if(es==fn&&A.string.charAt(Be-2)!="\\"){Be--;break}}else if(xt&&!at){++Be;break}}xt&&!at&&(U.fatArrowAt=Be)}}var oe={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function Q(A,U,le,_e,at,xt){this.indented=A,this.column=U,this.type=le,this.prev=at,this.info=xt,_e!=null&&(this.align=_e)}function X(A,U){if(!d)return!1;for(var le=A.localVars;le;le=le.next)if(le.name==U)return!0;for(var _e=A.context;_e;_e=_e.prev)for(var le=_e.vars;le;le=le.next)if(le.name==U)return!0}function Se(A,U,le,_e,at){var xt=A.cc;for(H.state=A,H.stream=at,H.marked=null,H.cc=xt,H.style=U,A.lexical.hasOwnProperty("align")||(A.lexical.align=!0);;){var Be=xt.length?xt.pop():p?Ze:Ee;if(Be(le,_e)){for(;xt.length&&xt[xt.length-1].lex;)xt.pop()();return H.marked?H.marked:le=="variable"&&X(A,_e)?"variable-2":U}}}var H={state:null,column:null,marked:null,cc:null};function W(){for(var A=arguments.length-1;A>=0;A--)H.cc.push(arguments[A])}function D(){return W.apply(null,arguments),!0}function ee(A,U){for(var le=U;le;le=le.next)if(le.name==A)return!0;return!1}function te(A){var U=H.state;if(H.marked="def",!!d){if(U.context){if(U.lexical.info=="var"&&U.context&&U.context.block){var le=Me(A,U.context);if(le!=null){U.context=le;return}}else if(!ee(A,U.localVars)){U.localVars=new ue(A,U.localVars);return}}a.globalVars&&!ee(A,U.globalVars)&&(U.globalVars=new ue(A,U.globalVars))}}function Me(A,U){if(U)if(U.block){var le=Me(A,U.prev);return le?le==U.prev?U:new ce(le,U.vars,!0):null}else return ee(A,U.vars)?U:new ce(U.prev,new ue(A,U.vars),!1);else return null}function Oe(A){return A=="public"||A=="private"||A=="protected"||A=="abstract"||A=="readonly"}function ce(A,U,le){this.prev=A,this.vars=U,this.block=le}function ue(A,U){this.name=A,this.next=U}var We=new ue("this",new ue("arguments",null));function Pe(){H.state.context=new ce(H.state.context,H.state.localVars,!1),H.state.localVars=We}function ze(){H.state.context=new ce(H.state.context,H.state.localVars,!0),H.state.localVars=null}function $e(){H.state.localVars=H.state.context.vars,H.state.context=H.state.context.prev}$e.lex=!0;function K(A,U){var le=function(){var _e=H.state,at=_e.indented;if(_e.lexical.type=="stat")at=_e.lexical.indented;else for(var xt=_e.lexical;xt&&xt.type==")"&&xt.align;xt=xt.prev)at=xt.indented;_e.lexical=new Q(at,H.stream.column(),A,null,_e.lexical,U)};return le.lex=!0,le}function Ae(){var A=H.state;A.lexical.prev&&(A.lexical.type==")"&&(A.indented=A.lexical.indented),A.lexical=A.lexical.prev)}Ae.lex=!0;function Re(A){function U(le){return le==A?D():A==";"||le=="}"||le==")"||le=="]"?W():D(U)}return U}function Ee(A,U){return A=="var"?D(K("vardef",U),Ei,Re(";"),Ae):A=="keyword a"?D(K("form"),be,Ee,Ae):A=="keyword b"?D(K("form"),Ee,Ae):A=="keyword d"?H.stream.match(/^\s*$/,!1)?D():D(K("stat"),me,Re(";"),Ae):A=="debugger"?D(Re(";")):A=="{"?D(K("}"),ze,Te,Ae,$e):A==";"?D():A=="if"?(H.state.lexical.info=="else"&&H.state.cc[H.state.cc.length-1]==Ae&&H.state.cc.pop()(),D(K("form"),be,Ee,Ae,$)):A=="function"?D(Ke):A=="for"?D(K("form"),ze,ae,Ee,$e,Ae):A=="class"||g&&U=="interface"?(H.marked="keyword",D(K("form",A=="class"?A:U),ct,Ae)):A=="variable"?g&&U=="declare"?(H.marked="keyword",D(Ee)):g&&(U=="module"||U=="enum"||U=="type")&&H.stream.match(/^\s*\w/,!1)?(H.marked="keyword",U=="enum"?D(_n):U=="type"?D(dt,Re("operator"),Ve,Re(";")):D(K("form"),an,Re("{"),K("}"),Te,Ae,Ae)):g&&U=="namespace"?(H.marked="keyword",D(K("form"),Ze,Ee,Ae)):g&&U=="abstract"?(H.marked="keyword",D(Ee)):D(K("stat"),qe):A=="switch"?D(K("form"),be,Re("{"),K("}","switch"),ze,Te,Ae,Ae,$e):A=="case"?D(Ze,Re(":")):A=="default"?D(Re(":")):A=="catch"?D(K("form"),Pe,Je,Ee,Ae,$e):A=="export"?D(K("stat"),gt,Ae):A=="import"?D(K("stat"),lt,Ae):A=="async"?D(Ee):U=="@"?D(Ze,Ee):W(K("stat"),Ze,Re(";"),Ae)}function Je(A){if(A=="(")return D(it,Re(")"))}function Ze(A,U){return Le(A,U,!1)}function se(A,U){return Le(A,U,!0)}function be(A){return A!="("?W():D(K(")"),me,Re(")"),Ae)}function Le(A,U,le){if(H.state.fatArrowAt==H.stream.start){var _e=le?G:bt;if(A=="(")return D(Pe,K(")"),ne(it,")"),Ae,Re("=>"),_e,$e);if(A=="variable")return W(Pe,an,Re("=>"),_e,$e)}var at=le?tt:Ce;return oe.hasOwnProperty(A)?D(at):A=="function"?D(Ke,at):A=="class"||g&&U=="interface"?(H.marked="keyword",D(K("form"),mt,Ae)):A=="keyword c"||A=="async"?D(le?se:Ze):A=="("?D(K(")"),me,Re(")"),Ae,at):A=="operator"||A=="spread"?D(le?se:Ze):A=="["?D(K("]"),nt,Ae,at):A=="{"?ve(Y,"}",null,at):A=="quasi"?W(rt,at):A=="new"?D(O(le)):D()}function me(A){return A.match(/[;\}\)\],]/)?W():W(Ze)}function Ce(A,U){return A==","?D(me):tt(A,U,!1)}function tt(A,U,le){var _e=le==!1?Ce:tt,at=le==!1?Ze:se;if(A=="=>")return D(Pe,le?G:bt,$e);if(A=="operator")return/\+\+|--/.test(U)||g&&U=="!"?D(_e):g&&U=="<"&&H.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?D(K(">"),ne(Ve,">"),Ae,_e):U=="?"?D(Ze,Re(":"),at):D(at);if(A=="quasi")return W(rt,_e);if(A!=";"){if(A=="(")return ve(se,")","call",_e);if(A==".")return D(Xe,_e);if(A=="[")return D(K("]"),me,Re("]"),Ae,_e);if(g&&U=="as")return H.marked="keyword",D(Ve,_e);if(A=="regexp")return H.state.lastType=H.marked="operator",H.stream.backUp(H.stream.pos-H.stream.start-1),D(at)}}function rt(A,U){return A!="quasi"?W():U.slice(U.length-2)!="${"?D(rt):D(me,ht)}function ht(A){if(A=="}")return H.marked="string-2",H.state.tokenize=q,D(rt)}function bt(A){return J(H.stream,H.state),W(A=="{"?Ee:Ze)}function G(A){return J(H.stream,H.state),W(A=="{"?Ee:se)}function O(A){return function(U){return U=="."?D(A?de:pe):U=="variable"&&g?D(Ti,A?tt:Ce):W(A?se:Ze)}}function pe(A,U){if(U=="target")return H.marked="keyword",D(Ce)}function de(A,U){if(U=="target")return H.marked="keyword",D(tt)}function qe(A){return A==":"?D(Ae,Ee):W(Ce,Re(";"),Ae)}function Xe(A){if(A=="variable")return H.marked="property",D()}function Y(A,U){if(A=="async")return H.marked="property",D(Y);if(A=="variable"||H.style=="keyword"){if(H.marked="property",U=="get"||U=="set")return D(ke);var le;return g&&H.state.fatArrowAt==H.stream.start&&(le=H.stream.match(/^\s*:\s*/,!1))&&(H.state.fatArrowAt=H.stream.pos+le[0].length),D(z)}else{if(A=="number"||A=="string")return H.marked=f?"property":H.style+" property",D(z);if(A=="jsonld-keyword")return D(z);if(g&&Oe(U))return H.marked="keyword",D(Y);if(A=="[")return D(Ze,Ne,Re("]"),z);if(A=="spread")return D(se,z);if(U=="*")return H.marked="keyword",D(Y);if(A==":")return W(z)}}function ke(A){return A!="variable"?W(z):(H.marked="property",D(Ke))}function z(A){if(A==":")return D(se);if(A=="(")return W(Ke)}function ne(A,U,le){function _e(at,xt){if(le?le.indexOf(at)>-1:at==","){var Be=H.state.lexical;return Be.info=="call"&&(Be.pos=(Be.pos||0)+1),D(function(fn,Vn){return fn==U||Vn==U?W():W(A)},_e)}return at==U||xt==U?D():le&&le.indexOf(";")>-1?W(A):D(Re(U))}return function(at,xt){return at==U||xt==U?D():W(A,_e)}}function ve(A,U,le){for(var _e=3;_e<arguments.length;_e++)H.cc.push(arguments[_e]);return D(K(U,le),ne(A,U),Ae)}function Te(A){return A=="}"?D():W(Ee,Te)}function Ne(A,U){if(g){if(A==":")return D(Ve);if(U=="?")return D(Ne)}}function xe(A,U){if(g&&(A==":"||U=="in"))return D(Ve)}function wt(A){if(g&&A==":")return H.stream.match(/^\s*\w+\s+is\b/,!1)?D(Ze,st,Ve):D(Ve)}function st(A,U){if(U=="is")return H.marked="keyword",D()}function Ve(A,U){if(U=="keyof"||U=="typeof"||U=="infer"||U=="readonly")return H.marked="keyword",D(U=="typeof"?se:Ve);if(A=="variable"||U=="void")return H.marked="type",D(yn);if(U=="|"||U=="&")return D(Ve);if(A=="string"||A=="number"||A=="atom")return D(yn);if(A=="[")return D(K("]"),ne(Ve,"]",","),Ae,yn);if(A=="{")return D(K("}"),Gi,Ae,yn);if(A=="(")return D(ne(Si,")"),ft,yn);if(A=="<")return D(ne(Ve,">"),Ve);if(A=="quasi")return W(Un,yn)}function ft(A){if(A=="=>")return D(Ve)}function Gi(A){return A.match(/[\}\)\]]/)?D():A==","||A==";"?D(Gi):W(Wt,Gi)}function Wt(A,U){if(A=="variable"||H.style=="keyword")return H.marked="property",D(Wt);if(U=="?"||A=="number"||A=="string")return D(Wt);if(A==":")return D(Ve);if(A=="[")return D(Re("variable"),xe,Re("]"),Wt);if(A=="(")return W(Ye,Wt);if(!A.match(/[;\}\)\],]/))return D()}function Un(A,U){return A!="quasi"?W():U.slice(U.length-2)!="${"?D(Un):D(Ve,Dt)}function Dt(A){if(A=="}")return H.marked="string-2",H.state.tokenize=q,D(Un)}function Si(A,U){return A=="variable"&&H.stream.match(/^\s*[?:]/,!1)||U=="?"?D(Si):A==":"?D(Ve):A=="spread"?D(Si):W(Ve)}function yn(A,U){if(U=="<")return D(K(">"),ne(Ve,">"),Ae,yn);if(U=="|"||A=="."||U=="&")return D(Ve);if(A=="[")return D(Ve,Re("]"),yn);if(U=="extends"||U=="implements")return H.marked="keyword",D(Ve);if(U=="?")return D(Ve,Re(":"),Ve)}function Ti(A,U){if(U=="<")return D(K(">"),ne(Ve,">"),Ae,yn)}function Wn(){return W(Ve,Qr)}function Qr(A,U){if(U=="=")return D(Ve)}function Ei(A,U){return U=="enum"?(H.marked="keyword",D(_n)):W(an,Ne,jn,F)}function an(A,U){if(g&&Oe(U))return H.marked="keyword",D(an);if(A=="variable")return te(U),D();if(A=="spread")return D(an);if(A=="[")return ve(Sr,"]");if(A=="{")return ve($r,"}")}function $r(A,U){return A=="variable"&&!H.stream.match(/^\s*:/,!1)?(te(U),D(jn)):(A=="variable"&&(H.marked="property"),A=="spread"?D(an):A=="}"?W():A=="["?D(Ze,Re("]"),Re(":"),$r):D(Re(":"),an,jn))}function Sr(){return W(an,jn)}function jn(A,U){if(U=="=")return D(se)}function F(A){if(A==",")return D(Ei)}function $(A,U){if(A=="keyword b"&&U=="else")return D(K("form","else"),Ee,Ae)}function ae(A,U){if(U=="await")return D(ae);if(A=="(")return D(K(")"),re,Ae)}function re(A){return A=="var"?D(Ei,fe):A=="variable"?D(fe):W(fe)}function fe(A,U){return A==")"?D():A==";"?D(fe):U=="in"||U=="of"?(H.marked="keyword",D(Ze,fe)):W(Ze,fe)}function Ke(A,U){if(U=="*")return H.marked="keyword",D(Ke);if(A=="variable")return te(U),D(Ke);if(A=="(")return D(Pe,K(")"),ne(it,")"),Ae,wt,Ee,$e);if(g&&U=="<")return D(K(">"),ne(Wn,">"),Ae,Ke)}function Ye(A,U){if(U=="*")return H.marked="keyword",D(Ye);if(A=="variable")return te(U),D(Ye);if(A=="(")return D(Pe,K(")"),ne(it,")"),Ae,wt,$e);if(g&&U=="<")return D(K(">"),ne(Wn,">"),Ae,Ye)}function dt(A,U){if(A=="keyword"||A=="variable")return H.marked="type",D(dt);if(U=="<")return D(K(">"),ne(Wn,">"),Ae)}function it(A,U){return U=="@"&&D(Ze,it),A=="spread"?D(it):g&&Oe(U)?(H.marked="keyword",D(it)):g&&A=="this"?D(Ne,jn):W(an,Ne,jn)}function mt(A,U){return A=="variable"?ct(A,U):ut(A,U)}function ct(A,U){if(A=="variable")return te(U),D(ut)}function ut(A,U){if(U=="<")return D(K(">"),ne(Wn,">"),Ae,ut);if(U=="extends"||U=="implements"||g&&A==",")return U=="implements"&&(H.marked="keyword"),D(g?Ve:Ze,ut);if(A=="{")return D(K("}"),_t,Ae)}function _t(A,U){if(A=="async"||A=="variable"&&(U=="static"||U=="get"||U=="set"||g&&Oe(U))&&H.stream.match(/^\s+[\w$\xa1-\uffff]/,!1))return H.marked="keyword",D(_t);if(A=="variable"||H.style=="keyword")return H.marked="property",D(Gt,_t);if(A=="number"||A=="string")return D(Gt,_t);if(A=="[")return D(Ze,Ne,Re("]"),Gt,_t);if(U=="*")return H.marked="keyword",D(_t);if(g&&A=="(")return W(Ye,_t);if(A==";"||A==",")return D(_t);if(A=="}")return D();if(U=="@")return D(Ze,_t)}function Gt(A,U){if(U=="!"||U=="?")return D(Gt);if(A==":")return D(Ve,jn);if(U=="=")return D(se);var le=H.state.lexical.prev,_e=le&&le.info=="interface";return W(_e?Ye:Ke)}function gt(A,U){return U=="*"?(H.marked="keyword",D(zt,Re(";"))):U=="default"?(H.marked="keyword",D(Ze,Re(";"))):A=="{"?D(ne(ni,"}"),zt,Re(";")):W(Ee)}function ni(A,U){if(U=="as")return H.marked="keyword",D(Re("variable"));if(A=="variable")return W(se,ni)}function lt(A){return A=="string"?D():A=="("?W(Ze):A=="."?W(Ce):W(Ue,on,zt)}function Ue(A,U){return A=="{"?ve(Ue,"}"):(A=="variable"&&te(U),U=="*"&&(H.marked="keyword"),D(Gn))}function on(A){if(A==",")return D(Ue,on)}function Gn(A,U){if(U=="as")return H.marked="keyword",D(Ue)}function zt(A,U){if(U=="from")return H.marked="keyword",D(Ze)}function nt(A){return A=="]"?D():W(ne(se,"]"))}function _n(){return W(K("form"),an,Re("{"),K("}"),ne(Jt,"}"),Ae,Ae)}function Jt(){return W(an,jn)}function da(A,U){return A.lastType=="operator"||A.lastType==","||_.test(U.charAt(0))||/[,.]/.test(U.charAt(0))}function ge(A,U,le){return U.tokenize==N&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(U.lastType)||U.lastType=="quasi"&&/\{\s*$/.test(A.string.slice(0,A.pos-(le||0)))}return{startState:function(A){var U={tokenize:N,lastType:"sof",cc:[],lexical:new Q((A||0)-o,0,"block",!1),localVars:a.localVars,context:a.localVars&&new ce(null,null,!1),indented:A||0};return a.globalVars&&typeof a.globalVars=="object"&&(U.globalVars=a.globalVars),U},token:function(A,U){if(A.sol()&&(U.lexical.hasOwnProperty("align")||(U.lexical.align=!1),U.indented=A.indentation(),J(A,U)),U.tokenize!=k&&A.eatSpace())return null;var le=U.tokenize(A,U);return P=="comment"?le:(U.lastType=P=="operator"&&(M=="++"||M=="--")?"incdec":P,Se(U,le,P,M,A))},indent:function(A,U){if(A.tokenize==k||A.tokenize==q)return t.Pass;if(A.tokenize!=N)return 0;var le=U&&U.charAt(0),_e=A.lexical,at;if(!/^\s*else\b/.test(U))for(var xt=A.cc.length-1;xt>=0;--xt){var Be=A.cc[xt];if(Be==Ae)_e=_e.prev;else if(Be!=$&&Be!=$e)break}for(;(_e.type=="stat"||_e.type=="form")&&(le=="}"||(at=A.cc[A.cc.length-1])&&(at==Ce||at==tt)&&!/^[,\.=+\-*:?[\(]/.test(U));)_e=_e.prev;h&&_e.type==")"&&_e.prev.type=="stat"&&(_e=_e.prev);var fn=_e.type,Vn=le==fn;return fn=="vardef"?_e.indented+(A.lastType=="operator"||A.lastType==","?_e.info.length+1:0):fn=="form"&&le=="{"?_e.indented:fn=="form"?_e.indented+o:fn=="stat"?_e.indented+(da(A,U)?h||o:0):_e.info=="switch"&&!Vn&&a.doubleIndentSwitch!=!1?_e.indented+(/^(?:case|default)\b/.test(U)?o:2*o):_e.align?_e.column+(Vn?0:1):_e.indented+(Vn?0:o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:p?null:"/*",blockCommentEnd:p?null:"*/",blockCommentContinue:p?null:" * ",lineComment:p?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:p?"json":"javascript",jsonldMode:f,jsonMode:p,expressionAllowed:ge,skipExpression:function(A){Se(A,"atom","atom","true",new t.StringStream("",2,null))}}}),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})})})();/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const bc="135",_s={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},bs={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},uy=0,pp=1,cy=2,mp=1,hy=2,Ua=3,Wa=0,nn=1,ws=2,gp=1,$i=0,Ga=1,vp=2,xp=3,yp=4,fy=5,Ms=100,dy=101,py=102,_p=103,bp=104,my=200,gy=201,vy=202,xy=203,wp=204,Mp=205,yy=206,_y=207,by=208,wy=209,My=210,Sy=0,Ty=1,Ey=2,wc=3,Ay=4,Ly=5,Cy=6,Ry=7,pl=0,Py=1,Dy=2,Nr=0,Iy=1,ky=2,Ny=3,Fy=4,Oy=5,Sp=300,Va=301,Xa=302,Mc=303,Sc=304,ml=306,Tc=307,Ec=1e3,Zn=1001,Ac=1002,un=1003,Tp=1004,Ep=1005,Jn=1006,zy=1007,gl=1008,er=1009,By=1010,Hy=1011,Za=1012,Uy=1013,vl=1014,tr=1015,Ss=1016,Wy=1017,Gy=1018,Vy=1019,Ts=1020,Xy=1021,Fr=1022,In=1023,Zy=1024,qy=1025,Yy=In,Or=1026,Es=1027,jy=1028,Jy=1029,Ky=1030,Qy=1031,$y=1032,e_=1033,Ap=33776,Lp=33777,Cp=33778,Rp=33779,Pp=35840,Dp=35841,Ip=35842,kp=35843,t_=36196,Np=37492,Fp=37496,n_=37808,i_=37809,r_=37810,s_=37811,a_=37812,o_=37813,l_=37814,u_=37815,c_=37816,h_=37817,f_=37818,d_=37819,p_=37820,m_=37821,g_=36492,v_=37840,x_=37841,y_=37842,__=37843,b_=37844,w_=37845,M_=37846,S_=37847,T_=37848,E_=37849,A_=37850,L_=37851,C_=37852,R_=37853,P_=2200,D_=2201,I_=2202,xl=2300,yl=2301,Lc=2302,As=2400,Ls=2401,_l=2402,Cc=2500,Op=2501,k_=0,On=3e3,bl=3001,Rc=3007,Pc=3002,zp=3004,Bp=3005,Hp=3006,N_=3200,F_=3201,Cs=0,O_=1,Dc=7680,z_=519,qa=35044,wl=35048,Up="300 es";class nr{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const a=this._listeners[e];if(a!==void 0){const o=a.indexOf(t);o!==-1&&a.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const a=i.slice(0);for(let o=0,h=a.length;o<h;o++)a[o].call(this,e);e.target=null}}}const mn=[];for(let r=0;r<256;r++)mn[r]=(r<16?"0":"")+r.toString(16);let Ml=1234567;const Ya=Math.PI/180,ja=180/Math.PI;function ai(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(mn[r&255]+mn[r>>8&255]+mn[r>>16&255]+mn[r>>24&255]+"-"+mn[e&255]+mn[e>>8&255]+"-"+mn[e>>16&15|64]+mn[e>>24&255]+"-"+mn[t&63|128]+mn[t>>8&255]+"-"+mn[t>>16&255]+mn[t>>24&255]+mn[i&255]+mn[i>>8&255]+mn[i>>16&255]+mn[i>>24&255]).toUpperCase()}function Mn(r,e,t){return Math.max(e,Math.min(t,r))}function Ic(r,e){return(r%e+e)%e}function B_(r,e,t,i,a){return i+(r-e)*(a-i)/(t-e)}function H_(r,e,t){return r!==e?(t-r)/(e-r):0}function Ja(r,e,t){return(1-t)*r+t*e}function U_(r,e,t,i){return Ja(r,e,1-Math.exp(-t*i))}function W_(r,e=1){return e-Math.abs(Ic(r,e*2)-e)}function G_(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function V_(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function X_(r,e){return r+Math.floor(Math.random()*(e-r+1))}function Z_(r,e){return r+Math.random()*(e-r)}function q_(r){return r*(.5-Math.random())}function Y_(r){return r!==void 0&&(Ml=r%2147483647),Ml=Ml*16807%2147483647,(Ml-1)/2147483646}function j_(r){return r*Ya}function J_(r){return r*ja}function kc(r){return(r&r-1)==0&&r!==0}function K_(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Wp(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Q_(r,e,t,i,a){const o=Math.cos,h=Math.sin,f=o(t/2),p=h(t/2),d=o((e+i)/2),g=h((e+i)/2),y=o((e-i)/2),x=h((e-i)/2),_=o((i-e)/2),T=h((i-e)/2);switch(a){case"XYX":r.set(f*g,p*y,p*x,f*d);break;case"YZY":r.set(p*x,f*g,p*y,f*d);break;case"ZXZ":r.set(p*y,p*x,f*g,f*d);break;case"XZX":r.set(f*g,p*T,p*_,f*d);break;case"YXY":r.set(p*_,f*g,p*T,f*d);break;case"ZYZ":r.set(p*T,p*_,f*g,f*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}var xC=Object.freeze({__proto__:null,DEG2RAD:Ya,RAD2DEG:ja,generateUUID:ai,clamp:Mn,euclideanModulo:Ic,mapLinear:B_,inverseLerp:H_,lerp:Ja,damp:U_,pingpong:W_,smoothstep:G_,smootherstep:V_,randInt:X_,randFloat:Z_,randFloatSpread:q_,seededRandom:Y_,degToRad:j_,radToDeg:J_,isPowerOfTwo:kc,ceilPowerOfTwo:K_,floorPowerOfTwo:Wp,setQuaternionFromProperEuler:Q_});class ye{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6],this.y=a[1]*t+a[4]*i+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),a=Math.sin(t),o=this.x-e.x,h=this.y-e.y;return this.x=o*i-h*a+e.x,this.y=o*a+h*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}ye.prototype.isVector2=!0;class gn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,a,o,h,f,p,d){const g=this.elements;return g[0]=e,g[1]=a,g[2]=f,g[3]=t,g[4]=o,g[5]=p,g[6]=i,g[7]=h,g[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,a=t.elements,o=this.elements,h=i[0],f=i[3],p=i[6],d=i[1],g=i[4],y=i[7],x=i[2],_=i[5],T=i[8],L=a[0],P=a[3],M=a[6],w=a[1],N=a[4],C=a[7],k=a[2],q=a[5],R=a[8];return o[0]=h*L+f*w+p*k,o[3]=h*P+f*N+p*q,o[6]=h*M+f*C+p*R,o[1]=d*L+g*w+y*k,o[4]=d*P+g*N+y*q,o[7]=d*M+g*C+y*R,o[2]=x*L+_*w+T*k,o[5]=x*P+_*N+T*q,o[8]=x*M+_*C+T*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],a=e[2],o=e[3],h=e[4],f=e[5],p=e[6],d=e[7],g=e[8];return t*h*g-t*f*d-i*o*g+i*f*p+a*o*d-a*h*p}invert(){const e=this.elements,t=e[0],i=e[1],a=e[2],o=e[3],h=e[4],f=e[5],p=e[6],d=e[7],g=e[8],y=g*h-f*d,x=f*p-g*o,_=d*o-h*p,T=t*y+i*x+a*_;if(T===0)return this.set(0,0,0,0,0,0,0,0,0);const L=1/T;return e[0]=y*L,e[1]=(a*d-g*i)*L,e[2]=(f*i-a*h)*L,e[3]=x*L,e[4]=(g*t-a*p)*L,e[5]=(a*o-f*t)*L,e[6]=_*L,e[7]=(i*p-d*t)*L,e[8]=(h*t-i*o)*L,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,a,o,h,f){const p=Math.cos(o),d=Math.sin(o);return this.set(i*p,i*d,-i*(p*h+d*f)+h+e,-a*d,a*p,-a*(-d*h+p*f)+f+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),a=this.elements,o=a[0],h=a[3],f=a[6],p=a[1],d=a[4],g=a[7];return a[0]=t*o+i*p,a[3]=t*h+i*d,a[6]=t*f+i*g,a[1]=-i*o+t*p,a[4]=-i*h+t*d,a[7]=-i*f+t*g,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let a=0;a<9;a++)if(t[a]!==i[a])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}gn.prototype.isMatrix3=!0;function Gp(r){if(r.length===0)return-1/0;let e=r[0];for(let t=1,i=r.length;t<i;++t)r[t]>e&&(e=r[t]);return e}function Sl(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Vp(r,e=0){let t=3735928559^e,i=1103547991^e;for(let a=0,o;a<r.length;a++)o=r.charCodeAt(a),t=Math.imul(t^o,2654435761),i=Math.imul(i^o,1597334677);return t=Math.imul(t^t>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}let Rs;class Ps{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Rs===void 0&&(Rs=Sl("canvas")),Rs.width=e.width,Rs.height=e.height;const i=Rs.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Rs}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let $_=0;class vn extends nr{constructor(e=vn.DEFAULT_IMAGE,t=vn.DEFAULT_MAPPING,i=Zn,a=Zn,o=Jn,h=gl,f=In,p=er,d=1,g=On){super();Object.defineProperty(this,"id",{value:$_++}),this.uuid=ai(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=a,this.magFilter=o,this.minFilter=h,this.anisotropy=d,this.format=f,this.internalFormat=null,this.type=p,this.offset=new ye(0,0),this.repeat=new ye(1,1),this.center=new ye(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const a=this.image;if(a.uuid===void 0&&(a.uuid=ai()),!t&&e.images[a.uuid]===void 0){let o;if(Array.isArray(a)){o=[];for(let h=0,f=a.length;h<f;h++)a[h].isDataTexture?o.push(Nc(a[h].image)):o.push(Nc(a[h]))}else o=Nc(a);e.images[a.uuid]={uuid:a.uuid,url:o}}i.image=a.uuid}return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Sp)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ec:e.x=e.x-Math.floor(e.x);break;case Zn:e.x=e.x<0?0:1;break;case Ac:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ec:e.y=e.y-Math.floor(e.y);break;case Zn:e.y=e.y<0?0:1;break;case Ac:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}vn.DEFAULT_IMAGE=void 0;vn.DEFAULT_MAPPING=Sp;vn.prototype.isTexture=!0;function Nc(r){return typeof HTMLImageElement!="undefined"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&r instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&r instanceof ImageBitmap?Ps.getDataURL(r):r.data?{data:Array.prototype.slice.call(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Rt{constructor(e=0,t=0,i=0,a=1){this.x=e,this.y=t,this.z=i,this.w=a}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,a){return this.x=e,this.y=t,this.z=i,this.w=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,a=this.z,o=this.w,h=e.elements;return this.x=h[0]*t+h[4]*i+h[8]*a+h[12]*o,this.y=h[1]*t+h[5]*i+h[9]*a+h[13]*o,this.z=h[2]*t+h[6]*i+h[10]*a+h[14]*o,this.w=h[3]*t+h[7]*i+h[11]*a+h[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,a,o;const h=.01,f=.1,p=e.elements,d=p[0],g=p[4],y=p[8],x=p[1],_=p[5],T=p[9],L=p[2],P=p[6],M=p[10];if(Math.abs(g-x)<h&&Math.abs(y-L)<h&&Math.abs(T-P)<h){if(Math.abs(g+x)<f&&Math.abs(y+L)<f&&Math.abs(T+P)<f&&Math.abs(d+_+M-3)<f)return this.set(1,0,0,0),this;t=Math.PI;const N=(d+1)/2,C=(_+1)/2,k=(M+1)/2,q=(g+x)/4,R=(y+L)/4,J=(T+P)/4;return N>C&&N>k?N<h?(i=0,a=.707106781,o=.707106781):(i=Math.sqrt(N),a=q/i,o=R/i):C>k?C<h?(i=.707106781,a=0,o=.707106781):(a=Math.sqrt(C),i=q/a,o=J/a):k<h?(i=.707106781,a=.707106781,o=0):(o=Math.sqrt(k),i=R/o,a=J/o),this.set(i,a,o,t),this}let w=Math.sqrt((P-T)*(P-T)+(y-L)*(y-L)+(x-g)*(x-g));return Math.abs(w)<.001&&(w=1),this.x=(P-T)/w,this.y=(y-L)/w,this.z=(x-g)/w,this.w=Math.acos((d+_+M-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Rt.prototype.isVector4=!0;class Kn extends nr{constructor(e,t,i={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new Rt(0,0,e,t),this.scissorTest=!1,this.viewport=new Rt(0,0,e,t),this.texture=new vn(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Jn,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=dp({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Kn.prototype.isWebGLRenderTarget=!0;class eb extends Kn{constructor(e,t,i){super(e,t);const a=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=a.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let a=0,o=this.texture.length;a<o;a++)this.texture[a].image.width=e,this.texture[a].image.height=t,this.texture[a].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}eb.prototype.isWebGLMultipleRenderTargets=!0;class Fc extends Kn{constructor(e,t,i={}){super(e,t,i);this.samples=4,this.ignoreDepthForMultisampleCopy=i.ignoreDepth!==void 0?i.ignoreDepth:!0,this.useRenderToTexture=i.useRenderToTexture!==void 0?i.useRenderToTexture:!1,this.useRenderbuffer=this.useRenderToTexture===!1}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}Fc.prototype.isWebGLMultisampleRenderTarget=!0;class Sn{constructor(e=0,t=0,i=0,a=1){this._x=e,this._y=t,this._z=i,this._w=a}static slerp(e,t,i,a){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,a)}static slerpFlat(e,t,i,a,o,h,f){let p=i[a+0],d=i[a+1],g=i[a+2],y=i[a+3];const x=o[h+0],_=o[h+1],T=o[h+2],L=o[h+3];if(f===0){e[t+0]=p,e[t+1]=d,e[t+2]=g,e[t+3]=y;return}if(f===1){e[t+0]=x,e[t+1]=_,e[t+2]=T,e[t+3]=L;return}if(y!==L||p!==x||d!==_||g!==T){let P=1-f;const M=p*x+d*_+g*T+y*L,w=M>=0?1:-1,N=1-M*M;if(N>Number.EPSILON){const k=Math.sqrt(N),q=Math.atan2(k,M*w);P=Math.sin(P*q)/k,f=Math.sin(f*q)/k}const C=f*w;if(p=p*P+x*C,d=d*P+_*C,g=g*P+T*C,y=y*P+L*C,P===1-f){const k=1/Math.sqrt(p*p+d*d+g*g+y*y);p*=k,d*=k,g*=k,y*=k}}e[t]=p,e[t+1]=d,e[t+2]=g,e[t+3]=y}static multiplyQuaternionsFlat(e,t,i,a,o,h){const f=i[a],p=i[a+1],d=i[a+2],g=i[a+3],y=o[h],x=o[h+1],_=o[h+2],T=o[h+3];return e[t]=f*T+g*y+p*_-d*x,e[t+1]=p*T+g*x+d*y-f*_,e[t+2]=d*T+g*_+f*x-p*y,e[t+3]=g*T-f*y-p*x-d*_,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,a){return this._x=e,this._y=t,this._z=i,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,a=e._y,o=e._z,h=e._order,f=Math.cos,p=Math.sin,d=f(i/2),g=f(a/2),y=f(o/2),x=p(i/2),_=p(a/2),T=p(o/2);switch(h){case"XYZ":this._x=x*g*y+d*_*T,this._y=d*_*y-x*g*T,this._z=d*g*T+x*_*y,this._w=d*g*y-x*_*T;break;case"YXZ":this._x=x*g*y+d*_*T,this._y=d*_*y-x*g*T,this._z=d*g*T-x*_*y,this._w=d*g*y+x*_*T;break;case"ZXY":this._x=x*g*y-d*_*T,this._y=d*_*y+x*g*T,this._z=d*g*T+x*_*y,this._w=d*g*y-x*_*T;break;case"ZYX":this._x=x*g*y-d*_*T,this._y=d*_*y+x*g*T,this._z=d*g*T-x*_*y,this._w=d*g*y+x*_*T;break;case"YZX":this._x=x*g*y+d*_*T,this._y=d*_*y+x*g*T,this._z=d*g*T-x*_*y,this._w=d*g*y-x*_*T;break;case"XZY":this._x=x*g*y-d*_*T,this._y=d*_*y-x*g*T,this._z=d*g*T+x*_*y,this._w=d*g*y+x*_*T;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,a=Math.sin(i);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],a=t[4],o=t[8],h=t[1],f=t[5],p=t[9],d=t[2],g=t[6],y=t[10],x=i+f+y;if(x>0){const _=.5/Math.sqrt(x+1);this._w=.25/_,this._x=(g-p)*_,this._y=(o-d)*_,this._z=(h-a)*_}else if(i>f&&i>y){const _=2*Math.sqrt(1+i-f-y);this._w=(g-p)/_,this._x=.25*_,this._y=(a+h)/_,this._z=(o+d)/_}else if(f>y){const _=2*Math.sqrt(1+f-i-y);this._w=(o-d)/_,this._x=(a+h)/_,this._y=.25*_,this._z=(p+g)/_}else{const _=2*Math.sqrt(1+y-i-f);this._w=(h-a)/_,this._x=(o+d)/_,this._y=(p+g)/_,this._z=.25*_}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Mn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const a=Math.min(1,t/i);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,a=e._y,o=e._z,h=e._w,f=t._x,p=t._y,d=t._z,g=t._w;return this._x=i*g+h*f+a*d-o*p,this._y=a*g+h*p+o*f-i*d,this._z=o*g+h*d+i*p-a*f,this._w=h*g-i*f-a*p-o*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,a=this._y,o=this._z,h=this._w;let f=h*e._w+i*e._x+a*e._y+o*e._z;if(f<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,f=-f):this.copy(e),f>=1)return this._w=h,this._x=i,this._y=a,this._z=o,this;const p=1-f*f;if(p<=Number.EPSILON){const _=1-t;return this._w=_*h+t*this._w,this._x=_*i+t*this._x,this._y=_*a+t*this._y,this._z=_*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const d=Math.sqrt(p),g=Math.atan2(d,f),y=Math.sin((1-t)*g)/d,x=Math.sin(t*g)/d;return this._w=h*y+this._w*x,this._x=i*y+this._x*x,this._y=a*y+this._y*x,this._z=o*y+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),a=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(a),i*Math.sin(o),i*Math.cos(o),t*Math.sin(a))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Sn.prototype.isQuaternion=!0;class V{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Xp.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Xp.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*a,this.y=o[1]*t+o[4]*i+o[7]*a,this.z=o[2]*t+o[5]*i+o[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,a=this.z,o=e.elements,h=1/(o[3]*t+o[7]*i+o[11]*a+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*a+o[12])*h,this.y=(o[1]*t+o[5]*i+o[9]*a+o[13])*h,this.z=(o[2]*t+o[6]*i+o[10]*a+o[14])*h,this}applyQuaternion(e){const t=this.x,i=this.y,a=this.z,o=e.x,h=e.y,f=e.z,p=e.w,d=p*t+h*a-f*i,g=p*i+f*t-o*a,y=p*a+o*i-h*t,x=-o*t-h*i-f*a;return this.x=d*p+x*-o+g*-f-y*-h,this.y=g*p+x*-h+y*-o-d*-f,this.z=y*p+x*-f+d*-h-g*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*a,this.y=o[1]*t+o[5]*i+o[9]*a,this.z=o[2]*t+o[6]*i+o[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,a=e.y,o=e.z,h=t.x,f=t.y,p=t.z;return this.x=a*p-o*f,this.y=o*h-i*p,this.z=i*f-a*h,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Oc.copy(this).projectOnVector(e),this.sub(Oc)}reflect(e){return this.sub(Oc.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Mn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,a=this.z-e.z;return t*t+i*i+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const a=Math.sin(t)*e;return this.x=a*Math.sin(i),this.y=Math.cos(t)*e,this.z=a*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=a,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}V.prototype.isVector3=!0;const Oc=new V,Xp=new Sn;class oi{constructor(e=new V(1/0,1/0,1/0),t=new V(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,a=1/0,o=-1/0,h=-1/0,f=-1/0;for(let p=0,d=e.length;p<d;p+=3){const g=e[p],y=e[p+1],x=e[p+2];g<t&&(t=g),y<i&&(i=y),x<a&&(a=x),g>o&&(o=g),y>h&&(h=y),x>f&&(f=x)}return this.min.set(t,i,a),this.max.set(o,h,f),this}setFromBufferAttribute(e){let t=1/0,i=1/0,a=1/0,o=-1/0,h=-1/0,f=-1/0;for(let p=0,d=e.count;p<d;p++){const g=e.getX(p),y=e.getY(p),x=e.getZ(p);g<t&&(t=g),y<i&&(i=y),x<a&&(a=x),g>o&&(o=g),y>h&&(h=y),x>f&&(f=x)}return this.min.set(t,i,a),this.max.set(o,h,f),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ka.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),zc.copy(t.boundingBox),zc.applyMatrix4(e.matrixWorld),this.union(zc));const i=e.children;for(let a=0,o=i.length;a<o;a++)this.expandByObject(i[a]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ka),Ka.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Qa),Tl.subVectors(this.max,Qa),Ds.subVectors(e.a,Qa),Is.subVectors(e.b,Qa),ks.subVectors(e.c,Qa),ir.subVectors(Is,Ds),rr.subVectors(ks,Is),zr.subVectors(Ds,ks);let t=[0,-ir.z,ir.y,0,-rr.z,rr.y,0,-zr.z,zr.y,ir.z,0,-ir.x,rr.z,0,-rr.x,zr.z,0,-zr.x,-ir.y,ir.x,0,-rr.y,rr.x,0,-zr.y,zr.x,0];return!Bc(t,Ds,Is,ks,Tl)||(t=[1,0,0,0,1,0,0,0,1],!Bc(t,Ds,Is,ks,Tl))?!1:(El.crossVectors(ir,rr),t=[El.x,El.y,El.z],Bc(t,Ds,Is,ks,Tl))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ka.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Ka).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ii[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ii[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ii[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ii[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ii[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ii[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ii[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ii[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ii),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}oi.prototype.isBox3=!0;const Ii=[new V,new V,new V,new V,new V,new V,new V,new V],Ka=new V,zc=new oi,Ds=new V,Is=new V,ks=new V,ir=new V,rr=new V,zr=new V,Qa=new V,Tl=new V,El=new V,Br=new V;function Bc(r,e,t,i,a){for(let o=0,h=r.length-3;o<=h;o+=3){Br.fromArray(r,o);const f=a.x*Math.abs(Br.x)+a.y*Math.abs(Br.y)+a.z*Math.abs(Br.z),p=e.dot(Br),d=t.dot(Br),g=i.dot(Br);if(Math.max(-Math.max(p,d,g),Math.min(p,d,g))>f)return!1}return!0}const tb=new oi,Zp=new V,Hc=new V,Uc=new V;class Ns{constructor(e=new V,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):tb.setFromPoints(e).getCenter(i);let a=0;for(let o=0,h=e.length;o<h;o++)a=Math.max(a,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(a),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Uc.subVectors(e,this.center);const t=Uc.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),a=(i-this.radius)*.5;this.center.add(Uc.multiplyScalar(a/i)),this.radius+=a}return this}union(e){return Hc.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Zp.copy(e.center).add(Hc)),this.expandByPoint(Zp.copy(e.center).sub(Hc)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ki=new V,Wc=new V,Al=new V,sr=new V,Gc=new V,Ll=new V,Vc=new V;class Fs{constructor(e=new V,t=new V(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ki)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ki.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ki.copy(this.direction).multiplyScalar(t).add(this.origin),ki.distanceToSquared(e))}distanceSqToSegment(e,t,i,a){Wc.copy(e).add(t).multiplyScalar(.5),Al.copy(t).sub(e).normalize(),sr.copy(this.origin).sub(Wc);const o=e.distanceTo(t)*.5,h=-this.direction.dot(Al),f=sr.dot(this.direction),p=-sr.dot(Al),d=sr.lengthSq(),g=Math.abs(1-h*h);let y,x,_,T;if(g>0)if(y=h*p-f,x=h*f-p,T=o*g,y>=0)if(x>=-T)if(x<=T){const L=1/g;y*=L,x*=L,_=y*(y+h*x+2*f)+x*(h*y+x+2*p)+d}else x=o,y=Math.max(0,-(h*x+f)),_=-y*y+x*(x+2*p)+d;else x=-o,y=Math.max(0,-(h*x+f)),_=-y*y+x*(x+2*p)+d;else x<=-T?(y=Math.max(0,-(-h*o+f)),x=y>0?-o:Math.min(Math.max(-o,-p),o),_=-y*y+x*(x+2*p)+d):x<=T?(y=0,x=Math.min(Math.max(-o,-p),o),_=x*(x+2*p)+d):(y=Math.max(0,-(h*o+f)),x=y>0?o:Math.min(Math.max(-o,-p),o),_=-y*y+x*(x+2*p)+d);else x=h>0?-o:o,y=Math.max(0,-(h*x+f)),_=-y*y+x*(x+2*p)+d;return i&&i.copy(this.direction).multiplyScalar(y).add(this.origin),a&&a.copy(Al).multiplyScalar(x).add(Wc),_}intersectSphere(e,t){ki.subVectors(e.center,this.origin);const i=ki.dot(this.direction),a=ki.dot(ki)-i*i,o=e.radius*e.radius;if(a>o)return null;const h=Math.sqrt(o-a),f=i-h,p=i+h;return f<0&&p<0?null:f<0?this.at(p,t):this.at(f,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,a,o,h,f,p;const d=1/this.direction.x,g=1/this.direction.y,y=1/this.direction.z,x=this.origin;return d>=0?(i=(e.min.x-x.x)*d,a=(e.max.x-x.x)*d):(i=(e.max.x-x.x)*d,a=(e.min.x-x.x)*d),g>=0?(o=(e.min.y-x.y)*g,h=(e.max.y-x.y)*g):(o=(e.max.y-x.y)*g,h=(e.min.y-x.y)*g),i>h||o>a||((o>i||i!==i)&&(i=o),(h<a||a!==a)&&(a=h),y>=0?(f=(e.min.z-x.z)*y,p=(e.max.z-x.z)*y):(f=(e.max.z-x.z)*y,p=(e.min.z-x.z)*y),i>p||f>a)||((f>i||i!==i)&&(i=f),(p<a||a!==a)&&(a=p),a<0)?null:this.at(i>=0?i:a,t)}intersectsBox(e){return this.intersectBox(e,ki)!==null}intersectTriangle(e,t,i,a,o){Gc.subVectors(t,e),Ll.subVectors(i,e),Vc.crossVectors(Gc,Ll);let h=this.direction.dot(Vc),f;if(h>0){if(a)return null;f=1}else if(h<0)f=-1,h=-h;else return null;sr.subVectors(this.origin,e);const p=f*this.direction.dot(Ll.crossVectors(sr,Ll));if(p<0)return null;const d=f*this.direction.dot(Gc.cross(sr));if(d<0||p+d>h)return null;const g=-f*sr.dot(Vc);return g<0?null:this.at(g/h,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ot{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,a,o,h,f,p,d,g,y,x,_,T,L,P){const M=this.elements;return M[0]=e,M[4]=t,M[8]=i,M[12]=a,M[1]=o,M[5]=h,M[9]=f,M[13]=p,M[2]=d,M[6]=g,M[10]=y,M[14]=x,M[3]=_,M[7]=T,M[11]=L,M[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ot().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,a=1/Os.setFromMatrixColumn(e,0).length(),o=1/Os.setFromMatrixColumn(e,1).length(),h=1/Os.setFromMatrixColumn(e,2).length();return t[0]=i[0]*a,t[1]=i[1]*a,t[2]=i[2]*a,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*h,t[9]=i[9]*h,t[10]=i[10]*h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,a=e.y,o=e.z,h=Math.cos(i),f=Math.sin(i),p=Math.cos(a),d=Math.sin(a),g=Math.cos(o),y=Math.sin(o);if(e.order==="XYZ"){const x=h*g,_=h*y,T=f*g,L=f*y;t[0]=p*g,t[4]=-p*y,t[8]=d,t[1]=_+T*d,t[5]=x-L*d,t[9]=-f*p,t[2]=L-x*d,t[6]=T+_*d,t[10]=h*p}else if(e.order==="YXZ"){const x=p*g,_=p*y,T=d*g,L=d*y;t[0]=x+L*f,t[4]=T*f-_,t[8]=h*d,t[1]=h*y,t[5]=h*g,t[9]=-f,t[2]=_*f-T,t[6]=L+x*f,t[10]=h*p}else if(e.order==="ZXY"){const x=p*g,_=p*y,T=d*g,L=d*y;t[0]=x-L*f,t[4]=-h*y,t[8]=T+_*f,t[1]=_+T*f,t[5]=h*g,t[9]=L-x*f,t[2]=-h*d,t[6]=f,t[10]=h*p}else if(e.order==="ZYX"){const x=h*g,_=h*y,T=f*g,L=f*y;t[0]=p*g,t[4]=T*d-_,t[8]=x*d+L,t[1]=p*y,t[5]=L*d+x,t[9]=_*d-T,t[2]=-d,t[6]=f*p,t[10]=h*p}else if(e.order==="YZX"){const x=h*p,_=h*d,T=f*p,L=f*d;t[0]=p*g,t[4]=L-x*y,t[8]=T*y+_,t[1]=y,t[5]=h*g,t[9]=-f*g,t[2]=-d*g,t[6]=_*y+T,t[10]=x-L*y}else if(e.order==="XZY"){const x=h*p,_=h*d,T=f*p,L=f*d;t[0]=p*g,t[4]=-y,t[8]=d*g,t[1]=x*y+L,t[5]=h*g,t[9]=_*y-T,t[2]=T*y-_,t[6]=f*g,t[10]=L*y+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nb,e,ib)}lookAt(e,t,i){const a=this.elements;return qn.subVectors(e,t),qn.lengthSq()===0&&(qn.z=1),qn.normalize(),ar.crossVectors(i,qn),ar.lengthSq()===0&&(Math.abs(i.z)===1?qn.x+=1e-4:qn.z+=1e-4,qn.normalize(),ar.crossVectors(i,qn)),ar.normalize(),Cl.crossVectors(qn,ar),a[0]=ar.x,a[4]=Cl.x,a[8]=qn.x,a[1]=ar.y,a[5]=Cl.y,a[9]=qn.y,a[2]=ar.z,a[6]=Cl.z,a[10]=qn.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,a=t.elements,o=this.elements,h=i[0],f=i[4],p=i[8],d=i[12],g=i[1],y=i[5],x=i[9],_=i[13],T=i[2],L=i[6],P=i[10],M=i[14],w=i[3],N=i[7],C=i[11],k=i[15],q=a[0],R=a[4],J=a[8],oe=a[12],Q=a[1],X=a[5],Se=a[9],H=a[13],W=a[2],D=a[6],ee=a[10],te=a[14],Me=a[3],Oe=a[7],ce=a[11],ue=a[15];return o[0]=h*q+f*Q+p*W+d*Me,o[4]=h*R+f*X+p*D+d*Oe,o[8]=h*J+f*Se+p*ee+d*ce,o[12]=h*oe+f*H+p*te+d*ue,o[1]=g*q+y*Q+x*W+_*Me,o[5]=g*R+y*X+x*D+_*Oe,o[9]=g*J+y*Se+x*ee+_*ce,o[13]=g*oe+y*H+x*te+_*ue,o[2]=T*q+L*Q+P*W+M*Me,o[6]=T*R+L*X+P*D+M*Oe,o[10]=T*J+L*Se+P*ee+M*ce,o[14]=T*oe+L*H+P*te+M*ue,o[3]=w*q+N*Q+C*W+k*Me,o[7]=w*R+N*X+C*D+k*Oe,o[11]=w*J+N*Se+C*ee+k*ce,o[15]=w*oe+N*H+C*te+k*ue,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],a=e[8],o=e[12],h=e[1],f=e[5],p=e[9],d=e[13],g=e[2],y=e[6],x=e[10],_=e[14],T=e[3],L=e[7],P=e[11],M=e[15];return T*(+o*p*y-a*d*y-o*f*x+i*d*x+a*f*_-i*p*_)+L*(+t*p*_-t*d*x+o*h*x-a*h*_+a*d*g-o*p*g)+P*(+t*d*y-t*f*_-o*h*y+i*h*_+o*f*g-i*d*g)+M*(-a*f*g-t*p*y+t*f*x+a*h*y-i*h*x+i*p*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],a=e[2],o=e[3],h=e[4],f=e[5],p=e[6],d=e[7],g=e[8],y=e[9],x=e[10],_=e[11],T=e[12],L=e[13],P=e[14],M=e[15],w=y*P*d-L*x*d+L*p*_-f*P*_-y*p*M+f*x*M,N=T*x*d-g*P*d-T*p*_+h*P*_+g*p*M-h*x*M,C=g*L*d-T*y*d+T*f*_-h*L*_-g*f*M+h*y*M,k=T*y*p-g*L*p-T*f*x+h*L*x+g*f*P-h*y*P,q=t*w+i*N+a*C+o*k;if(q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/q;return e[0]=w*R,e[1]=(L*x*o-y*P*o-L*a*_+i*P*_+y*a*M-i*x*M)*R,e[2]=(f*P*o-L*p*o+L*a*d-i*P*d-f*a*M+i*p*M)*R,e[3]=(y*p*o-f*x*o-y*a*d+i*x*d+f*a*_-i*p*_)*R,e[4]=N*R,e[5]=(g*P*o-T*x*o+T*a*_-t*P*_-g*a*M+t*x*M)*R,e[6]=(T*p*o-h*P*o-T*a*d+t*P*d+h*a*M-t*p*M)*R,e[7]=(h*x*o-g*p*o+g*a*d-t*x*d-h*a*_+t*p*_)*R,e[8]=C*R,e[9]=(T*y*o-g*L*o-T*i*_+t*L*_+g*i*M-t*y*M)*R,e[10]=(h*L*o-T*f*o+T*i*d-t*L*d-h*i*M+t*f*M)*R,e[11]=(g*f*o-h*y*o-g*i*d+t*y*d+h*i*_-t*f*_)*R,e[12]=k*R,e[13]=(g*L*a-T*y*a+T*i*x-t*L*x-g*i*P+t*y*P)*R,e[14]=(T*f*a-h*L*a-T*i*p+t*L*p+h*i*P-t*f*P)*R,e[15]=(h*y*a-g*f*a+g*i*p-t*y*p-h*i*x+t*f*x)*R,this}scale(e){const t=this.elements,i=e.x,a=e.y,o=e.z;return t[0]*=i,t[4]*=a,t[8]*=o,t[1]*=i,t[5]*=a,t[9]*=o,t[2]*=i,t[6]*=a,t[10]*=o,t[3]*=i,t[7]*=a,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,a))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),a=Math.sin(t),o=1-i,h=e.x,f=e.y,p=e.z,d=o*h,g=o*f;return this.set(d*h+i,d*f-a*p,d*p+a*f,0,d*f+a*p,g*f+i,g*p-a*h,0,d*p-a*f,g*p+a*h,o*p*p+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,a,o,h){return this.set(1,i,o,0,e,1,h,0,t,a,1,0,0,0,0,1),this}compose(e,t,i){const a=this.elements,o=t._x,h=t._y,f=t._z,p=t._w,d=o+o,g=h+h,y=f+f,x=o*d,_=o*g,T=o*y,L=h*g,P=h*y,M=f*y,w=p*d,N=p*g,C=p*y,k=i.x,q=i.y,R=i.z;return a[0]=(1-(L+M))*k,a[1]=(_+C)*k,a[2]=(T-N)*k,a[3]=0,a[4]=(_-C)*q,a[5]=(1-(x+M))*q,a[6]=(P+w)*q,a[7]=0,a[8]=(T+N)*R,a[9]=(P-w)*R,a[10]=(1-(x+L))*R,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,t,i){const a=this.elements;let o=Os.set(a[0],a[1],a[2]).length();const h=Os.set(a[4],a[5],a[6]).length(),f=Os.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),e.x=a[12],e.y=a[13],e.z=a[14],li.copy(this);const d=1/o,g=1/h,y=1/f;return li.elements[0]*=d,li.elements[1]*=d,li.elements[2]*=d,li.elements[4]*=g,li.elements[5]*=g,li.elements[6]*=g,li.elements[8]*=y,li.elements[9]*=y,li.elements[10]*=y,t.setFromRotationMatrix(li),i.x=o,i.y=h,i.z=f,this}makePerspective(e,t,i,a,o,h){h===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const f=this.elements,p=2*o/(t-e),d=2*o/(i-a),g=(t+e)/(t-e),y=(i+a)/(i-a),x=-(h+o)/(h-o),_=-2*h*o/(h-o);return f[0]=p,f[4]=0,f[8]=g,f[12]=0,f[1]=0,f[5]=d,f[9]=y,f[13]=0,f[2]=0,f[6]=0,f[10]=x,f[14]=_,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this}makeOrthographic(e,t,i,a,o,h){const f=this.elements,p=1/(t-e),d=1/(i-a),g=1/(h-o),y=(t+e)*p,x=(i+a)*d,_=(h+o)*g;return f[0]=2*p,f[4]=0,f[8]=0,f[12]=-y,f[1]=0,f[5]=2*d,f[9]=0,f[13]=-x,f[2]=0,f[6]=0,f[10]=-2*g,f[14]=-_,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let a=0;a<16;a++)if(t[a]!==i[a])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}ot.prototype.isMatrix4=!0;const Os=new V,li=new ot,nb=new V(0,0,0),ib=new V(1,1,1),ar=new V,Cl=new V,qn=new V,qp=new ot,Yp=new Sn;class zs{constructor(e=0,t=0,i=0,a=zs.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=a}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,a=this._order){return this._x=e,this._y=t,this._z=i,this._order=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const a=e.elements,o=a[0],h=a[4],f=a[8],p=a[1],d=a[5],g=a[9],y=a[2],x=a[6],_=a[10];switch(t){case"XYZ":this._y=Math.asin(Mn(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-g,_),this._z=Math.atan2(-h,o)):(this._x=Math.atan2(x,d),this._z=0);break;case"YXZ":this._x=Math.asin(-Mn(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(f,_),this._z=Math.atan2(p,d)):(this._y=Math.atan2(-y,o),this._z=0);break;case"ZXY":this._x=Math.asin(Mn(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-y,_),this._z=Math.atan2(-h,d)):(this._y=0,this._z=Math.atan2(p,o));break;case"ZYX":this._y=Math.asin(-Mn(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(x,_),this._z=Math.atan2(p,o)):(this._x=0,this._z=Math.atan2(-h,d));break;case"YZX":this._z=Math.asin(Mn(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-g,d),this._y=Math.atan2(-y,o)):(this._x=0,this._y=Math.atan2(f,_));break;case"XZY":this._z=Math.asin(-Mn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(x,d),this._y=Math.atan2(f,o)):(this._x=Math.atan2(-g,_),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return qp.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qp,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Yp.setFromEuler(this),this.setFromQuaternion(Yp,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new V(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}zs.prototype.isEuler=!0;zs.DefaultOrder="XYZ";zs.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class rb{constructor(){this.mask=1|0}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let sb=0;const jp=new V,Bs=new Sn,Ni=new ot,Rl=new V,$a=new V,ab=new V,ob=new Sn,Jp=new V(1,0,0),Kp=new V(0,1,0),Qp=new V(0,0,1),lb={type:"added"},$p={type:"removed"};class Et extends nr{constructor(){super();Object.defineProperty(this,"id",{value:sb++}),this.uuid=ai(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Et.DefaultUp.clone();const e=new V,t=new zs,i=new Sn,a=new V(1,1,1);function o(){i.setFromEuler(t,!1)}function h(){t.setFromQuaternion(i,void 0,!1)}t._onChange(o),i._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new ot},normalMatrix:{value:new gn}}),this.matrix=new ot,this.matrixWorld=new ot,this.matrixAutoUpdate=Et.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new rb,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Bs.setFromAxisAngle(e,t),this.quaternion.multiply(Bs),this}rotateOnWorldAxis(e,t){return Bs.setFromAxisAngle(e,t),this.quaternion.premultiply(Bs),this}rotateX(e){return this.rotateOnAxis(Jp,e)}rotateY(e){return this.rotateOnAxis(Kp,e)}rotateZ(e){return this.rotateOnAxis(Qp,e)}translateOnAxis(e,t){return jp.copy(e).applyQuaternion(this.quaternion),this.position.add(jp.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Jp,e)}translateY(e){return this.translateOnAxis(Kp,e)}translateZ(e){return this.translateOnAxis(Qp,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ni.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Rl.copy(e):Rl.set(e,t,i);const a=this.parent;this.updateWorldMatrix(!0,!1),$a.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ni.lookAt($a,Rl,this.up):Ni.lookAt(Rl,$a,this.up),this.quaternion.setFromRotationMatrix(Ni),a&&(Ni.extractRotation(a.matrixWorld),Bs.setFromRotationMatrix(Ni),this.quaternion.premultiply(Bs.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(lb)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent($p)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent($p)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ni.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ni.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ni),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,a=this.children.length;i<a;i++){const h=this.children[i].getObjectByProperty(e,t);if(h!==void 0)return h}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($a,e,ab),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($a,ob,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,a=t.length;i<a;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,a=t.length;i<a;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,a=t.length;i<a;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const a=this.children;for(let o=0,h=a.length;o<h;o++)a[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const a={};a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),this.castShadow===!0&&(a.castShadow=!0),this.receiveShadow===!0&&(a.receiveShadow=!0),this.visible===!1&&(a.visible=!1),this.frustumCulled===!1&&(a.frustumCulled=!1),this.renderOrder!==0&&(a.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(a.instanceColor=this.instanceColor.toJSON()));function o(f,p){return f[p.uuid]===void 0&&(f[p.uuid]=p.toJSON(e)),p.uuid}if(this.isScene)this.background&&(this.background.isColor?a.background=this.background.toJSON():this.background.isTexture&&(a.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(a.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){a.geometry=o(e.geometries,this.geometry);const f=this.geometry.parameters;if(f!==void 0&&f.shapes!==void 0){const p=f.shapes;if(Array.isArray(p))for(let d=0,g=p.length;d<g;d++){const y=p[d];o(e.shapes,y)}else o(e.shapes,p)}}if(this.isSkinnedMesh&&(a.bindMode=this.bindMode,a.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),a.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const f=[];for(let p=0,d=this.material.length;p<d;p++)f.push(o(e.materials,this.material[p]));a.material=f}else a.material=o(e.materials,this.material);if(this.children.length>0){a.children=[];for(let f=0;f<this.children.length;f++)a.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){a.animations=[];for(let f=0;f<this.animations.length;f++){const p=this.animations[f];a.animations.push(o(e.animations,p))}}if(t){const f=h(e.geometries),p=h(e.materials),d=h(e.textures),g=h(e.images),y=h(e.shapes),x=h(e.skeletons),_=h(e.animations);f.length>0&&(i.geometries=f),p.length>0&&(i.materials=p),d.length>0&&(i.textures=d),g.length>0&&(i.images=g),y.length>0&&(i.shapes=y),x.length>0&&(i.skeletons=x),_.length>0&&(i.animations=_)}return i.object=a,i;function h(f){const p=[];for(const d in f){const g=f[d];delete g.metadata,p.push(g)}return p}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const a=e.children[i];this.add(a.clone())}return this}}Et.DefaultUp=new V(0,1,0);Et.DefaultMatrixAutoUpdate=!0;Et.prototype.isObject3D=!0;const ui=new V,Fi=new V,Xc=new V,Oi=new V,Hs=new V,Us=new V,em=new V,Zc=new V,qc=new V,Yc=new V;class Yt{constructor(e=new V,t=new V,i=new V){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,a){a.subVectors(i,t),ui.subVectors(e,t),a.cross(ui);const o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}static getBarycoord(e,t,i,a,o){ui.subVectors(a,t),Fi.subVectors(i,t),Xc.subVectors(e,t);const h=ui.dot(ui),f=ui.dot(Fi),p=ui.dot(Xc),d=Fi.dot(Fi),g=Fi.dot(Xc),y=h*d-f*f;if(y===0)return o.set(-2,-1,-1);const x=1/y,_=(d*p-f*g)*x,T=(h*g-f*p)*x;return o.set(1-_-T,T,_)}static containsPoint(e,t,i,a){return this.getBarycoord(e,t,i,a,Oi),Oi.x>=0&&Oi.y>=0&&Oi.x+Oi.y<=1}static getUV(e,t,i,a,o,h,f,p){return this.getBarycoord(e,t,i,a,Oi),p.set(0,0),p.addScaledVector(o,Oi.x),p.addScaledVector(h,Oi.y),p.addScaledVector(f,Oi.z),p}static isFrontFacing(e,t,i,a){return ui.subVectors(i,t),Fi.subVectors(e,t),ui.cross(Fi).dot(a)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,a){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[a]),this}setFromAttributeAndIndices(e,t,i,a){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,a),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ui.subVectors(this.c,this.b),Fi.subVectors(this.a,this.b),ui.cross(Fi).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Yt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Yt.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,a,o){return Yt.getUV(e,this.a,this.b,this.c,t,i,a,o)}containsPoint(e){return Yt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Yt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,a=this.b,o=this.c;let h,f;Hs.subVectors(a,i),Us.subVectors(o,i),Zc.subVectors(e,i);const p=Hs.dot(Zc),d=Us.dot(Zc);if(p<=0&&d<=0)return t.copy(i);qc.subVectors(e,a);const g=Hs.dot(qc),y=Us.dot(qc);if(g>=0&&y<=g)return t.copy(a);const x=p*y-g*d;if(x<=0&&p>=0&&g<=0)return h=p/(p-g),t.copy(i).addScaledVector(Hs,h);Yc.subVectors(e,o);const _=Hs.dot(Yc),T=Us.dot(Yc);if(T>=0&&_<=T)return t.copy(o);const L=_*d-p*T;if(L<=0&&d>=0&&T<=0)return f=d/(d-T),t.copy(i).addScaledVector(Us,f);const P=g*T-_*y;if(P<=0&&y-g>=0&&_-T>=0)return em.subVectors(o,a),f=(y-g)/(y-g+(_-T)),t.copy(a).addScaledVector(em,f);const M=1/(P+L+x);return h=L*M,f=x*M,t.copy(i).addScaledVector(Hs,h).addScaledVector(Us,f)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let ub=0;class Tn extends nr{constructor(){super();Object.defineProperty(this,"id",{value:ub++}),this.uuid=ai(),this.name="",this.type="Material",this.fog=!0,this.blending=Ga,this.side=Wa,this.vertexColors=!1,this.opacity=1,this.format=In,this.transparent=!1,this.blendSrc=wp,this.blendDst=Mp,this.blendEquation=Ms,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=wc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=z_,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Dc,this.stencilZFail=Dc,this.stencilZPass=Dc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===gp;continue}const a=this[t];if(a===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}a&&a.isColor?a.set(i):a&&a.isVector3&&i&&i.isVector3?a.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ga&&(i.blending=this.blending),this.side!==Wa&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==In&&(i.format=this.format),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function a(o){const h=[];for(const f in o){const p=o[f];delete p.metadata,h.push(p)}return h}if(t){const o=a(e.textures),h=a(e.images);o.length>0&&(i.textures=o),h.length>0&&(i.images=h)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const a=t.length;i=new Array(a);for(let o=0;o!==a;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Tn.prototype.isMaterial=!0;const tm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ci={h:0,s:0,l:0},Pl={h:0,s:0,l:0};function jc(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}function Jc(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Kc(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}class et{constructor(e,t,i){return t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Ic(e,1),t=Mn(t,0,1),i=Mn(i,0,1),t===0)this.r=this.g=this.b=i;else{const a=i<=.5?i*(1+t):i+t-i*t,o=2*i-a;this.r=jc(o,a,e+1/3),this.g=jc(o,a,e),this.b=jc(o,a,e-1/3)}return this}setStyle(e){function t(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let a;const o=i[1],h=i[2];switch(o){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,t(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,t(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h)){const f=parseFloat(a[1])/360,p=parseInt(a[2],10)/100,d=parseInt(a[3],10)/100;return t(a[4]),this.setHSL(f,p,d)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=i[1],o=a.length;if(o===3)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,this;if(o===6)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=tm[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Jc(e.r),this.g=Jc(e.g),this.b=Jc(e.b),this}copyLinearToSRGB(e){return this.r=Kc(e.r),this.g=Kc(e.g),this.b=Kc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,a=this.b,o=Math.max(t,i,a),h=Math.min(t,i,a);let f,p;const d=(h+o)/2;if(h===o)f=0,p=0;else{const g=o-h;switch(p=d<=.5?g/(o+h):g/(2-o-h),o){case t:f=(i-a)/g+(i<a?6:0);break;case i:f=(a-t)/g+2;break;case a:f=(t-i)/g+4;break}f/=6}return e.h=f,e.s=p,e.l=d,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,i){return this.getHSL(ci),ci.h+=e,ci.s+=t,ci.l+=i,this.setHSL(ci.h,ci.s,ci.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ci),e.getHSL(Pl);const i=Ja(ci.h,Pl.h,t),a=Ja(ci.s,Pl.s,t),o=Ja(ci.l,Pl.l,t);return this.setHSL(i,a,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}et.NAMES=tm;et.prototype.isColor=!0;et.prototype.r=1;et.prototype.g=1;et.prototype.b=1;class Qc extends Tn{constructor(e){super();this.type="MeshBasicMaterial",this.color=new et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Qc.prototype.isMeshBasicMaterial=!0;const Pt=new V,Dl=new ye;class rn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=qa,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let a=0,o=this.itemSize;a<o;a++)this.array[e+a]=t.array[i+a];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let a=0,o=e.length;a<o;a++){let h=e[a];h===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",a),h=new et),t[i++]=h.r,t[i++]=h.g,t[i++]=h.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let a=0,o=e.length;a<o;a++){let h=e[a];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",a),h=new ye),t[i++]=h.x,t[i++]=h.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let a=0,o=e.length;a<o;a++){let h=e[a];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",a),h=new V),t[i++]=h.x,t[i++]=h.y,t[i++]=h.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let a=0,o=e.length;a<o;a++){let h=e[a];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",a),h=new Rt),t[i++]=h.x,t[i++]=h.y,t[i++]=h.z,t[i++]=h.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Dl.fromBufferAttribute(this,t),Dl.applyMatrix3(e),this.setXY(t,Dl.x,Dl.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Pt.fromBufferAttribute(this,t),Pt.applyMatrix3(e),this.setXYZ(t,Pt.x,Pt.y,Pt.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Pt.x=this.getX(t),Pt.y=this.getY(t),Pt.z=this.getZ(t),Pt.applyMatrix4(e),this.setXYZ(t,Pt.x,Pt.y,Pt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Pt.x=this.getX(t),Pt.y=this.getY(t),Pt.z=this.getZ(t),Pt.applyNormalMatrix(e),this.setXYZ(t,Pt.x,Pt.y,Pt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Pt.x=this.getX(t),Pt.y=this.getY(t),Pt.z=this.getZ(t),Pt.transformDirection(e),this.setXYZ(t,Pt.x,Pt.y,Pt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=a,this}setXYZW(e,t,i,a,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=a,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==qa&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}rn.prototype.isBufferAttribute=!0;class nm extends rn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class im extends rn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class cb extends rn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}cb.prototype.isFloat16BufferAttribute=!0;class jt extends rn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let hb=0;const Qn=new ot,$c=new Et,Ws=new V,Yn=new oi,eo=new oi,cn=new V;class kt extends nr{constructor(){super();Object.defineProperty(this,"id",{value:hb++}),this.uuid=ai(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Gp(e)>65535?im:nm)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const o=new gn().getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const a=this.attributes.tangent;return a!==void 0&&(a.transformDirection(e),a.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Qn.makeRotationFromQuaternion(e),this.applyMatrix4(Qn),this}rotateX(e){return Qn.makeRotationX(e),this.applyMatrix4(Qn),this}rotateY(e){return Qn.makeRotationY(e),this.applyMatrix4(Qn),this}rotateZ(e){return Qn.makeRotationZ(e),this.applyMatrix4(Qn),this}translate(e,t,i){return Qn.makeTranslation(e,t,i),this.applyMatrix4(Qn),this}scale(e,t,i){return Qn.makeScale(e,t,i),this.applyMatrix4(Qn),this}lookAt(e){return $c.lookAt(e),$c.updateMatrix(),this.applyMatrix4($c.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ws).negate(),this.translate(Ws.x,Ws.y,Ws.z),this}setFromPoints(e){const t=[];for(let i=0,a=e.length;i<a;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new jt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new oi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new V(-1/0,-1/0,-1/0),new V(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,a=t.length;i<a;i++){const o=t[i];Yn.setFromBufferAttribute(o),this.morphTargetsRelative?(cn.addVectors(this.boundingBox.min,Yn.min),this.boundingBox.expandByPoint(cn),cn.addVectors(this.boundingBox.max,Yn.max),this.boundingBox.expandByPoint(cn)):(this.boundingBox.expandByPoint(Yn.min),this.boundingBox.expandByPoint(Yn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ns);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new V,1/0);return}if(e){const i=this.boundingSphere.center;if(Yn.setFromBufferAttribute(e),t)for(let o=0,h=t.length;o<h;o++){const f=t[o];eo.setFromBufferAttribute(f),this.morphTargetsRelative?(cn.addVectors(Yn.min,eo.min),Yn.expandByPoint(cn),cn.addVectors(Yn.max,eo.max),Yn.expandByPoint(cn)):(Yn.expandByPoint(eo.min),Yn.expandByPoint(eo.max))}Yn.getCenter(i);let a=0;for(let o=0,h=e.count;o<h;o++)cn.fromBufferAttribute(e,o),a=Math.max(a,i.distanceToSquared(cn));if(t)for(let o=0,h=t.length;o<h;o++){const f=t[o],p=this.morphTargetsRelative;for(let d=0,g=f.count;d<g;d++)cn.fromBufferAttribute(f,d),p&&(Ws.fromBufferAttribute(e,d),cn.add(Ws)),a=Math.max(a,i.distanceToSquared(cn))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,a=t.position.array,o=t.normal.array,h=t.uv.array,f=a.length/3;t.tangent===void 0&&this.setAttribute("tangent",new rn(new Float32Array(4*f),4));const p=t.tangent.array,d=[],g=[];for(let Q=0;Q<f;Q++)d[Q]=new V,g[Q]=new V;const y=new V,x=new V,_=new V,T=new ye,L=new ye,P=new ye,M=new V,w=new V;function N(Q,X,Se){y.fromArray(a,Q*3),x.fromArray(a,X*3),_.fromArray(a,Se*3),T.fromArray(h,Q*2),L.fromArray(h,X*2),P.fromArray(h,Se*2),x.sub(y),_.sub(y),L.sub(T),P.sub(T);const H=1/(L.x*P.y-P.x*L.y);!isFinite(H)||(M.copy(x).multiplyScalar(P.y).addScaledVector(_,-L.y).multiplyScalar(H),w.copy(_).multiplyScalar(L.x).addScaledVector(x,-P.x).multiplyScalar(H),d[Q].add(M),d[X].add(M),d[Se].add(M),g[Q].add(w),g[X].add(w),g[Se].add(w))}let C=this.groups;C.length===0&&(C=[{start:0,count:i.length}]);for(let Q=0,X=C.length;Q<X;++Q){const Se=C[Q],H=Se.start,W=Se.count;for(let D=H,ee=H+W;D<ee;D+=3)N(i[D+0],i[D+1],i[D+2])}const k=new V,q=new V,R=new V,J=new V;function oe(Q){R.fromArray(o,Q*3),J.copy(R);const X=d[Q];k.copy(X),k.sub(R.multiplyScalar(R.dot(X))).normalize(),q.crossVectors(J,X);const H=q.dot(g[Q])<0?-1:1;p[Q*4]=k.x,p[Q*4+1]=k.y,p[Q*4+2]=k.z,p[Q*4+3]=H}for(let Q=0,X=C.length;Q<X;++Q){const Se=C[Q],H=Se.start,W=Se.count;for(let D=H,ee=H+W;D<ee;D+=3)oe(i[D+0]),oe(i[D+1]),oe(i[D+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new rn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let x=0,_=i.count;x<_;x++)i.setXYZ(x,0,0,0);const a=new V,o=new V,h=new V,f=new V,p=new V,d=new V,g=new V,y=new V;if(e)for(let x=0,_=e.count;x<_;x+=3){const T=e.getX(x+0),L=e.getX(x+1),P=e.getX(x+2);a.fromBufferAttribute(t,T),o.fromBufferAttribute(t,L),h.fromBufferAttribute(t,P),g.subVectors(h,o),y.subVectors(a,o),g.cross(y),f.fromBufferAttribute(i,T),p.fromBufferAttribute(i,L),d.fromBufferAttribute(i,P),f.add(g),p.add(g),d.add(g),i.setXYZ(T,f.x,f.y,f.z),i.setXYZ(L,p.x,p.y,p.z),i.setXYZ(P,d.x,d.y,d.z)}else for(let x=0,_=t.count;x<_;x+=3)a.fromBufferAttribute(t,x+0),o.fromBufferAttribute(t,x+1),h.fromBufferAttribute(t,x+2),g.subVectors(h,o),y.subVectors(a,o),g.cross(y),i.setXYZ(x+0,g.x,g.y,g.z),i.setXYZ(x+1,g.x,g.y,g.z),i.setXYZ(x+2,g.x,g.y,g.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const a in i){if(e.attributes[a]===void 0)continue;const h=i[a].array,f=e.attributes[a],p=f.array,d=f.itemSize*t,g=Math.min(p.length,h.length-d);for(let y=0,x=d;y<g;y++,x++)h[x]=p[y]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)cn.fromBufferAttribute(e,t),cn.normalize(),e.setXYZ(t,cn.x,cn.y,cn.z)}toNonIndexed(){function e(f,p){const d=f.array,g=f.itemSize,y=f.normalized,x=new d.constructor(p.length*g);let _=0,T=0;for(let L=0,P=p.length;L<P;L++){f.isInterleavedBufferAttribute?_=p[L]*f.data.stride+f.offset:_=p[L]*g;for(let M=0;M<g;M++)x[T++]=d[_++]}return new rn(x,g,y)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new kt,i=this.index.array,a=this.attributes;for(const f in a){const p=a[f],d=e(p,i);t.setAttribute(f,d)}const o=this.morphAttributes;for(const f in o){const p=[],d=o[f];for(let g=0,y=d.length;g<y;g++){const x=d[g],_=e(x,i);p.push(_)}t.morphAttributes[f]=p}t.morphTargetsRelative=this.morphTargetsRelative;const h=this.groups;for(let f=0,p=h.length;f<p;f++){const d=h[f];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const p=this.parameters;for(const d in p)p[d]!==void 0&&(e[d]=p[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const p in i){const d=i[p];e.data.attributes[p]=d.toJSON(e.data)}const a={};let o=!1;for(const p in this.morphAttributes){const d=this.morphAttributes[p],g=[];for(let y=0,x=d.length;y<x;y++){const _=d[y];g.push(_.toJSON(e.data))}g.length>0&&(a[p]=g,o=!0)}o&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);const h=this.groups;h.length>0&&(e.data.groups=JSON.parse(JSON.stringify(h)));const f=this.boundingSphere;return f!==null&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const a=e.attributes;for(const d in a){const g=a[d];this.setAttribute(d,g.clone(t))}const o=e.morphAttributes;for(const d in o){const g=[],y=o[d];for(let x=0,_=y.length;x<_;x++)g.push(y[x].clone(t));this.morphAttributes[d]=g}this.morphTargetsRelative=e.morphTargetsRelative;const h=e.groups;for(let d=0,g=h.length;d<g;d++){const y=h[d];this.addGroup(y.start,y.count,y.materialIndex)}const f=e.boundingBox;f!==null&&(this.boundingBox=f.clone());const p=e.boundingSphere;return p!==null&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}kt.prototype.isBufferGeometry=!0;const rm=new ot,Gs=new Fs,eh=new Ns,or=new V,lr=new V,ur=new V,th=new V,nh=new V,ih=new V,Il=new V,kl=new V,Nl=new V,Fl=new ye,Ol=new ye,zl=new ye,rh=new V,Bl=new V;class zn extends Et{constructor(e=new kt,t=new Qc){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const a=t[i[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,h=a.length;o<h;o++){const f=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,a=this.material,o=this.matrixWorld;if(a===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),eh.copy(i.boundingSphere),eh.applyMatrix4(o),e.ray.intersectsSphere(eh)===!1)||(rm.copy(o).invert(),Gs.copy(e.ray).applyMatrix4(rm),i.boundingBox!==null&&Gs.intersectsBox(i.boundingBox)===!1))return;let h;if(i.isBufferGeometry){const f=i.index,p=i.attributes.position,d=i.morphAttributes.position,g=i.morphTargetsRelative,y=i.attributes.uv,x=i.attributes.uv2,_=i.groups,T=i.drawRange;if(f!==null)if(Array.isArray(a))for(let L=0,P=_.length;L<P;L++){const M=_[L],w=a[M.materialIndex],N=Math.max(M.start,T.start),C=Math.min(f.count,Math.min(M.start+M.count,T.start+T.count));for(let k=N,q=C;k<q;k+=3){const R=f.getX(k),J=f.getX(k+1),oe=f.getX(k+2);h=Hl(this,w,e,Gs,p,d,g,y,x,R,J,oe),h&&(h.faceIndex=Math.floor(k/3),h.face.materialIndex=M.materialIndex,t.push(h))}}else{const L=Math.max(0,T.start),P=Math.min(f.count,T.start+T.count);for(let M=L,w=P;M<w;M+=3){const N=f.getX(M),C=f.getX(M+1),k=f.getX(M+2);h=Hl(this,a,e,Gs,p,d,g,y,x,N,C,k),h&&(h.faceIndex=Math.floor(M/3),t.push(h))}}else if(p!==void 0)if(Array.isArray(a))for(let L=0,P=_.length;L<P;L++){const M=_[L],w=a[M.materialIndex],N=Math.max(M.start,T.start),C=Math.min(p.count,Math.min(M.start+M.count,T.start+T.count));for(let k=N,q=C;k<q;k+=3){const R=k,J=k+1,oe=k+2;h=Hl(this,w,e,Gs,p,d,g,y,x,R,J,oe),h&&(h.faceIndex=Math.floor(k/3),h.face.materialIndex=M.materialIndex,t.push(h))}}else{const L=Math.max(0,T.start),P=Math.min(p.count,T.start+T.count);for(let M=L,w=P;M<w;M+=3){const N=M,C=M+1,k=M+2;h=Hl(this,a,e,Gs,p,d,g,y,x,N,C,k),h&&(h.faceIndex=Math.floor(M/3),t.push(h))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}zn.prototype.isMesh=!0;function fb(r,e,t,i,a,o,h,f){let p;if(e.side===nn?p=i.intersectTriangle(h,o,a,!0,f):p=i.intersectTriangle(a,o,h,e.side!==ws,f),p===null)return null;Bl.copy(f),Bl.applyMatrix4(r.matrixWorld);const d=t.ray.origin.distanceTo(Bl);return d<t.near||d>t.far?null:{distance:d,point:Bl.clone(),object:r}}function Hl(r,e,t,i,a,o,h,f,p,d,g,y){or.fromBufferAttribute(a,d),lr.fromBufferAttribute(a,g),ur.fromBufferAttribute(a,y);const x=r.morphTargetInfluences;if(o&&x){Il.set(0,0,0),kl.set(0,0,0),Nl.set(0,0,0);for(let T=0,L=o.length;T<L;T++){const P=x[T],M=o[T];P!==0&&(th.fromBufferAttribute(M,d),nh.fromBufferAttribute(M,g),ih.fromBufferAttribute(M,y),h?(Il.addScaledVector(th,P),kl.addScaledVector(nh,P),Nl.addScaledVector(ih,P)):(Il.addScaledVector(th.sub(or),P),kl.addScaledVector(nh.sub(lr),P),Nl.addScaledVector(ih.sub(ur),P)))}or.add(Il),lr.add(kl),ur.add(Nl)}r.isSkinnedMesh&&(r.boneTransform(d,or),r.boneTransform(g,lr),r.boneTransform(y,ur));const _=fb(r,e,t,i,or,lr,ur,rh);if(_){f&&(Fl.fromBufferAttribute(f,d),Ol.fromBufferAttribute(f,g),zl.fromBufferAttribute(f,y),_.uv=Yt.getUV(rh,or,lr,ur,Fl,Ol,zl,new ye)),p&&(Fl.fromBufferAttribute(p,d),Ol.fromBufferAttribute(p,g),zl.fromBufferAttribute(p,y),_.uv2=Yt.getUV(rh,or,lr,ur,Fl,Ol,zl,new ye));const T={a:d,b:g,c:y,normal:new V,materialIndex:0};Yt.getNormal(or,lr,ur,T.normal),_.face=T}return _}class to extends kt{constructor(e=1,t=1,i=1,a=1,o=1,h=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:a,heightSegments:o,depthSegments:h};const f=this;a=Math.floor(a),o=Math.floor(o),h=Math.floor(h);const p=[],d=[],g=[],y=[];let x=0,_=0;T("z","y","x",-1,-1,i,t,e,h,o,0),T("z","y","x",1,-1,i,t,-e,h,o,1),T("x","z","y",1,1,e,i,t,a,h,2),T("x","z","y",1,-1,e,i,-t,a,h,3),T("x","y","z",1,-1,e,t,i,a,o,4),T("x","y","z",-1,-1,e,t,-i,a,o,5),this.setIndex(p),this.setAttribute("position",new jt(d,3)),this.setAttribute("normal",new jt(g,3)),this.setAttribute("uv",new jt(y,2));function T(L,P,M,w,N,C,k,q,R,J,oe){const Q=C/R,X=k/J,Se=C/2,H=k/2,W=q/2,D=R+1,ee=J+1;let te=0,Me=0;const Oe=new V;for(let ce=0;ce<ee;ce++){const ue=ce*X-H;for(let We=0;We<D;We++){const Pe=We*Q-Se;Oe[L]=Pe*w,Oe[P]=ue*N,Oe[M]=W,d.push(Oe.x,Oe.y,Oe.z),Oe[L]=0,Oe[P]=0,Oe[M]=q>0?1:-1,g.push(Oe.x,Oe.y,Oe.z),y.push(We/R),y.push(1-ce/J),te+=1}}for(let ce=0;ce<J;ce++)for(let ue=0;ue<R;ue++){const We=x+ue+D*ce,Pe=x+ue+D*(ce+1),ze=x+(ue+1)+D*(ce+1),$e=x+(ue+1)+D*ce;p.push(We,Pe,$e),p.push(Pe,ze,$e),Me+=6}f.addGroup(_,Me,oe),_+=Me,x+=te}}static fromJSON(e){return new to(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Vs(r){const e={};for(const t in r){e[t]={};for(const i in r[t]){const a=r[t][i];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?e[t][i]=a.clone():Array.isArray(a)?e[t][i]=a.slice():e[t][i]=a}}return e}function En(r){const e={};for(let t=0;t<r.length;t++){const i=Vs(r[t]);for(const a in i)e[a]=i[a]}return e}const db={clone:Vs,merge:En};var pb=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,mb=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Hr extends Tn{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=pb,this.fragmentShader=mb,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Vs(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const a in this.uniforms){const h=this.uniforms[a].value;h&&h.isTexture?t.uniforms[a]={type:"t",value:h.toJSON(e).uuid}:h&&h.isColor?t.uniforms[a]={type:"c",value:h.getHex()}:h&&h.isVector2?t.uniforms[a]={type:"v2",value:h.toArray()}:h&&h.isVector3?t.uniforms[a]={type:"v3",value:h.toArray()}:h&&h.isVector4?t.uniforms[a]={type:"v4",value:h.toArray()}:h&&h.isMatrix3?t.uniforms[a]={type:"m3",value:h.toArray()}:h&&h.isMatrix4?t.uniforms[a]={type:"m4",value:h.toArray()}:t.uniforms[a]={value:h}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const a in this.extensions)this.extensions[a]===!0&&(i[a]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}Hr.prototype.isShaderMaterial=!0;class sh extends Et{constructor(){super();this.type="Camera",this.matrixWorldInverse=new ot,this.projectionMatrix=new ot,this.projectionMatrixInverse=new ot}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}sh.prototype.isCamera=!0;class Bn extends sh{constructor(e=50,t=1,i=.1,a=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=a,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ja*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ya*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ja*2*Math.atan(Math.tan(Ya*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,a,o,h){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=a,this.view.width=o,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ya*.5*this.fov)/this.zoom,i=2*t,a=this.aspect*i,o=-.5*a;const h=this.view;if(this.view!==null&&this.view.enabled){const p=h.fullWidth,d=h.fullHeight;o+=h.offsetX*a/p,t-=h.offsetY*i/d,a*=h.width/p,i*=h.height/d}const f=this.filmOffset;f!==0&&(o+=e*f/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+a,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Bn.prototype.isPerspectiveCamera=!0;const Xs=90,Zs=1;class ah extends Et{constructor(e,t,i){super();if(this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const a=new Bn(Xs,Zs,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new V(1,0,0)),this.add(a);const o=new Bn(Xs,Zs,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new V(-1,0,0)),this.add(o);const h=new Bn(Xs,Zs,e,t);h.layers=this.layers,h.up.set(0,0,1),h.lookAt(new V(0,1,0)),this.add(h);const f=new Bn(Xs,Zs,e,t);f.layers=this.layers,f.up.set(0,0,-1),f.lookAt(new V(0,-1,0)),this.add(f);const p=new Bn(Xs,Zs,e,t);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new V(0,0,1)),this.add(p);const d=new Bn(Xs,Zs,e,t);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new V(0,0,-1)),this.add(d)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[a,o,h,f,p,d]=this.children,g=e.xr.enabled,y=e.getRenderTarget();e.xr.enabled=!1;const x=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,a),e.setRenderTarget(i,1),e.render(t,o),e.setRenderTarget(i,2),e.render(t,h),e.setRenderTarget(i,3),e.render(t,f),e.setRenderTarget(i,4),e.render(t,p),i.texture.generateMipmaps=x,e.setRenderTarget(i,5),e.render(t,d),e.setRenderTarget(y),e.xr.enabled=g}}class Ul extends vn{constructor(e,t,i,a,o,h,f,p,d,g){e=e!==void 0?e:[],t=t!==void 0?t:Va;super(e,t,i,a,o,h,f,p,d,g);this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ul.prototype.isCubeTexture=!0;class sm extends Kn{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i);super(e,e,t);t=t||{},this.texture=new Ul(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Jn,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=In,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},a=new to(5,5,5),o=new Hr({name:"CubemapFromEquirect",uniforms:Vs(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:nn,blending:$i});o.uniforms.tEquirect.value=t;const h=new zn(a,o),f=t.minFilter;return t.minFilter===gl&&(t.minFilter=Jn),new ah(1,10,this).update(e,h),t.minFilter=f,h.geometry.dispose(),h.material.dispose(),this}clear(e,t,i,a){const o=e.getRenderTarget();for(let h=0;h<6;h++)e.setRenderTarget(this,h),e.clear(t,i,a);e.setRenderTarget(o)}}sm.prototype.isWebGLCubeRenderTarget=!0;const oh=new V,gb=new V,vb=new gn;class zi{constructor(e=new V(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,a){return this.normal.set(e,t,i),this.constant=a,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const a=oh.subVectors(i,t).cross(gb.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(oh),a=this.normal.dot(i);if(a===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/a;return o<0||o>1?null:t.copy(i).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||vb.getNormalMatrix(e),a=this.coplanarPoint(oh).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-a.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}zi.prototype.isPlane=!0;const qs=new Ns,Wl=new V;class Gl{constructor(e=new zi,t=new zi,i=new zi,a=new zi,o=new zi,h=new zi){this.planes=[e,t,i,a,o,h]}set(e,t,i,a,o,h){const f=this.planes;return f[0].copy(e),f[1].copy(t),f[2].copy(i),f[3].copy(a),f[4].copy(o),f[5].copy(h),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,a=i[0],o=i[1],h=i[2],f=i[3],p=i[4],d=i[5],g=i[6],y=i[7],x=i[8],_=i[9],T=i[10],L=i[11],P=i[12],M=i[13],w=i[14],N=i[15];return t[0].setComponents(f-a,y-p,L-x,N-P).normalize(),t[1].setComponents(f+a,y+p,L+x,N+P).normalize(),t[2].setComponents(f+o,y+d,L+_,N+M).normalize(),t[3].setComponents(f-o,y-d,L-_,N-M).normalize(),t[4].setComponents(f-h,y-g,L-T,N-w).normalize(),t[5].setComponents(f+h,y+g,L+T,N+w).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),qs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(qs)}intersectsSprite(e){return qs.center.set(0,0,0),qs.radius=.7071067811865476,qs.applyMatrix4(e.matrixWorld),this.intersectsSphere(qs)}intersectsSphere(e){const t=this.planes,i=e.center,a=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<a)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const a=t[i];if(Wl.x=a.normal.x>0?e.max.x:e.min.x,Wl.y=a.normal.y>0?e.max.y:e.min.y,Wl.z=a.normal.z>0?e.max.z:e.min.z,a.distanceToPoint(Wl)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function am(){let r=null,e=!1,t=null,i=null;function a(o,h){t(o,h),i=r.requestAnimationFrame(a)}return{start:function(){e!==!0&&t!==null&&(i=r.requestAnimationFrame(a),e=!0)},stop:function(){r.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){r=o}}}function xb(r,e){const t=e.isWebGL2,i=new WeakMap;function a(d,g){const y=d.array,x=d.usage,_=r.createBuffer();r.bindBuffer(g,_),r.bufferData(g,y,x),d.onUploadCallback();let T=5126;return y instanceof Float32Array?T=5126:y instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):y instanceof Uint16Array?d.isFloat16BufferAttribute?t?T=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):T=5123:y instanceof Int16Array?T=5122:y instanceof Uint32Array?T=5125:y instanceof Int32Array?T=5124:y instanceof Int8Array?T=5120:(y instanceof Uint8Array||y instanceof Uint8ClampedArray)&&(T=5121),{buffer:_,type:T,bytesPerElement:y.BYTES_PER_ELEMENT,version:d.version}}function o(d,g,y){const x=g.array,_=g.updateRange;r.bindBuffer(y,d),_.count===-1?r.bufferSubData(y,0,x):(t?r.bufferSubData(y,_.offset*x.BYTES_PER_ELEMENT,x,_.offset,_.count):r.bufferSubData(y,_.offset*x.BYTES_PER_ELEMENT,x.subarray(_.offset,_.offset+_.count)),_.count=-1)}function h(d){return d.isInterleavedBufferAttribute&&(d=d.data),i.get(d)}function f(d){d.isInterleavedBufferAttribute&&(d=d.data);const g=i.get(d);g&&(r.deleteBuffer(g.buffer),i.delete(d))}function p(d,g){if(d.isGLBufferAttribute){const x=i.get(d);(!x||x.version<d.version)&&i.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version});return}d.isInterleavedBufferAttribute&&(d=d.data);const y=i.get(d);y===void 0?i.set(d,a(d,g)):y.version<d.version&&(o(y.buffer,d,g),y.version=d.version)}return{get:h,remove:f,update:p}}class lh extends kt{constructor(e=1,t=1,i=1,a=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:a};const o=e/2,h=t/2,f=Math.floor(i),p=Math.floor(a),d=f+1,g=p+1,y=e/f,x=t/p,_=[],T=[],L=[],P=[];for(let M=0;M<g;M++){const w=M*x-h;for(let N=0;N<d;N++){const C=N*y-o;T.push(C,-w,0),L.push(0,0,1),P.push(N/f),P.push(1-M/p)}}for(let M=0;M<p;M++)for(let w=0;w<f;w++){const N=w+d*M,C=w+d*(M+1),k=w+1+d*(M+1),q=w+1+d*M;_.push(N,C,q),_.push(C,k,q)}this.setIndex(_),this.setAttribute("position",new jt(T,3)),this.setAttribute("normal",new jt(L,3)),this.setAttribute("uv",new jt(P,2))}static fromJSON(e){return new lh(e.width,e.height,e.widthSegments,e.heightSegments)}}var yb=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,_b=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bb=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,wb=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Mb=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Sb=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Tb="vec3 transformed = vec3( position );",Eb=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Ab=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Lb=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Cb=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Rb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Pb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Db=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Ib=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,kb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Nb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Fb=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Ob=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,zb=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Bb=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Hb=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Ub=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Wb=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Gb=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Vb="gl_FragColor = linearToOutputTexel( gl_FragColor );",Xb=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}`,Zb=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,qb=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Yb=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,jb=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Jb=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Kb=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Qb=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,$b=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,ew=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,tw=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,nw=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,iw=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,rw=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,sw=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,aw=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,ow=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lw=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,uw=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,cw=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,hw=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,fw=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,dw=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,pw=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,mw=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,gw=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,vw=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xw=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,yw=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,_w=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,bw=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,ww=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Mw=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Sw=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Tw=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Ew=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Aw=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Lw=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Cw=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Rw=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Pw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Dw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Iw=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,kw=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Nw=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Fw=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Ow=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,zw=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Bw=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Hw=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Uw=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Ww=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Gw=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Vw=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Xw=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Zw=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,qw=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Yw=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,jw=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Jw=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Kw=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,Qw=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,$w=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,eM=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,tM=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,nM=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,iM=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,rM=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,sM=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,aM=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,oM=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,lM=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,cM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,hM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,fM=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const dM=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,pM=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,mM=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,gM=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vM=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,xM=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,yM=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,_M=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,bM=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,wM=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,MM=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,SM=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,TM=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,EM=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AM=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LM=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CM=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,RM=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PM=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,DM=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,IM=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kM=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NM=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,FM=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OM=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zM=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BM=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,HM=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UM=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,WM=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,GM=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,VM=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,vt={alphamap_fragment:yb,alphamap_pars_fragment:_b,alphatest_fragment:bb,alphatest_pars_fragment:wb,aomap_fragment:Mb,aomap_pars_fragment:Sb,begin_vertex:Tb,beginnormal_vertex:Eb,bsdfs:Ab,bumpmap_pars_fragment:Lb,clipping_planes_fragment:Cb,clipping_planes_pars_fragment:Rb,clipping_planes_pars_vertex:Pb,clipping_planes_vertex:Db,color_fragment:Ib,color_pars_fragment:kb,color_pars_vertex:Nb,color_vertex:Fb,common:Ob,cube_uv_reflection_fragment:zb,defaultnormal_vertex:Bb,displacementmap_pars_vertex:Hb,displacementmap_vertex:Ub,emissivemap_fragment:Wb,emissivemap_pars_fragment:Gb,encodings_fragment:Vb,encodings_pars_fragment:Xb,envmap_fragment:Zb,envmap_common_pars_fragment:qb,envmap_pars_fragment:Yb,envmap_pars_vertex:jb,envmap_physical_pars_fragment:aw,envmap_vertex:Jb,fog_vertex:Kb,fog_pars_vertex:Qb,fog_fragment:$b,fog_pars_fragment:ew,gradientmap_pars_fragment:tw,lightmap_fragment:nw,lightmap_pars_fragment:iw,lights_lambert_vertex:rw,lights_pars_begin:sw,lights_toon_fragment:ow,lights_toon_pars_fragment:lw,lights_phong_fragment:uw,lights_phong_pars_fragment:cw,lights_physical_fragment:hw,lights_physical_pars_fragment:fw,lights_fragment_begin:dw,lights_fragment_maps:pw,lights_fragment_end:mw,logdepthbuf_fragment:gw,logdepthbuf_pars_fragment:vw,logdepthbuf_pars_vertex:xw,logdepthbuf_vertex:yw,map_fragment:_w,map_pars_fragment:bw,map_particle_fragment:ww,map_particle_pars_fragment:Mw,metalnessmap_fragment:Sw,metalnessmap_pars_fragment:Tw,morphnormal_vertex:Ew,morphtarget_pars_vertex:Aw,morphtarget_vertex:Lw,normal_fragment_begin:Cw,normal_fragment_maps:Rw,normal_pars_fragment:Pw,normal_pars_vertex:Dw,normal_vertex:Iw,normalmap_pars_fragment:kw,clearcoat_normal_fragment_begin:Nw,clearcoat_normal_fragment_maps:Fw,clearcoat_pars_fragment:Ow,output_fragment:zw,packing:Bw,premultiplied_alpha_fragment:Hw,project_vertex:Uw,dithering_fragment:Ww,dithering_pars_fragment:Gw,roughnessmap_fragment:Vw,roughnessmap_pars_fragment:Xw,shadowmap_pars_fragment:Zw,shadowmap_pars_vertex:qw,shadowmap_vertex:Yw,shadowmask_pars_fragment:jw,skinbase_vertex:Jw,skinning_pars_vertex:Kw,skinning_vertex:Qw,skinnormal_vertex:$w,specularmap_fragment:eM,specularmap_pars_fragment:tM,tonemapping_fragment:nM,tonemapping_pars_fragment:iM,transmission_fragment:rM,transmission_pars_fragment:sM,uv_pars_fragment:aM,uv_pars_vertex:oM,uv_vertex:lM,uv2_pars_fragment:uM,uv2_pars_vertex:cM,uv2_vertex:hM,worldpos_vertex:fM,background_vert:dM,background_frag:pM,cube_vert:mM,cube_frag:gM,depth_vert:vM,depth_frag:xM,distanceRGBA_vert:yM,distanceRGBA_frag:_M,equirect_vert:bM,equirect_frag:wM,linedashed_vert:MM,linedashed_frag:SM,meshbasic_vert:TM,meshbasic_frag:EM,meshlambert_vert:AM,meshlambert_frag:LM,meshmatcap_vert:CM,meshmatcap_frag:RM,meshnormal_vert:PM,meshnormal_frag:DM,meshphong_vert:IM,meshphong_frag:kM,meshphysical_vert:NM,meshphysical_frag:FM,meshtoon_vert:OM,meshtoon_frag:zM,points_vert:BM,points_frag:HM,shadow_vert:UM,shadow_frag:WM,sprite_vert:GM,sprite_frag:VM},He={common:{diffuse:{value:new et(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new gn},uv2Transform:{value:new gn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ye(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new et(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new et(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gn}},sprite:{diffuse:{value:new et(16777215)},opacity:{value:1},center:{value:new ye(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gn}}},vi={basic:{uniforms:En([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.fog]),vertexShader:vt.meshbasic_vert,fragmentShader:vt.meshbasic_frag},lambert:{uniforms:En([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.fog,He.lights,{emissive:{value:new et(0)}}]),vertexShader:vt.meshlambert_vert,fragmentShader:vt.meshlambert_frag},phong:{uniforms:En([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new et(0)},specular:{value:new et(1118481)},shininess:{value:30}}]),vertexShader:vt.meshphong_vert,fragmentShader:vt.meshphong_frag},standard:{uniforms:En([He.common,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.roughnessmap,He.metalnessmap,He.fog,He.lights,{emissive:{value:new et(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:vt.meshphysical_vert,fragmentShader:vt.meshphysical_frag},toon:{uniforms:En([He.common,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.gradientmap,He.fog,He.lights,{emissive:{value:new et(0)}}]),vertexShader:vt.meshtoon_vert,fragmentShader:vt.meshtoon_frag},matcap:{uniforms:En([He.common,He.bumpmap,He.normalmap,He.displacementmap,He.fog,{matcap:{value:null}}]),vertexShader:vt.meshmatcap_vert,fragmentShader:vt.meshmatcap_frag},points:{uniforms:En([He.points,He.fog]),vertexShader:vt.points_vert,fragmentShader:vt.points_frag},dashed:{uniforms:En([He.common,He.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vt.linedashed_vert,fragmentShader:vt.linedashed_frag},depth:{uniforms:En([He.common,He.displacementmap]),vertexShader:vt.depth_vert,fragmentShader:vt.depth_frag},normal:{uniforms:En([He.common,He.bumpmap,He.normalmap,He.displacementmap,{opacity:{value:1}}]),vertexShader:vt.meshnormal_vert,fragmentShader:vt.meshnormal_frag},sprite:{uniforms:En([He.sprite,He.fog]),vertexShader:vt.sprite_vert,fragmentShader:vt.sprite_frag},background:{uniforms:{uvTransform:{value:new gn},t2D:{value:null}},vertexShader:vt.background_vert,fragmentShader:vt.background_frag},cube:{uniforms:En([He.envmap,{opacity:{value:1}}]),vertexShader:vt.cube_vert,fragmentShader:vt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vt.equirect_vert,fragmentShader:vt.equirect_frag},distanceRGBA:{uniforms:En([He.common,He.displacementmap,{referencePosition:{value:new V},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vt.distanceRGBA_vert,fragmentShader:vt.distanceRGBA_frag},shadow:{uniforms:En([He.lights,He.fog,{color:{value:new et(0)},opacity:{value:1}}]),vertexShader:vt.shadow_vert,fragmentShader:vt.shadow_frag}};vi.physical={uniforms:En([vi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ye(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new et(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ye},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new et(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new et(1,1,1)},specularColorMap:{value:null}}]),vertexShader:vt.meshphysical_vert,fragmentShader:vt.meshphysical_frag};function XM(r,e,t,i,a){const o=new et(0);let h=0,f,p,d=null,g=0,y=null;function x(T,L){let P=!1,M=L.isScene===!0?L.background:null;M&&M.isTexture&&(M=e.get(M));const w=r.xr,N=w.getSession&&w.getSession();N&&N.environmentBlendMode==="additive"&&(M=null),M===null?_(o,h):M&&M.isColor&&(_(M,1),P=!0),(r.autoClear||P)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),M&&(M.isCubeTexture||M.mapping===ml)?(p===void 0&&(p=new zn(new to(1,1,1),new Hr({name:"BackgroundCubeMaterial",uniforms:Vs(vi.cube.uniforms),vertexShader:vi.cube.vertexShader,fragmentShader:vi.cube.fragmentShader,side:nn,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(C,k,q){this.matrixWorld.copyPosition(q.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(p)),p.material.uniforms.envMap.value=M,p.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,(d!==M||g!==M.version||y!==r.toneMapping)&&(p.material.needsUpdate=!0,d=M,g=M.version,y=r.toneMapping),T.unshift(p,p.geometry,p.material,0,0,null)):M&&M.isTexture&&(f===void 0&&(f=new zn(new lh(2,2),new Hr({name:"BackgroundMaterial",uniforms:Vs(vi.background.uniforms),vertexShader:vi.background.vertexShader,fragmentShader:vi.background.fragmentShader,side:Wa,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(f)),f.material.uniforms.t2D.value=M,M.matrixAutoUpdate===!0&&M.updateMatrix(),f.material.uniforms.uvTransform.value.copy(M.matrix),(d!==M||g!==M.version||y!==r.toneMapping)&&(f.material.needsUpdate=!0,d=M,g=M.version,y=r.toneMapping),T.unshift(f,f.geometry,f.material,0,0,null))}function _(T,L){t.buffers.color.setClear(T.r,T.g,T.b,L,a)}return{getClearColor:function(){return o},setClearColor:function(T,L=1){o.set(T),h=L,_(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(T){h=T,_(o,h)},render:x}}function ZM(r,e,t,i){const a=r.getParameter(34921),o=i.isWebGL2?null:e.get("OES_vertex_array_object"),h=i.isWebGL2||o!==null,f={},p=L(null);let d=p;function g(H,W,D,ee,te){let Me=!1;if(h){const Oe=T(ee,D,W);d!==Oe&&(d=Oe,x(d.object)),Me=P(ee,te),Me&&M(ee,te)}else{const Oe=W.wireframe===!0;(d.geometry!==ee.id||d.program!==D.id||d.wireframe!==Oe)&&(d.geometry=ee.id,d.program=D.id,d.wireframe=Oe,Me=!0)}H.isInstancedMesh===!0&&(Me=!0),te!==null&&t.update(te,34963),Me&&(R(H,W,D,ee),te!==null&&r.bindBuffer(34963,t.get(te).buffer))}function y(){return i.isWebGL2?r.createVertexArray():o.createVertexArrayOES()}function x(H){return i.isWebGL2?r.bindVertexArray(H):o.bindVertexArrayOES(H)}function _(H){return i.isWebGL2?r.deleteVertexArray(H):o.deleteVertexArrayOES(H)}function T(H,W,D){const ee=D.wireframe===!0;let te=f[H.id];te===void 0&&(te={},f[H.id]=te);let Me=te[W.id];Me===void 0&&(Me={},te[W.id]=Me);let Oe=Me[ee];return Oe===void 0&&(Oe=L(y()),Me[ee]=Oe),Oe}function L(H){const W=[],D=[],ee=[];for(let te=0;te<a;te++)W[te]=0,D[te]=0,ee[te]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:W,enabledAttributes:D,attributeDivisors:ee,object:H,attributes:{},index:null}}function P(H,W){const D=d.attributes,ee=H.attributes;let te=0;for(const Me in ee){const Oe=D[Me],ce=ee[Me];if(Oe===void 0||Oe.attribute!==ce||Oe.data!==ce.data)return!0;te++}return d.attributesNum!==te||d.index!==W}function M(H,W){const D={},ee=H.attributes;let te=0;for(const Me in ee){const Oe=ee[Me],ce={};ce.attribute=Oe,Oe.data&&(ce.data=Oe.data),D[Me]=ce,te++}d.attributes=D,d.attributesNum=te,d.index=W}function w(){const H=d.newAttributes;for(let W=0,D=H.length;W<D;W++)H[W]=0}function N(H){C(H,0)}function C(H,W){const D=d.newAttributes,ee=d.enabledAttributes,te=d.attributeDivisors;D[H]=1,ee[H]===0&&(r.enableVertexAttribArray(H),ee[H]=1),te[H]!==W&&((i.isWebGL2?r:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](H,W),te[H]=W)}function k(){const H=d.newAttributes,W=d.enabledAttributes;for(let D=0,ee=W.length;D<ee;D++)W[D]!==H[D]&&(r.disableVertexAttribArray(D),W[D]=0)}function q(H,W,D,ee,te,Me){i.isWebGL2===!0&&(D===5124||D===5125)?r.vertexAttribIPointer(H,W,D,te,Me):r.vertexAttribPointer(H,W,D,ee,te,Me)}function R(H,W,D,ee){if(i.isWebGL2===!1&&(H.isInstancedMesh||ee.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;w();const te=ee.attributes,Me=D.getAttributes(),Oe=W.defaultAttributeValues;for(const ce in Me){const ue=Me[ce];if(ue.location>=0){let We=te[ce];if(We===void 0&&(ce==="instanceMatrix"&&H.instanceMatrix&&(We=H.instanceMatrix),ce==="instanceColor"&&H.instanceColor&&(We=H.instanceColor)),We!==void 0){const Pe=We.normalized,ze=We.itemSize,$e=t.get(We);if($e===void 0)continue;const K=$e.buffer,Ae=$e.type,Re=$e.bytesPerElement;if(We.isInterleavedBufferAttribute){const Ee=We.data,Je=Ee.stride,Ze=We.offset;if(Ee&&Ee.isInstancedInterleavedBuffer){for(let se=0;se<ue.locationSize;se++)C(ue.location+se,Ee.meshPerAttribute);H.isInstancedMesh!==!0&&ee._maxInstanceCount===void 0&&(ee._maxInstanceCount=Ee.meshPerAttribute*Ee.count)}else for(let se=0;se<ue.locationSize;se++)N(ue.location+se);r.bindBuffer(34962,K);for(let se=0;se<ue.locationSize;se++)q(ue.location+se,ze/ue.locationSize,Ae,Pe,Je*Re,(Ze+ze/ue.locationSize*se)*Re)}else{if(We.isInstancedBufferAttribute){for(let Ee=0;Ee<ue.locationSize;Ee++)C(ue.location+Ee,We.meshPerAttribute);H.isInstancedMesh!==!0&&ee._maxInstanceCount===void 0&&(ee._maxInstanceCount=We.meshPerAttribute*We.count)}else for(let Ee=0;Ee<ue.locationSize;Ee++)N(ue.location+Ee);r.bindBuffer(34962,K);for(let Ee=0;Ee<ue.locationSize;Ee++)q(ue.location+Ee,ze/ue.locationSize,Ae,Pe,ze*Re,ze/ue.locationSize*Ee*Re)}}else if(Oe!==void 0){const Pe=Oe[ce];if(Pe!==void 0)switch(Pe.length){case 2:r.vertexAttrib2fv(ue.location,Pe);break;case 3:r.vertexAttrib3fv(ue.location,Pe);break;case 4:r.vertexAttrib4fv(ue.location,Pe);break;default:r.vertexAttrib1fv(ue.location,Pe)}}}}k()}function J(){X();for(const H in f){const W=f[H];for(const D in W){const ee=W[D];for(const te in ee)_(ee[te].object),delete ee[te];delete W[D]}delete f[H]}}function oe(H){if(f[H.id]===void 0)return;const W=f[H.id];for(const D in W){const ee=W[D];for(const te in ee)_(ee[te].object),delete ee[te];delete W[D]}delete f[H.id]}function Q(H){for(const W in f){const D=f[W];if(D[H.id]===void 0)continue;const ee=D[H.id];for(const te in ee)_(ee[te].object),delete ee[te];delete D[H.id]}}function X(){Se(),d!==p&&(d=p,x(d.object))}function Se(){p.geometry=null,p.program=null,p.wireframe=!1}return{setup:g,reset:X,resetDefaultState:Se,dispose:J,releaseStatesOfGeometry:oe,releaseStatesOfProgram:Q,initAttributes:w,enableAttribute:N,disableUnusedAttributes:k}}function qM(r,e,t,i){const a=i.isWebGL2;let o;function h(d){o=d}function f(d,g){r.drawArrays(o,d,g),t.update(g,o,1)}function p(d,g,y){if(y===0)return;let x,_;if(a)x=r,_="drawArraysInstanced";else if(x=e.get("ANGLE_instanced_arrays"),_="drawArraysInstancedANGLE",x===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}x[_](o,d,g,y),t.update(g,o,y)}this.setMode=h,this.render=f,this.renderInstances=p}function YM(r,e,t){let i;function a(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");i=r.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(R){if(R==="highp"){if(r.getShaderPrecisionFormat(35633,36338).precision>0&&r.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";R="mediump"}return R==="mediump"&&r.getShaderPrecisionFormat(35633,36337).precision>0&&r.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const h=typeof WebGL2RenderingContext!="undefined"&&r instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&r instanceof WebGL2ComputeRenderingContext;let f=t.precision!==void 0?t.precision:"highp";const p=o(f);p!==f&&(console.warn("THREE.WebGLRenderer:",f,"not supported, using",p,"instead."),f=p);const d=h||e.has("WEBGL_draw_buffers"),g=t.logarithmicDepthBuffer===!0,y=r.getParameter(34930),x=r.getParameter(35660),_=r.getParameter(3379),T=r.getParameter(34076),L=r.getParameter(34921),P=r.getParameter(36347),M=r.getParameter(36348),w=r.getParameter(36349),N=x>0,C=h||e.has("OES_texture_float"),k=N&&C,q=h?r.getParameter(36183):0;return{isWebGL2:h,drawBuffers:d,getMaxAnisotropy:a,getMaxPrecision:o,precision:f,logarithmicDepthBuffer:g,maxTextures:y,maxVertexTextures:x,maxTextureSize:_,maxCubemapSize:T,maxAttributes:L,maxVertexUniforms:P,maxVaryings:M,maxFragmentUniforms:w,vertexTextures:N,floatFragmentTextures:C,floatVertexTextures:k,maxSamples:q}}function jM(r){const e=this;let t=null,i=0,a=!1,o=!1;const h=new zi,f=new gn,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(y,x,_){const T=y.length!==0||x||i!==0||a;return a=x,t=g(y,_,0),i=y.length,T},this.beginShadows=function(){o=!0,g(null)},this.endShadows=function(){o=!1,d()},this.setState=function(y,x,_){const T=y.clippingPlanes,L=y.clipIntersection,P=y.clipShadows,M=r.get(y);if(!a||T===null||T.length===0||o&&!P)o?g(null):d();else{const w=o?0:i,N=w*4;let C=M.clippingState||null;p.value=C,C=g(T,x,N,_);for(let k=0;k!==N;++k)C[k]=t[k];M.clippingState=C,this.numIntersection=L?this.numPlanes:0,this.numPlanes+=w}};function d(){p.value!==t&&(p.value=t,p.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function g(y,x,_,T){const L=y!==null?y.length:0;let P=null;if(L!==0){if(P=p.value,T!==!0||P===null){const M=_+L*4,w=x.matrixWorldInverse;f.getNormalMatrix(w),(P===null||P.length<M)&&(P=new Float32Array(M));for(let N=0,C=_;N!==L;++N,C+=4)h.copy(y[N]).applyMatrix4(w,f),h.normal.toArray(P,C),P[C+3]=h.constant}p.value=P,p.needsUpdate=!0}return e.numPlanes=L,e.numIntersection=0,P}}function JM(r){let e=new WeakMap;function t(h,f){return f===Mc?h.mapping=Va:f===Sc&&(h.mapping=Xa),h}function i(h){if(h&&h.isTexture&&h.isRenderTargetTexture===!1){const f=h.mapping;if(f===Mc||f===Sc)if(e.has(h)){const p=e.get(h).texture;return t(p,h.mapping)}else{const p=h.image;if(p&&p.height>0){const d=r.getRenderTarget(),g=new sm(p.height/2);return g.fromEquirectangularTexture(r,h),e.set(h,g),r.setRenderTarget(d),h.addEventListener("dispose",a),t(g.texture,h.mapping)}else return null}}return h}function a(h){const f=h.target;f.removeEventListener("dispose",a);const p=e.get(f);p!==void 0&&(e.delete(f),p.dispose())}function o(){e=new WeakMap}return{get:i,dispose:o}}class uh extends sh{constructor(e=-1,t=1,i=1,a=-1,o=.1,h=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=a,this.near=o,this.far=h,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,a,o,h){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=a,this.view.width=o,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,a=(this.top+this.bottom)/2;let o=i-e,h=i+e,f=a+t,p=a-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=d*this.view.offsetX,h=o+d*this.view.width,f-=g*this.view.offsetY,p=f-g*this.view.height}this.projectionMatrix.makeOrthographic(o,h,f,p,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}uh.prototype.isOrthographicCamera=!0;class Vl extends Hr{constructor(e){super(e);this.type="RawShaderMaterial"}}Vl.prototype.isRawShaderMaterial=!0;const Ys=4,cr=8,xi=Math.pow(2,cr),om=[.125,.215,.35,.446,.526,.582],lm=cr-Ys+1+om.length,js=20,Ur={[On]:0,[bl]:1,[Pc]:2,[zp]:3,[Bp]:4,[Hp]:5,[Rc]:6},ch=new uh,{_lodPlanes:no,_sizeLods:um,_sigmas:Xl}=$M(),cm=new et;let hh=null;const Wr=(1+Math.sqrt(5))/2,Js=1/Wr,hm=[new V(1,1,1),new V(-1,1,1),new V(1,1,-1),new V(-1,1,-1),new V(0,Wr,Js),new V(0,Wr,-Js),new V(Js,0,Wr),new V(-Js,0,Wr),new V(Wr,Js,0),new V(-Wr,Js,0)];class KM{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=eS(js),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,a=100){hh=this._renderer.getRenderTarget();const o=this._allocateTargets();return this._sceneToCubeUV(e,i,a,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=pm(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=dm(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<no.length;e++)no[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(hh),e.scissorTest=!1,Zl(e,0,0,e.width,e.height)}_fromTexture(e){hh=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:un,minFilter:un,generateMipmaps:!1,type:er,format:Yy,encoding:QM(e)?e.encoding:Pc,depthBuffer:!1},i=fm(t);return i.depthBuffer=!e,this._pingPongRenderTarget=fm(t),i}_compileMaterial(e){const t=new zn(no[0],e);this._renderer.compile(t,ch)}_sceneToCubeUV(e,t,i,a){const o=90,h=1,f=new Bn(o,h,t,i),p=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],g=this._renderer,y=g.autoClear,x=g.outputEncoding,_=g.toneMapping;g.getClearColor(cm),g.toneMapping=Nr,g.outputEncoding=On,g.autoClear=!1;const T=new Qc({name:"PMREM.Background",side:nn,depthWrite:!1,depthTest:!1}),L=new zn(new to,T);let P=!1;const M=e.background;M?M.isColor&&(T.color.copy(M),e.background=null,P=!0):(T.color.copy(cm),P=!0);for(let w=0;w<6;w++){const N=w%3;N==0?(f.up.set(0,p[w],0),f.lookAt(d[w],0,0)):N==1?(f.up.set(0,0,p[w]),f.lookAt(0,d[w],0)):(f.up.set(0,p[w],0),f.lookAt(0,0,d[w])),Zl(a,N*xi,w>2?xi:0,xi,xi),g.setRenderTarget(a),P&&g.render(L,f),g.render(e,f)}L.geometry.dispose(),L.material.dispose(),g.toneMapping=_,g.outputEncoding=x,g.autoClear=y,e.background=M}_setEncoding(e,t){e.value=Ur[t.encoding]}_textureToCubeUV(e,t){const i=this._renderer,a=e.mapping===Va||e.mapping===Xa;a?this._cubemapShader==null&&(this._cubemapShader=pm()):this._equirectShader==null&&(this._equirectShader=dm());const o=a?this._cubemapShader:this._equirectShader,h=new zn(no[0],o),f=o.uniforms;f.envMap.value=e,a||f.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(f.inputEncoding,e),this._setEncoding(f.outputEncoding,t.texture),Zl(t,0,0,3*xi,2*xi),i.setRenderTarget(t),i.render(h,ch)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let a=1;a<lm;a++){const o=Math.sqrt(Xl[a]*Xl[a]-Xl[a-1]*Xl[a-1]),h=hm[(a-1)%hm.length];this._blur(e,a-1,a,o,h)}t.autoClear=i}_blur(e,t,i,a,o){const h=this._pingPongRenderTarget;this._halfBlur(e,h,t,i,a,"latitudinal",o),this._halfBlur(h,e,i,i,a,"longitudinal",o)}_halfBlur(e,t,i,a,o,h,f){const p=this._renderer,d=this._blurMaterial;h!=="latitudinal"&&h!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const g=3,y=new zn(no[a],d),x=d.uniforms,_=um[i]-1,T=isFinite(o)?Math.PI/(2*_):2*Math.PI/(2*js-1),L=o/T,P=isFinite(o)?1+Math.floor(g*L):js;P>js&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${P} samples when the maximum is set to ${js}`);const M=[];let w=0;for(let q=0;q<js;++q){const R=q/L,J=Math.exp(-R*R/2);M.push(J),q==0?w+=J:q<P&&(w+=2*J)}for(let q=0;q<M.length;q++)M[q]=M[q]/w;x.envMap.value=e.texture,x.samples.value=P,x.weights.value=M,x.latitudinal.value=h==="latitudinal",f&&(x.poleAxis.value=f),x.dTheta.value=T,x.mipInt.value=cr-i,this._setEncoding(x.inputEncoding,e.texture),this._setEncoding(x.outputEncoding,e.texture);const N=um[a],C=3*Math.max(0,xi-2*N),k=(a===0?0:2*xi)+2*N*(a>cr-Ys?a-cr+Ys:0);Zl(t,C,k,3*N,2*N),p.setRenderTarget(t),p.render(y,ch)}}function QM(r){return r===void 0||r.type!==er?!1:r.encoding===On||r.encoding===bl||r.encoding===Rc}function $M(){const r=[],e=[],t=[];let i=cr;for(let a=0;a<lm;a++){const o=Math.pow(2,i);e.push(o);let h=1/o;a>cr-Ys?h=om[a-cr+Ys-1]:a==0&&(h=0),t.push(h);const f=1/(o-1),p=-f/2,d=1+f/2,g=[p,p,d,p,d,d,p,p,d,d,p,d],y=6,x=6,_=3,T=2,L=1,P=new Float32Array(_*x*y),M=new Float32Array(T*x*y),w=new Float32Array(L*x*y);for(let C=0;C<y;C++){const k=C%3*2/3-1,q=C>2?0:-1,R=[k,q,0,k+2/3,q,0,k+2/3,q+1,0,k,q,0,k+2/3,q+1,0,k,q+1,0];P.set(R,_*x*C),M.set(g,T*x*C);const J=[C,C,C,C,C,C];w.set(J,L*x*C)}const N=new kt;N.setAttribute("position",new rn(P,_)),N.setAttribute("uv",new rn(M,T)),N.setAttribute("faceIndex",new rn(w,L)),r.push(N),i>Ys&&i--}return{_lodPlanes:r,_sizeLods:e,_sigmas:t}}function fm(r){const e=new Kn(3*xi,3*xi,r);return e.texture.mapping=ml,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Zl(r,e,t,i,a){r.viewport.set(e,t,i,a),r.scissor.set(e,t,i,a)}function eS(r){const e=new Float32Array(r),t=new V(0,1,0);return new Vl({name:"SphericalGaussianBlur",defines:{n:r},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:Ur[On]},outputEncoding:{value:Ur[On]}},vertexShader:fh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${dh()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:$i,depthTest:!1,depthWrite:!1})}function dm(){const r=new ye(1,1);return new Vl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:r},inputEncoding:{value:Ur[On]},outputEncoding:{value:Ur[On]}},vertexShader:fh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${dh()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:$i,depthTest:!1,depthWrite:!1})}function pm(){return new Vl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ur[On]},outputEncoding:{value:Ur[On]}},vertexShader:fh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${dh()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:$i,depthTest:!1,depthWrite:!1})}function fh(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function dh(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function tS(r){let e=new WeakMap,t=null;function i(f){if(f&&f.isTexture&&f.isRenderTargetTexture===!1){const p=f.mapping,d=p===Mc||p===Sc,g=p===Va||p===Xa;if(d||g){if(e.has(f))return e.get(f).texture;{const y=f.image;if(d&&y&&y.height>0||g&&y&&a(y)){const x=r.getRenderTarget();t===null&&(t=new KM(r));const _=d?t.fromEquirectangular(f):t.fromCubemap(f);return e.set(f,_),r.setRenderTarget(x),f.addEventListener("dispose",o),_.texture}else return null}}}return f}function a(f){let p=0;const d=6;for(let g=0;g<d;g++)f[g]!==void 0&&p++;return p===d}function o(f){const p=f.target;p.removeEventListener("dispose",o);const d=e.get(p);d!==void 0&&(e.delete(p),d.dispose())}function h(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:h}}function nS(r){const e={};function t(i){if(e[i]!==void 0)return e[i];let a;switch(i){case"WEBGL_depth_texture":a=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=r.getExtension(i)}return e[i]=a,a}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const a=t(i);return a===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),a}}}function iS(r,e,t,i){const a={},o=new WeakMap;function h(y){const x=y.target;x.index!==null&&e.remove(x.index);for(const T in x.attributes)e.remove(x.attributes[T]);x.removeEventListener("dispose",h),delete a[x.id];const _=o.get(x);_&&(e.remove(_),o.delete(x)),i.releaseStatesOfGeometry(x),x.isInstancedBufferGeometry===!0&&delete x._maxInstanceCount,t.memory.geometries--}function f(y,x){return a[x.id]===!0||(x.addEventListener("dispose",h),a[x.id]=!0,t.memory.geometries++),x}function p(y){const x=y.attributes;for(const T in x)e.update(x[T],34962);const _=y.morphAttributes;for(const T in _){const L=_[T];for(let P=0,M=L.length;P<M;P++)e.update(L[P],34962)}}function d(y){const x=[],_=y.index,T=y.attributes.position;let L=0;if(_!==null){const w=_.array;L=_.version;for(let N=0,C=w.length;N<C;N+=3){const k=w[N+0],q=w[N+1],R=w[N+2];x.push(k,q,q,R,R,k)}}else{const w=T.array;L=T.version;for(let N=0,C=w.length/3-1;N<C;N+=3){const k=N+0,q=N+1,R=N+2;x.push(k,q,q,R,R,k)}}const P=new(Gp(x)>65535?im:nm)(x,1);P.version=L;const M=o.get(y);M&&e.remove(M),o.set(y,P)}function g(y){const x=o.get(y);if(x){const _=y.index;_!==null&&x.version<_.version&&d(y)}else d(y);return o.get(y)}return{get:f,update:p,getWireframeAttribute:g}}function rS(r,e,t,i){const a=i.isWebGL2;let o;function h(x){o=x}let f,p;function d(x){f=x.type,p=x.bytesPerElement}function g(x,_){r.drawElements(o,_,f,x*p),t.update(_,o,1)}function y(x,_,T){if(T===0)return;let L,P;if(a)L=r,P="drawElementsInstanced";else if(L=e.get("ANGLE_instanced_arrays"),P="drawElementsInstancedANGLE",L===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}L[P](o,_,f,x*p,T),t.update(_,o,T)}this.setMode=h,this.setIndex=d,this.render=g,this.renderInstances=y}function sS(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(o,h,f){switch(t.calls++,h){case 4:t.triangles+=f*(o/3);break;case 1:t.lines+=f*(o/2);break;case 3:t.lines+=f*(o-1);break;case 2:t.lines+=f*o;break;case 0:t.points+=f*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",h);break}}function a(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:a,update:i}}class ph extends vn{constructor(e=null,t=1,i=1,a=1){super(null);this.image={data:e,width:t,height:i,depth:a},this.magFilter=un,this.minFilter=un,this.wrapR=Zn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ph.prototype.isDataTexture2DArray=!0;function aS(r,e){return r[0]-e[0]}function oS(r,e){return Math.abs(e[1])-Math.abs(r[1])}function mm(r,e){let t=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?t=127:i instanceof Int16Array?t=32767:i instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),r.divideScalar(t)}function lS(r,e,t){const i={},a=new Float32Array(8),o=new WeakMap,h=new V,f=[];for(let d=0;d<8;d++)f[d]=[d,0];function p(d,g,y,x){const _=d.morphTargetInfluences;if(e.isWebGL2===!0){const T=g.morphAttributes.position.length;let L=o.get(g);if(L===void 0||L.count!==T){L!==void 0&&L.texture.dispose();const w=g.morphAttributes.normal!==void 0,N=g.morphAttributes.position,C=g.morphAttributes.normal||[],k=g.attributes.position.count,q=w===!0?2:1;let R=k*q,J=1;R>e.maxTextureSize&&(J=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const oe=new Float32Array(R*J*4*T),Q=new ph(oe,R,J,T);Q.format=In,Q.type=tr;const X=q*4;for(let Se=0;Se<T;Se++){const H=N[Se],W=C[Se],D=R*J*4*Se;for(let ee=0;ee<H.count;ee++){h.fromBufferAttribute(H,ee),H.normalized===!0&&mm(h,H);const te=ee*X;oe[D+te+0]=h.x,oe[D+te+1]=h.y,oe[D+te+2]=h.z,oe[D+te+3]=0,w===!0&&(h.fromBufferAttribute(W,ee),W.normalized===!0&&mm(h,W),oe[D+te+4]=h.x,oe[D+te+5]=h.y,oe[D+te+6]=h.z,oe[D+te+7]=0)}}L={count:T,texture:Q,size:new ye(R,J)},o.set(g,L)}let P=0;for(let w=0;w<_.length;w++)P+=_[w];const M=g.morphTargetsRelative?1:1-P;x.getUniforms().setValue(r,"morphTargetBaseInfluence",M),x.getUniforms().setValue(r,"morphTargetInfluences",_),x.getUniforms().setValue(r,"morphTargetsTexture",L.texture,t),x.getUniforms().setValue(r,"morphTargetsTextureSize",L.size)}else{const T=_===void 0?0:_.length;let L=i[g.id];if(L===void 0||L.length!==T){L=[];for(let C=0;C<T;C++)L[C]=[C,0];i[g.id]=L}for(let C=0;C<T;C++){const k=L[C];k[0]=C,k[1]=_[C]}L.sort(oS);for(let C=0;C<8;C++)C<T&&L[C][1]?(f[C][0]=L[C][0],f[C][1]=L[C][1]):(f[C][0]=Number.MAX_SAFE_INTEGER,f[C][1]=0);f.sort(aS);const P=g.morphAttributes.position,M=g.morphAttributes.normal;let w=0;for(let C=0;C<8;C++){const k=f[C],q=k[0],R=k[1];q!==Number.MAX_SAFE_INTEGER&&R?(P&&g.getAttribute("morphTarget"+C)!==P[q]&&g.setAttribute("morphTarget"+C,P[q]),M&&g.getAttribute("morphNormal"+C)!==M[q]&&g.setAttribute("morphNormal"+C,M[q]),a[C]=R,w+=R):(P&&g.hasAttribute("morphTarget"+C)===!0&&g.deleteAttribute("morphTarget"+C),M&&g.hasAttribute("morphNormal"+C)===!0&&g.deleteAttribute("morphNormal"+C),a[C]=0)}const N=g.morphTargetsRelative?1:1-w;x.getUniforms().setValue(r,"morphTargetBaseInfluence",N),x.getUniforms().setValue(r,"morphTargetInfluences",a)}}return{update:p}}function uS(r,e,t,i){let a=new WeakMap;function o(p){const d=i.render.frame,g=p.geometry,y=e.get(p,g);return a.get(y)!==d&&(e.update(y),a.set(y,d)),p.isInstancedMesh&&(p.hasEventListener("dispose",f)===!1&&p.addEventListener("dispose",f),t.update(p.instanceMatrix,34962),p.instanceColor!==null&&t.update(p.instanceColor,34962)),y}function h(){a=new WeakMap}function f(p){const d=p.target;d.removeEventListener("dispose",f),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:o,dispose:h}}class gm extends vn{constructor(e=null,t=1,i=1,a=1){super(null);this.image={data:e,width:t,height:i,depth:a},this.magFilter=un,this.minFilter=un,this.wrapR=Zn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}gm.prototype.isDataTexture3D=!0;const vm=new vn,xm=new ph,ym=new gm,_m=new Ul,bm=[],wm=[],Mm=new Float32Array(16),Sm=new Float32Array(9),Tm=new Float32Array(4);function Ks(r,e,t){const i=r[0];if(i<=0||i>0)return r;const a=e*t;let o=bm[a];if(o===void 0&&(o=new Float32Array(a),bm[a]=o),e!==0){i.toArray(o,0);for(let h=1,f=0;h!==e;++h)f+=t,r[h].toArray(o,f)}return o}function kn(r,e){if(r.length!==e.length)return!1;for(let t=0,i=r.length;t<i;t++)if(r[t]!==e[t])return!1;return!0}function An(r,e){for(let t=0,i=e.length;t<i;t++)r[t]=e[t]}function ql(r,e){let t=wm[e];t===void 0&&(t=new Int32Array(e),wm[e]=t);for(let i=0;i!==e;++i)t[i]=r.allocateTextureUnit();return t}function cS(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function hS(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kn(t,e))return;r.uniform2fv(this.addr,e),An(t,e)}}function fS(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(kn(t,e))return;r.uniform3fv(this.addr,e),An(t,e)}}function dS(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kn(t,e))return;r.uniform4fv(this.addr,e),An(t,e)}}function pS(r,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),An(t,e)}else{if(kn(t,i))return;Tm.set(i),r.uniformMatrix2fv(this.addr,!1,Tm),An(t,i)}}function mS(r,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),An(t,e)}else{if(kn(t,i))return;Sm.set(i),r.uniformMatrix3fv(this.addr,!1,Sm),An(t,i)}}function gS(r,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),An(t,e)}else{if(kn(t,i))return;Mm.set(i),r.uniformMatrix4fv(this.addr,!1,Mm),An(t,i)}}function vS(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function xS(r,e){const t=this.cache;kn(t,e)||(r.uniform2iv(this.addr,e),An(t,e))}function yS(r,e){const t=this.cache;kn(t,e)||(r.uniform3iv(this.addr,e),An(t,e))}function _S(r,e){const t=this.cache;kn(t,e)||(r.uniform4iv(this.addr,e),An(t,e))}function bS(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function wS(r,e){const t=this.cache;kn(t,e)||(r.uniform2uiv(this.addr,e),An(t,e))}function MS(r,e){const t=this.cache;kn(t,e)||(r.uniform3uiv(this.addr,e),An(t,e))}function SS(r,e){const t=this.cache;kn(t,e)||(r.uniform4uiv(this.addr,e),An(t,e))}function TS(r,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.safeSetTexture2D(e||vm,a)}function ES(r,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.setTexture3D(e||ym,a)}function AS(r,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.safeSetTextureCube(e||_m,a)}function LS(r,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(r.uniform1i(this.addr,a),i[0]=a),t.setTexture2DArray(e||xm,a)}function CS(r){switch(r){case 5126:return cS;case 35664:return hS;case 35665:return fS;case 35666:return dS;case 35674:return pS;case 35675:return mS;case 35676:return gS;case 5124:case 35670:return vS;case 35667:case 35671:return xS;case 35668:case 35672:return yS;case 35669:case 35673:return _S;case 5125:return bS;case 36294:return wS;case 36295:return MS;case 36296:return SS;case 35678:case 36198:case 36298:case 36306:case 35682:return TS;case 35679:case 36299:case 36307:return ES;case 35680:case 36300:case 36308:case 36293:return AS;case 36289:case 36303:case 36311:case 36292:return LS}}function RS(r,e){r.uniform1fv(this.addr,e)}function PS(r,e){const t=Ks(e,this.size,2);r.uniform2fv(this.addr,t)}function DS(r,e){const t=Ks(e,this.size,3);r.uniform3fv(this.addr,t)}function IS(r,e){const t=Ks(e,this.size,4);r.uniform4fv(this.addr,t)}function kS(r,e){const t=Ks(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function NS(r,e){const t=Ks(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function FS(r,e){const t=Ks(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function OS(r,e){r.uniform1iv(this.addr,e)}function zS(r,e){r.uniform2iv(this.addr,e)}function BS(r,e){r.uniform3iv(this.addr,e)}function HS(r,e){r.uniform4iv(this.addr,e)}function US(r,e){r.uniform1uiv(this.addr,e)}function WS(r,e){r.uniform2uiv(this.addr,e)}function GS(r,e){r.uniform3uiv(this.addr,e)}function VS(r,e){r.uniform4uiv(this.addr,e)}function XS(r,e,t){const i=e.length,a=ql(t,i);r.uniform1iv(this.addr,a);for(let o=0;o!==i;++o)t.safeSetTexture2D(e[o]||vm,a[o])}function ZS(r,e,t){const i=e.length,a=ql(t,i);r.uniform1iv(this.addr,a);for(let o=0;o!==i;++o)t.setTexture3D(e[o]||ym,a[o])}function qS(r,e,t){const i=e.length,a=ql(t,i);r.uniform1iv(this.addr,a);for(let o=0;o!==i;++o)t.safeSetTextureCube(e[o]||_m,a[o])}function YS(r,e,t){const i=e.length,a=ql(t,i);r.uniform1iv(this.addr,a);for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||xm,a[o])}function jS(r){switch(r){case 5126:return RS;case 35664:return PS;case 35665:return DS;case 35666:return IS;case 35674:return kS;case 35675:return NS;case 35676:return FS;case 5124:case 35670:return OS;case 35667:case 35671:return zS;case 35668:case 35672:return BS;case 35669:case 35673:return HS;case 5125:return US;case 36294:return WS;case 36295:return GS;case 36296:return VS;case 35678:case 36198:case 36298:case 36306:case 35682:return XS;case 35679:case 36299:case 36307:return ZS;case 35680:case 36300:case 36308:case 36293:return qS;case 36289:case 36303:case 36311:case 36292:return YS}}function JS(r,e,t){this.id=r,this.addr=t,this.cache=[],this.setValue=CS(e.type)}function Em(r,e,t){this.id=r,this.addr=t,this.cache=[],this.size=e.size,this.setValue=jS(e.type)}Em.prototype.updateCache=function(r){const e=this.cache;r instanceof Float32Array&&e.length!==r.length&&(this.cache=new Float32Array(r.length)),An(e,r)};function Am(r){this.id=r,this.seq=[],this.map={}}Am.prototype.setValue=function(r,e,t){const i=this.seq;for(let a=0,o=i.length;a!==o;++a){const h=i[a];h.setValue(r,e[h.id],t)}};const mh=/(\w+)(\])?(\[|\.)?/g;function Lm(r,e){r.seq.push(e),r.map[e.id]=e}function KS(r,e,t){const i=r.name,a=i.length;for(mh.lastIndex=0;;){const o=mh.exec(i),h=mh.lastIndex;let f=o[1];const p=o[2]==="]",d=o[3];if(p&&(f=f|0),d===void 0||d==="["&&h+2===a){Lm(t,d===void 0?new JS(f,r,e):new Em(f,r,e));break}else{let y=t.map[f];y===void 0&&(y=new Am(f),Lm(t,y)),t=y}}}function hr(r,e){this.seq=[],this.map={};const t=r.getProgramParameter(e,35718);for(let i=0;i<t;++i){const a=r.getActiveUniform(e,i),o=r.getUniformLocation(e,a.name);KS(a,o,this)}}hr.prototype.setValue=function(r,e,t,i){const a=this.map[e];a!==void 0&&a.setValue(r,t,i)};hr.prototype.setOptional=function(r,e,t){const i=e[t];i!==void 0&&this.setValue(r,t,i)};hr.upload=function(r,e,t,i){for(let a=0,o=e.length;a!==o;++a){const h=e[a],f=t[h.id];f.needsUpdate!==!1&&h.setValue(r,f.value,i)}};hr.seqWithValue=function(r,e){const t=[];for(let i=0,a=r.length;i!==a;++i){const o=r[i];o.id in e&&t.push(o)}return t};function Cm(r,e,t){const i=r.createShader(e);return r.shaderSource(i,t),r.compileShader(i),i}let QS=0;function $S(r){const e=r.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function Rm(r){switch(r){case On:return["Linear","( value )"];case bl:return["sRGB","( value )"];case Pc:return["RGBE","( value )"];case zp:return["RGBM","( value, 7.0 )"];case Bp:return["RGBM","( value, 16.0 )"];case Hp:return["RGBD","( value, 256.0 )"];case Rc:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",r),["Linear","( value )"]}}function Pm(r,e,t){const i=r.getShaderParameter(e,35713),a=r.getShaderInfoLog(e).trim();return i&&a===""?"":t.toUpperCase()+`

`+a+`

`+$S(r.getShaderSource(e))}function Gr(r,e){const t=Rm(e);return"vec4 "+r+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function e1(r,e){const t=Rm(e);return"vec4 "+r+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function t1(r,e){let t;switch(e){case Iy:t="Linear";break;case ky:t="Reinhard";break;case Ny:t="OptimizedCineon";break;case Fy:t="ACESFilmic";break;case Oy:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function n1(r){return[r.extensionDerivatives||r.envMapCubeUV||r.bumpMap||r.tangentSpaceNormalMap||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(io).join(`
`)}function i1(r){const e=[];for(const t in r){const i=r[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function r1(r,e){const t={},i=r.getProgramParameter(e,35721);for(let a=0;a<i;a++){const o=r.getActiveAttrib(e,a),h=o.name;let f=1;o.type===35674&&(f=2),o.type===35675&&(f=3),o.type===35676&&(f=4),t[h]={type:o.type,location:r.getAttribLocation(e,h),locationSize:f}}return t}function io(r){return r!==""}function Dm(r,e){return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Im(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const s1=/^[ \t]*#include +<([\w\d./]+)>/gm;function gh(r){return r.replace(s1,a1)}function a1(r,e){const t=vt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return gh(t)}const o1=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,l1=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function km(r){return r.replace(l1,Nm).replace(o1,u1)}function u1(r,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Nm(r,e,t,i)}function Nm(r,e,t,i){let a="";for(let o=parseInt(e);o<parseInt(t);o++)a+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return a}function Fm(r){let e="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function c1(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===mp?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===hy?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Ua&&(e="SHADOWMAP_TYPE_VSM"),e}function h1(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case Va:case Xa:e="ENVMAP_TYPE_CUBE";break;case ml:case Tc:e="ENVMAP_TYPE_CUBE_UV";break}return e}function f1(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Xa:case Tc:e="ENVMAP_MODE_REFRACTION";break}return e}function d1(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case pl:e="ENVMAP_BLENDING_MULTIPLY";break;case Py:e="ENVMAP_BLENDING_MIX";break;case Dy:e="ENVMAP_BLENDING_ADD";break}return e}function p1(r,e,t,i){const a=r.getContext(),o=t.defines;let h=t.vertexShader,f=t.fragmentShader;const p=c1(t),d=h1(t),g=f1(t),y=d1(t),x=r.gammaFactor>0?r.gammaFactor:1,_=t.isWebGL2?"":n1(t),T=i1(o),L=a.createProgram();let P,M,w=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(P=[T].filter(io).join(`
`),P.length>0&&(P+=`
`),M=[_,T].filter(io).join(`
`),M.length>0&&(M+=`
`)):(P=[Fm(t),"#define SHADER_NAME "+t.shaderName,T,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(io).join(`
`),M=[_,Fm(t),"#define SHADER_NAME "+t.shaderName,T,"#define GAMMA_FACTOR "+x,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+g:"",t.envMap?"#define "+y:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Nr?"#define TONE_MAPPING":"",t.toneMapping!==Nr?vt.tonemapping_pars_fragment:"",t.toneMapping!==Nr?t1("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===Fr?"#define OPAQUE":"",vt.encodings_pars_fragment,t.map?Gr("mapTexelToLinear",t.mapEncoding):"",t.matcap?Gr("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Gr("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Gr("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularColorMap?Gr("specularColorMapTexelToLinear",t.specularColorMapEncoding):"",t.sheenColorMap?Gr("sheenColorMapTexelToLinear",t.sheenColorMapEncoding):"",t.lightMap?Gr("lightMapTexelToLinear",t.lightMapEncoding):"",e1("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(io).join(`
`)),h=gh(h),h=Dm(h,t),h=Im(h,t),f=gh(f),f=Dm(f,t),f=Im(f,t),h=km(h),f=km(f),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,P=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+P,M=["#define varying in",t.glslVersion===Up?"":"out highp vec4 pc_fragColor;",t.glslVersion===Up?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+M);const N=w+P+h,C=w+M+f,k=Cm(a,35633,N),q=Cm(a,35632,C);if(a.attachShader(L,k),a.attachShader(L,q),t.index0AttributeName!==void 0?a.bindAttribLocation(L,0,t.index0AttributeName):t.morphTargets===!0&&a.bindAttribLocation(L,0,"position"),a.linkProgram(L),r.debug.checkShaderErrors){const oe=a.getProgramInfoLog(L).trim(),Q=a.getShaderInfoLog(k).trim(),X=a.getShaderInfoLog(q).trim();let Se=!0,H=!0;if(a.getProgramParameter(L,35714)===!1){Se=!1;const W=Pm(a,k,"vertex"),D=Pm(a,q,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(L,35715)+`

Program Info Log: `+oe+`
`+W+`
`+D)}else oe!==""?console.warn("THREE.WebGLProgram: Program Info Log:",oe):(Q===""||X==="")&&(H=!1);H&&(this.diagnostics={runnable:Se,programLog:oe,vertexShader:{log:Q,prefix:P},fragmentShader:{log:X,prefix:M}})}a.deleteShader(k),a.deleteShader(q);let R;this.getUniforms=function(){return R===void 0&&(R=new hr(a,L)),R};let J;return this.getAttributes=function(){return J===void 0&&(J=r1(a,L)),J},this.destroy=function(){i.releaseStatesOfProgram(this),a.deleteProgram(L),this.program=void 0},this.name=t.shaderName,this.id=QS++,this.cacheKey=e,this.usedTimes=1,this.program=L,this.vertexShader=k,this.fragmentShader=q,this}function m1(r,e,t,i,a,o,h){const f=[],p=a.isWebGL2,d=a.logarithmicDepthBuffer,g=a.floatVertexTextures,y=a.maxVertexUniforms,x=a.vertexTextures;let _=a.precision;const T={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},L=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function P(R){const oe=R.skeleton.bones;if(g)return 1024;{const X=Math.floor((y-20)/4),Se=Math.min(X,oe.length);return Se<oe.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+oe.length+" bones. This GPU supports "+Se+"."),0):Se}}function M(R){let J;return R&&R.isTexture?J=R.encoding:R&&R.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),J=R.texture.encoding):J=On,J}function w(R,J,oe,Q,X){const Se=Q.fog,H=R.isMeshStandardMaterial?Q.environment:null,W=(R.isMeshStandardMaterial?t:e).get(R.envMap||H),D=T[R.type],ee=X.isSkinnedMesh?P(X):0;R.precision!==null&&(_=a.getMaxPrecision(R.precision),_!==R.precision&&console.warn("THREE.WebGLProgram.getParameters:",R.precision,"not supported, using",_,"instead."));let te,Me;if(D){const Pe=vi[D];te=Pe.vertexShader,Me=Pe.fragmentShader}else te=R.vertexShader,Me=R.fragmentShader;const Oe=r.getRenderTarget(),ce=R.alphaTest>0,ue=R.clearcoat>0;return{isWebGL2:p,shaderID:D,shaderName:R.type,vertexShader:te,fragmentShader:Me,defines:R.defines,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:_,instancing:X.isInstancedMesh===!0,instancingColor:X.isInstancedMesh===!0&&X.instanceColor!==null,supportsVertexTextures:x,outputEncoding:Oe!==null?M(Oe.texture):r.outputEncoding,map:!!R.map,mapEncoding:M(R.map),matcap:!!R.matcap,matcapEncoding:M(R.matcap),envMap:!!W,envMapMode:W&&W.mapping,envMapEncoding:M(W),envMapCubeUV:!!W&&(W.mapping===ml||W.mapping===Tc),lightMap:!!R.lightMap,lightMapEncoding:M(R.lightMap),aoMap:!!R.aoMap,emissiveMap:!!R.emissiveMap,emissiveMapEncoding:M(R.emissiveMap),bumpMap:!!R.bumpMap,normalMap:!!R.normalMap,objectSpaceNormalMap:R.normalMapType===O_,tangentSpaceNormalMap:R.normalMapType===Cs,clearcoat:ue,clearcoatMap:ue&&!!R.clearcoatMap,clearcoatRoughnessMap:ue&&!!R.clearcoatRoughnessMap,clearcoatNormalMap:ue&&!!R.clearcoatNormalMap,displacementMap:!!R.displacementMap,roughnessMap:!!R.roughnessMap,metalnessMap:!!R.metalnessMap,specularMap:!!R.specularMap,specularIntensityMap:!!R.specularIntensityMap,specularColorMap:!!R.specularColorMap,specularColorMapEncoding:M(R.specularColorMap),alphaMap:!!R.alphaMap,alphaTest:ce,gradientMap:!!R.gradientMap,sheen:R.sheen>0,sheenColorMap:!!R.sheenColorMap,sheenColorMapEncoding:M(R.sheenColorMap),sheenRoughnessMap:!!R.sheenRoughnessMap,transmission:R.transmission>0,transmissionMap:!!R.transmissionMap,thicknessMap:!!R.thicknessMap,combine:R.combine,vertexTangents:!!R.normalMap&&!!X.geometry&&!!X.geometry.attributes.tangent,vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!X.geometry&&!!X.geometry.attributes.color&&X.geometry.attributes.color.itemSize===4,vertexUvs:!!R.map||!!R.bumpMap||!!R.normalMap||!!R.specularMap||!!R.alphaMap||!!R.emissiveMap||!!R.roughnessMap||!!R.metalnessMap||!!R.clearcoatMap||!!R.clearcoatRoughnessMap||!!R.clearcoatNormalMap||!!R.displacementMap||!!R.transmissionMap||!!R.thicknessMap||!!R.specularIntensityMap||!!R.specularColorMap||!!R.sheenColorMap||R.sheenRoughnessMap,uvsVertexOnly:!(!!R.map||!!R.bumpMap||!!R.normalMap||!!R.specularMap||!!R.alphaMap||!!R.emissiveMap||!!R.roughnessMap||!!R.metalnessMap||!!R.clearcoatNormalMap||R.transmission>0||!!R.transmissionMap||!!R.thicknessMap||!!R.specularIntensityMap||!!R.specularColorMap||R.sheen>0||!!R.sheenColorMap||!!R.sheenRoughnessMap)&&!!R.displacementMap,fog:!!Se,useFog:R.fog,fogExp2:Se&&Se.isFogExp2,flatShading:!!R.flatShading,sizeAttenuation:R.sizeAttenuation,logarithmicDepthBuffer:d,skinning:X.isSkinnedMesh===!0&&ee>0,maxBones:ee,useVertexTexture:g,morphTargets:!!X.geometry&&!!X.geometry.morphAttributes.position,morphNormals:!!X.geometry&&!!X.geometry.morphAttributes.normal,morphTargetsCount:!!X.geometry&&!!X.geometry.morphAttributes.position?X.geometry.morphAttributes.position.length:0,numDirLights:J.directional.length,numPointLights:J.point.length,numSpotLights:J.spot.length,numRectAreaLights:J.rectArea.length,numHemiLights:J.hemi.length,numDirLightShadows:J.directionalShadowMap.length,numPointLightShadows:J.pointShadowMap.length,numSpotLightShadows:J.spotShadowMap.length,numClippingPlanes:h.numPlanes,numClipIntersection:h.numIntersection,format:R.format,dithering:R.dithering,shadowMapEnabled:r.shadowMap.enabled&&oe.length>0,shadowMapType:r.shadowMap.type,toneMapping:R.toneMapped?r.toneMapping:Nr,physicallyCorrectLights:r.physicallyCorrectLights,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===ws,flipSided:R.side===nn,depthPacking:R.depthPacking!==void 0?R.depthPacking:!1,index0AttributeName:R.index0AttributeName,extensionDerivatives:R.extensions&&R.extensions.derivatives,extensionFragDepth:R.extensions&&R.extensions.fragDepth,extensionDrawBuffers:R.extensions&&R.extensions.drawBuffers,extensionShaderTextureLOD:R.extensions&&R.extensions.shaderTextureLOD,rendererExtensionFragDepth:p||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||i.has("EXT_shader_texture_lod"),customProgramCacheKey:R.customProgramCacheKey()}}function N(R){const J=[];if(R.shaderID?J.push(R.shaderID):(J.push(Vp(R.fragmentShader)),J.push(Vp(R.vertexShader))),R.defines!==void 0)for(const oe in R.defines)J.push(oe),J.push(R.defines[oe]);if(R.isRawShaderMaterial===!1){for(let oe=0;oe<L.length;oe++)J.push(R[L[oe]]);J.push(r.outputEncoding),J.push(r.gammaFactor)}return J.push(R.customProgramCacheKey),J.join()}function C(R){const J=T[R.type];let oe;if(J){const Q=vi[J];oe=db.clone(Q.uniforms)}else oe=R.uniforms;return oe}function k(R,J){let oe;for(let Q=0,X=f.length;Q<X;Q++){const Se=f[Q];if(Se.cacheKey===J){oe=Se,++oe.usedTimes;break}}return oe===void 0&&(oe=new p1(r,J,R,o),f.push(oe)),oe}function q(R){if(--R.usedTimes==0){const J=f.indexOf(R);f[J]=f[f.length-1],f.pop(),R.destroy()}}return{getParameters:w,getProgramCacheKey:N,getUniforms:C,acquireProgram:k,releaseProgram:q,programs:f}}function g1(){let r=new WeakMap;function e(o){let h=r.get(o);return h===void 0&&(h={},r.set(o,h)),h}function t(o){r.delete(o)}function i(o,h,f){r.get(o)[h]=f}function a(){r=new WeakMap}return{get:e,remove:t,update:i,dispose:a}}function v1(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.program!==e.program?r.program.id-e.program.id:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function Om(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function zm(r){const e=[];let t=0;const i=[],a=[],o=[],h={id:-1};function f(){t=0,i.length=0,a.length=0,o.length=0}function p(_,T,L,P,M,w){let N=e[t];const C=r.get(L);return N===void 0?(N={id:_.id,object:_,geometry:T,material:L,program:C.program||h,groupOrder:P,renderOrder:_.renderOrder,z:M,group:w},e[t]=N):(N.id=_.id,N.object=_,N.geometry=T,N.material=L,N.program=C.program||h,N.groupOrder=P,N.renderOrder=_.renderOrder,N.z=M,N.group=w),t++,N}function d(_,T,L,P,M,w){const N=p(_,T,L,P,M,w);L.transmission>0?a.push(N):L.transparent===!0?o.push(N):i.push(N)}function g(_,T,L,P,M,w){const N=p(_,T,L,P,M,w);L.transmission>0?a.unshift(N):L.transparent===!0?o.unshift(N):i.unshift(N)}function y(_,T){i.length>1&&i.sort(_||v1),a.length>1&&a.sort(T||Om),o.length>1&&o.sort(T||Om)}function x(){for(let _=t,T=e.length;_<T;_++){const L=e[_];if(L.id===null)break;L.id=null,L.object=null,L.geometry=null,L.material=null,L.program=null,L.group=null}}return{opaque:i,transmissive:a,transparent:o,init:f,push:d,unshift:g,finish:x,sort:y}}function x1(r){let e=new WeakMap;function t(a,o){let h;return e.has(a)===!1?(h=new zm(r),e.set(a,[h])):o>=e.get(a).length?(h=new zm(r),e.get(a).push(h)):h=e.get(a)[o],h}function i(){e=new WeakMap}return{get:t,dispose:i}}function y1(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new V,color:new et};break;case"SpotLight":t={position:new V,direction:new V,color:new et,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new V,color:new et,distance:0,decay:0};break;case"HemisphereLight":t={direction:new V,skyColor:new et,groundColor:new et};break;case"RectAreaLight":t={color:new et,position:new V,halfWidth:new V,halfHeight:new V};break}return r[e.id]=t,t}}}function _1(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let b1=0;function w1(r,e){return(e.castShadow?1:0)-(r.castShadow?1:0)}function M1(r,e){const t=new y1,i=_1(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let g=0;g<9;g++)a.probe.push(new V);const o=new V,h=new ot,f=new ot;function p(g,y){let x=0,_=0,T=0;for(let oe=0;oe<9;oe++)a.probe[oe].set(0,0,0);let L=0,P=0,M=0,w=0,N=0,C=0,k=0,q=0;g.sort(w1);const R=y!==!0?Math.PI:1;for(let oe=0,Q=g.length;oe<Q;oe++){const X=g[oe],Se=X.color,H=X.intensity,W=X.distance,D=X.shadow&&X.shadow.map?X.shadow.map.texture:null;if(X.isAmbientLight)x+=Se.r*H*R,_+=Se.g*H*R,T+=Se.b*H*R;else if(X.isLightProbe)for(let ee=0;ee<9;ee++)a.probe[ee].addScaledVector(X.sh.coefficients[ee],H);else if(X.isDirectionalLight){const ee=t.get(X);if(ee.color.copy(X.color).multiplyScalar(X.intensity*R),X.castShadow){const te=X.shadow,Me=i.get(X);Me.shadowBias=te.bias,Me.shadowNormalBias=te.normalBias,Me.shadowRadius=te.radius,Me.shadowMapSize=te.mapSize,a.directionalShadow[L]=Me,a.directionalShadowMap[L]=D,a.directionalShadowMatrix[L]=X.shadow.matrix,C++}a.directional[L]=ee,L++}else if(X.isSpotLight){const ee=t.get(X);if(ee.position.setFromMatrixPosition(X.matrixWorld),ee.color.copy(Se).multiplyScalar(H*R),ee.distance=W,ee.coneCos=Math.cos(X.angle),ee.penumbraCos=Math.cos(X.angle*(1-X.penumbra)),ee.decay=X.decay,X.castShadow){const te=X.shadow,Me=i.get(X);Me.shadowBias=te.bias,Me.shadowNormalBias=te.normalBias,Me.shadowRadius=te.radius,Me.shadowMapSize=te.mapSize,a.spotShadow[M]=Me,a.spotShadowMap[M]=D,a.spotShadowMatrix[M]=X.shadow.matrix,q++}a.spot[M]=ee,M++}else if(X.isRectAreaLight){const ee=t.get(X);ee.color.copy(Se).multiplyScalar(H),ee.halfWidth.set(X.width*.5,0,0),ee.halfHeight.set(0,X.height*.5,0),a.rectArea[w]=ee,w++}else if(X.isPointLight){const ee=t.get(X);if(ee.color.copy(X.color).multiplyScalar(X.intensity*R),ee.distance=X.distance,ee.decay=X.decay,X.castShadow){const te=X.shadow,Me=i.get(X);Me.shadowBias=te.bias,Me.shadowNormalBias=te.normalBias,Me.shadowRadius=te.radius,Me.shadowMapSize=te.mapSize,Me.shadowCameraNear=te.camera.near,Me.shadowCameraFar=te.camera.far,a.pointShadow[P]=Me,a.pointShadowMap[P]=D,a.pointShadowMatrix[P]=X.shadow.matrix,k++}a.point[P]=ee,P++}else if(X.isHemisphereLight){const ee=t.get(X);ee.skyColor.copy(X.color).multiplyScalar(H*R),ee.groundColor.copy(X.groundColor).multiplyScalar(H*R),a.hemi[N]=ee,N++}}w>0&&(e.isWebGL2||r.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=He.LTC_FLOAT_1,a.rectAreaLTC2=He.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(a.rectAreaLTC1=He.LTC_HALF_1,a.rectAreaLTC2=He.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=x,a.ambient[1]=_,a.ambient[2]=T;const J=a.hash;(J.directionalLength!==L||J.pointLength!==P||J.spotLength!==M||J.rectAreaLength!==w||J.hemiLength!==N||J.numDirectionalShadows!==C||J.numPointShadows!==k||J.numSpotShadows!==q)&&(a.directional.length=L,a.spot.length=M,a.rectArea.length=w,a.point.length=P,a.hemi.length=N,a.directionalShadow.length=C,a.directionalShadowMap.length=C,a.pointShadow.length=k,a.pointShadowMap.length=k,a.spotShadow.length=q,a.spotShadowMap.length=q,a.directionalShadowMatrix.length=C,a.pointShadowMatrix.length=k,a.spotShadowMatrix.length=q,J.directionalLength=L,J.pointLength=P,J.spotLength=M,J.rectAreaLength=w,J.hemiLength=N,J.numDirectionalShadows=C,J.numPointShadows=k,J.numSpotShadows=q,a.version=b1++)}function d(g,y){let x=0,_=0,T=0,L=0,P=0;const M=y.matrixWorldInverse;for(let w=0,N=g.length;w<N;w++){const C=g[w];if(C.isDirectionalLight){const k=a.directional[x];k.direction.setFromMatrixPosition(C.matrixWorld),o.setFromMatrixPosition(C.target.matrixWorld),k.direction.sub(o),k.direction.transformDirection(M),x++}else if(C.isSpotLight){const k=a.spot[T];k.position.setFromMatrixPosition(C.matrixWorld),k.position.applyMatrix4(M),k.direction.setFromMatrixPosition(C.matrixWorld),o.setFromMatrixPosition(C.target.matrixWorld),k.direction.sub(o),k.direction.transformDirection(M),T++}else if(C.isRectAreaLight){const k=a.rectArea[L];k.position.setFromMatrixPosition(C.matrixWorld),k.position.applyMatrix4(M),f.identity(),h.copy(C.matrixWorld),h.premultiply(M),f.extractRotation(h),k.halfWidth.set(C.width*.5,0,0),k.halfHeight.set(0,C.height*.5,0),k.halfWidth.applyMatrix4(f),k.halfHeight.applyMatrix4(f),L++}else if(C.isPointLight){const k=a.point[_];k.position.setFromMatrixPosition(C.matrixWorld),k.position.applyMatrix4(M),_++}else if(C.isHemisphereLight){const k=a.hemi[P];k.direction.setFromMatrixPosition(C.matrixWorld),k.direction.transformDirection(M),k.direction.normalize(),P++}}}return{setup:p,setupView:d,state:a}}function Bm(r,e){const t=new M1(r,e),i=[],a=[];function o(){i.length=0,a.length=0}function h(y){i.push(y)}function f(y){a.push(y)}function p(y){t.setup(i,y)}function d(y){t.setupView(i,y)}return{init:o,state:{lightsArray:i,shadowsArray:a,lights:t},setupLights:p,setupLightsView:d,pushLight:h,pushShadow:f}}function S1(r,e){let t=new WeakMap;function i(o,h=0){let f;return t.has(o)===!1?(f=new Bm(r,e),t.set(o,[f])):h>=t.get(o).length?(f=new Bm(r,e),t.get(o).push(f)):f=t.get(o)[h],f}function a(){t=new WeakMap}return{get:i,dispose:a}}class Hm extends Tn{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=N_,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Hm.prototype.isMeshDepthMaterial=!0;class Um extends Tn{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new V,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Um.prototype.isMeshDistanceMaterial=!0;const T1=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,E1=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Wm(r,e,t){let i=new Gl;const a=new ye,o=new ye,h=new Rt,f=new Hm({depthPacking:F_}),p=new Um,d={},g=t.maxTextureSize,y={0:nn,1:Wa,2:ws},x=new Hr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ye},radius:{value:4}},vertexShader:T1,fragmentShader:E1}),_=x.clone();_.defines.HORIZONTAL_PASS=1;const T=new kt;T.setAttribute("position",new rn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const L=new zn(T,x),P=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=mp,this.render=function(C,k,q){if(P.enabled===!1||P.autoUpdate===!1&&P.needsUpdate===!1||C.length===0)return;const R=r.getRenderTarget(),J=r.getActiveCubeFace(),oe=r.getActiveMipmapLevel(),Q=r.state;Q.setBlending($i),Q.buffers.color.setClear(1,1,1,1),Q.buffers.depth.setTest(!0),Q.setScissorTest(!1);for(let X=0,Se=C.length;X<Se;X++){const H=C[X],W=H.shadow;if(W===void 0){console.warn("THREE.WebGLShadowMap:",H,"has no shadow.");continue}if(W.autoUpdate===!1&&W.needsUpdate===!1)continue;a.copy(W.mapSize);const D=W.getFrameExtents();if(a.multiply(D),o.copy(W.mapSize),(a.x>g||a.y>g)&&(a.x>g&&(o.x=Math.floor(g/D.x),a.x=o.x*D.x,W.mapSize.x=o.x),a.y>g&&(o.y=Math.floor(g/D.y),a.y=o.y*D.y,W.mapSize.y=o.y)),W.map===null&&!W.isPointLightShadow&&this.type===Ua){const te={minFilter:Jn,magFilter:Jn,format:In};W.map=new Kn(a.x,a.y,te),W.map.texture.name=H.name+".shadowMap",W.mapPass=new Kn(a.x,a.y,te),W.camera.updateProjectionMatrix()}if(W.map===null){const te={minFilter:un,magFilter:un,format:In};W.map=new Kn(a.x,a.y,te),W.map.texture.name=H.name+".shadowMap",W.camera.updateProjectionMatrix()}r.setRenderTarget(W.map),r.clear();const ee=W.getViewportCount();for(let te=0;te<ee;te++){const Me=W.getViewport(te);h.set(o.x*Me.x,o.y*Me.y,o.x*Me.z,o.y*Me.w),Q.viewport(h),W.updateMatrices(H,te),i=W.getFrustum(),N(k,q,W.camera,H,this.type)}!W.isPointLightShadow&&this.type===Ua&&M(W,q),W.needsUpdate=!1}P.needsUpdate=!1,r.setRenderTarget(R,J,oe)};function M(C,k){const q=e.update(L);x.defines.VSM_SAMPLES!==C.blurSamples&&(x.defines.VSM_SAMPLES=C.blurSamples,_.defines.VSM_SAMPLES=C.blurSamples,x.needsUpdate=!0,_.needsUpdate=!0),x.uniforms.shadow_pass.value=C.map.texture,x.uniforms.resolution.value=C.mapSize,x.uniforms.radius.value=C.radius,r.setRenderTarget(C.mapPass),r.clear(),r.renderBufferDirect(k,null,q,x,L,null),_.uniforms.shadow_pass.value=C.mapPass.texture,_.uniforms.resolution.value=C.mapSize,_.uniforms.radius.value=C.radius,r.setRenderTarget(C.map),r.clear(),r.renderBufferDirect(k,null,q,_,L,null)}function w(C,k,q,R,J,oe,Q){let X=null;const Se=R.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(Se!==void 0?X=Se:X=R.isPointLight===!0?p:f,r.localClippingEnabled&&q.clipShadows===!0&&q.clippingPlanes.length!==0||q.displacementMap&&q.displacementScale!==0||q.alphaMap&&q.alphaTest>0){const H=X.uuid,W=q.uuid;let D=d[H];D===void 0&&(D={},d[H]=D);let ee=D[W];ee===void 0&&(ee=X.clone(),D[W]=ee),X=ee}return X.visible=q.visible,X.wireframe=q.wireframe,Q===Ua?X.side=q.shadowSide!==null?q.shadowSide:q.side:X.side=q.shadowSide!==null?q.shadowSide:y[q.side],X.alphaMap=q.alphaMap,X.alphaTest=q.alphaTest,X.clipShadows=q.clipShadows,X.clippingPlanes=q.clippingPlanes,X.clipIntersection=q.clipIntersection,X.displacementMap=q.displacementMap,X.displacementScale=q.displacementScale,X.displacementBias=q.displacementBias,X.wireframeLinewidth=q.wireframeLinewidth,X.linewidth=q.linewidth,R.isPointLight===!0&&X.isMeshDistanceMaterial===!0&&(X.referencePosition.setFromMatrixPosition(R.matrixWorld),X.nearDistance=J,X.farDistance=oe),X}function N(C,k,q,R,J){if(C.visible===!1)return;if(C.layers.test(k.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&J===Ua)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,C.matrixWorld);const X=e.update(C),Se=C.material;if(Array.isArray(Se)){const H=X.groups;for(let W=0,D=H.length;W<D;W++){const ee=H[W],te=Se[ee.materialIndex];if(te&&te.visible){const Me=w(C,X,te,R,q.near,q.far,J);r.renderBufferDirect(q,null,X,Me,C,ee)}}}else if(Se.visible){const H=w(C,X,Se,R,q.near,q.far,J);r.renderBufferDirect(q,null,X,H,C,null)}}const Q=C.children;for(let X=0,Se=Q.length;X<Se;X++)N(Q[X],k,q,R,J)}}function A1(r,e,t){const i=t.isWebGL2;function a(){let Y=!1;const ke=new Rt;let z=null;const ne=new Rt(0,0,0,0);return{setMask:function(ve){z!==ve&&!Y&&(r.colorMask(ve,ve,ve,ve),z=ve)},setLocked:function(ve){Y=ve},setClear:function(ve,Te,Ne,xe,wt){wt===!0&&(ve*=xe,Te*=xe,Ne*=xe),ke.set(ve,Te,Ne,xe),ne.equals(ke)===!1&&(r.clearColor(ve,Te,Ne,xe),ne.copy(ke))},reset:function(){Y=!1,z=null,ne.set(-1,0,0,0)}}}function o(){let Y=!1,ke=null,z=null,ne=null;return{setTest:function(ve){ve?Pe(2929):ze(2929)},setMask:function(ve){ke!==ve&&!Y&&(r.depthMask(ve),ke=ve)},setFunc:function(ve){if(z!==ve){if(ve)switch(ve){case Sy:r.depthFunc(512);break;case Ty:r.depthFunc(519);break;case Ey:r.depthFunc(513);break;case wc:r.depthFunc(515);break;case Ay:r.depthFunc(514);break;case Ly:r.depthFunc(518);break;case Cy:r.depthFunc(516);break;case Ry:r.depthFunc(517);break;default:r.depthFunc(515)}else r.depthFunc(515);z=ve}},setLocked:function(ve){Y=ve},setClear:function(ve){ne!==ve&&(r.clearDepth(ve),ne=ve)},reset:function(){Y=!1,ke=null,z=null,ne=null}}}function h(){let Y=!1,ke=null,z=null,ne=null,ve=null,Te=null,Ne=null,xe=null,wt=null;return{setTest:function(st){Y||(st?Pe(2960):ze(2960))},setMask:function(st){ke!==st&&!Y&&(r.stencilMask(st),ke=st)},setFunc:function(st,Ve,ft){(z!==st||ne!==Ve||ve!==ft)&&(r.stencilFunc(st,Ve,ft),z=st,ne=Ve,ve=ft)},setOp:function(st,Ve,ft){(Te!==st||Ne!==Ve||xe!==ft)&&(r.stencilOp(st,Ve,ft),Te=st,Ne=Ve,xe=ft)},setLocked:function(st){Y=st},setClear:function(st){wt!==st&&(r.clearStencil(st),wt=st)},reset:function(){Y=!1,ke=null,z=null,ne=null,ve=null,Te=null,Ne=null,xe=null,wt=null}}}const f=new a,p=new o,d=new h;let g={},y={},x=null,_=!1,T=null,L=null,P=null,M=null,w=null,N=null,C=null,k=!1,q=null,R=null,J=null,oe=null,Q=null;const X=r.getParameter(35661);let Se=!1,H=0;const W=r.getParameter(7938);W.indexOf("WebGL")!==-1?(H=parseFloat(/^WebGL (\d)/.exec(W)[1]),Se=H>=1):W.indexOf("OpenGL ES")!==-1&&(H=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]),Se=H>=2);let D=null,ee={};const te=r.getParameter(3088),Me=r.getParameter(2978),Oe=new Rt().fromArray(te),ce=new Rt().fromArray(Me);function ue(Y,ke,z){const ne=new Uint8Array(4),ve=r.createTexture();r.bindTexture(Y,ve),r.texParameteri(Y,10241,9728),r.texParameteri(Y,10240,9728);for(let Te=0;Te<z;Te++)r.texImage2D(ke+Te,0,6408,1,1,0,6408,5121,ne);return ve}const We={};We[3553]=ue(3553,3553,1),We[34067]=ue(34067,34069,6),f.setClear(0,0,0,1),p.setClear(1),d.setClear(0),Pe(2929),p.setFunc(wc),Ze(!1),se(pp),Pe(2884),Ee($i);function Pe(Y){g[Y]!==!0&&(r.enable(Y),g[Y]=!0)}function ze(Y){g[Y]!==!1&&(r.disable(Y),g[Y]=!1)}function $e(Y,ke){return y[Y]!==ke?(r.bindFramebuffer(Y,ke),y[Y]=ke,i&&(Y===36009&&(y[36160]=ke),Y===36160&&(y[36009]=ke)),!0):!1}function K(Y){return x!==Y?(r.useProgram(Y),x=Y,!0):!1}const Ae={[Ms]:32774,[dy]:32778,[py]:32779};if(i)Ae[_p]=32775,Ae[bp]=32776;else{const Y=e.get("EXT_blend_minmax");Y!==null&&(Ae[_p]=Y.MIN_EXT,Ae[bp]=Y.MAX_EXT)}const Re={[my]:0,[gy]:1,[vy]:768,[wp]:770,[My]:776,[by]:774,[yy]:772,[xy]:769,[Mp]:771,[wy]:775,[_y]:773};function Ee(Y,ke,z,ne,ve,Te,Ne,xe){if(Y===$i){_===!0&&(ze(3042),_=!1);return}if(_===!1&&(Pe(3042),_=!0),Y!==fy){if(Y!==T||xe!==k){if((L!==Ms||w!==Ms)&&(r.blendEquation(32774),L=Ms,w=Ms),xe)switch(Y){case Ga:r.blendFuncSeparate(1,771,1,771);break;case vp:r.blendFunc(1,1);break;case xp:r.blendFuncSeparate(0,0,769,771);break;case yp:r.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}else switch(Y){case Ga:r.blendFuncSeparate(770,771,1,771);break;case vp:r.blendFunc(770,1);break;case xp:r.blendFunc(0,769);break;case yp:r.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}P=null,M=null,N=null,C=null,T=Y,k=xe}return}ve=ve||ke,Te=Te||z,Ne=Ne||ne,(ke!==L||ve!==w)&&(r.blendEquationSeparate(Ae[ke],Ae[ve]),L=ke,w=ve),(z!==P||ne!==M||Te!==N||Ne!==C)&&(r.blendFuncSeparate(Re[z],Re[ne],Re[Te],Re[Ne]),P=z,M=ne,N=Te,C=Ne),T=Y,k=null}function Je(Y,ke){Y.side===ws?ze(2884):Pe(2884);let z=Y.side===nn;ke&&(z=!z),Ze(z),Y.blending===Ga&&Y.transparent===!1?Ee($i):Ee(Y.blending,Y.blendEquation,Y.blendSrc,Y.blendDst,Y.blendEquationAlpha,Y.blendSrcAlpha,Y.blendDstAlpha,Y.premultipliedAlpha),p.setFunc(Y.depthFunc),p.setTest(Y.depthTest),p.setMask(Y.depthWrite),f.setMask(Y.colorWrite);const ne=Y.stencilWrite;d.setTest(ne),ne&&(d.setMask(Y.stencilWriteMask),d.setFunc(Y.stencilFunc,Y.stencilRef,Y.stencilFuncMask),d.setOp(Y.stencilFail,Y.stencilZFail,Y.stencilZPass)),Le(Y.polygonOffset,Y.polygonOffsetFactor,Y.polygonOffsetUnits),Y.alphaToCoverage===!0?Pe(32926):ze(32926)}function Ze(Y){q!==Y&&(Y?r.frontFace(2304):r.frontFace(2305),q=Y)}function se(Y){Y!==uy?(Pe(2884),Y!==R&&(Y===pp?r.cullFace(1029):Y===cy?r.cullFace(1028):r.cullFace(1032))):ze(2884),R=Y}function be(Y){Y!==J&&(Se&&r.lineWidth(Y),J=Y)}function Le(Y,ke,z){Y?(Pe(32823),(oe!==ke||Q!==z)&&(r.polygonOffset(ke,z),oe=ke,Q=z)):ze(32823)}function me(Y){Y?Pe(3089):ze(3089)}function Ce(Y){Y===void 0&&(Y=33984+X-1),D!==Y&&(r.activeTexture(Y),D=Y)}function tt(Y,ke){D===null&&Ce();let z=ee[D];z===void 0&&(z={type:void 0,texture:void 0},ee[D]=z),(z.type!==Y||z.texture!==ke)&&(r.bindTexture(Y,ke||We[Y]),z.type=Y,z.texture=ke)}function rt(){const Y=ee[D];Y!==void 0&&Y.type!==void 0&&(r.bindTexture(Y.type,null),Y.type=void 0,Y.texture=void 0)}function ht(){try{r.compressedTexImage2D.apply(r,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function bt(){try{r.texSubImage2D.apply(r,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function G(){try{r.texStorage2D.apply(r,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function O(){try{r.texImage2D.apply(r,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function pe(){try{r.texImage3D.apply(r,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function de(Y){Oe.equals(Y)===!1&&(r.scissor(Y.x,Y.y,Y.z,Y.w),Oe.copy(Y))}function qe(Y){ce.equals(Y)===!1&&(r.viewport(Y.x,Y.y,Y.z,Y.w),ce.copy(Y))}function Xe(){r.disable(3042),r.disable(2884),r.disable(2929),r.disable(32823),r.disable(3089),r.disable(2960),r.disable(32926),r.blendEquation(32774),r.blendFunc(1,0),r.blendFuncSeparate(1,0,1,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(513),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(519,0,4294967295),r.stencilOp(7680,7680,7680),r.clearStencil(0),r.cullFace(1029),r.frontFace(2305),r.polygonOffset(0,0),r.activeTexture(33984),r.bindFramebuffer(36160,null),i===!0&&(r.bindFramebuffer(36009,null),r.bindFramebuffer(36008,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),g={},D=null,ee={},y={},x=null,_=!1,T=null,L=null,P=null,M=null,w=null,N=null,C=null,k=!1,q=null,R=null,J=null,oe=null,Q=null,Oe.set(0,0,r.canvas.width,r.canvas.height),ce.set(0,0,r.canvas.width,r.canvas.height),f.reset(),p.reset(),d.reset()}return{buffers:{color:f,depth:p,stencil:d},enable:Pe,disable:ze,bindFramebuffer:$e,useProgram:K,setBlending:Ee,setMaterial:Je,setFlipSided:Ze,setCullFace:se,setLineWidth:be,setPolygonOffset:Le,setScissorTest:me,activeTexture:Ce,bindTexture:tt,unbindTexture:rt,compressedTexImage2D:ht,texImage2D:O,texImage3D:pe,texStorage2D:G,texSubImage2D:bt,scissor:de,viewport:qe,reset:Xe}}function L1(r,e,t,i,a,o,h){const f=a.isWebGL2,p=a.maxTextures,d=a.maxCubemapSize,g=a.maxTextureSize,y=a.maxSamples,_=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):void 0,T=new WeakMap;let L,P=!1;try{P=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function M(G,O){return P?new OffscreenCanvas(G,O):Sl("canvas")}function w(G,O,pe,de){let qe=1;if((G.width>de||G.height>de)&&(qe=de/Math.max(G.width,G.height)),qe<1||O===!0)if(typeof HTMLImageElement!="undefined"&&G instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&G instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&G instanceof ImageBitmap){const Xe=O?Wp:Math.floor,Y=Xe(qe*G.width),ke=Xe(qe*G.height);L===void 0&&(L=M(Y,ke));const z=pe?M(Y,ke):L;return z.width=Y,z.height=ke,z.getContext("2d").drawImage(G,0,0,Y,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+G.width+"x"+G.height+") to ("+Y+"x"+ke+")."),z}else return"data"in G&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+G.width+"x"+G.height+")."),G;return G}function N(G){return kc(G.width)&&kc(G.height)}function C(G){return f?!1:G.wrapS!==Zn||G.wrapT!==Zn||G.minFilter!==un&&G.minFilter!==Jn}function k(G,O){return G.generateMipmaps&&O&&G.minFilter!==un&&G.minFilter!==Jn}function q(G){r.generateMipmap(G)}function R(G,O,pe){if(f===!1)return O;if(G!==null){if(r[G]!==void 0)return r[G];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+G+"'")}let de=O;return O===6403&&(pe===5126&&(de=33326),pe===5131&&(de=33325),pe===5121&&(de=33321)),O===6407&&(pe===5126&&(de=34837),pe===5131&&(de=34843),pe===5121&&(de=32849)),O===6408&&(pe===5126&&(de=34836),pe===5131&&(de=34842),pe===5121&&(de=32856)),(de===33325||de===33326||de===34842||de===34836)&&e.get("EXT_color_buffer_float"),de}function J(G,O,pe){return k(G,pe)===!0?Math.log2(Math.max(O.width,O.height))+1:G.mipmaps.length>0?G.mipmaps.length:1}function oe(G){return G===un||G===Tp||G===Ep?9728:9729}function Q(G){const O=G.target;O.removeEventListener("dispose",Q),Se(O),O.isVideoTexture&&T.delete(O),h.memory.textures--}function X(G){const O=G.target;O.removeEventListener("dispose",X),H(O)}function Se(G){const O=i.get(G);O.__webglInit!==void 0&&(r.deleteTexture(O.__webglTexture),i.remove(G))}function H(G){const O=G.texture,pe=i.get(G),de=i.get(O);if(!!G){if(de.__webglTexture!==void 0&&(r.deleteTexture(de.__webglTexture),h.memory.textures--),G.depthTexture&&G.depthTexture.dispose(),G.isWebGLCubeRenderTarget)for(let qe=0;qe<6;qe++)r.deleteFramebuffer(pe.__webglFramebuffer[qe]),pe.__webglDepthbuffer&&r.deleteRenderbuffer(pe.__webglDepthbuffer[qe]);else r.deleteFramebuffer(pe.__webglFramebuffer),pe.__webglDepthbuffer&&r.deleteRenderbuffer(pe.__webglDepthbuffer),pe.__webglMultisampledFramebuffer&&r.deleteFramebuffer(pe.__webglMultisampledFramebuffer),pe.__webglColorRenderbuffer&&r.deleteRenderbuffer(pe.__webglColorRenderbuffer),pe.__webglDepthRenderbuffer&&r.deleteRenderbuffer(pe.__webglDepthRenderbuffer);if(G.isWebGLMultipleRenderTargets)for(let qe=0,Xe=O.length;qe<Xe;qe++){const Y=i.get(O[qe]);Y.__webglTexture&&(r.deleteTexture(Y.__webglTexture),h.memory.textures--),i.remove(O[qe])}i.remove(O),i.remove(G)}}let W=0;function D(){W=0}function ee(){const G=W;return G>=p&&console.warn("THREE.WebGLTextures: Trying to use "+G+" texture units while this GPU supports only "+p),W+=1,G}function te(G,O){const pe=i.get(G);if(G.isVideoTexture&&Ce(G),G.version>0&&pe.__version!==G.version){const de=G.image;if(de===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(de.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{$e(pe,G,O);return}}t.activeTexture(33984+O),t.bindTexture(3553,pe.__webglTexture)}function Me(G,O){const pe=i.get(G);if(G.version>0&&pe.__version!==G.version){$e(pe,G,O);return}t.activeTexture(33984+O),t.bindTexture(35866,pe.__webglTexture)}function Oe(G,O){const pe=i.get(G);if(G.version>0&&pe.__version!==G.version){$e(pe,G,O);return}t.activeTexture(33984+O),t.bindTexture(32879,pe.__webglTexture)}function ce(G,O){const pe=i.get(G);if(G.version>0&&pe.__version!==G.version){K(pe,G,O);return}t.activeTexture(33984+O),t.bindTexture(34067,pe.__webglTexture)}const ue={[Ec]:10497,[Zn]:33071,[Ac]:33648},We={[un]:9728,[Tp]:9984,[Ep]:9986,[Jn]:9729,[zy]:9985,[gl]:9987};function Pe(G,O,pe){if(pe?(r.texParameteri(G,10242,ue[O.wrapS]),r.texParameteri(G,10243,ue[O.wrapT]),(G===32879||G===35866)&&r.texParameteri(G,32882,ue[O.wrapR]),r.texParameteri(G,10240,We[O.magFilter]),r.texParameteri(G,10241,We[O.minFilter])):(r.texParameteri(G,10242,33071),r.texParameteri(G,10243,33071),(G===32879||G===35866)&&r.texParameteri(G,32882,33071),(O.wrapS!==Zn||O.wrapT!==Zn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(G,10240,oe(O.magFilter)),r.texParameteri(G,10241,oe(O.minFilter)),O.minFilter!==un&&O.minFilter!==Jn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const de=e.get("EXT_texture_filter_anisotropic");if(O.type===tr&&e.has("OES_texture_float_linear")===!1||f===!1&&O.type===Ss&&e.has("OES_texture_half_float_linear")===!1)return;(O.anisotropy>1||i.get(O).__currentAnisotropy)&&(r.texParameterf(G,de.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,a.getMaxAnisotropy())),i.get(O).__currentAnisotropy=O.anisotropy)}}function ze(G,O){G.__webglInit===void 0&&(G.__webglInit=!0,O.addEventListener("dispose",Q),G.__webglTexture=r.createTexture(),h.memory.textures++)}function $e(G,O,pe){let de=3553;O.isDataTexture2DArray&&(de=35866),O.isDataTexture3D&&(de=32879),ze(G,O),t.activeTexture(33984+pe),t.bindTexture(de,G.__webglTexture),r.pixelStorei(37440,O.flipY),r.pixelStorei(37441,O.premultiplyAlpha),r.pixelStorei(3317,O.unpackAlignment),r.pixelStorei(37443,0);const qe=C(O)&&N(O.image)===!1,Xe=w(O.image,qe,!1,g),Y=N(Xe)||f,ke=o.convert(O.format);let z=o.convert(O.type),ne=R(O.internalFormat,ke,z,O.encoding);Pe(de,O,Y);let ve;const Te=O.mipmaps;if(O.isDepthTexture)ne=6402,f?O.type===tr?ne=36012:O.type===vl?ne=33190:O.type===Ts?ne=35056:ne=33189:O.type===tr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),O.format===Or&&ne===6402&&O.type!==Za&&O.type!==vl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),O.type=Za,z=o.convert(O.type)),O.format===Es&&ne===6402&&(ne=34041,O.type!==Ts&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),O.type=Ts,z=o.convert(O.type))),t.texImage2D(3553,0,ne,Xe.width,Xe.height,0,ke,z,null);else if(O.isDataTexture)if(Te.length>0&&Y){for(let Ne=0,xe=Te.length;Ne<xe;Ne++)ve=Te[Ne],t.texImage2D(3553,Ne,ne,ve.width,ve.height,0,ke,z,ve.data);O.generateMipmaps=!1}else t.texImage2D(3553,0,ne,Xe.width,Xe.height,0,ke,z,Xe.data);else if(O.isCompressedTexture)for(let Ne=0,xe=Te.length;Ne<xe;Ne++)ve=Te[Ne],O.format!==In&&O.format!==Fr?ke!==null?t.compressedTexImage2D(3553,Ne,ne,ve.width,ve.height,0,ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,Ne,ne,ve.width,ve.height,0,ke,z,ve.data);else if(O.isDataTexture2DArray)t.texImage3D(35866,0,ne,Xe.width,Xe.height,Xe.depth,0,ke,z,Xe.data);else if(O.isDataTexture3D)t.texImage3D(32879,0,ne,Xe.width,Xe.height,Xe.depth,0,ke,z,Xe.data);else{const Ne=J(O,Xe,Y),xe=f&&O.isVideoTexture!==!0,wt=G.__version===void 0;if(Te.length>0&&Y){xe&&wt&&t.texStorage2D(3553,Ne,ne,Te[0].width,Te[0].height);for(let st=0,Ve=Te.length;st<Ve;st++)ve=Te[st],xe?t.texSubImage2D(3553,st,0,0,ke,z,ve):t.texImage2D(3553,st,ne,ke,z,ve);O.generateMipmaps=!1}else xe?(wt&&t.texStorage2D(3553,Ne,ne,Xe.width,Xe.height),t.texSubImage2D(3553,0,0,0,ke,z,Xe)):t.texImage2D(3553,0,ne,ke,z,Xe)}k(O,Y)&&q(de),G.__version=O.version,O.onUpdate&&O.onUpdate(O)}function K(G,O,pe){if(O.image.length!==6)return;ze(G,O),t.activeTexture(33984+pe),t.bindTexture(34067,G.__webglTexture),r.pixelStorei(37440,O.flipY),r.pixelStorei(37441,O.premultiplyAlpha),r.pixelStorei(3317,O.unpackAlignment),r.pixelStorei(37443,0);const de=O&&(O.isCompressedTexture||O.image[0].isCompressedTexture),qe=O.image[0]&&O.image[0].isDataTexture,Xe=[];for(let Ne=0;Ne<6;Ne++)!de&&!qe?Xe[Ne]=w(O.image[Ne],!1,!0,d):Xe[Ne]=qe?O.image[Ne].image:O.image[Ne];const Y=Xe[0],ke=N(Y)||f,z=o.convert(O.format),ne=o.convert(O.type),ve=R(O.internalFormat,z,ne,O.encoding);Pe(34067,O,ke);let Te;if(de)for(let Ne=0;Ne<6;Ne++){Te=Xe[Ne].mipmaps;for(let xe=0;xe<Te.length;xe++){const wt=Te[xe];O.format!==In&&O.format!==Fr?z!==null?t.compressedTexImage2D(34069+Ne,xe,ve,wt.width,wt.height,0,wt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+Ne,xe,ve,wt.width,wt.height,0,z,ne,wt.data)}}else{Te=O.mipmaps;for(let Ne=0;Ne<6;Ne++)if(qe){t.texImage2D(34069+Ne,0,ve,Xe[Ne].width,Xe[Ne].height,0,z,ne,Xe[Ne].data);for(let xe=0;xe<Te.length;xe++){const st=Te[xe].image[Ne].image;t.texImage2D(34069+Ne,xe+1,ve,st.width,st.height,0,z,ne,st.data)}}else{t.texImage2D(34069+Ne,0,ve,z,ne,Xe[Ne]);for(let xe=0;xe<Te.length;xe++){const wt=Te[xe];t.texImage2D(34069+Ne,xe+1,ve,z,ne,wt.image[Ne])}}}k(O,ke)&&q(34067),G.__version=O.version,O.onUpdate&&O.onUpdate(O)}function Ae(G,O,pe,de,qe){const Xe=o.convert(pe.format),Y=o.convert(pe.type),ke=R(pe.internalFormat,Xe,Y,pe.encoding);i.get(O).__hasExternalTextures||(qe===32879||qe===35866?t.texImage3D(qe,0,ke,O.width,O.height,O.depth,0,Xe,Y,null):t.texImage2D(qe,0,ke,O.width,O.height,0,Xe,Y,null)),t.bindFramebuffer(36160,G),O.useRenderToTexture?_.framebufferTexture2DMultisampleEXT(36160,de,qe,i.get(pe).__webglTexture,0,me(O)):r.framebufferTexture2D(36160,de,qe,i.get(pe).__webglTexture,0),t.bindFramebuffer(36160,null)}function Re(G,O,pe){if(r.bindRenderbuffer(36161,G),O.depthBuffer&&!O.stencilBuffer){let de=33189;if(pe||O.useRenderToTexture){const qe=O.depthTexture;qe&&qe.isDepthTexture&&(qe.type===tr?de=36012:qe.type===vl&&(de=33190));const Xe=me(O);O.useRenderToTexture?_.renderbufferStorageMultisampleEXT(36161,Xe,de,O.width,O.height):r.renderbufferStorageMultisample(36161,Xe,de,O.width,O.height)}else r.renderbufferStorage(36161,de,O.width,O.height);r.framebufferRenderbuffer(36160,36096,36161,G)}else if(O.depthBuffer&&O.stencilBuffer){const de=me(O);pe&&O.useRenderbuffer?r.renderbufferStorageMultisample(36161,de,35056,O.width,O.height):O.useRenderToTexture?_.renderbufferStorageMultisampleEXT(36161,de,35056,O.width,O.height):r.renderbufferStorage(36161,34041,O.width,O.height),r.framebufferRenderbuffer(36160,33306,36161,G)}else{const de=O.isWebGLMultipleRenderTargets===!0?O.texture[0]:O.texture,qe=o.convert(de.format),Xe=o.convert(de.type),Y=R(de.internalFormat,qe,Xe,de.encoding),ke=me(O);pe&&O.useRenderbuffer?r.renderbufferStorageMultisample(36161,ke,Y,O.width,O.height):O.useRenderToTexture?_.renderbufferStorageMultisampleEXT(36161,ke,Y,O.width,O.height):r.renderbufferStorage(36161,Y,O.width,O.height)}r.bindRenderbuffer(36161,null)}function Ee(G,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,G),!(O.depthTexture&&O.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(O.depthTexture).__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),te(O.depthTexture,0);const de=i.get(O.depthTexture).__webglTexture,qe=me(O);if(O.depthTexture.format===Or)O.useRenderToTexture?_.framebufferTexture2DMultisampleEXT(36160,36096,3553,de,0,qe):r.framebufferTexture2D(36160,36096,3553,de,0);else if(O.depthTexture.format===Es)O.useRenderToTexture?_.framebufferTexture2DMultisampleEXT(36160,33306,3553,de,0,qe):r.framebufferTexture2D(36160,33306,3553,de,0);else throw new Error("Unknown depthTexture format")}function Je(G){const O=i.get(G),pe=G.isWebGLCubeRenderTarget===!0;if(G.depthTexture&&!O.__autoAllocateDepthBuffer){if(pe)throw new Error("target.depthTexture not supported in Cube render targets");Ee(O.__webglFramebuffer,G)}else if(pe){O.__webglDepthbuffer=[];for(let de=0;de<6;de++)t.bindFramebuffer(36160,O.__webglFramebuffer[de]),O.__webglDepthbuffer[de]=r.createRenderbuffer(),Re(O.__webglDepthbuffer[de],G,!1)}else t.bindFramebuffer(36160,O.__webglFramebuffer),O.__webglDepthbuffer=r.createRenderbuffer(),Re(O.__webglDepthbuffer,G,!1);t.bindFramebuffer(36160,null)}function Ze(G,O,pe){const de=i.get(G);O!==void 0&&Ae(de.__webglFramebuffer,G,G.texture,36064,3553),pe!==void 0&&Je(G)}function se(G){const O=G.texture,pe=i.get(G),de=i.get(O);G.addEventListener("dispose",X),G.isWebGLMultipleRenderTargets!==!0&&(de.__webglTexture===void 0&&(de.__webglTexture=r.createTexture()),de.__version=O.version,h.memory.textures++);const qe=G.isWebGLCubeRenderTarget===!0,Xe=G.isWebGLMultipleRenderTargets===!0,Y=O.isDataTexture3D||O.isDataTexture2DArray,ke=N(G)||f;if(f&&O.format===Fr&&(O.type===tr||O.type===Ss)&&(O.format=In,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),qe){pe.__webglFramebuffer=[];for(let z=0;z<6;z++)pe.__webglFramebuffer[z]=r.createFramebuffer()}else if(pe.__webglFramebuffer=r.createFramebuffer(),Xe)if(a.drawBuffers){const z=G.texture;for(let ne=0,ve=z.length;ne<ve;ne++){const Te=i.get(z[ne]);Te.__webglTexture===void 0&&(Te.__webglTexture=r.createTexture(),h.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(G.useRenderbuffer)if(f){pe.__webglMultisampledFramebuffer=r.createFramebuffer(),pe.__webglColorRenderbuffer=r.createRenderbuffer(),r.bindRenderbuffer(36161,pe.__webglColorRenderbuffer);const z=o.convert(O.format),ne=o.convert(O.type),ve=R(O.internalFormat,z,ne,O.encoding),Te=me(G);r.renderbufferStorageMultisample(36161,Te,ve,G.width,G.height),t.bindFramebuffer(36160,pe.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(36160,36064,36161,pe.__webglColorRenderbuffer),r.bindRenderbuffer(36161,null),G.depthBuffer&&(pe.__webglDepthRenderbuffer=r.createRenderbuffer(),Re(pe.__webglDepthRenderbuffer,G,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(qe){t.bindTexture(34067,de.__webglTexture),Pe(34067,O,ke);for(let z=0;z<6;z++)Ae(pe.__webglFramebuffer[z],G,O,36064,34069+z);k(O,ke)&&q(34067),t.unbindTexture()}else if(Xe){const z=G.texture;for(let ne=0,ve=z.length;ne<ve;ne++){const Te=z[ne],Ne=i.get(Te);t.bindTexture(3553,Ne.__webglTexture),Pe(3553,Te,ke),Ae(pe.__webglFramebuffer,G,Te,36064+ne,3553),k(Te,ke)&&q(3553)}t.unbindTexture()}else{let z=3553;Y&&(f?z=O.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(z,de.__webglTexture),Pe(z,O,ke),Ae(pe.__webglFramebuffer,G,O,36064,z),k(O,ke)&&q(z),t.unbindTexture()}G.depthBuffer&&Je(G)}function be(G){const O=N(G)||f,pe=G.isWebGLMultipleRenderTargets===!0?G.texture:[G.texture];for(let de=0,qe=pe.length;de<qe;de++){const Xe=pe[de];if(k(Xe,O)){const Y=G.isWebGLCubeRenderTarget?34067:3553,ke=i.get(Xe).__webglTexture;t.bindTexture(Y,ke),q(Y),t.unbindTexture()}}}function Le(G){if(G.useRenderbuffer)if(f){const O=G.width,pe=G.height;let de=16384;const qe=[36064],Xe=G.stencilBuffer?33306:36096;G.depthBuffer&&qe.push(Xe),G.ignoreDepthForMultisampleCopy||(G.depthBuffer&&(de|=256),G.stencilBuffer&&(de|=1024));const Y=i.get(G);t.bindFramebuffer(36008,Y.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Y.__webglFramebuffer),G.ignoreDepthForMultisampleCopy&&(r.invalidateFramebuffer(36008,[Xe]),r.invalidateFramebuffer(36009,[Xe])),r.blitFramebuffer(0,0,O,pe,0,0,O,pe,de,9728),r.invalidateFramebuffer(36008,qe),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Y.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function me(G){return f&&(G.useRenderbuffer||G.useRenderToTexture)?Math.min(y,G.samples):0}function Ce(G){const O=h.render.frame;T.get(G)!==O&&(T.set(G,O),G.update())}let tt=!1,rt=!1;function ht(G,O){G&&G.isWebGLRenderTarget&&(tt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),tt=!0),G=G.texture),te(G,O)}function bt(G,O){G&&G.isWebGLCubeRenderTarget&&(rt===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),rt=!0),G=G.texture),ce(G,O)}this.allocateTextureUnit=ee,this.resetTextureUnits=D,this.setTexture2D=te,this.setTexture2DArray=Me,this.setTexture3D=Oe,this.setTextureCube=ce,this.rebindTextures=Ze,this.setupRenderTarget=se,this.updateRenderTargetMipmap=be,this.updateMultisampleRenderTarget=Le,this.setupDepthRenderbuffer=Je,this.setupFrameBufferTexture=Ae,this.safeSetTexture2D=ht,this.safeSetTextureCube=bt}function C1(r,e,t){const i=t.isWebGL2;function a(o){let h;if(o===er)return 5121;if(o===Wy)return 32819;if(o===Gy)return 32820;if(o===Vy)return 33635;if(o===By)return 5120;if(o===Hy)return 5122;if(o===Za)return 5123;if(o===Uy)return 5124;if(o===vl)return 5125;if(o===tr)return 5126;if(o===Ss)return i?5131:(h=e.get("OES_texture_half_float"),h!==null?h.HALF_FLOAT_OES:null);if(o===Xy)return 6406;if(o===Fr)return 6407;if(o===In)return 6408;if(o===Zy)return 6409;if(o===qy)return 6410;if(o===Or)return 6402;if(o===Es)return 34041;if(o===jy)return 6403;if(o===Jy)return 36244;if(o===Ky)return 33319;if(o===Qy)return 33320;if(o===$y)return 36248;if(o===e_)return 36249;if(o===Ap||o===Lp||o===Cp||o===Rp)if(h=e.get("WEBGL_compressed_texture_s3tc"),h!==null){if(o===Ap)return h.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===Lp)return h.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===Cp)return h.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===Rp)return h.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===Pp||o===Dp||o===Ip||o===kp)if(h=e.get("WEBGL_compressed_texture_pvrtc"),h!==null){if(o===Pp)return h.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===Dp)return h.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===Ip)return h.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===kp)return h.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===t_)return h=e.get("WEBGL_compressed_texture_etc1"),h!==null?h.COMPRESSED_RGB_ETC1_WEBGL:null;if((o===Np||o===Fp)&&(h=e.get("WEBGL_compressed_texture_etc"),h!==null)){if(o===Np)return h.COMPRESSED_RGB8_ETC2;if(o===Fp)return h.COMPRESSED_RGBA8_ETC2_EAC}if(o===n_||o===i_||o===r_||o===s_||o===a_||o===o_||o===l_||o===u_||o===c_||o===h_||o===f_||o===d_||o===p_||o===m_||o===v_||o===x_||o===y_||o===__||o===b_||o===w_||o===M_||o===S_||o===T_||o===E_||o===A_||o===L_||o===C_||o===R_)return h=e.get("WEBGL_compressed_texture_astc"),h!==null?o:null;if(o===g_)return h=e.get("EXT_texture_compression_bptc"),h!==null?o:null;if(o===Ts)return i?34042:(h=e.get("WEBGL_depth_texture"),h!==null?h.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:a}}class Gm extends Bn{constructor(e=[]){super();this.cameras=e}}Gm.prototype.isArrayCamera=!0;class ro extends Et{constructor(){super();this.type="Group"}}ro.prototype.isGroup=!0;const R1={type:"move"};class vh{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ro,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ro,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new V,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new V),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ro,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new V,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new V),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let a=null,o=null,h=null;const f=this._targetRay,p=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(f!==null&&(a=t.getPose(e.targetRaySpace,i),a!==null&&(f.matrix.fromArray(a.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),a.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(a.linearVelocity)):f.hasLinearVelocity=!1,a.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(a.angularVelocity)):f.hasAngularVelocity=!1,this.dispatchEvent(R1))),d&&e.hand){h=!0;for(const L of e.hand.values()){const P=t.getJointPose(L,i);if(d.joints[L.jointName]===void 0){const w=new ro;w.matrixAutoUpdate=!1,w.visible=!1,d.joints[L.jointName]=w,d.add(w)}const M=d.joints[L.jointName];P!==null&&(M.matrix.fromArray(P.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.jointRadius=P.radius),M.visible=P!==null}const g=d.joints["index-finger-tip"],y=d.joints["thumb-tip"],x=g.position.distanceTo(y.position),_=.02,T=.005;d.inputState.pinching&&x>_+T?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&x<=_-T&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else p!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),o!==null&&(p.matrix.fromArray(o.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),o.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(o.linearVelocity)):p.hasLinearVelocity=!1,o.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(o.angularVelocity)):p.hasAngularVelocity=!1));return f!==null&&(f.visible=a!==null),p!==null&&(p.visible=o!==null),d!==null&&(d.visible=h!==null),this}}class xh extends vn{constructor(e,t,i,a,o,h,f,p,d,g){if(g=g!==void 0?g:Or,g!==Or&&g!==Es)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&g===Or&&(i=Za),i===void 0&&g===Es&&(i=Ts);super(null,a,o,h,f,p,g,i,d);this.image={width:e,height:t},this.magFilter=f!==void 0?f:un,this.minFilter=p!==void 0?p:un,this.flipY=!1,this.generateMipmaps=!1}}xh.prototype.isDepthTexture=!0;class P1 extends nr{constructor(e,t){super();const i=this;let a=null,o=1,h=null,f="local-floor";const p=e.extensions.has("WEBGL_multisampled_render_to_texture");let d=null,g=null,y=null,x=null,_=!1,T=null;const L=t.getContextAttributes();let P=null,M=null;const w=[],N=new Map,C=new Bn;C.layers.enable(1),C.viewport=new Rt;const k=new Bn;k.layers.enable(2),k.viewport=new Rt;const q=[C,k],R=new Gm;R.layers.enable(1),R.layers.enable(2);let J=null,oe=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ce){let ue=w[ce];return ue===void 0&&(ue=new vh,w[ce]=ue),ue.getTargetRaySpace()},this.getControllerGrip=function(ce){let ue=w[ce];return ue===void 0&&(ue=new vh,w[ce]=ue),ue.getGripSpace()},this.getHand=function(ce){let ue=w[ce];return ue===void 0&&(ue=new vh,w[ce]=ue),ue.getHandSpace()};function Q(ce){const ue=N.get(ce.inputSource);ue&&ue.dispatchEvent({type:ce.type,data:ce.inputSource})}function X(){N.forEach(function(ce,ue){ce.disconnect(ue)}),N.clear(),J=null,oe=null,e.setRenderTarget(P),x=null,y=null,g=null,a=null,M=null,Oe.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ce){o=ce,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ce){f=ce,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h},this.getBaseLayer=function(){return y!==null?y:x},this.getBinding=function(){return g},this.getFrame=function(){return T},this.getSession=function(){return a},this.setSession=async function(ce){if(a=ce,a!==null){if(P=e.getRenderTarget(),a.addEventListener("select",Q),a.addEventListener("selectstart",Q),a.addEventListener("selectend",Q),a.addEventListener("squeeze",Q),a.addEventListener("squeezestart",Q),a.addEventListener("squeezeend",Q),a.addEventListener("end",X),a.addEventListener("inputsourceschange",Se),L.xrCompatible!==!0&&await t.makeXRCompatible(),a.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ue={antialias:a.renderState.layers===void 0?L.antialias:!0,alpha:L.alpha,depth:L.depth,stencil:L.stencil,framebufferScaleFactor:o};x=new XRWebGLLayer(a,t,ue),a.updateRenderState({baseLayer:x}),M=new Kn(x.framebufferWidth,x.framebufferHeight)}else{_=L.antialias;let ue=null,We=null,Pe=null;L.depth&&(Pe=L.stencil?35056:33189,ue=L.stencil?Es:Or,We=L.stencil?Ts:Za);const ze={colorFormat:L.alpha||_?32856:32849,depthFormat:Pe,scaleFactor:o};g=new XRWebGLBinding(a,t),y=g.createProjectionLayer(ze),a.updateRenderState({layers:[y]}),_?M=new Fc(y.textureWidth,y.textureHeight,{format:In,type:er,depthTexture:new xh(y.textureWidth,y.textureHeight,We,void 0,void 0,void 0,void 0,void 0,void 0,ue),stencilBuffer:L.stencil,ignoreDepth:y.ignoreDepthValues,useRenderToTexture:p}):M=new Kn(y.textureWidth,y.textureHeight,{format:L.alpha?In:Fr,type:er,depthTexture:new xh(y.textureWidth,y.textureHeight,We,void 0,void 0,void 0,void 0,void 0,void 0,ue),stencilBuffer:L.stencil,ignoreDepth:y.ignoreDepthValues})}this.setFoveation(0),h=await a.requestReferenceSpace(f),Oe.setContext(a),Oe.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function Se(ce){const ue=a.inputSources;for(let We=0;We<w.length;We++)N.set(ue[We],w[We]);for(let We=0;We<ce.removed.length;We++){const Pe=ce.removed[We],ze=N.get(Pe);ze&&(ze.dispatchEvent({type:"disconnected",data:Pe}),N.delete(Pe))}for(let We=0;We<ce.added.length;We++){const Pe=ce.added[We],ze=N.get(Pe);ze&&ze.dispatchEvent({type:"connected",data:Pe})}}const H=new V,W=new V;function D(ce,ue,We){H.setFromMatrixPosition(ue.matrixWorld),W.setFromMatrixPosition(We.matrixWorld);const Pe=H.distanceTo(W),ze=ue.projectionMatrix.elements,$e=We.projectionMatrix.elements,K=ze[14]/(ze[10]-1),Ae=ze[14]/(ze[10]+1),Re=(ze[9]+1)/ze[5],Ee=(ze[9]-1)/ze[5],Je=(ze[8]-1)/ze[0],Ze=($e[8]+1)/$e[0],se=K*Je,be=K*Ze,Le=Pe/(-Je+Ze),me=Le*-Je;ue.matrixWorld.decompose(ce.position,ce.quaternion,ce.scale),ce.translateX(me),ce.translateZ(Le),ce.matrixWorld.compose(ce.position,ce.quaternion,ce.scale),ce.matrixWorldInverse.copy(ce.matrixWorld).invert();const Ce=K+Le,tt=Ae+Le,rt=se-me,ht=be+(Pe-me),bt=Re*Ae/tt*Ce,G=Ee*Ae/tt*Ce;ce.projectionMatrix.makePerspective(rt,ht,bt,G,Ce,tt)}function ee(ce,ue){ue===null?ce.matrixWorld.copy(ce.matrix):ce.matrixWorld.multiplyMatrices(ue.matrixWorld,ce.matrix),ce.matrixWorldInverse.copy(ce.matrixWorld).invert()}this.updateCamera=function(ce){if(a===null)return;R.near=k.near=C.near=ce.near,R.far=k.far=C.far=ce.far,(J!==R.near||oe!==R.far)&&(a.updateRenderState({depthNear:R.near,depthFar:R.far}),J=R.near,oe=R.far);const ue=ce.parent,We=R.cameras;ee(R,ue);for(let ze=0;ze<We.length;ze++)ee(We[ze],ue);R.matrixWorld.decompose(R.position,R.quaternion,R.scale),ce.position.copy(R.position),ce.quaternion.copy(R.quaternion),ce.scale.copy(R.scale),ce.matrix.copy(R.matrix),ce.matrixWorld.copy(R.matrixWorld);const Pe=ce.children;for(let ze=0,$e=Pe.length;ze<$e;ze++)Pe[ze].updateMatrixWorld(!0);We.length===2?D(R,C,k):R.projectionMatrix.copy(C.projectionMatrix)},this.getCamera=function(){return R},this.getFoveation=function(){if(y!==null)return y.fixedFoveation;if(x!==null)return x.fixedFoveation},this.setFoveation=function(ce){y!==null&&(y.fixedFoveation=ce),x!==null&&x.fixedFoveation!==void 0&&(x.fixedFoveation=ce)};let te=null;function Me(ce,ue){if(d=ue.getViewerPose(h),T=ue,d!==null){const Pe=d.views;x!==null&&(e.setRenderTargetFramebuffer(M,x.framebuffer),e.setRenderTarget(M));let ze=!1;Pe.length!==R.cameras.length&&(R.cameras.length=0,ze=!0);for(let $e=0;$e<Pe.length;$e++){const K=Pe[$e];let Ae=null;if(x!==null)Ae=x.getViewport(K);else{const Ee=g.getViewSubImage(y,K);Ae=Ee.viewport,$e===0&&(e.setRenderTargetTextures(M,Ee.colorTexture,y.ignoreDepthValues?void 0:Ee.depthStencilTexture),e.setRenderTarget(M))}const Re=q[$e];Re.matrix.fromArray(K.transform.matrix),Re.projectionMatrix.fromArray(K.projectionMatrix),Re.viewport.set(Ae.x,Ae.y,Ae.width,Ae.height),$e===0&&R.matrix.copy(Re.matrix),ze===!0&&R.cameras.push(Re)}}const We=a.inputSources;for(let Pe=0;Pe<w.length;Pe++){const ze=w[Pe],$e=We[Pe];ze.update($e,ue,h)}te&&te(ce,ue),T=null}const Oe=new am;Oe.setAnimationLoop(Me),this.setAnimationLoop=function(ce){te=ce},this.dispose=function(){}}}function D1(r){function e(M,w){M.fogColor.value.copy(w.color),w.isFog?(M.fogNear.value=w.near,M.fogFar.value=w.far):w.isFogExp2&&(M.fogDensity.value=w.density)}function t(M,w,N,C,k){w.isMeshBasicMaterial?i(M,w):w.isMeshLambertMaterial?(i(M,w),p(M,w)):w.isMeshToonMaterial?(i(M,w),g(M,w)):w.isMeshPhongMaterial?(i(M,w),d(M,w)):w.isMeshStandardMaterial?(i(M,w),w.isMeshPhysicalMaterial?x(M,w,k):y(M,w)):w.isMeshMatcapMaterial?(i(M,w),_(M,w)):w.isMeshDepthMaterial?(i(M,w),T(M,w)):w.isMeshDistanceMaterial?(i(M,w),L(M,w)):w.isMeshNormalMaterial?(i(M,w),P(M,w)):w.isLineBasicMaterial?(a(M,w),w.isLineDashedMaterial&&o(M,w)):w.isPointsMaterial?h(M,w,N,C):w.isSpriteMaterial?f(M,w):w.isShadowMaterial?(M.color.value.copy(w.color),M.opacity.value=w.opacity):w.isShaderMaterial&&(w.uniformsNeedUpdate=!1)}function i(M,w){M.opacity.value=w.opacity,w.color&&M.diffuse.value.copy(w.color),w.emissive&&M.emissive.value.copy(w.emissive).multiplyScalar(w.emissiveIntensity),w.map&&(M.map.value=w.map),w.alphaMap&&(M.alphaMap.value=w.alphaMap),w.specularMap&&(M.specularMap.value=w.specularMap),w.alphaTest>0&&(M.alphaTest.value=w.alphaTest);const N=r.get(w).envMap;N&&(M.envMap.value=N,M.flipEnvMap.value=N.isCubeTexture&&N.isRenderTargetTexture===!1?-1:1,M.reflectivity.value=w.reflectivity,M.ior.value=w.ior,M.refractionRatio.value=w.refractionRatio),w.lightMap&&(M.lightMap.value=w.lightMap,M.lightMapIntensity.value=w.lightMapIntensity),w.aoMap&&(M.aoMap.value=w.aoMap,M.aoMapIntensity.value=w.aoMapIntensity);let C;w.map?C=w.map:w.specularMap?C=w.specularMap:w.displacementMap?C=w.displacementMap:w.normalMap?C=w.normalMap:w.bumpMap?C=w.bumpMap:w.roughnessMap?C=w.roughnessMap:w.metalnessMap?C=w.metalnessMap:w.alphaMap?C=w.alphaMap:w.emissiveMap?C=w.emissiveMap:w.clearcoatMap?C=w.clearcoatMap:w.clearcoatNormalMap?C=w.clearcoatNormalMap:w.clearcoatRoughnessMap?C=w.clearcoatRoughnessMap:w.specularIntensityMap?C=w.specularIntensityMap:w.specularColorMap?C=w.specularColorMap:w.transmissionMap?C=w.transmissionMap:w.thicknessMap?C=w.thicknessMap:w.sheenColorMap?C=w.sheenColorMap:w.sheenRoughnessMap&&(C=w.sheenRoughnessMap),C!==void 0&&(C.isWebGLRenderTarget&&(C=C.texture),C.matrixAutoUpdate===!0&&C.updateMatrix(),M.uvTransform.value.copy(C.matrix));let k;w.aoMap?k=w.aoMap:w.lightMap&&(k=w.lightMap),k!==void 0&&(k.isWebGLRenderTarget&&(k=k.texture),k.matrixAutoUpdate===!0&&k.updateMatrix(),M.uv2Transform.value.copy(k.matrix))}function a(M,w){M.diffuse.value.copy(w.color),M.opacity.value=w.opacity}function o(M,w){M.dashSize.value=w.dashSize,M.totalSize.value=w.dashSize+w.gapSize,M.scale.value=w.scale}function h(M,w,N,C){M.diffuse.value.copy(w.color),M.opacity.value=w.opacity,M.size.value=w.size*N,M.scale.value=C*.5,w.map&&(M.map.value=w.map),w.alphaMap&&(M.alphaMap.value=w.alphaMap),w.alphaTest>0&&(M.alphaTest.value=w.alphaTest);let k;w.map?k=w.map:w.alphaMap&&(k=w.alphaMap),k!==void 0&&(k.matrixAutoUpdate===!0&&k.updateMatrix(),M.uvTransform.value.copy(k.matrix))}function f(M,w){M.diffuse.value.copy(w.color),M.opacity.value=w.opacity,M.rotation.value=w.rotation,w.map&&(M.map.value=w.map),w.alphaMap&&(M.alphaMap.value=w.alphaMap),w.alphaTest>0&&(M.alphaTest.value=w.alphaTest);let N;w.map?N=w.map:w.alphaMap&&(N=w.alphaMap),N!==void 0&&(N.matrixAutoUpdate===!0&&N.updateMatrix(),M.uvTransform.value.copy(N.matrix))}function p(M,w){w.emissiveMap&&(M.emissiveMap.value=w.emissiveMap)}function d(M,w){M.specular.value.copy(w.specular),M.shininess.value=Math.max(w.shininess,1e-4),w.emissiveMap&&(M.emissiveMap.value=w.emissiveMap),w.bumpMap&&(M.bumpMap.value=w.bumpMap,M.bumpScale.value=w.bumpScale,w.side===nn&&(M.bumpScale.value*=-1)),w.normalMap&&(M.normalMap.value=w.normalMap,M.normalScale.value.copy(w.normalScale),w.side===nn&&M.normalScale.value.negate()),w.displacementMap&&(M.displacementMap.value=w.displacementMap,M.displacementScale.value=w.displacementScale,M.displacementBias.value=w.displacementBias)}function g(M,w){w.gradientMap&&(M.gradientMap.value=w.gradientMap),w.emissiveMap&&(M.emissiveMap.value=w.emissiveMap),w.bumpMap&&(M.bumpMap.value=w.bumpMap,M.bumpScale.value=w.bumpScale,w.side===nn&&(M.bumpScale.value*=-1)),w.normalMap&&(M.normalMap.value=w.normalMap,M.normalScale.value.copy(w.normalScale),w.side===nn&&M.normalScale.value.negate()),w.displacementMap&&(M.displacementMap.value=w.displacementMap,M.displacementScale.value=w.displacementScale,M.displacementBias.value=w.displacementBias)}function y(M,w){M.roughness.value=w.roughness,M.metalness.value=w.metalness,w.roughnessMap&&(M.roughnessMap.value=w.roughnessMap),w.metalnessMap&&(M.metalnessMap.value=w.metalnessMap),w.emissiveMap&&(M.emissiveMap.value=w.emissiveMap),w.bumpMap&&(M.bumpMap.value=w.bumpMap,M.bumpScale.value=w.bumpScale,w.side===nn&&(M.bumpScale.value*=-1)),w.normalMap&&(M.normalMap.value=w.normalMap,M.normalScale.value.copy(w.normalScale),w.side===nn&&M.normalScale.value.negate()),w.displacementMap&&(M.displacementMap.value=w.displacementMap,M.displacementScale.value=w.displacementScale,M.displacementBias.value=w.displacementBias),r.get(w).envMap&&(M.envMapIntensity.value=w.envMapIntensity)}function x(M,w,N){y(M,w),M.ior.value=w.ior,w.sheen>0&&(M.sheenColor.value.copy(w.sheenColor).multiplyScalar(w.sheen),M.sheenRoughness.value=w.sheenRoughness,w.sheenColorMap&&(M.sheenColorMap.value=w.sheenColorMap),w.sheenRoughnessMap&&(M.sheenRoughnessMap.value=w.sheenRoughnessMap)),w.clearcoat>0&&(M.clearcoat.value=w.clearcoat,M.clearcoatRoughness.value=w.clearcoatRoughness,w.clearcoatMap&&(M.clearcoatMap.value=w.clearcoatMap),w.clearcoatRoughnessMap&&(M.clearcoatRoughnessMap.value=w.clearcoatRoughnessMap),w.clearcoatNormalMap&&(M.clearcoatNormalScale.value.copy(w.clearcoatNormalScale),M.clearcoatNormalMap.value=w.clearcoatNormalMap,w.side===nn&&M.clearcoatNormalScale.value.negate())),w.transmission>0&&(M.transmission.value=w.transmission,M.transmissionSamplerMap.value=N.texture,M.transmissionSamplerSize.value.set(N.width,N.height),w.transmissionMap&&(M.transmissionMap.value=w.transmissionMap),M.thickness.value=w.thickness,w.thicknessMap&&(M.thicknessMap.value=w.thicknessMap),M.attenuationDistance.value=w.attenuationDistance,M.attenuationColor.value.copy(w.attenuationColor)),M.specularIntensity.value=w.specularIntensity,M.specularColor.value.copy(w.specularColor),w.specularIntensityMap&&(M.specularIntensityMap.value=w.specularIntensityMap),w.specularColorMap&&(M.specularColorMap.value=w.specularColorMap)}function _(M,w){w.matcap&&(M.matcap.value=w.matcap),w.bumpMap&&(M.bumpMap.value=w.bumpMap,M.bumpScale.value=w.bumpScale,w.side===nn&&(M.bumpScale.value*=-1)),w.normalMap&&(M.normalMap.value=w.normalMap,M.normalScale.value.copy(w.normalScale),w.side===nn&&M.normalScale.value.negate()),w.displacementMap&&(M.displacementMap.value=w.displacementMap,M.displacementScale.value=w.displacementScale,M.displacementBias.value=w.displacementBias)}function T(M,w){w.displacementMap&&(M.displacementMap.value=w.displacementMap,M.displacementScale.value=w.displacementScale,M.displacementBias.value=w.displacementBias)}function L(M,w){w.displacementMap&&(M.displacementMap.value=w.displacementMap,M.displacementScale.value=w.displacementScale,M.displacementBias.value=w.displacementBias),M.referencePosition.value.copy(w.referencePosition),M.nearDistance.value=w.nearDistance,M.farDistance.value=w.farDistance}function P(M,w){w.bumpMap&&(M.bumpMap.value=w.bumpMap,M.bumpScale.value=w.bumpScale,w.side===nn&&(M.bumpScale.value*=-1)),w.normalMap&&(M.normalMap.value=w.normalMap,M.normalScale.value.copy(w.normalScale),w.side===nn&&M.normalScale.value.negate()),w.displacementMap&&(M.displacementMap.value=w.displacementMap,M.displacementScale.value=w.displacementScale,M.displacementBias.value=w.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function I1(){const r=Sl("canvas");return r.style.display="block",r}function Ct(r={}){const e=r.canvas!==void 0?r.canvas:I1(),t=r.context!==void 0?r.context:null,i=r.alpha!==void 0?r.alpha:!1,a=r.depth!==void 0?r.depth:!0,o=r.stencil!==void 0?r.stencil:!0,h=r.antialias!==void 0?r.antialias:!1,f=r.premultipliedAlpha!==void 0?r.premultipliedAlpha:!0,p=r.preserveDrawingBuffer!==void 0?r.preserveDrawingBuffer:!1,d=r.powerPreference!==void 0?r.powerPreference:"default",g=r.failIfMajorPerformanceCaveat!==void 0?r.failIfMajorPerformanceCaveat:!1;let y=null,x=null;const _=[],T=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=On,this.physicallyCorrectLights=!1,this.toneMapping=Nr,this.toneMappingExposure=1;const L=this;let P=!1,M=0,w=0,N=null,C=-1,k=null;const q=new Rt,R=new Rt;let J=null,oe=e.width,Q=e.height,X=1,Se=null,H=null;const W=new Rt(0,0,oe,Q),D=new Rt(0,0,oe,Q);let ee=!1;const te=[],Me=new Gl;let Oe=!1,ce=!1,ue=null;const We=new ot,Pe=new V,ze={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $e(){return N===null?X:1}let K=t;function Ae(F,$){for(let ae=0;ae<F.length;ae++){const re=F[ae],fe=e.getContext(re,$);if(fe!==null)return fe}return null}try{const F={alpha:i,depth:a,stencil:o,antialias:h,premultipliedAlpha:f,preserveDrawingBuffer:p,powerPreference:d,failIfMajorPerformanceCaveat:g};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${bc}`),e.addEventListener("webglcontextlost",Ne,!1),e.addEventListener("webglcontextrestored",xe,!1),K===null){const $=["webgl2","webgl","experimental-webgl"];if(L.isWebGL1Renderer===!0&&$.shift(),K=Ae($,F),K===null)throw Ae($)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}K.getShaderPrecisionFormat===void 0&&(K.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(F){throw console.error("THREE.WebGLRenderer: "+F.message),F}let Re,Ee,Je,Ze,se,be,Le,me,Ce,tt,rt,ht,bt,G,O,pe,de,qe,Xe,Y,ke,z,ne;function ve(){Re=new nS(K),Ee=new YM(K,Re,r),Re.init(Ee),z=new C1(K,Re,Ee),Je=new A1(K,Re,Ee),te[0]=1029,Ze=new sS(K),se=new g1,be=new L1(K,Re,Je,se,Ee,z,Ze),Le=new JM(L),me=new tS(L),Ce=new xb(K,Ee),ne=new ZM(K,Re,Ce,Ee),tt=new iS(K,Ce,Ze,ne),rt=new uS(K,tt,Ce,Ze),Xe=new lS(K,Ee,be),pe=new jM(se),ht=new m1(L,Le,me,Re,Ee,ne,pe),bt=new D1(se),G=new x1(se),O=new S1(Re,Ee),qe=new XM(L,Le,Je,rt,f),de=new Wm(L,rt,Ee),Y=new qM(K,Re,Ze,Ee),ke=new rS(K,Re,Ze,Ee),Ze.programs=ht.programs,L.capabilities=Ee,L.extensions=Re,L.properties=se,L.renderLists=G,L.shadowMap=de,L.state=Je,L.info=Ze}ve();const Te=new P1(L,K);this.xr=Te,this.getContext=function(){return K},this.getContextAttributes=function(){return K.getContextAttributes()},this.forceContextLoss=function(){const F=Re.get("WEBGL_lose_context");F&&F.loseContext()},this.forceContextRestore=function(){const F=Re.get("WEBGL_lose_context");F&&F.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(F){F!==void 0&&(X=F,this.setSize(oe,Q,!1))},this.getSize=function(F){return F.set(oe,Q)},this.setSize=function(F,$,ae){if(Te.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}oe=F,Q=$,e.width=Math.floor(F*X),e.height=Math.floor($*X),ae!==!1&&(e.style.width=F+"px",e.style.height=$+"px"),this.setViewport(0,0,F,$)},this.getDrawingBufferSize=function(F){return F.set(oe*X,Q*X).floor()},this.setDrawingBufferSize=function(F,$,ae){oe=F,Q=$,X=ae,e.width=Math.floor(F*ae),e.height=Math.floor($*ae),this.setViewport(0,0,F,$)},this.getCurrentViewport=function(F){return F.copy(q)},this.getViewport=function(F){return F.copy(W)},this.setViewport=function(F,$,ae,re){F.isVector4?W.set(F.x,F.y,F.z,F.w):W.set(F,$,ae,re),Je.viewport(q.copy(W).multiplyScalar(X).floor())},this.getScissor=function(F){return F.copy(D)},this.setScissor=function(F,$,ae,re){F.isVector4?D.set(F.x,F.y,F.z,F.w):D.set(F,$,ae,re),Je.scissor(R.copy(D).multiplyScalar(X).floor())},this.getScissorTest=function(){return ee},this.setScissorTest=function(F){Je.setScissorTest(ee=F)},this.setOpaqueSort=function(F){Se=F},this.setTransparentSort=function(F){H=F},this.getClearColor=function(F){return F.copy(qe.getClearColor())},this.setClearColor=function(){qe.setClearColor.apply(qe,arguments)},this.getClearAlpha=function(){return qe.getClearAlpha()},this.setClearAlpha=function(){qe.setClearAlpha.apply(qe,arguments)},this.clear=function(F,$,ae){let re=0;(F===void 0||F)&&(re|=16384),($===void 0||$)&&(re|=256),(ae===void 0||ae)&&(re|=1024),K.clear(re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ne,!1),e.removeEventListener("webglcontextrestored",xe,!1),G.dispose(),O.dispose(),se.dispose(),Le.dispose(),me.dispose(),rt.dispose(),ne.dispose(),Te.dispose(),Te.removeEventListener("sessionstart",Wt),Te.removeEventListener("sessionend",Un),ue&&(ue.dispose(),ue=null),Dt.stop()};function Ne(F){F.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),P=!0}function xe(){console.log("THREE.WebGLRenderer: Context Restored."),P=!1;const F=Ze.autoReset,$=de.enabled,ae=de.autoUpdate,re=de.needsUpdate,fe=de.type;ve(),Ze.autoReset=F,de.enabled=$,de.autoUpdate=ae,de.needsUpdate=re,de.type=fe}function wt(F){const $=F.target;$.removeEventListener("dispose",wt),st($)}function st(F){Ve(F),se.remove(F)}function Ve(F){const $=se.get(F).programs;$!==void 0&&$.forEach(function(ae){ht.releaseProgram(ae)})}this.renderBufferDirect=function(F,$,ae,re,fe,Ke){$===null&&($=ze);const Ye=fe.isMesh&&fe.matrixWorld.determinant()<0,dt=$r(F,$,ae,re,fe);Je.setMaterial(re,Ye);let it=ae.index;const mt=ae.attributes.position;if(it===null){if(mt===void 0||mt.count===0)return}else if(it.count===0)return;let ct=1;re.wireframe===!0&&(it=tt.getWireframeAttribute(ae),ct=2),ne.setup(fe,re,dt,ae,it);let ut,_t=Y;it!==null&&(ut=Ce.get(it),_t=ke,_t.setIndex(ut));const Gt=it!==null?it.count:mt.count,gt=ae.drawRange.start*ct,ni=ae.drawRange.count*ct,lt=Ke!==null?Ke.start*ct:0,Ue=Ke!==null?Ke.count*ct:1/0,on=Math.max(gt,lt),Gn=Math.min(Gt,gt+ni,lt+Ue)-1,zt=Math.max(0,Gn-on+1);if(zt!==0){if(fe.isMesh)re.wireframe===!0?(Je.setLineWidth(re.wireframeLinewidth*$e()),_t.setMode(1)):_t.setMode(4);else if(fe.isLine){let nt=re.linewidth;nt===void 0&&(nt=1),Je.setLineWidth(nt*$e()),fe.isLineSegments?_t.setMode(1):fe.isLineLoop?_t.setMode(2):_t.setMode(3)}else fe.isPoints?_t.setMode(0):fe.isSprite&&_t.setMode(4);if(fe.isInstancedMesh)_t.renderInstances(on,zt,fe.count);else if(ae.isInstancedBufferGeometry){const nt=Math.min(ae.instanceCount,ae._maxInstanceCount);_t.renderInstances(on,zt,nt)}else _t.render(on,zt)}},this.compile=function(F,$){x=O.get(F),x.init(),T.push(x),F.traverseVisible(function(ae){ae.isLight&&ae.layers.test($.layers)&&(x.pushLight(ae),ae.castShadow&&x.pushShadow(ae))}),x.setupLights(L.physicallyCorrectLights),F.traverse(function(ae){const re=ae.material;if(re)if(Array.isArray(re))for(let fe=0;fe<re.length;fe++){const Ke=re[fe];Ei(Ke,F,ae)}else Ei(re,F,ae)}),T.pop(),x=null};let ft=null;function Gi(F){ft&&ft(F)}function Wt(){Dt.stop()}function Un(){Dt.start()}const Dt=new am;Dt.setAnimationLoop(Gi),typeof window!="undefined"&&Dt.setContext(window),this.setAnimationLoop=function(F){ft=F,Te.setAnimationLoop(F),F===null?Dt.stop():Dt.start()},Te.addEventListener("sessionstart",Wt),Te.addEventListener("sessionend",Un),this.render=function(F,$){if($!==void 0&&$.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(P===!0)return;F.autoUpdate===!0&&F.updateMatrixWorld(),$.parent===null&&$.updateMatrixWorld(),Te.enabled===!0&&Te.isPresenting===!0&&(Te.cameraAutoUpdate===!0&&Te.updateCamera($),$=Te.getCamera()),F.isScene===!0&&F.onBeforeRender(L,F,$,N),x=O.get(F,T.length),x.init(),T.push(x),We.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),Me.setFromProjectionMatrix(We),ce=this.localClippingEnabled,Oe=pe.init(this.clippingPlanes,ce,$),y=G.get(F,_.length),y.init(),_.push(y),Si(F,$,0,L.sortObjects),y.finish(),L.sortObjects===!0&&y.sort(Se,H),Oe===!0&&pe.beginShadows();const ae=x.state.shadowsArray;if(de.render(ae,F,$),Oe===!0&&pe.endShadows(),this.info.autoReset===!0&&this.info.reset(),qe.render(y,F),x.setupLights(L.physicallyCorrectLights),$.isArrayCamera){const re=$.cameras;for(let fe=0,Ke=re.length;fe<Ke;fe++){const Ye=re[fe];yn(y,F,Ye,Ye.viewport)}}else yn(y,F,$);N!==null&&(be.updateMultisampleRenderTarget(N),be.updateRenderTargetMipmap(N)),F.isScene===!0&&F.onAfterRender(L,F,$),Je.buffers.depth.setTest(!0),Je.buffers.depth.setMask(!0),Je.buffers.color.setMask(!0),Je.setPolygonOffset(!1),ne.resetDefaultState(),C=-1,k=null,T.pop(),T.length>0?x=T[T.length-1]:x=null,_.pop(),_.length>0?y=_[_.length-1]:y=null};function Si(F,$,ae,re){if(F.visible===!1)return;if(F.layers.test($.layers)){if(F.isGroup)ae=F.renderOrder;else if(F.isLOD)F.autoUpdate===!0&&F.update($);else if(F.isLight)x.pushLight(F),F.castShadow&&x.pushShadow(F);else if(F.isSprite){if(!F.frustumCulled||Me.intersectsSprite(F)){re&&Pe.setFromMatrixPosition(F.matrixWorld).applyMatrix4(We);const Ye=rt.update(F),dt=F.material;dt.visible&&y.push(F,Ye,dt,ae,Pe.z,null)}}else if((F.isMesh||F.isLine||F.isPoints)&&(F.isSkinnedMesh&&F.skeleton.frame!==Ze.render.frame&&(F.skeleton.update(),F.skeleton.frame=Ze.render.frame),!F.frustumCulled||Me.intersectsObject(F))){re&&Pe.setFromMatrixPosition(F.matrixWorld).applyMatrix4(We);const Ye=rt.update(F),dt=F.material;if(Array.isArray(dt)){const it=Ye.groups;for(let mt=0,ct=it.length;mt<ct;mt++){const ut=it[mt],_t=dt[ut.materialIndex];_t&&_t.visible&&y.push(F,Ye,_t,ae,Pe.z,ut)}}else dt.visible&&y.push(F,Ye,dt,ae,Pe.z,null)}}const Ke=F.children;for(let Ye=0,dt=Ke.length;Ye<dt;Ye++)Si(Ke[Ye],$,ae,re)}function yn(F,$,ae,re){const fe=F.opaque,Ke=F.transmissive,Ye=F.transparent;x.setupLightsView(ae),Ke.length>0&&Ti(fe,$,ae),re&&Je.viewport(q.copy(re)),fe.length>0&&Wn(fe,$,ae),Ke.length>0&&Wn(Ke,$,ae),Ye.length>0&&Wn(Ye,$,ae)}function Ti(F,$,ae){if(ue===null){const Ye=h===!0&&Ee.isWebGL2===!0?Fc:Kn;ue=new Ye(1024,1024,{generateMipmaps:!0,type:z.convert(Ss)!==null?Ss:er,minFilter:gl,magFilter:un,wrapS:Zn,wrapT:Zn,useRenderToTexture:Re.has("WEBGL_multisampled_render_to_texture")})}const re=L.getRenderTarget();L.setRenderTarget(ue),L.clear();const fe=L.toneMapping;L.toneMapping=Nr,Wn(F,$,ae),L.toneMapping=fe,be.updateMultisampleRenderTarget(ue),be.updateRenderTargetMipmap(ue),L.setRenderTarget(re)}function Wn(F,$,ae){const re=$.isScene===!0?$.overrideMaterial:null;for(let fe=0,Ke=F.length;fe<Ke;fe++){const Ye=F[fe],dt=Ye.object,it=Ye.geometry,mt=re===null?Ye.material:re,ct=Ye.group;dt.layers.test(ae.layers)&&Qr(dt,$,ae,it,mt,ct)}}function Qr(F,$,ae,re,fe,Ke){F.onBeforeRender(L,$,ae,re,fe,Ke),F.modelViewMatrix.multiplyMatrices(ae.matrixWorldInverse,F.matrixWorld),F.normalMatrix.getNormalMatrix(F.modelViewMatrix),fe.onBeforeRender(L,$,ae,re,F,Ke),fe.transparent===!0&&fe.side===ws?(fe.side=nn,fe.needsUpdate=!0,L.renderBufferDirect(ae,$,re,fe,F,Ke),fe.side=Wa,fe.needsUpdate=!0,L.renderBufferDirect(ae,$,re,fe,F,Ke),fe.side=ws):L.renderBufferDirect(ae,$,re,fe,F,Ke),F.onAfterRender(L,$,ae,re,fe,Ke)}function Ei(F,$,ae){$.isScene!==!0&&($=ze);const re=se.get(F),fe=x.state.lights,Ke=x.state.shadowsArray,Ye=fe.state.version,dt=ht.getParameters(F,fe.state,Ke,$,ae),it=ht.getProgramCacheKey(dt);let mt=re.programs;re.environment=F.isMeshStandardMaterial?$.environment:null,re.fog=$.fog,re.envMap=(F.isMeshStandardMaterial?me:Le).get(F.envMap||re.environment),mt===void 0&&(F.addEventListener("dispose",wt),mt=new Map,re.programs=mt);let ct=mt.get(it);if(ct!==void 0){if(re.currentProgram===ct&&re.lightsStateVersion===Ye)return an(F,dt),ct}else dt.uniforms=ht.getUniforms(F),F.onBuild(ae,dt,L),F.onBeforeCompile(dt,L),ct=ht.acquireProgram(dt,it),mt.set(it,ct),re.uniforms=dt.uniforms;const ut=re.uniforms;(!F.isShaderMaterial&&!F.isRawShaderMaterial||F.clipping===!0)&&(ut.clippingPlanes=pe.uniform),an(F,dt),re.needsLights=jn(F),re.lightsStateVersion=Ye,re.needsLights&&(ut.ambientLightColor.value=fe.state.ambient,ut.lightProbe.value=fe.state.probe,ut.directionalLights.value=fe.state.directional,ut.directionalLightShadows.value=fe.state.directionalShadow,ut.spotLights.value=fe.state.spot,ut.spotLightShadows.value=fe.state.spotShadow,ut.rectAreaLights.value=fe.state.rectArea,ut.ltc_1.value=fe.state.rectAreaLTC1,ut.ltc_2.value=fe.state.rectAreaLTC2,ut.pointLights.value=fe.state.point,ut.pointLightShadows.value=fe.state.pointShadow,ut.hemisphereLights.value=fe.state.hemi,ut.directionalShadowMap.value=fe.state.directionalShadowMap,ut.directionalShadowMatrix.value=fe.state.directionalShadowMatrix,ut.spotShadowMap.value=fe.state.spotShadowMap,ut.spotShadowMatrix.value=fe.state.spotShadowMatrix,ut.pointShadowMap.value=fe.state.pointShadowMap,ut.pointShadowMatrix.value=fe.state.pointShadowMatrix);const _t=ct.getUniforms(),Gt=hr.seqWithValue(_t.seq,ut);return re.currentProgram=ct,re.uniformsList=Gt,ct}function an(F,$){const ae=se.get(F);ae.outputEncoding=$.outputEncoding,ae.instancing=$.instancing,ae.skinning=$.skinning,ae.morphTargets=$.morphTargets,ae.morphNormals=$.morphNormals,ae.morphTargetsCount=$.morphTargetsCount,ae.numClippingPlanes=$.numClippingPlanes,ae.numIntersection=$.numClipIntersection,ae.vertexAlphas=$.vertexAlphas,ae.vertexTangents=$.vertexTangents}function $r(F,$,ae,re,fe){$.isScene!==!0&&($=ze),be.resetTextureUnits();const Ke=$.fog,Ye=re.isMeshStandardMaterial?$.environment:null,dt=N===null?L.outputEncoding:N.texture.encoding,it=(re.isMeshStandardMaterial?me:Le).get(re.envMap||Ye),mt=re.vertexColors===!0&&!!ae.attributes.color&&ae.attributes.color.itemSize===4,ct=!!re.normalMap&&!!ae.attributes.tangent,ut=!!ae.morphAttributes.position,_t=!!ae.morphAttributes.normal,Gt=ae.morphAttributes.position?ae.morphAttributes.position.length:0,gt=se.get(re),ni=x.state.lights;if(Oe===!0&&(ce===!0||F!==k)){const Jt=F===k&&re.id===C;pe.setState(re,F,Jt)}let lt=!1;re.version===gt.__version?(gt.needsLights&&gt.lightsStateVersion!==ni.state.version||gt.outputEncoding!==dt||fe.isInstancedMesh&&gt.instancing===!1||!fe.isInstancedMesh&&gt.instancing===!0||fe.isSkinnedMesh&&gt.skinning===!1||!fe.isSkinnedMesh&&gt.skinning===!0||gt.envMap!==it||re.fog&&gt.fog!==Ke||gt.numClippingPlanes!==void 0&&(gt.numClippingPlanes!==pe.numPlanes||gt.numIntersection!==pe.numIntersection)||gt.vertexAlphas!==mt||gt.vertexTangents!==ct||gt.morphTargets!==ut||gt.morphNormals!==_t||Ee.isWebGL2===!0&&gt.morphTargetsCount!==Gt)&&(lt=!0):(lt=!0,gt.__version=re.version);let Ue=gt.currentProgram;lt===!0&&(Ue=Ei(re,$,fe));let on=!1,Gn=!1,zt=!1;const nt=Ue.getUniforms(),_n=gt.uniforms;if(Je.useProgram(Ue.program)&&(on=!0,Gn=!0,zt=!0),re.id!==C&&(C=re.id,Gn=!0),on||k!==F){if(nt.setValue(K,"projectionMatrix",F.projectionMatrix),Ee.logarithmicDepthBuffer&&nt.setValue(K,"logDepthBufFC",2/(Math.log(F.far+1)/Math.LN2)),k!==F&&(k=F,Gn=!0,zt=!0),re.isShaderMaterial||re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshStandardMaterial||re.envMap){const Jt=nt.map.cameraPosition;Jt!==void 0&&Jt.setValue(K,Pe.setFromMatrixPosition(F.matrixWorld))}(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial)&&nt.setValue(K,"isOrthographic",F.isOrthographicCamera===!0),(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial||re.isShadowMaterial||fe.isSkinnedMesh)&&nt.setValue(K,"viewMatrix",F.matrixWorldInverse)}if(fe.isSkinnedMesh){nt.setOptional(K,fe,"bindMatrix"),nt.setOptional(K,fe,"bindMatrixInverse");const Jt=fe.skeleton;Jt&&(Ee.floatVertexTextures?(Jt.boneTexture===null&&Jt.computeBoneTexture(),nt.setValue(K,"boneTexture",Jt.boneTexture,be),nt.setValue(K,"boneTextureSize",Jt.boneTextureSize)):nt.setOptional(K,Jt,"boneMatrices"))}return!!ae&&(ae.morphAttributes.position!==void 0||ae.morphAttributes.normal!==void 0)&&Xe.update(fe,ae,re,Ue),(Gn||gt.receiveShadow!==fe.receiveShadow)&&(gt.receiveShadow=fe.receiveShadow,nt.setValue(K,"receiveShadow",fe.receiveShadow)),Gn&&(nt.setValue(K,"toneMappingExposure",L.toneMappingExposure),gt.needsLights&&Sr(_n,zt),Ke&&re.fog&&bt.refreshFogUniforms(_n,Ke),bt.refreshMaterialUniforms(_n,re,X,Q,ue),hr.upload(K,gt.uniformsList,_n,be)),re.isShaderMaterial&&re.uniformsNeedUpdate===!0&&(hr.upload(K,gt.uniformsList,_n,be),re.uniformsNeedUpdate=!1),re.isSpriteMaterial&&nt.setValue(K,"center",fe.center),nt.setValue(K,"modelViewMatrix",fe.modelViewMatrix),nt.setValue(K,"normalMatrix",fe.normalMatrix),nt.setValue(K,"modelMatrix",fe.matrixWorld),Ue}function Sr(F,$){F.ambientLightColor.needsUpdate=$,F.lightProbe.needsUpdate=$,F.directionalLights.needsUpdate=$,F.directionalLightShadows.needsUpdate=$,F.pointLights.needsUpdate=$,F.pointLightShadows.needsUpdate=$,F.spotLights.needsUpdate=$,F.spotLightShadows.needsUpdate=$,F.rectAreaLights.needsUpdate=$,F.hemisphereLights.needsUpdate=$}function jn(F){return F.isMeshLambertMaterial||F.isMeshToonMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.isShadowMaterial||F.isShaderMaterial&&F.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return N},this.setRenderTargetTextures=function(F,$,ae){se.get(F.texture).__webglTexture=$,se.get(F.depthTexture).__webglTexture=ae;const re=se.get(F);re.__hasExternalTextures=!0,re.__hasExternalTextures&&(re.__autoAllocateDepthBuffer=ae===void 0,re.__autoAllocateDepthBuffer||F.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),F.useRenderToTexture=!1,F.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(F,$){const ae=se.get(F);ae.__webglFramebuffer=$,ae.__useDefaultFramebuffer=$===void 0},this.setRenderTarget=function(F,$=0,ae=0){N=F,M=$,w=ae;let re=!0;if(F){const it=se.get(F);it.__useDefaultFramebuffer!==void 0?(Je.bindFramebuffer(36160,null),re=!1):it.__webglFramebuffer===void 0?be.setupRenderTarget(F):it.__hasExternalTextures&&be.rebindTextures(F,se.get(F.texture).__webglTexture,se.get(F.depthTexture).__webglTexture)}let fe=null,Ke=!1,Ye=!1;if(F){const it=F.texture;(it.isDataTexture3D||it.isDataTexture2DArray)&&(Ye=!0);const mt=se.get(F).__webglFramebuffer;F.isWebGLCubeRenderTarget?(fe=mt[$],Ke=!0):F.useRenderbuffer?fe=se.get(F).__webglMultisampledFramebuffer:fe=mt,q.copy(F.viewport),R.copy(F.scissor),J=F.scissorTest}else q.copy(W).multiplyScalar(X).floor(),R.copy(D).multiplyScalar(X).floor(),J=ee;if(Je.bindFramebuffer(36160,fe)&&Ee.drawBuffers&&re){let it=!1;if(F)if(F.isWebGLMultipleRenderTargets){const mt=F.texture;if(te.length!==mt.length||te[0]!==36064){for(let ct=0,ut=mt.length;ct<ut;ct++)te[ct]=36064+ct;te.length=mt.length,it=!0}}else(te.length!==1||te[0]!==36064)&&(te[0]=36064,te.length=1,it=!0);else(te.length!==1||te[0]!==1029)&&(te[0]=1029,te.length=1,it=!0);it&&(Ee.isWebGL2?K.drawBuffers(te):Re.get("WEBGL_draw_buffers").drawBuffersWEBGL(te))}if(Je.viewport(q),Je.scissor(R),Je.setScissorTest(J),Ke){const it=se.get(F.texture);K.framebufferTexture2D(36160,36064,34069+$,it.__webglTexture,ae)}else if(Ye){const it=se.get(F.texture),mt=$||0;K.framebufferTextureLayer(36160,36064,it.__webglTexture,ae||0,mt)}C=-1},this.readRenderTargetPixels=function(F,$,ae,re,fe,Ke,Ye){if(!(F&&F.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let dt=se.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&Ye!==void 0&&(dt=dt[Ye]),dt){Je.bindFramebuffer(36160,dt);try{const it=F.texture,mt=it.format,ct=it.type;if(mt!==In&&z.convert(mt)!==K.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ut=ct===Ss&&(Re.has("EXT_color_buffer_half_float")||Ee.isWebGL2&&Re.has("EXT_color_buffer_float"));if(ct!==er&&z.convert(ct)!==K.getParameter(35738)&&!(ct===tr&&(Ee.isWebGL2||Re.has("OES_texture_float")||Re.has("WEBGL_color_buffer_float")))&&!ut){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}K.checkFramebufferStatus(36160)===36053?$>=0&&$<=F.width-re&&ae>=0&&ae<=F.height-fe&&K.readPixels($,ae,re,fe,z.convert(mt),z.convert(ct),Ke):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const it=N!==null?se.get(N).__webglFramebuffer:null;Je.bindFramebuffer(36160,it)}}},this.copyFramebufferToTexture=function(F,$,ae=0){const re=Math.pow(2,-ae),fe=Math.floor($.image.width*re),Ke=Math.floor($.image.height*re);let Ye=z.convert($.format);Ee.isWebGL2&&(Ye===6407&&(Ye=32849),Ye===6408&&(Ye=32856)),be.setTexture2D($,0),K.copyTexImage2D(3553,ae,Ye,F.x,F.y,fe,Ke,0),Je.unbindTexture()},this.copyTextureToTexture=function(F,$,ae,re=0){const fe=$.image.width,Ke=$.image.height,Ye=z.convert(ae.format),dt=z.convert(ae.type);be.setTexture2D(ae,0),K.pixelStorei(37440,ae.flipY),K.pixelStorei(37441,ae.premultiplyAlpha),K.pixelStorei(3317,ae.unpackAlignment),$.isDataTexture?K.texSubImage2D(3553,re,F.x,F.y,fe,Ke,Ye,dt,$.image.data):$.isCompressedTexture?K.compressedTexSubImage2D(3553,re,F.x,F.y,$.mipmaps[0].width,$.mipmaps[0].height,Ye,$.mipmaps[0].data):K.texSubImage2D(3553,re,F.x,F.y,Ye,dt,$.image),re===0&&ae.generateMipmaps&&K.generateMipmap(3553),Je.unbindTexture()},this.copyTextureToTexture3D=function(F,$,ae,re,fe=0){if(L.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ke=F.max.x-F.min.x+1,Ye=F.max.y-F.min.y+1,dt=F.max.z-F.min.z+1,it=z.convert(re.format),mt=z.convert(re.type);let ct;if(re.isDataTexture3D)be.setTexture3D(re,0),ct=32879;else if(re.isDataTexture2DArray)be.setTexture2DArray(re,0),ct=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}K.pixelStorei(37440,re.flipY),K.pixelStorei(37441,re.premultiplyAlpha),K.pixelStorei(3317,re.unpackAlignment);const ut=K.getParameter(3314),_t=K.getParameter(32878),Gt=K.getParameter(3316),gt=K.getParameter(3315),ni=K.getParameter(32877),lt=ae.isCompressedTexture?ae.mipmaps[0]:ae.image;K.pixelStorei(3314,lt.width),K.pixelStorei(32878,lt.height),K.pixelStorei(3316,F.min.x),K.pixelStorei(3315,F.min.y),K.pixelStorei(32877,F.min.z),ae.isDataTexture||ae.isDataTexture3D?K.texSubImage3D(ct,fe,$.x,$.y,$.z,Ke,Ye,dt,it,mt,lt.data):ae.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),K.compressedTexSubImage3D(ct,fe,$.x,$.y,$.z,Ke,Ye,dt,it,lt.data)):K.texSubImage3D(ct,fe,$.x,$.y,$.z,Ke,Ye,dt,it,mt,lt),K.pixelStorei(3314,ut),K.pixelStorei(32878,_t),K.pixelStorei(3316,Gt),K.pixelStorei(3315,gt),K.pixelStorei(32877,ni),fe===0&&re.generateMipmaps&&K.generateMipmap(ct),Je.unbindTexture()},this.initTexture=function(F){be.setTexture2D(F,0),Je.unbindTexture()},this.resetState=function(){M=0,w=0,N=null,Je.reset(),ne.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ct.prototype.isWebGLRenderer=!0;class k1 extends Ct{}k1.prototype.isWebGL1Renderer=!0;class Vm extends Et{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}Vm.prototype.isScene=!0;class so{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=qa,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ai()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let a=0,o=this.stride;a<o;a++)this.array[e+a]=t.array[i+a];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ai()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ai()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}so.prototype.isInterleavedBuffer=!0;const Zt=new V;class ao{constructor(e,t,i,a=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=a===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Zt.x=this.getX(t),Zt.y=this.getY(t),Zt.z=this.getZ(t),Zt.applyMatrix4(e),this.setXYZ(t,Zt.x,Zt.y,Zt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Zt.x=this.getX(t),Zt.y=this.getY(t),Zt.z=this.getZ(t),Zt.applyNormalMatrix(e),this.setXYZ(t,Zt.x,Zt.y,Zt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Zt.x=this.getX(t),Zt.y=this.getY(t),Zt.z=this.getZ(t),Zt.transformDirection(e),this.setXYZ(t,Zt.x,Zt.y,Zt.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,a){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=a,this}setXYZW(e,t,i,a,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=a,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const a=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[a+o])}return new rn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ao(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const a=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[a+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ao.prototype.isInterleavedBufferAttribute=!0;class Xm extends Tn{constructor(e){super();this.type="SpriteMaterial",this.color=new et(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}Xm.prototype.isSpriteMaterial=!0;let Qs;const oo=new V,$s=new V,ea=new V,ta=new ye,lo=new ye,Zm=new ot,Yl=new V,uo=new V,jl=new V,qm=new ye,yh=new ye,Ym=new ye;class N1 extends Et{constructor(e){super();if(this.type="Sprite",Qs===void 0){Qs=new kt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new so(t,5);Qs.setIndex([0,1,2,0,2,3]),Qs.setAttribute("position",new ao(i,3,0,!1)),Qs.setAttribute("uv",new ao(i,2,3,!1))}this.geometry=Qs,this.material=e!==void 0?e:new Xm,this.center=new ye(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),$s.setFromMatrixScale(this.matrixWorld),Zm.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ea.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&$s.multiplyScalar(-ea.z);const i=this.material.rotation;let a,o;i!==0&&(o=Math.cos(i),a=Math.sin(i));const h=this.center;Jl(Yl.set(-.5,-.5,0),ea,h,$s,a,o),Jl(uo.set(.5,-.5,0),ea,h,$s,a,o),Jl(jl.set(.5,.5,0),ea,h,$s,a,o),qm.set(0,0),yh.set(1,0),Ym.set(1,1);let f=e.ray.intersectTriangle(Yl,uo,jl,!1,oo);if(f===null&&(Jl(uo.set(-.5,.5,0),ea,h,$s,a,o),yh.set(0,1),f=e.ray.intersectTriangle(Yl,jl,uo,!1,oo),f===null))return;const p=e.ray.origin.distanceTo(oo);p<e.near||p>e.far||t.push({distance:p,point:oo.clone(),uv:Yt.getUV(oo,Yl,uo,jl,qm,yh,Ym,new ye),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}N1.prototype.isSprite=!0;function Jl(r,e,t,i,a,o){ta.subVectors(r,t).addScalar(.5).multiply(i),a!==void 0?(lo.x=o*ta.x-a*ta.y,lo.y=a*ta.x+o*ta.y):lo.copy(ta),r.copy(e),r.x+=lo.x,r.y+=lo.y,r.applyMatrix4(Zm)}const jm=new V,Jm=new Rt,Km=new Rt,F1=new V,Qm=new ot;class $m extends zn{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ot,this.bindMatrixInverse=new ot}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Rt,t=this.geometry.attributes.skinWeight;for(let i=0,a=t.count;i<a;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,a=this.geometry;Jm.fromBufferAttribute(a.attributes.skinIndex,e),Km.fromBufferAttribute(a.attributes.skinWeight,e),jm.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const h=Km.getComponent(o);if(h!==0){const f=Jm.getComponent(o);Qm.multiplyMatrices(i.bones[f].matrixWorld,i.boneInverses[f]),t.addScaledVector(F1.copy(jm).applyMatrix4(Qm),h)}}return t.applyMatrix4(this.bindMatrixInverse)}}$m.prototype.isSkinnedMesh=!0;class O1 extends Et{constructor(){super();this.type="Bone"}}O1.prototype.isBone=!0;class z1 extends vn{constructor(e=null,t=1,i=1,a,o,h,f,p,d=un,g=un,y,x){super(null,h,f,p,d,g,a,o,y,x);this.image={data:e,width:t,height:i},this.magFilter=d,this.minFilter=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}z1.prototype.isDataTexture=!0;class _h extends rn{constructor(e,t,i,a=1){typeof i=="number"&&(a=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,i);this.meshPerAttribute=a}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}_h.prototype.isInstancedBufferAttribute=!0;const eg=new ot,tg=new ot,Kl=[],co=new zn;class B1 extends zn{constructor(e,t,i){super(e,t);this.instanceMatrix=new _h(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,a=this.count;if(co.geometry=this.geometry,co.material=this.material,co.material!==void 0)for(let o=0;o<a;o++){this.getMatrixAt(o,eg),tg.multiplyMatrices(i,eg),co.matrixWorld=tg,co.raycast(e,Kl);for(let h=0,f=Kl.length;h<f;h++){const p=Kl[h];p.instanceId=o,p.object=this,t.push(p)}Kl.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new _h(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}B1.prototype.isInstancedMesh=!0;class na extends Tn{constructor(e){super();this.type="LineBasicMaterial",this.color=new et(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}na.prototype.isLineBasicMaterial=!0;const ng=new V,ig=new V,rg=new ot,bh=new Fs,Ql=new Ns;class wh extends Et{constructor(e=new kt,t=new na){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[0];for(let a=1,o=t.count;a<o;a++)ng.fromBufferAttribute(t,a-1),ig.fromBufferAttribute(t,a),i[a]=i[a-1],i[a]+=ng.distanceTo(ig);e.setAttribute("lineDistance",new jt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,a=this.matrixWorld,o=e.params.Line.threshold,h=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ql.copy(i.boundingSphere),Ql.applyMatrix4(a),Ql.radius+=o,e.ray.intersectsSphere(Ql)===!1)return;rg.copy(a).invert(),bh.copy(e.ray).applyMatrix4(rg);const f=o/((this.scale.x+this.scale.y+this.scale.z)/3),p=f*f,d=new V,g=new V,y=new V,x=new V,_=this.isLineSegments?2:1;if(i.isBufferGeometry){const T=i.index,P=i.attributes.position;if(T!==null){const M=Math.max(0,h.start),w=Math.min(T.count,h.start+h.count);for(let N=M,C=w-1;N<C;N+=_){const k=T.getX(N),q=T.getX(N+1);if(d.fromBufferAttribute(P,k),g.fromBufferAttribute(P,q),bh.distanceSqToSegment(d,g,x,y)>p)continue;x.applyMatrix4(this.matrixWorld);const J=e.ray.origin.distanceTo(x);J<e.near||J>e.far||t.push({distance:J,point:y.clone().applyMatrix4(this.matrixWorld),index:N,face:null,faceIndex:null,object:this})}}else{const M=Math.max(0,h.start),w=Math.min(P.count,h.start+h.count);for(let N=M,C=w-1;N<C;N+=_){if(d.fromBufferAttribute(P,N),g.fromBufferAttribute(P,N+1),bh.distanceSqToSegment(d,g,x,y)>p)continue;x.applyMatrix4(this.matrixWorld);const q=e.ray.origin.distanceTo(x);q<e.near||q>e.far||t.push({distance:q,point:y.clone().applyMatrix4(this.matrixWorld),index:N,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const a=t[i[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,h=a.length;o<h;o++){const f=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}wh.prototype.isLine=!0;const sg=new V,ag=new V;class $l extends wh{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[];for(let a=0,o=t.count;a<o;a+=2)sg.fromBufferAttribute(t,a),ag.fromBufferAttribute(t,a+1),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+sg.distanceTo(ag);e.setAttribute("lineDistance",new jt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}$l.prototype.isLineSegments=!0;class H1 extends wh{constructor(e,t){super(e,t);this.type="LineLoop"}}H1.prototype.isLineLoop=!0;class og extends Tn{constructor(e){super();this.type="PointsMaterial",this.color=new et(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}og.prototype.isPointsMaterial=!0;const lg=new ot,Mh=new Fs,eu=new Ns,tu=new V;class U1 extends Et{constructor(e=new kt,t=new og){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,a=this.matrixWorld,o=e.params.Points.threshold,h=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),eu.copy(i.boundingSphere),eu.applyMatrix4(a),eu.radius+=o,e.ray.intersectsSphere(eu)===!1)return;lg.copy(a).invert(),Mh.copy(e.ray).applyMatrix4(lg);const f=o/((this.scale.x+this.scale.y+this.scale.z)/3),p=f*f;if(i.isBufferGeometry){const d=i.index,y=i.attributes.position;if(d!==null){const x=Math.max(0,h.start),_=Math.min(d.count,h.start+h.count);for(let T=x,L=_;T<L;T++){const P=d.getX(T);tu.fromBufferAttribute(y,P),ug(tu,P,p,a,e,t,this)}}else{const x=Math.max(0,h.start),_=Math.min(y.count,h.start+h.count);for(let T=x,L=_;T<L;T++)tu.fromBufferAttribute(y,T),ug(tu,T,p,a,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const a=t[i[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,h=a.length;o<h;o++){const f=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[f]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}U1.prototype.isPoints=!0;function ug(r,e,t,i,a,o,h){const f=Mh.distanceSqToPoint(r);if(f<t){const p=new V;Mh.closestPointToPoint(r,p),p.applyMatrix4(i);const d=a.ray.origin.distanceTo(p);if(d<a.near||d>a.far)return;o.push({distance:d,distanceToRay:Math.sqrt(f),point:p,index:e,face:null,object:h})}}class W1 extends vn{constructor(e,t,i,a,o,h,f,p,d){super(e,t,i,a,o,h,f,p,d);this.format=f!==void 0?f:Fr,this.minFilter=h!==void 0?h:Jn,this.magFilter=o!==void 0?o:Jn,this.generateMipmaps=!1;const g=this;function y(){g.needsUpdate=!0,e.requestVideoFrameCallback(y)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(y)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}W1.prototype.isVideoTexture=!0;class G1 extends vn{constructor(e,t,i,a,o,h,f,p,d,g,y,x){super(null,h,f,p,d,g,a,o,y,x);this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}G1.prototype.isCompressedTexture=!0;class V1 extends vn{constructor(e,t,i,a,o,h,f,p,d){super(e,t,i,a,o,h,f,p,d);this.needsUpdate=!0}}V1.prototype.isCanvasTexture=!0;new V;new V;new V;new Yt;class $n{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,a=this.getPoint(0),o=0;t.push(0);for(let h=1;h<=e;h++)i=this.getPoint(h/e),o+=i.distanceTo(a),t.push(o),a=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let a=0;const o=i.length;let h;t?h=t:h=e*i[o-1];let f=0,p=o-1,d;for(;f<=p;)if(a=Math.floor(f+(p-f)/2),d=i[a]-h,d<0)f=a+1;else if(d>0)p=a-1;else{p=a;break}if(a=p,i[a]===h)return a/(o-1);const g=i[a],x=i[a+1]-g,_=(h-g)/x;return(a+_)/(o-1)}getTangent(e,t){const i=1e-4;let a=e-i,o=e+i;a<0&&(a=0),o>1&&(o=1);const h=this.getPoint(a),f=this.getPoint(o),p=t||(h.isVector2?new ye:new V);return p.copy(f).sub(h).normalize(),p}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new V,a=[],o=[],h=[],f=new V,p=new ot;for(let _=0;_<=e;_++){const T=_/e;a[_]=this.getTangentAt(T,new V)}o[0]=new V,h[0]=new V;let d=Number.MAX_VALUE;const g=Math.abs(a[0].x),y=Math.abs(a[0].y),x=Math.abs(a[0].z);g<=d&&(d=g,i.set(1,0,0)),y<=d&&(d=y,i.set(0,1,0)),x<=d&&i.set(0,0,1),f.crossVectors(a[0],i).normalize(),o[0].crossVectors(a[0],f),h[0].crossVectors(a[0],o[0]);for(let _=1;_<=e;_++){if(o[_]=o[_-1].clone(),h[_]=h[_-1].clone(),f.crossVectors(a[_-1],a[_]),f.length()>Number.EPSILON){f.normalize();const T=Math.acos(Mn(a[_-1].dot(a[_]),-1,1));o[_].applyMatrix4(p.makeRotationAxis(f,T))}h[_].crossVectors(a[_],o[_])}if(t===!0){let _=Math.acos(Mn(o[0].dot(o[e]),-1,1));_/=e,a[0].dot(f.crossVectors(o[0],o[e]))>0&&(_=-_);for(let T=1;T<=e;T++)o[T].applyMatrix4(p.makeRotationAxis(a[T],_*T)),h[T].crossVectors(a[T],o[T])}return{tangents:a,normals:o,binormals:h}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class nu extends $n{constructor(e=0,t=0,i=1,a=1,o=0,h=Math.PI*2,f=!1,p=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=a,this.aStartAngle=o,this.aEndAngle=h,this.aClockwise=f,this.aRotation=p}getPoint(e,t){const i=t||new ye,a=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const h=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=a;for(;o>a;)o-=a;o<Number.EPSILON&&(h?o=0:o=a),this.aClockwise===!0&&!h&&(o===a?o=-a:o=o-a);const f=this.aStartAngle+e*o;let p=this.aX+this.xRadius*Math.cos(f),d=this.aY+this.yRadius*Math.sin(f);if(this.aRotation!==0){const g=Math.cos(this.aRotation),y=Math.sin(this.aRotation),x=p-this.aX,_=d-this.aY;p=x*g-_*y+this.aX,d=x*y+_*g+this.aY}return i.set(p,d)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}nu.prototype.isEllipseCurve=!0;class cg extends nu{constructor(e,t,i,a,o,h){super(e,t,i,i,a,o,h);this.type="ArcCurve"}}cg.prototype.isArcCurve=!0;function Sh(){let r=0,e=0,t=0,i=0;function a(o,h,f,p){r=o,e=f,t=-3*o+3*h-2*f-p,i=2*o-2*h+f+p}return{initCatmullRom:function(o,h,f,p,d){a(h,f,d*(f-o),d*(p-h))},initNonuniformCatmullRom:function(o,h,f,p,d,g,y){let x=(h-o)/d-(f-o)/(d+g)+(f-h)/g,_=(f-h)/g-(p-h)/(g+y)+(p-f)/y;x*=g,_*=g,a(h,f,x,_)},calc:function(o){const h=o*o,f=h*o;return r+e*o+t*h+i*f}}}const iu=new V,Th=new Sh,Eh=new Sh,Ah=new Sh;class hg extends $n{constructor(e=[],t=!1,i="centripetal",a=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=a}getPoint(e,t=new V){const i=t,a=this.points,o=a.length,h=(o-(this.closed?0:1))*e;let f=Math.floor(h),p=h-f;this.closed?f+=f>0?0:(Math.floor(Math.abs(f)/o)+1)*o:p===0&&f===o-1&&(f=o-2,p=1);let d,g;this.closed||f>0?d=a[(f-1)%o]:(iu.subVectors(a[0],a[1]).add(a[0]),d=iu);const y=a[f%o],x=a[(f+1)%o];if(this.closed||f+2<o?g=a[(f+2)%o]:(iu.subVectors(a[o-1],a[o-2]).add(a[o-1]),g=iu),this.curveType==="centripetal"||this.curveType==="chordal"){const _=this.curveType==="chordal"?.5:.25;let T=Math.pow(d.distanceToSquared(y),_),L=Math.pow(y.distanceToSquared(x),_),P=Math.pow(x.distanceToSquared(g),_);L<1e-4&&(L=1),T<1e-4&&(T=L),P<1e-4&&(P=L),Th.initNonuniformCatmullRom(d.x,y.x,x.x,g.x,T,L,P),Eh.initNonuniformCatmullRom(d.y,y.y,x.y,g.y,T,L,P),Ah.initNonuniformCatmullRom(d.z,y.z,x.z,g.z,T,L,P)}else this.curveType==="catmullrom"&&(Th.initCatmullRom(d.x,y.x,x.x,g.x,this.tension),Eh.initCatmullRom(d.y,y.y,x.y,g.y,this.tension),Ah.initCatmullRom(d.z,y.z,x.z,g.z,this.tension));return i.set(Th.calc(p),Eh.calc(p),Ah.calc(p)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const a=e.points[t];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const a=this.points[t];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const a=e.points[t];this.points.push(new V().fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}hg.prototype.isCatmullRomCurve3=!0;function fg(r,e,t,i,a){const o=(i-e)*.5,h=(a-t)*.5,f=r*r,p=r*f;return(2*t-2*i+o+h)*p+(-3*t+3*i-2*o-h)*f+o*r+t}function X1(r,e){const t=1-r;return t*t*e}function Z1(r,e){return 2*(1-r)*r*e}function q1(r,e){return r*r*e}function ho(r,e,t,i){return X1(r,e)+Z1(r,t)+q1(r,i)}function Y1(r,e){const t=1-r;return t*t*t*e}function j1(r,e){const t=1-r;return 3*t*t*r*e}function J1(r,e){return 3*(1-r)*r*r*e}function K1(r,e){return r*r*r*e}function fo(r,e,t,i,a){return Y1(r,e)+j1(r,t)+J1(r,i)+K1(r,a)}class Lh extends $n{constructor(e=new ye,t=new ye,i=new ye,a=new ye){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=a}getPoint(e,t=new ye){const i=t,a=this.v0,o=this.v1,h=this.v2,f=this.v3;return i.set(fo(e,a.x,o.x,h.x,f.x),fo(e,a.y,o.y,h.y,f.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Lh.prototype.isCubicBezierCurve=!0;class dg extends $n{constructor(e=new V,t=new V,i=new V,a=new V){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=a}getPoint(e,t=new V){const i=t,a=this.v0,o=this.v1,h=this.v2,f=this.v3;return i.set(fo(e,a.x,o.x,h.x,f.x),fo(e,a.y,o.y,h.y,f.y),fo(e,a.z,o.z,h.z,f.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}dg.prototype.isCubicBezierCurve3=!0;class ru extends $n{constructor(e=new ye,t=new ye){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ye){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new ye;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ru.prototype.isLineCurve=!0;class Q1 extends $n{constructor(e=new V,t=new V){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new V){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ch extends $n{constructor(e=new ye,t=new ye,i=new ye){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ye){const i=t,a=this.v0,o=this.v1,h=this.v2;return i.set(ho(e,a.x,o.x,h.x),ho(e,a.y,o.y,h.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ch.prototype.isQuadraticBezierCurve=!0;class pg extends $n{constructor(e=new V,t=new V,i=new V){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new V){const i=t,a=this.v0,o=this.v1,h=this.v2;return i.set(ho(e,a.x,o.x,h.x),ho(e,a.y,o.y,h.y),ho(e,a.z,o.z,h.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}pg.prototype.isQuadraticBezierCurve3=!0;class Rh extends $n{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new ye){const i=t,a=this.points,o=(a.length-1)*e,h=Math.floor(o),f=o-h,p=a[h===0?h:h-1],d=a[h],g=a[h>a.length-2?a.length-1:h+1],y=a[h>a.length-3?a.length-1:h+2];return i.set(fg(f,p.x,d.x,g.x,y.x),fg(f,p.y,d.y,g.y,y.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const a=e.points[t];this.points.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const a=this.points[t];e.points.push(a.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const a=e.points[t];this.points.push(new ye().fromArray(a))}return this}}Rh.prototype.isSplineCurve=!0;var mg=Object.freeze({__proto__:null,ArcCurve:cg,CatmullRomCurve3:hg,CubicBezierCurve:Lh,CubicBezierCurve3:dg,EllipseCurve:nu,LineCurve:ru,LineCurve3:Q1,QuadraticBezierCurve:Ch,QuadraticBezierCurve3:pg,SplineCurve:Rh});class $1 extends $n{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ru(t,e))}getPoint(e,t){const i=e*this.getLength(),a=this.getCurveLengths();let o=0;for(;o<a.length;){if(a[o]>=i){const h=a[o]-i,f=this.curves[o],p=f.getLength(),d=p===0?0:1-h/p;return f.getPointAt(d,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,a=this.curves.length;i<a;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let a=0,o=this.curves;a<o.length;a++){const h=o[a],f=h&&h.isEllipseCurve?e*2:h&&(h.isLineCurve||h.isLineCurve3)?1:h&&h.isSplineCurve?e*h.points.length:e,p=h.getPoints(f);for(let d=0;d<p.length;d++){const g=p[d];i&&i.equals(g)||(t.push(g),i=g)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const a=e.curves[t];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const a=this.curves[t];e.curves.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const a=e.curves[t];this.curves.push(new mg[a.type]().fromJSON(a))}return this}}class Ph extends $1{constructor(e){super();this.type="Path",this.currentPoint=new ye,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new ru(this.currentPoint.clone(),new ye(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,a){const o=new Ch(this.currentPoint.clone(),new ye(e,t),new ye(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}bezierCurveTo(e,t,i,a,o,h){const f=new Lh(this.currentPoint.clone(),new ye(e,t),new ye(i,a),new ye(o,h));return this.curves.push(f),this.currentPoint.set(o,h),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new Rh(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,a,o,h){const f=this.currentPoint.x,p=this.currentPoint.y;return this.absarc(e+f,t+p,i,a,o,h),this}absarc(e,t,i,a,o,h){return this.absellipse(e,t,i,i,a,o,h),this}ellipse(e,t,i,a,o,h,f,p){const d=this.currentPoint.x,g=this.currentPoint.y;return this.absellipse(e+d,t+g,i,a,o,h,f,p),this}absellipse(e,t,i,a,o,h,f,p){const d=new nu(e,t,i,a,o,h,f,p);if(this.curves.length>0){const y=d.getPoint(0);y.equals(this.currentPoint)||this.lineTo(y.x,y.y)}this.curves.push(d);const g=d.getPoint(1);return this.currentPoint.copy(g),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class po extends Ph{constructor(e){super(e);this.uuid=ai(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,a=this.holes.length;i<a;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const a=e.holes[t];this.holes.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const a=this.holes[t];e.holes.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const a=e.holes[t];this.holes.push(new Ph().fromJSON(a))}return this}}const eT={triangulate:function(r,e,t=2){const i=e&&e.length,a=i?e[0]*t:r.length;let o=gg(r,0,a,t,!0);const h=[];if(!o||o.next===o.prev)return h;let f,p,d,g,y,x,_;if(i&&(o=sT(r,e,o,t)),r.length>80*t){f=d=r[0],p=g=r[1];for(let T=t;T<a;T+=t)y=r[T],x=r[T+1],y<f&&(f=y),x<p&&(p=x),y>d&&(d=y),x>g&&(g=x);_=Math.max(d-f,g-p),_=_!==0?1/_:0}return mo(o,h,t,f,p,_),h}};function gg(r,e,t,i,a){let o,h;if(a===gT(r,e,t,i)>0)for(o=e;o<t;o+=i)h=yg(o,r[o],r[o+1],h);else for(o=t-i;o>=e;o-=i)h=yg(o,r[o],r[o+1],h);return h&&su(h,h.next)&&(vo(h),h=h.next),h}function fr(r,e){if(!r)return r;e||(e=r);let t=r,i;do if(i=!1,!t.steiner&&(su(t,t.next)||Ht(t.prev,t,t.next)===0)){if(vo(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function mo(r,e,t,i,a,o,h){if(!r)return;!h&&o&&cT(r,i,a,o);let f=r,p,d;for(;r.prev!==r.next;){if(p=r.prev,d=r.next,o?nT(r,i,a,o):tT(r)){e.push(p.i/t),e.push(r.i/t),e.push(d.i/t),vo(r),r=d.next,f=d.next;continue}if(r=d,r===f){h?h===1?(r=iT(fr(r),e,t),mo(r,e,t,i,a,o,2)):h===2&&rT(r,e,t,i,a,o):mo(fr(r),e,t,i,a,o,1);break}}}function tT(r){const e=r.prev,t=r,i=r.next;if(Ht(e,t,i)>=0)return!1;let a=r.next.next;for(;a!==r.prev;){if(ia(e.x,e.y,t.x,t.y,i.x,i.y,a.x,a.y)&&Ht(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function nT(r,e,t,i){const a=r.prev,o=r,h=r.next;if(Ht(a,o,h)>=0)return!1;const f=a.x<o.x?a.x<h.x?a.x:h.x:o.x<h.x?o.x:h.x,p=a.y<o.y?a.y<h.y?a.y:h.y:o.y<h.y?o.y:h.y,d=a.x>o.x?a.x>h.x?a.x:h.x:o.x>h.x?o.x:h.x,g=a.y>o.y?a.y>h.y?a.y:h.y:o.y>h.y?o.y:h.y,y=Dh(f,p,e,t,i),x=Dh(d,g,e,t,i);let _=r.prevZ,T=r.nextZ;for(;_&&_.z>=y&&T&&T.z<=x;){if(_!==r.prev&&_!==r.next&&ia(a.x,a.y,o.x,o.y,h.x,h.y,_.x,_.y)&&Ht(_.prev,_,_.next)>=0||(_=_.prevZ,T!==r.prev&&T!==r.next&&ia(a.x,a.y,o.x,o.y,h.x,h.y,T.x,T.y)&&Ht(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;_&&_.z>=y;){if(_!==r.prev&&_!==r.next&&ia(a.x,a.y,o.x,o.y,h.x,h.y,_.x,_.y)&&Ht(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;T&&T.z<=x;){if(T!==r.prev&&T!==r.next&&ia(a.x,a.y,o.x,o.y,h.x,h.y,T.x,T.y)&&Ht(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function iT(r,e,t){let i=r;do{const a=i.prev,o=i.next.next;!su(a,o)&&vg(a,i,i.next,o)&&go(a,o)&&go(o,a)&&(e.push(a.i/t),e.push(i.i/t),e.push(o.i/t),vo(i),vo(i.next),i=r=o),i=i.next}while(i!==r);return fr(i)}function rT(r,e,t,i,a,o){let h=r;do{let f=h.next.next;for(;f!==h.prev;){if(h.i!==f.i&&dT(h,f)){let p=xg(h,f);h=fr(h,h.next),p=fr(p,p.next),mo(h,e,t,i,a,o),mo(p,e,t,i,a,o);return}f=f.next}h=h.next}while(h!==r)}function sT(r,e,t,i){const a=[];let o,h,f,p,d;for(o=0,h=e.length;o<h;o++)f=e[o]*i,p=o<h-1?e[o+1]*i:r.length,d=gg(r,f,p,i,!1),d===d.next&&(d.steiner=!0),a.push(fT(d));for(a.sort(aT),o=0;o<a.length;o++)oT(a[o],t),t=fr(t,t.next);return t}function aT(r,e){return r.x-e.x}function oT(r,e){if(e=lT(r,e),e){const t=xg(e,r);fr(e,e.next),fr(t,t.next)}}function lT(r,e){let t=e;const i=r.x,a=r.y;let o=-1/0,h;do{if(a<=t.y&&a>=t.next.y&&t.next.y!==t.y){const x=t.x+(a-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(x<=i&&x>o){if(o=x,x===i){if(a===t.y)return t;if(a===t.next.y)return t.next}h=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!h)return null;if(i===o)return h;const f=h,p=h.x,d=h.y;let g=1/0,y;t=h;do i>=t.x&&t.x>=p&&i!==t.x&&ia(a<d?i:o,a,p,d,a<d?o:i,a,t.x,t.y)&&(y=Math.abs(a-t.y)/(i-t.x),go(t,r)&&(y<g||y===g&&(t.x>h.x||t.x===h.x&&uT(h,t)))&&(h=t,g=y)),t=t.next;while(t!==f);return h}function uT(r,e){return Ht(r.prev,r,e.prev)<0&&Ht(e.next,r,r.next)<0}function cT(r,e,t,i){let a=r;do a.z===null&&(a.z=Dh(a.x,a.y,e,t,i)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==r);a.prevZ.nextZ=null,a.prevZ=null,hT(a)}function hT(r){let e,t,i,a,o,h,f,p,d=1;do{for(t=r,r=null,o=null,h=0;t;){for(h++,i=t,f=0,e=0;e<d&&(f++,i=i.nextZ,!!i);e++);for(p=d;f>0||p>0&&i;)f!==0&&(p===0||!i||t.z<=i.z)?(a=t,t=t.nextZ,f--):(a=i,i=i.nextZ,p--),o?o.nextZ=a:r=a,a.prevZ=o,o=a;t=i}o.nextZ=null,d*=2}while(h>1);return r}function Dh(r,e,t,i,a){return r=32767*(r-t)*a,e=32767*(e-i)*a,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function fT(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function ia(r,e,t,i,a,o,h,f){return(a-h)*(e-f)-(r-h)*(o-f)>=0&&(r-h)*(i-f)-(t-h)*(e-f)>=0&&(t-h)*(o-f)-(a-h)*(i-f)>=0}function dT(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!pT(r,e)&&(go(r,e)&&go(e,r)&&mT(r,e)&&(Ht(r.prev,r,e.prev)||Ht(r,e.prev,e))||su(r,e)&&Ht(r.prev,r,r.next)>0&&Ht(e.prev,e,e.next)>0)}function Ht(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function su(r,e){return r.x===e.x&&r.y===e.y}function vg(r,e,t,i){const a=ou(Ht(r,e,t)),o=ou(Ht(r,e,i)),h=ou(Ht(t,i,r)),f=ou(Ht(t,i,e));return!!(a!==o&&h!==f||a===0&&au(r,t,e)||o===0&&au(r,i,e)||h===0&&au(t,r,i)||f===0&&au(t,e,i))}function au(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function ou(r){return r>0?1:r<0?-1:0}function pT(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&vg(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function go(r,e){return Ht(r.prev,r,r.next)<0?Ht(r,e,r.next)>=0&&Ht(r,r.prev,e)>=0:Ht(r,e,r.prev)<0||Ht(r,r.next,e)<0}function mT(r,e){let t=r,i=!1;const a=(r.x+e.x)/2,o=(r.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&a<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function xg(r,e){const t=new Ih(r.i,r.x,r.y),i=new Ih(e.i,e.x,e.y),a=r.next,o=e.prev;return r.next=e,e.prev=r,t.next=a,a.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function yg(r,e,t,i){const a=new Ih(r,e,t);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function vo(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ih(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gT(r,e,t,i){let a=0;for(let o=e,h=t-i;o<t;o+=i)a+=(r[h]-r[o])*(r[o+1]+r[h+1]),h=o;return a}class dr{static area(e){const t=e.length;let i=0;for(let a=t-1,o=0;o<t;a=o++)i+=e[a].x*e[o].y-e[o].x*e[a].y;return i*.5}static isClockWise(e){return dr.area(e)<0}static triangulateShape(e,t){const i=[],a=[],o=[];_g(e),bg(i,e);let h=e.length;t.forEach(_g);for(let p=0;p<t.length;p++)a.push(h),h+=t[p].length,bg(i,t[p]);const f=eT.triangulate(i,a);for(let p=0;p<f.length;p+=3)o.push(f.slice(p,p+3));return o}}function _g(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function bg(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}class ra extends kt{constructor(e=new po([new ye(.5,.5),new ye(-.5,.5),new ye(-.5,-.5),new ye(.5,-.5)]),t={}){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,a=[],o=[];for(let f=0,p=e.length;f<p;f++){const d=e[f];h(d)}this.setAttribute("position",new jt(a,3)),this.setAttribute("uv",new jt(o,2)),this.computeVertexNormals();function h(f){const p=[],d=t.curveSegments!==void 0?t.curveSegments:12,g=t.steps!==void 0?t.steps:1;let y=t.depth!==void 0?t.depth:1,x=t.bevelEnabled!==void 0?t.bevelEnabled:!0,_=t.bevelThickness!==void 0?t.bevelThickness:.2,T=t.bevelSize!==void 0?t.bevelSize:_-.1,L=t.bevelOffset!==void 0?t.bevelOffset:0,P=t.bevelSegments!==void 0?t.bevelSegments:3;const M=t.extrudePath,w=t.UVGenerator!==void 0?t.UVGenerator:vT;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),y=t.amount);let N,C=!1,k,q,R,J;M&&(N=M.getSpacedPoints(g),C=!0,x=!1,k=M.computeFrenetFrames(g,!1),q=new V,R=new V,J=new V),x||(P=0,_=0,T=0,L=0);const oe=f.extractPoints(d);let Q=oe.shape;const X=oe.holes;if(!dr.isClockWise(Q)){Q=Q.reverse();for(let se=0,be=X.length;se<be;se++){const Le=X[se];dr.isClockWise(Le)&&(X[se]=Le.reverse())}}const H=dr.triangulateShape(Q,X),W=Q;for(let se=0,be=X.length;se<be;se++){const Le=X[se];Q=Q.concat(Le)}function D(se,be,Le){return be||console.error("THREE.ExtrudeGeometry: vec does not exist"),be.clone().multiplyScalar(Le).add(se)}const ee=Q.length,te=H.length;function Me(se,be,Le){let me,Ce,tt;const rt=se.x-be.x,ht=se.y-be.y,bt=Le.x-se.x,G=Le.y-se.y,O=rt*rt+ht*ht,pe=rt*G-ht*bt;if(Math.abs(pe)>Number.EPSILON){const de=Math.sqrt(O),qe=Math.sqrt(bt*bt+G*G),Xe=be.x-ht/de,Y=be.y+rt/de,ke=Le.x-G/qe,z=Le.y+bt/qe,ne=((ke-Xe)*G-(z-Y)*bt)/(rt*G-ht*bt);me=Xe+rt*ne-se.x,Ce=Y+ht*ne-se.y;const ve=me*me+Ce*Ce;if(ve<=2)return new ye(me,Ce);tt=Math.sqrt(ve/2)}else{let de=!1;rt>Number.EPSILON?bt>Number.EPSILON&&(de=!0):rt<-Number.EPSILON?bt<-Number.EPSILON&&(de=!0):Math.sign(ht)===Math.sign(G)&&(de=!0),de?(me=-ht,Ce=rt,tt=Math.sqrt(O)):(me=rt,Ce=ht,tt=Math.sqrt(O/2))}return new ye(me/tt,Ce/tt)}const Oe=[];for(let se=0,be=W.length,Le=be-1,me=se+1;se<be;se++,Le++,me++)Le===be&&(Le=0),me===be&&(me=0),Oe[se]=Me(W[se],W[Le],W[me]);const ce=[];let ue,We=Oe.concat();for(let se=0,be=X.length;se<be;se++){const Le=X[se];ue=[];for(let me=0,Ce=Le.length,tt=Ce-1,rt=me+1;me<Ce;me++,tt++,rt++)tt===Ce&&(tt=0),rt===Ce&&(rt=0),ue[me]=Me(Le[me],Le[tt],Le[rt]);ce.push(ue),We=We.concat(ue)}for(let se=0;se<P;se++){const be=se/P,Le=_*Math.cos(be*Math.PI/2),me=T*Math.sin(be*Math.PI/2)+L;for(let Ce=0,tt=W.length;Ce<tt;Ce++){const rt=D(W[Ce],Oe[Ce],me);Ae(rt.x,rt.y,-Le)}for(let Ce=0,tt=X.length;Ce<tt;Ce++){const rt=X[Ce];ue=ce[Ce];for(let ht=0,bt=rt.length;ht<bt;ht++){const G=D(rt[ht],ue[ht],me);Ae(G.x,G.y,-Le)}}}const Pe=T+L;for(let se=0;se<ee;se++){const be=x?D(Q[se],We[se],Pe):Q[se];C?(R.copy(k.normals[0]).multiplyScalar(be.x),q.copy(k.binormals[0]).multiplyScalar(be.y),J.copy(N[0]).add(R).add(q),Ae(J.x,J.y,J.z)):Ae(be.x,be.y,0)}for(let se=1;se<=g;se++)for(let be=0;be<ee;be++){const Le=x?D(Q[be],We[be],Pe):Q[be];C?(R.copy(k.normals[se]).multiplyScalar(Le.x),q.copy(k.binormals[se]).multiplyScalar(Le.y),J.copy(N[se]).add(R).add(q),Ae(J.x,J.y,J.z)):Ae(Le.x,Le.y,y/g*se)}for(let se=P-1;se>=0;se--){const be=se/P,Le=_*Math.cos(be*Math.PI/2),me=T*Math.sin(be*Math.PI/2)+L;for(let Ce=0,tt=W.length;Ce<tt;Ce++){const rt=D(W[Ce],Oe[Ce],me);Ae(rt.x,rt.y,y+Le)}for(let Ce=0,tt=X.length;Ce<tt;Ce++){const rt=X[Ce];ue=ce[Ce];for(let ht=0,bt=rt.length;ht<bt;ht++){const G=D(rt[ht],ue[ht],me);C?Ae(G.x,G.y+N[g-1].y,N[g-1].x+Le):Ae(G.x,G.y,y+Le)}}}ze(),$e();function ze(){const se=a.length/3;if(x){let be=0,Le=ee*be;for(let me=0;me<te;me++){const Ce=H[me];Re(Ce[2]+Le,Ce[1]+Le,Ce[0]+Le)}be=g+P*2,Le=ee*be;for(let me=0;me<te;me++){const Ce=H[me];Re(Ce[0]+Le,Ce[1]+Le,Ce[2]+Le)}}else{for(let be=0;be<te;be++){const Le=H[be];Re(Le[2],Le[1],Le[0])}for(let be=0;be<te;be++){const Le=H[be];Re(Le[0]+ee*g,Le[1]+ee*g,Le[2]+ee*g)}}i.addGroup(se,a.length/3-se,0)}function $e(){const se=a.length/3;let be=0;K(W,be),be+=W.length;for(let Le=0,me=X.length;Le<me;Le++){const Ce=X[Le];K(Ce,be),be+=Ce.length}i.addGroup(se,a.length/3-se,1)}function K(se,be){let Le=se.length;for(;--Le>=0;){const me=Le;let Ce=Le-1;Ce<0&&(Ce=se.length-1);for(let tt=0,rt=g+P*2;tt<rt;tt++){const ht=ee*tt,bt=ee*(tt+1),G=be+me+ht,O=be+Ce+ht,pe=be+Ce+bt,de=be+me+bt;Ee(G,O,pe,de)}}}function Ae(se,be,Le){p.push(se),p.push(be),p.push(Le)}function Re(se,be,Le){Je(se),Je(be),Je(Le);const me=a.length/3,Ce=w.generateTopUV(i,a,me-3,me-2,me-1);Ze(Ce[0]),Ze(Ce[1]),Ze(Ce[2])}function Ee(se,be,Le,me){Je(se),Je(be),Je(me),Je(be),Je(Le),Je(me);const Ce=a.length/3,tt=w.generateSideWallUV(i,a,Ce-6,Ce-3,Ce-2,Ce-1);Ze(tt[0]),Ze(tt[1]),Ze(tt[3]),Ze(tt[1]),Ze(tt[2]),Ze(tt[3])}function Je(se){a.push(p[se*3+0]),a.push(p[se*3+1]),a.push(p[se*3+2])}function Ze(se){o.push(se.x),o.push(se.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return xT(t,i,e)}static fromJSON(e,t){const i=[];for(let o=0,h=e.shapes.length;o<h;o++){const f=t[e.shapes[o]];i.push(f)}const a=e.options.extrudePath;return a!==void 0&&(e.options.extrudePath=new mg[a.type]().fromJSON(a)),new ra(i,e.options)}}const vT={generateTopUV:function(r,e,t,i,a){const o=e[t*3],h=e[t*3+1],f=e[i*3],p=e[i*3+1],d=e[a*3],g=e[a*3+1];return[new ye(o,h),new ye(f,p),new ye(d,g)]},generateSideWallUV:function(r,e,t,i,a,o){const h=e[t*3],f=e[t*3+1],p=e[t*3+2],d=e[i*3],g=e[i*3+1],y=e[i*3+2],x=e[a*3],_=e[a*3+1],T=e[a*3+2],L=e[o*3],P=e[o*3+1],M=e[o*3+2];return Math.abs(f-g)<Math.abs(h-d)?[new ye(h,1-p),new ye(d,1-y),new ye(x,1-T),new ye(L,1-M)]:[new ye(f,1-p),new ye(g,1-y),new ye(_,1-T),new ye(P,1-M)]}};function xT(r,e,t){if(t.shapes=[],Array.isArray(r))for(let i=0,a=r.length;i<a;i++){const o=r[i];t.shapes.push(o.uuid)}else t.shapes.push(r.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class kh extends kt{constructor(e=new po([new ye(0,.5),new ye(-.5,-.5),new ye(.5,-.5)]),t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],a=[],o=[],h=[];let f=0,p=0;if(Array.isArray(e)===!1)d(e);else for(let g=0;g<e.length;g++)d(e[g]),this.addGroup(f,p,g),f+=p,p=0;this.setIndex(i),this.setAttribute("position",new jt(a,3)),this.setAttribute("normal",new jt(o,3)),this.setAttribute("uv",new jt(h,2));function d(g){const y=a.length/3,x=g.extractPoints(t);let _=x.shape;const T=x.holes;dr.isClockWise(_)===!1&&(_=_.reverse());for(let P=0,M=T.length;P<M;P++){const w=T[P];dr.isClockWise(w)===!0&&(T[P]=w.reverse())}const L=dr.triangulateShape(_,T);for(let P=0,M=T.length;P<M;P++){const w=T[P];_=_.concat(w)}for(let P=0,M=_.length;P<M;P++){const w=_[P];a.push(w.x,w.y,0),o.push(0,0,1),h.push(w.x,w.y)}for(let P=0,M=L.length;P<M;P++){const w=L[P],N=w[0]+y,C=w[1]+y,k=w[2]+y;i.push(N,C,k),p+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return yT(t,e)}static fromJSON(e,t){const i=[];for(let a=0,o=e.shapes.length;a<o;a++){const h=t[e.shapes[a]];i.push(h)}return new kh(i,e.curveSegments)}}function yT(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,i=r.length;t<i;t++){const a=r[t];e.shapes.push(a.uuid)}else e.shapes.push(r.uuid);return e}class _T extends Tn{constructor(e){super();this.type="ShadowMaterial",this.color=new et(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}_T.prototype.isShadowMaterial=!0;class wg extends Tn{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new et(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}wg.prototype.isMeshStandardMaterial=!0;class bT extends wg{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ye(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Mn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new et(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new et(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new et(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}bT.prototype.isMeshPhysicalMaterial=!0;class wT extends Tn{constructor(e){super();this.type="MeshPhongMaterial",this.color=new et(16777215),this.specular=new et(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}wT.prototype.isMeshPhongMaterial=!0;class MT extends Tn{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new et(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}MT.prototype.isMeshToonMaterial=!0;class ST extends Tn{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}ST.prototype.isMeshNormalMaterial=!0;class TT extends Tn{constructor(e){super();this.type="MeshLambertMaterial",this.color=new et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}TT.prototype.isMeshLambertMaterial=!0;class ET extends Tn{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new et(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}ET.prototype.isMeshMatcapMaterial=!0;class AT extends na{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}AT.prototype.isLineDashedMaterial=!0;const Ft={arraySlice:function(r,e,t){return Ft.isTypedArray(r)?new r.constructor(r.subarray(e,t!==void 0?t:r.length)):r.slice(e,t)},convertArray:function(r,e,t){return!r||!t&&r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)},isTypedArray:function(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)},getKeyframeOrder:function(r){function e(a,o){return r[a]-r[o]}const t=r.length,i=new Array(t);for(let a=0;a!==t;++a)i[a]=a;return i.sort(e),i},sortedArray:function(r,e,t){const i=r.length,a=new r.constructor(i);for(let o=0,h=0;h!==i;++o){const f=t[o]*e;for(let p=0;p!==e;++p)a[h++]=r[f+p]}return a},flattenJSON:function(r,e,t,i){let a=1,o=r[0];for(;o!==void 0&&o[i]===void 0;)o=r[a++];if(o===void 0)return;let h=o[i];if(h!==void 0)if(Array.isArray(h))do h=o[i],h!==void 0&&(e.push(o.time),t.push.apply(t,h)),o=r[a++];while(o!==void 0);else if(h.toArray!==void 0)do h=o[i],h!==void 0&&(e.push(o.time),h.toArray(t,t.length)),o=r[a++];while(o!==void 0);else do h=o[i],h!==void 0&&(e.push(o.time),t.push(h)),o=r[a++];while(o!==void 0)},subclip:function(r,e,t,i,a=30){const o=r.clone();o.name=e;const h=[];for(let p=0;p<o.tracks.length;++p){const d=o.tracks[p],g=d.getValueSize(),y=[],x=[];for(let _=0;_<d.times.length;++_){const T=d.times[_]*a;if(!(T<t||T>=i)){y.push(d.times[_]);for(let L=0;L<g;++L)x.push(d.values[_*g+L])}}y.length!==0&&(d.times=Ft.convertArray(y,d.times.constructor),d.values=Ft.convertArray(x,d.values.constructor),h.push(d))}o.tracks=h;let f=1/0;for(let p=0;p<o.tracks.length;++p)f>o.tracks[p].times[0]&&(f=o.tracks[p].times[0]);for(let p=0;p<o.tracks.length;++p)o.tracks[p].shift(-1*f);return o.resetDuration(),o},makeClipAdditive:function(r,e=0,t=r,i=30){i<=0&&(i=30);const a=t.tracks.length,o=e/i;for(let h=0;h<a;++h){const f=t.tracks[h],p=f.ValueTypeName;if(p==="bool"||p==="string")continue;const d=r.tracks.find(function(M){return M.name===f.name&&M.ValueTypeName===p});if(d===void 0)continue;let g=0;const y=f.getValueSize();f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=y/3);let x=0;const _=d.getValueSize();d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=_/3);const T=f.times.length-1;let L;if(o<=f.times[0]){const M=g,w=y-g;L=Ft.arraySlice(f.values,M,w)}else if(o>=f.times[T]){const M=T*y+g,w=M+y-g;L=Ft.arraySlice(f.values,M,w)}else{const M=f.createInterpolant(),w=g,N=y-g;M.evaluate(o),L=Ft.arraySlice(M.resultBuffer,w,N)}p==="quaternion"&&new Sn().fromArray(L).normalize().conjugate().toArray(L);const P=d.times.length;for(let M=0;M<P;++M){const w=M*_+x;if(p==="quaternion")Sn.multiplyQuaternionsFlat(d.values,w,L,0,d.values,w);else{const N=_-x*2;for(let C=0;C<N;++C)d.values[w+C]-=L[C]}}}return r.blendMode=Op,r}};class pr{constructor(e,t,i,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=a!==void 0?a:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,a=t[i],o=t[i-1];e:{t:{let h;n:{i:if(!(e<a)){for(let f=i+2;;){if(a===void 0){if(e<o)break i;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,o)}if(i===f)break;if(o=a,a=t[++i],e<a)break t}h=t.length;break n}if(!(e>=o)){const f=t[1];e<f&&(i=2,o=f);for(let p=i-2;;){if(o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,a);if(i===p)break;if(a=o,o=t[--i-1],e>=o)break t}h=i,i=0;break n}break e}for(;i<h;){const f=i+h>>>1;e<t[f]?h=f:i=f+1}if(a=t[i],o=t[i-1],o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,a);if(a===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,o,e)}this._cachedIndex=i,this.intervalChanged_(i,o,a)}return this.interpolate_(i,o,e,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,a=this.valueSize,o=e*a;for(let h=0;h!==a;++h)t[h]=i[o+h];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}pr.prototype.beforeStart_=pr.prototype.copySampleValue_;pr.prototype.afterEnd_=pr.prototype.copySampleValue_;class LT extends pr{constructor(e,t,i,a){super(e,t,i,a);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:As,endingEnd:As}}intervalChanged_(e,t,i){const a=this.parameterPositions;let o=e-2,h=e+1,f=a[o],p=a[h];if(f===void 0)switch(this.getSettings_().endingStart){case Ls:o=e,f=2*t-i;break;case _l:o=a.length-2,f=t+a[o]-a[o+1];break;default:o=e,f=i}if(p===void 0)switch(this.getSettings_().endingEnd){case Ls:h=e,p=2*i-t;break;case _l:h=1,p=i+a[1]-a[0];break;default:h=e-1,p=t}const d=(i-t)*.5,g=this.valueSize;this._weightPrev=d/(t-f),this._weightNext=d/(p-i),this._offsetPrev=o*g,this._offsetNext=h*g}interpolate_(e,t,i,a){const o=this.resultBuffer,h=this.sampleValues,f=this.valueSize,p=e*f,d=p-f,g=this._offsetPrev,y=this._offsetNext,x=this._weightPrev,_=this._weightNext,T=(i-t)/(a-t),L=T*T,P=L*T,M=-x*P+2*x*L-x*T,w=(1+x)*P+(-1.5-2*x)*L+(-.5+x)*T+1,N=(-1-_)*P+(1.5+_)*L+.5*T,C=_*P-_*L;for(let k=0;k!==f;++k)o[k]=M*h[g+k]+w*h[d+k]+N*h[p+k]+C*h[y+k];return o}}class Mg extends pr{constructor(e,t,i,a){super(e,t,i,a)}interpolate_(e,t,i,a){const o=this.resultBuffer,h=this.sampleValues,f=this.valueSize,p=e*f,d=p-f,g=(i-t)/(a-t),y=1-g;for(let x=0;x!==f;++x)o[x]=h[d+x]*y+h[p+x]*g;return o}}class CT extends pr{constructor(e,t,i,a){super(e,t,i,a)}interpolate_(e){return this.copySampleValue_(e-1)}}class yi{constructor(e,t,i,a){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ft.convertArray(t,this.TimeBufferType),this.values=Ft.convertArray(i,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Ft.convertArray(e.times,Array),values:Ft.convertArray(e.values,Array)};const a=e.getInterpolation();a!==e.DefaultInterpolation&&(i.interpolation=a)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new CT(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Mg(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new LT(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case xl:t=this.InterpolantFactoryMethodDiscrete;break;case yl:t=this.InterpolantFactoryMethodLinear;break;case Lc:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xl;case this.InterpolantFactoryMethodLinear:return yl;case this.InterpolantFactoryMethodSmooth:return Lc}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,a=t.length;i!==a;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,a=t.length;i!==a;++i)t[i]*=e}return this}trim(e,t){const i=this.times,a=i.length;let o=0,h=a-1;for(;o!==a&&i[o]<e;)++o;for(;h!==-1&&i[h]>t;)--h;if(++h,o!==0||h!==a){o>=h&&(h=Math.max(h,1),o=h-1);const f=this.getValueSize();this.times=Ft.arraySlice(i,o,h),this.values=Ft.arraySlice(this.values,o*f,h*f)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,a=this.values,o=i.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let h=null;for(let f=0;f!==o;f++){const p=i[f];if(typeof p=="number"&&isNaN(p)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,p),e=!1;break}if(h!==null&&h>p){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,p,h),e=!1;break}h=p}if(a!==void 0&&Ft.isTypedArray(a))for(let f=0,p=a.length;f!==p;++f){const d=a[f];if(isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,d),e=!1;break}}return e}optimize(){const e=Ft.arraySlice(this.times),t=Ft.arraySlice(this.values),i=this.getValueSize(),a=this.getInterpolation()===Lc,o=e.length-1;let h=1;for(let f=1;f<o;++f){let p=!1;const d=e[f],g=e[f+1];if(d!==g&&(f!==1||d!==e[0]))if(a)p=!0;else{const y=f*i,x=y-i,_=y+i;for(let T=0;T!==i;++T){const L=t[y+T];if(L!==t[x+T]||L!==t[_+T]){p=!0;break}}}if(p){if(f!==h){e[h]=e[f];const y=f*i,x=h*i;for(let _=0;_!==i;++_)t[x+_]=t[y+_]}++h}}if(o>0){e[h]=e[o];for(let f=o*i,p=h*i,d=0;d!==i;++d)t[p+d]=t[f+d];++h}return h!==e.length?(this.times=Ft.arraySlice(e,0,h),this.values=Ft.arraySlice(t,0,h*i)):(this.times=e,this.values=t),this}clone(){const e=Ft.arraySlice(this.times,0),t=Ft.arraySlice(this.values,0),i=this.constructor,a=new i(this.name,e,t);return a.createInterpolant=this.createInterpolant,a}}yi.prototype.TimeBufferType=Float32Array;yi.prototype.ValueBufferType=Float32Array;yi.prototype.DefaultInterpolation=yl;class sa extends yi{}sa.prototype.ValueTypeName="bool";sa.prototype.ValueBufferType=Array;sa.prototype.DefaultInterpolation=xl;sa.prototype.InterpolantFactoryMethodLinear=void 0;sa.prototype.InterpolantFactoryMethodSmooth=void 0;class Sg extends yi{}Sg.prototype.ValueTypeName="color";class lu extends yi{}lu.prototype.ValueTypeName="number";class RT extends pr{constructor(e,t,i,a){super(e,t,i,a)}interpolate_(e,t,i,a){const o=this.resultBuffer,h=this.sampleValues,f=this.valueSize,p=(i-t)/(a-t);let d=e*f;for(let g=d+f;d!==g;d+=4)Sn.slerpFlat(o,0,h,d-f,h,d,p);return o}}class xo extends yi{InterpolantFactoryMethodLinear(e){return new RT(this.times,this.values,this.getValueSize(),e)}}xo.prototype.ValueTypeName="quaternion";xo.prototype.DefaultInterpolation=yl;xo.prototype.InterpolantFactoryMethodSmooth=void 0;class aa extends yi{}aa.prototype.ValueTypeName="string";aa.prototype.ValueBufferType=Array;aa.prototype.DefaultInterpolation=xl;aa.prototype.InterpolantFactoryMethodLinear=void 0;aa.prototype.InterpolantFactoryMethodSmooth=void 0;class uu extends yi{}uu.prototype.ValueTypeName="vector";class Tg{constructor(e,t=-1,i,a=Cc){this.name=e,this.tracks=i,this.duration=t,this.blendMode=a,this.uuid=ai(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,a=1/(e.fps||1);for(let h=0,f=i.length;h!==f;++h)t.push(DT(i[h]).scale(a));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],i=e.tracks,a={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,h=i.length;o!==h;++o)t.push(yi.toJSON(i[o]));return a}static CreateFromMorphTargetSequence(e,t,i,a){const o=t.length,h=[];for(let f=0;f<o;f++){let p=[],d=[];p.push((f+o-1)%o,f,(f+1)%o),d.push(0,1,0);const g=Ft.getKeyframeOrder(p);p=Ft.sortedArray(p,1,g),d=Ft.sortedArray(d,1,g),!a&&p[0]===0&&(p.push(o),d.push(d[0])),h.push(new lu(".morphTargetInfluences["+t[f].name+"]",p,d).scale(1/i))}return new this(e,-1,h)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const a=e;i=a.geometry&&a.geometry.animations||a.animations}for(let a=0;a<i.length;a++)if(i[a].name===t)return i[a];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const a={},o=/^([\w-]*?)([\d]+)$/;for(let f=0,p=e.length;f<p;f++){const d=e[f],g=d.name.match(o);if(g&&g.length>1){const y=g[1];let x=a[y];x||(a[y]=x=[]),x.push(d)}}const h=[];for(const f in a)h.push(this.CreateFromMorphTargetSequence(f,a[f],t,i));return h}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(y,x,_,T,L){if(_.length!==0){const P=[],M=[];Ft.flattenJSON(_,P,M,T),P.length!==0&&L.push(new y(x,P,M))}},a=[],o=e.name||"default",h=e.fps||30,f=e.blendMode;let p=e.length||-1;const d=e.hierarchy||[];for(let y=0;y<d.length;y++){const x=d[y].keys;if(!(!x||x.length===0))if(x[0].morphTargets){const _={};let T;for(T=0;T<x.length;T++)if(x[T].morphTargets)for(let L=0;L<x[T].morphTargets.length;L++)_[x[T].morphTargets[L]]=-1;for(const L in _){const P=[],M=[];for(let w=0;w!==x[T].morphTargets.length;++w){const N=x[T];P.push(N.time),M.push(N.morphTarget===L?1:0)}a.push(new lu(".morphTargetInfluence["+L+"]",P,M))}p=_.length*(h||1)}else{const _=".bones["+t[y].name+"]";i(uu,_+".position",x,"pos",a),i(xo,_+".quaternion",x,"rot",a),i(uu,_+".scale",x,"scl",a)}}return a.length===0?null:new this(o,p,a,f)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,a=e.length;i!==a;++i){const o=this.tracks[i];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function PT(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return lu;case"vector":case"vector2":case"vector3":case"vector4":return uu;case"color":return Sg;case"quaternion":return xo;case"bool":case"boolean":return sa;case"string":return aa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function DT(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=PT(r.type);if(r.times===void 0){const t=[],i=[];Ft.flattenJSON(r.keys,t,i,"value"),r.times=t,r.values=i}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const oa={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class IT{constructor(e,t,i){const a=this;let o=!1,h=0,f=0,p;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(g){f++,o===!1&&a.onStart!==void 0&&a.onStart(g,h,f),o=!0},this.itemEnd=function(g){h++,a.onProgress!==void 0&&a.onProgress(g,h,f),h===f&&(o=!1,a.onLoad!==void 0&&a.onLoad())},this.itemError=function(g){a.onError!==void 0&&a.onError(g)},this.resolveURL=function(g){return p?p(g):g},this.setURLModifier=function(g){return p=g,this},this.addHandler=function(g,y){return d.push(g,y),this},this.removeHandler=function(g){const y=d.indexOf(g);return y!==-1&&d.splice(y,2),this},this.getHandler=function(g){for(let y=0,x=d.length;y<x;y+=2){const _=d[y],T=d[y+1];if(_.global&&(_.lastIndex=0),_.test(g))return T}return null}}}const kT=new IT;class mr{constructor(e){this.manager=e!==void 0?e:kT,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(a,o){i.load(e,a,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Bi={};class NT extends mr{constructor(e){super(e)}load(e,t,i,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=oa.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(Bi[e]!==void 0){Bi[e].push({onLoad:t,onProgress:i,onError:a});return}Bi[e]=[],Bi[e].push({onLoad:t,onProgress:i,onError:a});const h=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(h).then(f=>{if(f.status===200||f.status===0){f.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const p=Bi[e],d=f.body.getReader(),g=f.headers.get("Content-Length"),y=g?parseInt(g):0,x=y!==0;let _=0;return new ReadableStream({start(T){L();function L(){d.read().then(({done:P,value:M})=>{if(P)T.close();else{_+=M.byteLength;const w=new ProgressEvent("progress",{lengthComputable:x,loaded:_,total:y});for(let N=0,C=p.length;N<C;N++){const k=p[N];k.onProgress&&k.onProgress(w)}T.enqueue(M),L()}})}}})}else throw Error(`fetch for "${f.url}" responded with ${f.status}: ${f.statusText}`)}).then(f=>{const p=new Response(f);switch(this.responseType){case"arraybuffer":return p.arrayBuffer();case"blob":return p.blob();case"document":return p.text().then(d=>new DOMParser().parseFromString(d,this.mimeType));case"json":return p.json();default:return p.text()}}).then(f=>{oa.add(e,f);const p=Bi[e];delete Bi[e];for(let d=0,g=p.length;d<g;d++){const y=p[d];y.onLoad&&y.onLoad(f)}this.manager.itemEnd(e)}).catch(f=>{const p=Bi[e];delete Bi[e];for(let d=0,g=p.length;d<g;d++){const y=p[d];y.onError&&y.onError(f)}this.manager.itemError(e),this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Eg extends mr{constructor(e){super(e)}load(e,t,i,a){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,h=oa.get(e);if(h!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(h),o.manager.itemEnd(e)},0),h;const f=Sl("img");function p(){g(),oa.add(e,this),t&&t(this),o.manager.itemEnd(e)}function d(y){g(),a&&a(y),o.manager.itemError(e),o.manager.itemEnd(e)}function g(){f.removeEventListener("load",p,!1),f.removeEventListener("error",d,!1)}return f.addEventListener("load",p,!1),f.addEventListener("error",d,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(f.crossOrigin=this.crossOrigin),o.manager.itemStart(e),f.src=e,f}}class FT extends mr{constructor(e){super(e)}load(e,t,i,a){const o=new Ul,h=new Eg(this.manager);h.setCrossOrigin(this.crossOrigin),h.setPath(this.path);let f=0;function p(d){h.load(e[d],function(g){o.images[d]=g,f++,f===6&&(o.needsUpdate=!0,t&&t(o))},void 0,a)}for(let d=0;d<e.length;++d)p(d);return o}}class OT extends mr{constructor(e){super(e)}load(e,t,i,a){const o=new vn,h=new Eg(this.manager);return h.setCrossOrigin(this.crossOrigin),h.setPath(this.path),h.load(e,function(f){o.image=f,o.needsUpdate=!0,t!==void 0&&t(o)},i,a),o}}class _i extends Et{constructor(e,t=1){super();this.type="Light",this.color=new et(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}_i.prototype.isLight=!0;class zT extends _i{constructor(e,t,i){super(e,i);this.type="HemisphereLight",this.position.copy(Et.DefaultUp),this.updateMatrix(),this.groundColor=new et(t)}copy(e){return _i.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}zT.prototype.isHemisphereLight=!0;const Ag=new ot,Lg=new V,Cg=new V;class Nh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ye(512,512),this.map=null,this.mapPass=null,this.matrix=new ot,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Gl,this._frameExtents=new ye(1,1),this._viewportCount=1,this._viewports=[new Rt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Lg.setFromMatrixPosition(e.matrixWorld),t.position.copy(Lg),Cg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Cg),t.updateMatrixWorld(),Ag.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ag),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Rg extends Nh{constructor(){super(new Bn(50,1,.5,500));this.focus=1}updateMatrices(e){const t=this.camera,i=ja*2*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(i!==t.fov||a!==t.aspect||o!==t.far)&&(t.fov=i,t.aspect=a,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Rg.prototype.isSpotLightShadow=!0;class BT extends _i{constructor(e,t,i=0,a=Math.PI/3,o=0,h=1){super(e,t);this.type="SpotLight",this.position.copy(Et.DefaultUp),this.updateMatrix(),this.target=new Et,this.distance=i,this.angle=a,this.penumbra=o,this.decay=h,this.shadow=new Rg}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}BT.prototype.isSpotLight=!0;const Pg=new ot,yo=new V,Fh=new V;class Dg extends Nh{constructor(){super(new Bn(90,1,.5,500));this._frameExtents=new ye(4,2),this._viewportCount=6,this._viewports=[new Rt(2,1,1,1),new Rt(0,1,1,1),new Rt(3,1,1,1),new Rt(1,1,1,1),new Rt(3,0,1,1),new Rt(1,0,1,1)],this._cubeDirections=[new V(1,0,0),new V(-1,0,0),new V(0,0,1),new V(0,0,-1),new V(0,1,0),new V(0,-1,0)],this._cubeUps=[new V(0,1,0),new V(0,1,0),new V(0,1,0),new V(0,1,0),new V(0,0,1),new V(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,a=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),yo.setFromMatrixPosition(e.matrixWorld),i.position.copy(yo),Fh.copy(i.position),Fh.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Fh),i.updateMatrixWorld(),a.makeTranslation(-yo.x,-yo.y,-yo.z),Pg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Pg)}}Dg.prototype.isPointLightShadow=!0;class HT extends _i{constructor(e,t,i=0,a=1){super(e,t);this.type="PointLight",this.distance=i,this.decay=a,this.shadow=new Dg}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}HT.prototype.isPointLight=!0;class Ig extends Nh{constructor(){super(new uh(-5,5,5,-5,.5,500))}}Ig.prototype.isDirectionalLightShadow=!0;class UT extends _i{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(Et.DefaultUp),this.updateMatrix(),this.target=new Et,this.shadow=new Ig}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}UT.prototype.isDirectionalLight=!0;class WT extends _i{constructor(e,t){super(e,t);this.type="AmbientLight"}}WT.prototype.isAmbientLight=!0;class GT extends _i{constructor(e,t,i=10,a=10){super(e,t);this.type="RectAreaLight",this.width=i,this.height=a}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}GT.prototype.isRectAreaLight=!0;class kg{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new V)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,a=e.y,o=e.z,h=this.coefficients;return t.copy(h[0]).multiplyScalar(.282095),t.addScaledVector(h[1],.488603*a),t.addScaledVector(h[2],.488603*o),t.addScaledVector(h[3],.488603*i),t.addScaledVector(h[4],1.092548*(i*a)),t.addScaledVector(h[5],1.092548*(a*o)),t.addScaledVector(h[6],.315392*(3*o*o-1)),t.addScaledVector(h[7],1.092548*(i*o)),t.addScaledVector(h[8],.546274*(i*i-a*a)),t}getIrradianceAt(e,t){const i=e.x,a=e.y,o=e.z,h=this.coefficients;return t.copy(h[0]).multiplyScalar(.886227),t.addScaledVector(h[1],2*.511664*a),t.addScaledVector(h[2],2*.511664*o),t.addScaledVector(h[3],2*.511664*i),t.addScaledVector(h[4],2*.429043*i*a),t.addScaledVector(h[5],2*.429043*a*o),t.addScaledVector(h[6],.743125*o*o-.247708),t.addScaledVector(h[7],2*.429043*i*o),t.addScaledVector(h[8],.429043*(i*i-a*a)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let a=0;a<9;a++)i[a].fromArray(e,t+a*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let a=0;a<9;a++)i[a].toArray(e,t+a*3);return e}static getBasisAt(e,t){const i=e.x,a=e.y,o=e.z;t[0]=.282095,t[1]=.488603*a,t[2]=.488603*o,t[3]=.488603*i,t[4]=1.092548*i*a,t[5]=1.092548*a*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*i*o,t[8]=.546274*(i*i-a*a)}}kg.prototype.isSphericalHarmonics3=!0;class Oh extends _i{constructor(e=new kg,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Oh.prototype.isLightProbe=!0;class VT{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let i=0,a=e.length;i<a;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class XT extends kt{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}XT.prototype.isInstancedBufferGeometry=!0;class ZT extends mr{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,h=oa.get(e);if(h!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(h),o.manager.itemEnd(e)},0),h;const f={};f.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",f.headers=this.requestHeader,fetch(e,f).then(function(p){return p.blob()}).then(function(p){return createImageBitmap(p,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(p){oa.add(e,p),t&&t(p),o.manager.itemEnd(e)}).catch(function(p){a&&a(p),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}ZT.prototype.isImageBitmapLoader=!0;let cu;const qT={getContext:function(){return cu===void 0&&(cu=new(window.AudioContext||window.webkitAudioContext)),cu},setContext:function(r){cu=r}};class YT extends mr{constructor(e){super(e)}load(e,t,i,a){const o=this,h=new NT(this.manager);h.setResponseType("arraybuffer"),h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(f){try{const p=f.slice(0);qT.getContext().decodeAudioData(p,function(g){t(g)})}catch(p){a?a(p):console.error(p),o.manager.itemError(e)}},i,a)}}class jT extends Oh{constructor(e,t,i=1){super(void 0,i);const a=new et().set(e),o=new et().set(t),h=new V(a.r,a.g,a.b),f=new V(o.r,o.g,o.b),p=Math.sqrt(Math.PI),d=p*Math.sqrt(.75);this.sh.coefficients[0].copy(h).add(f).multiplyScalar(p),this.sh.coefficients[1].copy(h).sub(f).multiplyScalar(d)}}jT.prototype.isHemisphereLightProbe=!0;class JT extends Oh{constructor(e,t=1){super(void 0,t);const i=new et().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}JT.prototype.isAmbientLightProbe=!0;class KT extends Et{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class QT{constructor(e,t,i){this.binding=e,this.valueSize=i;let a,o,h;switch(t){case"quaternion":a=this._slerp,o=this._slerpAdditive,h=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":a=this._select,o=this._select,h=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:a=this._lerp,o=this._lerpAdditive,h=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=o,this._setIdentity=h,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,a=this.valueSize,o=e*a+a;let h=this.cumulativeWeight;if(h===0){for(let f=0;f!==a;++f)i[o+f]=i[f];h=t}else{h+=t;const f=t/h;this._mixBufferRegion(i,o,0,f,a)}this.cumulativeWeight=h}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,a=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,a,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,a=e*t+t,o=this.cumulativeWeight,h=this.cumulativeWeightAdditive,f=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const p=t*this._origIndex;this._mixBufferRegion(i,a,p,1-o,t)}h>0&&this._mixBufferRegionAdditive(i,a,this._addIndex*t,1,t);for(let p=t,d=t+t;p!==d;++p)if(i[p]!==i[p+t]){f.setValue(i,a);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,a=i*this._origIndex;e.getValue(t,a);for(let o=i,h=a;o!==h;++o)t[o]=t[a+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,a,o){if(a>=.5)for(let h=0;h!==o;++h)e[t+h]=e[i+h]}_slerp(e,t,i,a){Sn.slerpFlat(e,t,e,t,e,i,a)}_slerpAdditive(e,t,i,a,o){const h=this._workIndex*o;Sn.multiplyQuaternionsFlat(e,h,e,t,e,i),Sn.slerpFlat(e,t,e,t,e,h,a)}_lerp(e,t,i,a,o){const h=1-a;for(let f=0;f!==o;++f){const p=t+f;e[p]=e[p]*h+e[i+f]*a}}_lerpAdditive(e,t,i,a,o){for(let h=0;h!==o;++h){const f=t+h;e[f]=e[f]+e[i+h]*a}}}const zh="\\[\\]\\.:\\/",$T=new RegExp("["+zh+"]","g"),Bh="[^"+zh+"]",eE="[^"+zh.replace("\\.","")+"]",tE=/((?:WC+[\/:])*)/.source.replace("WC",Bh),nE=/(WCOD+)?/.source.replace("WCOD",eE),iE=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Bh),rE=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Bh),sE=new RegExp("^"+tE+nE+iE+rE+"$"),aE=["material","materials","bones"];class oE{constructor(e,t,i){const a=i||At.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,a)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,a=this._bindings[i];a!==void 0&&a.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let a=this._targetGroup.nCachedObjects_,o=i.length;a!==o;++a)i[a].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class At{constructor(e,t,i){this.path=t,this.parsedPath=i||At.parseTrackName(t),this.node=At.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new At.Composite(e,t,i):new At(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace($T,"")}static parseTrackName(e){const t=sE.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},a=i.nodeName&&i.nodeName.lastIndexOf(".");if(a!==void 0&&a!==-1){const o=i.nodeName.substring(a+1);aE.indexOf(o)!==-1&&(i.nodeName=i.nodeName.substring(0,a),i.objectName=o)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(o){for(let h=0;h<o.length;h++){const f=o[h];if(f.name===t||f.uuid===t)return f;const p=i(f.children);if(p)return p}return null},a=i(e.children);if(a)return a}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let a=0,o=i.length;a!==o;++a)e[t++]=i[a]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let a=0,o=i.length;a!==o;++a)i[a]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let a=0,o=i.length;a!==o;++a)i[a]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let a=0,o=i.length;a!==o;++a)i[a]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,a=t.propertyName;let o=t.propertyIndex;if(e||(e=At.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let d=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let g=0;g<e.length;g++)if(e[g].name===d){d=g;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(d!==void 0){if(e[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[d]}}const h=e[a];if(h===void 0){const d=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+a+" but it wasn't found.",e);return}let f=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?f=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(f=this.Versioning.MatrixWorldNeedsUpdate);let p=this.BindingType.Direct;if(o!==void 0){if(a==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}p=this.BindingType.ArrayElement,this.resolvedProperty=h,this.propertyIndex=o}else h.fromArray!==void 0&&h.toArray!==void 0?(p=this.BindingType.HasFromToArray,this.resolvedProperty=h):Array.isArray(h)?(p=this.BindingType.EntireArray,this.resolvedProperty=h):this.propertyName=a;this.getValue=this.GetterByBindingType[p],this.setValue=this.SetterByBindingTypeAndVersioning[p][f]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}At.Composite=oE;At.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};At.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};At.prototype.GetterByBindingType=[At.prototype._getValue_direct,At.prototype._getValue_array,At.prototype._getValue_arrayElement,At.prototype._getValue_toArray];At.prototype.SetterByBindingTypeAndVersioning=[[At.prototype._setValue_direct,At.prototype._setValue_direct_setNeedsUpdate,At.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[At.prototype._setValue_array,At.prototype._setValue_array_setNeedsUpdate,At.prototype._setValue_array_setMatrixWorldNeedsUpdate],[At.prototype._setValue_arrayElement,At.prototype._setValue_arrayElement_setNeedsUpdate,At.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[At.prototype._setValue_fromArray,At.prototype._setValue_fromArray_setNeedsUpdate,At.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class lE{constructor(e,t,i=null,a=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=a;const o=t.tracks,h=o.length,f=new Array(h),p={endingStart:As,endingEnd:As};for(let d=0;d!==h;++d){const g=o[d].createInterpolant(null);f[d]=g,g.settings=p}this._interpolantSettings=p,this._interpolants=f,this._propertyBindings=new Array(h),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=D_,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const a=this._clip.duration,o=e._clip.duration,h=o/a,f=a/o;e.warp(1,h,t),this.warp(f,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const a=this._mixer,o=a.time,h=this.timeScale;let f=this._timeScaleInterpolant;f===null&&(f=a._lendControlInterpolant(),this._timeScaleInterpolant=f);const p=f.parameterPositions,d=f.sampleValues;return p[0]=o,p[1]=o+i,d[0]=e/h,d[1]=t/h,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,a){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const p=(e-o)*i;if(p<0||i===0)return;this._startTime=null,t=i*p}t*=this._updateTimeScale(e);const h=this._updateTime(t),f=this._updateWeight(e);if(f>0){const p=this._interpolants,d=this._propertyBindings;switch(this.blendMode){case Op:for(let g=0,y=p.length;g!==y;++g)p[g].evaluate(h),d[g].accumulateAdditive(f);break;case Cc:default:for(let g=0,y=p.length;g!==y;++g)p[g].evaluate(h),d[g].accumulate(a,f)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const a=i.evaluate(e)[0];t*=a,e>i.parameterPositions[1]&&(this.stopFading(),a===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;i!==null&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let a=this.time+e,o=this._loopCount;const h=i===I_;if(e===0)return o===-1?a:h&&(o&1)==1?t-a:a;if(i===P_){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=t)a=t;else if(a<0)a=0;else{this.time=a;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,h)):this._setEndings(this.repetitions===0,!0,h)),a>=t||a<0){const f=Math.floor(a/t);a-=t*f,o+=Math.abs(f);const p=this.repetitions-o;if(p<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=e>0?t:0,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(p===1){const d=e<0;this._setEndings(d,!d,h)}else this._setEndings(!1,!1,h);this._loopCount=o,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}}else this.time=a;if(h&&(o&1)==1)return t-a}return a}_setEndings(e,t,i){const a=this._interpolantSettings;i?(a.endingStart=Ls,a.endingEnd=Ls):(e?a.endingStart=this.zeroSlopeAtStart?Ls:As:a.endingStart=_l,t?a.endingEnd=this.zeroSlopeAtEnd?Ls:As:a.endingEnd=_l)}_scheduleFading(e,t,i){const a=this._mixer,o=a.time;let h=this._weightInterpolant;h===null&&(h=a._lendControlInterpolant(),this._weightInterpolant=h);const f=h.parameterPositions,p=h.sampleValues;return f[0]=o,p[0]=t,f[1]=o+e,p[1]=i,this}}class uE extends nr{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,a=e._clip.tracks,o=a.length,h=e._propertyBindings,f=e._interpolants,p=i.uuid,d=this._bindingsByRootAndName;let g=d[p];g===void 0&&(g={},d[p]=g);for(let y=0;y!==o;++y){const x=a[y],_=x.name;let T=g[_];if(T!==void 0)h[y]=T;else{if(T=h[y],T!==void 0){T._cacheIndex===null&&(++T.referenceCount,this._addInactiveBinding(T,p,_));continue}const L=t&&t._propertyBindings[y].binding.parsedPath;T=new QT(At.create(i,_,L),x.ValueTypeName,x.getValueSize()),++T.referenceCount,this._addInactiveBinding(T,p,_),h[y]=T}f[y].resultBuffer=T.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,a=e._clip.uuid,o=this._actionsByClip[a];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,a,i)}const t=e._propertyBindings;for(let i=0,a=t.length;i!==a;++i){const o=t[i];o.useCount++==0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,a=t.length;i!==a;++i){const o=t[i];--o.useCount==0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const a=this._actions,o=this._actionsByClip;let h=o[t];if(h===void 0)h={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=h;else{const f=h.knownActions;e._byClipCacheIndex=f.length,f.push(e)}e._cacheIndex=a.length,a.push(e),h.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],a=e._cacheIndex;i._cacheIndex=a,t[a]=i,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,h=this._actionsByClip,f=h[o],p=f.knownActions,d=p[p.length-1],g=e._byClipCacheIndex;d._byClipCacheIndex=g,p[g]=d,p.pop(),e._byClipCacheIndex=null;const y=f.actionByRoot,x=(e._localRoot||this._root).uuid;delete y[x],p.length===0&&delete h[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,a=t.length;i!==a;++i){const o=t[i];--o.referenceCount==0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,a=this._nActiveActions++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=i,t[i]=o}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,a=--this._nActiveActions,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=i,t[i]=o}_addInactiveBinding(e,t,i){const a=this._bindingsByRootAndName,o=this._bindings;let h=a[t];h===void 0&&(h={},a[t]=h),h[i]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,a=i.rootNode.uuid,o=i.path,h=this._bindingsByRootAndName,f=h[a],p=t[t.length-1],d=e._cacheIndex;p._cacheIndex=d,t[d]=p,t.pop(),delete f[o],Object.keys(f).length===0&&delete h[a]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,a=this._nActiveBindings++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=i,t[i]=o}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,a=--this._nActiveBindings,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=i,t[i]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new Mg(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,a=--this._nActiveControlInterpolants,o=t[a];e.__cacheIndex=a,t[a]=e,o.__cacheIndex=i,t[i]=o}clipAction(e,t,i){const a=t||this._root,o=a.uuid;let h=typeof e=="string"?Tg.findByName(a,e):e;const f=h!==null?h.uuid:e,p=this._actionsByClip[f];let d=null;if(i===void 0&&(h!==null?i=h.blendMode:i=Cc),p!==void 0){const y=p.actionByRoot[o];if(y!==void 0&&y.blendMode===i)return y;d=p.knownActions[0],h===null&&(h=d._clip)}if(h===null)return null;const g=new lE(this,h,t,i);return this._bindAction(g,d),this._addInactiveAction(g,f,o),g}existingAction(e,t){const i=t||this._root,a=i.uuid,o=typeof e=="string"?Tg.findByName(i,e):e,h=o?o.uuid:e,f=this._actionsByClip[h];return f!==void 0&&f.actionByRoot[a]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,a=this.time+=e,o=Math.sign(e),h=this._accuIndex^=1;for(let d=0;d!==i;++d)t[d]._update(a,e,o,h);const f=this._bindings,p=this._nActiveBindings;for(let d=0;d!==p;++d)f[d].apply(h);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,a=this._actionsByClip,o=a[i];if(o!==void 0){const h=o.knownActions;for(let f=0,p=h.length;f!==p;++f){const d=h[f];this._deactivateAction(d);const g=d._cacheIndex,y=t[t.length-1];d._cacheIndex=null,d._byClipCacheIndex=null,y._cacheIndex=g,t[g]=y,t.pop(),this._removeInactiveBindingsForAction(d)}delete a[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const h in i){const f=i[h].actionByRoot,p=f[t];p!==void 0&&(this._deactivateAction(p),this._removeInactiveAction(p))}const a=this._bindingsByRootAndName,o=a[t];if(o!==void 0)for(const h in o){const f=o[h];f.restoreOriginalState(),this._removeInactiveBinding(f)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}uE.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class cE extends so{constructor(e,t,i=1){super(e,t);this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}cE.prototype.isInstancedInterleavedBuffer=!0;class Ng{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Mn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class yC{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const Fg=new ye;class _o{constructor(e=new ye(1/0,1/0),t=new ye(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Fg.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Fg.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}_o.prototype.isBox2=!0;const Og=new V,hu=new V;class hE{constructor(e=new V,t=new V){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Og.subVectors(e,this.start),hu.subVectors(this.end,this.start);const i=hu.dot(hu);let o=hu.dot(Og)/i;return t&&(o=Mn(o,0,1)),o}closestPointToPoint(e,t,i){const a=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(a).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const gr=new V,fu=new ot,Hh=new ot;class fE extends $l{constructor(e){const t=zg(e),i=new kt,a=[],o=[],h=new et(0,0,1),f=new et(0,1,0);for(let d=0;d<t.length;d++){const g=t[d];g.parent&&g.parent.isBone&&(a.push(0,0,0),a.push(0,0,0),o.push(h.r,h.g,h.b),o.push(f.r,f.g,f.b))}i.setAttribute("position",new jt(a,3)),i.setAttribute("color",new jt(o,3));const p=new na({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,p);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,a=i.getAttribute("position");Hh.copy(this.root.matrixWorld).invert();for(let o=0,h=0;o<t.length;o++){const f=t[o];f.parent&&f.parent.isBone&&(fu.multiplyMatrices(Hh,f.matrixWorld),gr.setFromMatrixPosition(fu),a.setXYZ(h,gr.x,gr.y,gr.z),fu.multiplyMatrices(Hh,f.parent.matrixWorld),gr.setFromMatrixPosition(fu),a.setXYZ(h+1,gr.x,gr.y,gr.z),h+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function zg(r){const e=[];r&&r.isBone&&e.push(r);for(let t=0;t<r.children.length;t++)e.push.apply(e,zg(r.children[t]));return e}class dE extends $l{constructor(e=10,t=10,i=4473924,a=8947848){i=new et(i),a=new et(a);const o=t/2,h=e/t,f=e/2,p=[],d=[];for(let x=0,_=0,T=-f;x<=t;x++,T+=h){p.push(-f,0,T,f,0,T),p.push(T,0,-f,T,0,f);const L=x===o?i:a;L.toArray(d,_),_+=3,L.toArray(d,_),_+=3,L.toArray(d,_),_+=3,L.toArray(d,_),_+=3}const g=new kt;g.setAttribute("position",new jt(p,3)),g.setAttribute("color",new jt(d,3));const y=new na({vertexColors:!0,toneMapped:!1});super(g,y);this.type="GridHelper"}}class _C extends $l{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],a=new kt;a.setAttribute("position",new jt(t,3)),a.setAttribute("color",new jt(i,3));const o=new na({vertexColors:!0,toneMapped:!1});super(a,o);this.type="AxesHelper"}setColors(e,t,i){const a=new et,o=this.geometry.attributes.color.array;return a.set(e),a.toArray(o,0),a.toArray(o,3),a.set(t),a.toArray(o,6),a.toArray(o,9),a.set(i),a.toArray(o,12),a.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const pE=new Float32Array(1);new Int32Array(pE.buffer);$n.create=function(r,e){return console.log("THREE.Curve.create() has been deprecated"),r.prototype=Object.create($n.prototype),r.prototype.constructor=r,r.prototype.getPoint=e,r};Ph.prototype.fromPoints=function(r){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(r)};dE.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};fE.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};mr.prototype.extractUrlBase=function(r){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),VT.extractUrlBase(r)};mr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};_o.prototype.center=function(r){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(r)};_o.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};_o.prototype.isIntersectionBox=function(r){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)};_o.prototype.size=function(r){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(r)};oi.prototype.center=function(r){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(r)};oi.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};oi.prototype.isIntersectionBox=function(r){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)};oi.prototype.isIntersectionSphere=function(r){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(r)};oi.prototype.size=function(r){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(r)};Ns.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Gl.prototype.setFromMatrix=function(r){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(r)};hE.prototype.center=function(r){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(r)};gn.prototype.flattenToArrayOffset=function(r,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(r,e)};gn.prototype.multiplyVector3=function(r){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),r.applyMatrix3(this)};gn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};gn.prototype.applyToBufferAttribute=function(r){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),r.applyMatrix3(this)};gn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};gn.prototype.getInverse=function(r){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(r).invert()};ot.prototype.extractPosition=function(r){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(r)};ot.prototype.flattenToArrayOffset=function(r,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(r,e)};ot.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new V().setFromMatrixColumn(this,3)};ot.prototype.setRotationFromQuaternion=function(r){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(r)};ot.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};ot.prototype.multiplyVector3=function(r){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};ot.prototype.multiplyVector4=function(r){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};ot.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};ot.prototype.rotateAxis=function(r){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),r.transformDirection(this)};ot.prototype.crossVector=function(r){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};ot.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};ot.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};ot.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};ot.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};ot.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};ot.prototype.applyToBufferAttribute=function(r){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};ot.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};ot.prototype.makeFrustum=function(r,e,t,i,a,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(r,e,i,t,a,o)};ot.prototype.getInverse=function(r){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(r).invert()};zi.prototype.isIntersectionLine=function(r){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(r)};Sn.prototype.multiplyVector3=function(r){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),r.applyQuaternion(this)};Sn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Fs.prototype.isIntersectionBox=function(r){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)};Fs.prototype.isIntersectionPlane=function(r){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(r)};Fs.prototype.isIntersectionSphere=function(r){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(r)};Yt.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Yt.prototype.barycoordFromPoint=function(r,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(r,e)};Yt.prototype.midpoint=function(r){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(r)};Yt.prototypenormal=function(r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(r)};Yt.prototype.plane=function(r){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(r)};Yt.barycoordFromPoint=function(r,e,t,i,a){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Yt.getBarycoord(r,e,t,i,a)};Yt.normal=function(r,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Yt.getNormal(r,e,t,i)};po.prototype.extractAllPoints=function(r){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(r)};po.prototype.extrude=function(r){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ra(this,r)};po.prototype.makeGeometry=function(r){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new kh(this,r)};ye.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)};ye.prototype.distanceToManhattan=function(r){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(r)};ye.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};V.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};V.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};V.prototype.getPositionFromMatrix=function(r){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(r)};V.prototype.getScaleFromMatrix=function(r){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(r)};V.prototype.getColumnFromMatrix=function(r,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,r)};V.prototype.applyProjection=function(r){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(r)};V.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)};V.prototype.distanceToManhattan=function(r){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(r)};V.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Rt.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)};Rt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Et.prototype.getChildByName=function(r){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(r)};Et.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Et.prototype.translate=function(r,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,r)};Et.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Et.prototype.applyMatrix=function(r){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(r)};Object.defineProperties(Et.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(r){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=r}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});zn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(zn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),k_},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});$m.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Bn.prototype.setLens=function(r,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(r)};Object.defineProperties(_i.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(r){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=r}},shadowCameraLeft:{set:function(r){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=r}},shadowCameraRight:{set:function(r){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=r}},shadowCameraTop:{set:function(r){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=r}},shadowCameraBottom:{set:function(r){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=r}},shadowCameraNear:{set:function(r){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=r}},shadowCameraFar:{set:function(r){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=r}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(r){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=r}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(r){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=r}},shadowMapHeight:{set:function(r){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=r}}});Object.defineProperties(rn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===wl},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(wl)}}});rn.prototype.setDynamic=function(r){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(r===!0?wl:qa),this};rn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},rn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};kt.prototype.addIndex=function(r){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(r)};kt.prototype.addAttribute=function(r,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(r,new rn(arguments[1],arguments[2]))):r==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(r,e)};kt.prototype.addDrawCall=function(r,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(r,e)};kt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};kt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};kt.prototype.removeAttribute=function(r){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(r)};kt.prototype.applyMatrix=function(r){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(r)};Object.defineProperties(kt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});so.prototype.setDynamic=function(r){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(r===!0?wl:qa),this};so.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};ra.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};ra.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};ra.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Vm.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(Tn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new et}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(r){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===gp}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(r){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=r}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Hr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(r){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=r}}});Ct.prototype.clearTarget=function(r,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(r),this.clear(e,t,i)};Ct.prototype.animate=function(r){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(r)};Ct.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Ct.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Ct.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Ct.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Ct.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Ct.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Ct.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Ct.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Ct.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Ct.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Ct.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Ct.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Ct.prototype.enableScissorTest=function(r){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(r)};Ct.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Ct.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Ct.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Ct.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Ct.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Ct.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Ct.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Ct.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Ct.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Ct.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Ct.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(r){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=r}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(r){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=r}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(r){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=r===!0?bl:On}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(Wm.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Kn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(r){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=r}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(r){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=r}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(r){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=r}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(r){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=r}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(r){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=r}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(r){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=r}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(r){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=r}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(r){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=r}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(r){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=r}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(r){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=r}}});KT.prototype.load=function(r){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new YT().load(r,function(i){e.setBuffer(i)}),this};ah.prototype.updateCubeMap=function(r,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(r,e)};ah.prototype.clear=function(r,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(r,e,t,i)};Ps.crossOrigin=void 0;Ps.loadTexture=function(r,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const a=new OT;a.setCrossOrigin(this.crossOrigin);const o=a.load(r,t,void 0,i);return e&&(o.mapping=e),o};Ps.loadTextureCube=function(r,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const a=new FT;a.setCrossOrigin(this.crossOrigin);const o=a.load(r,t,void 0,i);return e&&(o.mapping=e),o};Ps.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Ps.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:bc}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=bc);const Bg={type:"change"},Uh={type:"start"},Hg={type:"end"};class bC extends nr{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new V,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:_s.ROTATE,MIDDLE:_s.DOLLY,RIGHT:_s.PAN},this.touches={ONE:bs.ROTATE,TWO:bs.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(z){z.addEventListener("keydown",G),this._domElementKeyEvents=z},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Bg),i.update(),o=a.NONE},this.update=function(){const z=new V,ne=new Sn().setFromUnitVectors(e.up,new V(0,1,0)),ve=ne.clone().invert(),Te=new V,Ne=new Sn,xe=2*Math.PI;return function(){const st=i.object.position;z.copy(st).sub(i.target),z.applyQuaternion(ne),f.setFromVector3(z),i.autoRotate&&o===a.NONE&&oe(R()),i.enableDamping?(f.theta+=p.theta*i.dampingFactor,f.phi+=p.phi*i.dampingFactor):(f.theta+=p.theta,f.phi+=p.phi);let Ve=i.minAzimuthAngle,ft=i.maxAzimuthAngle;return isFinite(Ve)&&isFinite(ft)&&(Ve<-Math.PI?Ve+=xe:Ve>Math.PI&&(Ve-=xe),ft<-Math.PI?ft+=xe:ft>Math.PI&&(ft-=xe),Ve<=ft?f.theta=Math.max(Ve,Math.min(ft,f.theta)):f.theta=f.theta>(Ve+ft)/2?Math.max(Ve,f.theta):Math.min(ft,f.theta)),f.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=d,f.radius=Math.max(i.minDistance,Math.min(i.maxDistance,f.radius)),i.enableDamping===!0?i.target.addScaledVector(g,i.dampingFactor):i.target.add(g),z.setFromSpherical(f),z.applyQuaternion(ve),st.copy(i.target).add(z),i.object.lookAt(i.target),i.enableDamping===!0?(p.theta*=1-i.dampingFactor,p.phi*=1-i.dampingFactor,g.multiplyScalar(1-i.dampingFactor)):(p.set(0,0,0),g.set(0,0,0)),d=1,y||Te.distanceToSquared(i.object.position)>h||8*(1-Ne.dot(i.object.quaternion))>h?(i.dispatchEvent(Bg),Te.copy(i.object.position),Ne.copy(i.object.quaternion),y=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",de),i.domElement.removeEventListener("pointerdown",Le),i.domElement.removeEventListener("pointercancel",tt),i.domElement.removeEventListener("wheel",bt),i.domElement.removeEventListener("pointermove",me),i.domElement.removeEventListener("pointerup",Ce),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",G)};const i=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=a.NONE;const h=1e-6,f=new Ng,p=new Ng;let d=1;const g=new V;let y=!1;const x=new ye,_=new ye,T=new ye,L=new ye,P=new ye,M=new ye,w=new ye,N=new ye,C=new ye,k=[],q={};function R(){return 2*Math.PI/60/60*i.autoRotateSpeed}function J(){return Math.pow(.95,i.zoomSpeed)}function oe(z){p.theta-=z}function Q(z){p.phi-=z}const X=function(){const z=new V;return function(ve,Te){z.setFromMatrixColumn(Te,0),z.multiplyScalar(-ve),g.add(z)}}(),Se=function(){const z=new V;return function(ve,Te){i.screenSpacePanning===!0?z.setFromMatrixColumn(Te,1):(z.setFromMatrixColumn(Te,0),z.crossVectors(i.object.up,z)),z.multiplyScalar(ve),g.add(z)}}(),H=function(){const z=new V;return function(ve,Te){const Ne=i.domElement;if(i.object.isPerspectiveCamera){const xe=i.object.position;z.copy(xe).sub(i.target);let wt=z.length();wt*=Math.tan(i.object.fov/2*Math.PI/180),X(2*ve*wt/Ne.clientHeight,i.object.matrix),Se(2*Te*wt/Ne.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(X(ve*(i.object.right-i.object.left)/i.object.zoom/Ne.clientWidth,i.object.matrix),Se(Te*(i.object.top-i.object.bottom)/i.object.zoom/Ne.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function W(z){i.object.isPerspectiveCamera?d/=z:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*z)),i.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function D(z){i.object.isPerspectiveCamera?d*=z:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/z)),i.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ee(z){x.set(z.clientX,z.clientY)}function te(z){w.set(z.clientX,z.clientY)}function Me(z){L.set(z.clientX,z.clientY)}function Oe(z){_.set(z.clientX,z.clientY),T.subVectors(_,x).multiplyScalar(i.rotateSpeed);const ne=i.domElement;oe(2*Math.PI*T.x/ne.clientHeight),Q(2*Math.PI*T.y/ne.clientHeight),x.copy(_),i.update()}function ce(z){N.set(z.clientX,z.clientY),C.subVectors(N,w),C.y>0?W(J()):C.y<0&&D(J()),w.copy(N),i.update()}function ue(z){P.set(z.clientX,z.clientY),M.subVectors(P,L).multiplyScalar(i.panSpeed),H(M.x,M.y),L.copy(P),i.update()}function We(z){z.deltaY<0?D(J()):z.deltaY>0&&W(J()),i.update()}function Pe(z){let ne=!1;switch(z.code){case i.keys.UP:H(0,i.keyPanSpeed),ne=!0;break;case i.keys.BOTTOM:H(0,-i.keyPanSpeed),ne=!0;break;case i.keys.LEFT:H(i.keyPanSpeed,0),ne=!0;break;case i.keys.RIGHT:H(-i.keyPanSpeed,0),ne=!0;break}ne&&(z.preventDefault(),i.update())}function ze(){if(k.length===1)x.set(k[0].pageX,k[0].pageY);else{const z=.5*(k[0].pageX+k[1].pageX),ne=.5*(k[0].pageY+k[1].pageY);x.set(z,ne)}}function $e(){if(k.length===1)L.set(k[0].pageX,k[0].pageY);else{const z=.5*(k[0].pageX+k[1].pageX),ne=.5*(k[0].pageY+k[1].pageY);L.set(z,ne)}}function K(){const z=k[0].pageX-k[1].pageX,ne=k[0].pageY-k[1].pageY,ve=Math.sqrt(z*z+ne*ne);w.set(0,ve)}function Ae(){i.enableZoom&&K(),i.enablePan&&$e()}function Re(){i.enableZoom&&K(),i.enableRotate&&ze()}function Ee(z){if(k.length==1)_.set(z.pageX,z.pageY);else{const ve=ke(z),Te=.5*(z.pageX+ve.x),Ne=.5*(z.pageY+ve.y);_.set(Te,Ne)}T.subVectors(_,x).multiplyScalar(i.rotateSpeed);const ne=i.domElement;oe(2*Math.PI*T.x/ne.clientHeight),Q(2*Math.PI*T.y/ne.clientHeight),x.copy(_)}function Je(z){if(k.length===1)P.set(z.pageX,z.pageY);else{const ne=ke(z),ve=.5*(z.pageX+ne.x),Te=.5*(z.pageY+ne.y);P.set(ve,Te)}M.subVectors(P,L).multiplyScalar(i.panSpeed),H(M.x,M.y),L.copy(P)}function Ze(z){const ne=ke(z),ve=z.pageX-ne.x,Te=z.pageY-ne.y,Ne=Math.sqrt(ve*ve+Te*Te);N.set(0,Ne),C.set(0,Math.pow(N.y/w.y,i.zoomSpeed)),W(C.y),w.copy(N)}function se(z){i.enableZoom&&Ze(z),i.enablePan&&Je(z)}function be(z){i.enableZoom&&Ze(z),i.enableRotate&&Ee(z)}function Le(z){i.enabled!==!1&&(k.length===0&&(i.domElement.setPointerCapture(z.pointerId),i.domElement.addEventListener("pointermove",me),i.domElement.addEventListener("pointerup",Ce)),qe(z),z.pointerType==="touch"?O(z):rt(z))}function me(z){i.enabled!==!1&&(z.pointerType==="touch"?pe(z):ht(z))}function Ce(z){Xe(z),k.length===0&&(i.domElement.releasePointerCapture(z.pointerId),i.domElement.removeEventListener("pointermove",me),i.domElement.removeEventListener("pointerup",Ce)),i.dispatchEvent(Hg),o=a.NONE}function tt(z){Xe(z)}function rt(z){let ne;switch(z.button){case 0:ne=i.mouseButtons.LEFT;break;case 1:ne=i.mouseButtons.MIDDLE;break;case 2:ne=i.mouseButtons.RIGHT;break;default:ne=-1}switch(ne){case _s.DOLLY:if(i.enableZoom===!1)return;te(z),o=a.DOLLY;break;case _s.ROTATE:if(z.ctrlKey||z.metaKey||z.shiftKey){if(i.enablePan===!1)return;Me(z),o=a.PAN}else{if(i.enableRotate===!1)return;ee(z),o=a.ROTATE}break;case _s.PAN:if(z.ctrlKey||z.metaKey||z.shiftKey){if(i.enableRotate===!1)return;ee(z),o=a.ROTATE}else{if(i.enablePan===!1)return;Me(z),o=a.PAN}break;default:o=a.NONE}o!==a.NONE&&i.dispatchEvent(Uh)}function ht(z){if(i.enabled!==!1)switch(o){case a.ROTATE:if(i.enableRotate===!1)return;Oe(z);break;case a.DOLLY:if(i.enableZoom===!1)return;ce(z);break;case a.PAN:if(i.enablePan===!1)return;ue(z);break}}function bt(z){i.enabled===!1||i.enableZoom===!1||o!==a.NONE||(z.preventDefault(),i.dispatchEvent(Uh),We(z),i.dispatchEvent(Hg))}function G(z){i.enabled===!1||i.enablePan===!1||Pe(z)}function O(z){switch(Y(z),k.length){case 1:switch(i.touches.ONE){case bs.ROTATE:if(i.enableRotate===!1)return;ze(),o=a.TOUCH_ROTATE;break;case bs.PAN:if(i.enablePan===!1)return;$e(),o=a.TOUCH_PAN;break;default:o=a.NONE}break;case 2:switch(i.touches.TWO){case bs.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Ae(),o=a.TOUCH_DOLLY_PAN;break;case bs.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Re(),o=a.TOUCH_DOLLY_ROTATE;break;default:o=a.NONE}break;default:o=a.NONE}o!==a.NONE&&i.dispatchEvent(Uh)}function pe(z){switch(Y(z),o){case a.TOUCH_ROTATE:if(i.enableRotate===!1)return;Ee(z),i.update();break;case a.TOUCH_PAN:if(i.enablePan===!1)return;Je(z),i.update();break;case a.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;se(z),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;be(z),i.update();break;default:o=a.NONE}}function de(z){i.enabled!==!1&&z.preventDefault()}function qe(z){k.push(z)}function Xe(z){delete q[z.pointerId];for(let ne=0;ne<k.length;ne++)if(k[ne].pointerId==z.pointerId){k.splice(ne,1);return}}function Y(z){let ne=q[z.pointerId];ne===void 0&&(ne=new ye,q[z.pointerId]=ne),ne.set(z.pageX,z.pageY)}function ke(z){const ne=z.pointerId===k[0].pointerId?k[1]:k[0];return q[ne.pointerId]}i.domElement.addEventListener("contextmenu",de),i.domElement.addEventListener("pointerdown",Le),i.domElement.addEventListener("pointercancel",tt),i.domElement.addEventListener("wheel",bt,{passive:!1}),this.update()}}/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const mE=4,Ug=0,Wg=1,gE=2;function la(r){let e=r.length;for(;--e>=0;)r[e]=0}const vE=0,Gg=1,xE=2,yE=3,_E=258,Wh=29,bo=256,wo=bo+1+Wh,ua=30,Gh=19,Vg=2*wo+1,Vr=15,Vh=16,bE=7,Xh=256,Xg=16,Zg=17,qg=18,Zh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),du=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),wE=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Yg=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ME=512,Hi=new Array((wo+2)*2);la(Hi);const Mo=new Array(ua*2);la(Mo);const So=new Array(ME);la(So);const To=new Array(_E-yE+1);la(To);const qh=new Array(Wh);la(qh);const pu=new Array(ua);la(pu);function Yh(r,e,t,i,a){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=i,this.max_length=a,this.has_stree=r&&r.length}let jg,Jg,Kg;function jh(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}const Qg=r=>r<256?So[r]:So[256+(r>>>7)],Eo=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},Hn=(r,e,t)=>{r.bi_valid>Vh-t?(r.bi_buf|=e<<r.bi_valid&65535,Eo(r,r.bi_buf),r.bi_buf=e>>Vh-r.bi_valid,r.bi_valid+=t-Vh):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},bi=(r,e,t)=>{Hn(r,t[e*2],t[e*2+1])},$g=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},SE=r=>{r.bi_valid===16?(Eo(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},TE=(r,e)=>{const t=e.dyn_tree,i=e.max_code,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,h=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length;let d,g,y,x,_,T,L=0;for(x=0;x<=Vr;x++)r.bl_count[x]=0;for(t[r.heap[r.heap_max]*2+1]=0,d=r.heap_max+1;d<Vg;d++)g=r.heap[d],x=t[t[g*2+1]*2+1]+1,x>p&&(x=p,L++),t[g*2+1]=x,!(g>i)&&(r.bl_count[x]++,_=0,g>=f&&(_=h[g-f]),T=t[g*2],r.opt_len+=T*(x+_),o&&(r.static_len+=T*(a[g*2+1]+_)));if(L!==0){do{for(x=p-1;r.bl_count[x]===0;)x--;r.bl_count[x]--,r.bl_count[x+1]+=2,r.bl_count[p]--,L-=2}while(L>0);for(x=p;x!==0;x--)for(g=r.bl_count[x];g!==0;)y=r.heap[--d],!(y>i)&&(t[y*2+1]!==x&&(r.opt_len+=(x-t[y*2+1])*t[y*2],t[y*2+1]=x),g--)}},ev=(r,e,t)=>{const i=new Array(Vr+1);let a=0,o,h;for(o=1;o<=Vr;o++)i[o]=a=a+t[o-1]<<1;for(h=0;h<=e;h++){let f=r[h*2+1];f!==0&&(r[h*2]=$g(i[f]++,f))}},EE=()=>{let r,e,t,i,a;const o=new Array(Vr+1);for(t=0,i=0;i<Wh-1;i++)for(qh[i]=t,r=0;r<1<<Zh[i];r++)To[t++]=i;for(To[t-1]=i,a=0,i=0;i<16;i++)for(pu[i]=a,r=0;r<1<<du[i];r++)So[a++]=i;for(a>>=7;i<ua;i++)for(pu[i]=a<<7,r=0;r<1<<du[i]-7;r++)So[256+a++]=i;for(e=0;e<=Vr;e++)o[e]=0;for(r=0;r<=143;)Hi[r*2+1]=8,r++,o[8]++;for(;r<=255;)Hi[r*2+1]=9,r++,o[9]++;for(;r<=279;)Hi[r*2+1]=7,r++,o[7]++;for(;r<=287;)Hi[r*2+1]=8,r++,o[8]++;for(ev(Hi,wo+1,o),r=0;r<ua;r++)Mo[r*2+1]=5,Mo[r*2]=$g(r,5);jg=new Yh(Hi,Zh,bo+1,wo,Vr),Jg=new Yh(Mo,du,0,ua,Vr),Kg=new Yh(new Array(0),wE,0,Gh,bE)},tv=r=>{let e;for(e=0;e<wo;e++)r.dyn_ltree[e*2]=0;for(e=0;e<ua;e++)r.dyn_dtree[e*2]=0;for(e=0;e<Gh;e++)r.bl_tree[e*2]=0;r.dyn_ltree[Xh*2]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0},nv=r=>{r.bi_valid>8?Eo(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},AE=(r,e,t,i)=>{nv(r),i&&(Eo(r,t),Eo(r,~t)),r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},iv=(r,e,t,i)=>{const a=e*2,o=t*2;return r[a]<r[o]||r[a]===r[o]&&i[e]<=i[t]},Jh=(r,e,t)=>{const i=r.heap[t];let a=t<<1;for(;a<=r.heap_len&&(a<r.heap_len&&iv(e,r.heap[a+1],r.heap[a],r.depth)&&a++,!iv(e,i,r.heap[a],r.depth));)r.heap[t]=r.heap[a],t=a,a<<=1;r.heap[t]=i},rv=(r,e,t)=>{let i,a,o=0,h,f;if(r.last_lit!==0)do i=r.pending_buf[r.d_buf+o*2]<<8|r.pending_buf[r.d_buf+o*2+1],a=r.pending_buf[r.l_buf+o],o++,i===0?bi(r,a,e):(h=To[a],bi(r,h+bo+1,e),f=Zh[h],f!==0&&(a-=qh[h],Hn(r,a,f)),i--,h=Qg(i),bi(r,h,t),f=du[h],f!==0&&(i-=pu[h],Hn(r,i,f)));while(o<r.last_lit);bi(r,Xh,e)},Kh=(r,e)=>{const t=e.dyn_tree,i=e.stat_desc.static_tree,a=e.stat_desc.has_stree,o=e.stat_desc.elems;let h,f,p=-1,d;for(r.heap_len=0,r.heap_max=Vg,h=0;h<o;h++)t[h*2]!==0?(r.heap[++r.heap_len]=p=h,r.depth[h]=0):t[h*2+1]=0;for(;r.heap_len<2;)d=r.heap[++r.heap_len]=p<2?++p:0,t[d*2]=1,r.depth[d]=0,r.opt_len--,a&&(r.static_len-=i[d*2+1]);for(e.max_code=p,h=r.heap_len>>1;h>=1;h--)Jh(r,t,h);d=o;do h=r.heap[1],r.heap[1]=r.heap[r.heap_len--],Jh(r,t,1),f=r.heap[1],r.heap[--r.heap_max]=h,r.heap[--r.heap_max]=f,t[d*2]=t[h*2]+t[f*2],r.depth[d]=(r.depth[h]>=r.depth[f]?r.depth[h]:r.depth[f])+1,t[h*2+1]=t[f*2+1]=d,r.heap[1]=d++,Jh(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],TE(r,e),ev(t,p,r.bl_count)},sv=(r,e,t)=>{let i,a=-1,o,h=e[0*2+1],f=0,p=7,d=4;for(h===0&&(p=138,d=3),e[(t+1)*2+1]=65535,i=0;i<=t;i++)o=h,h=e[(i+1)*2+1],!(++f<p&&o===h)&&(f<d?r.bl_tree[o*2]+=f:o!==0?(o!==a&&r.bl_tree[o*2]++,r.bl_tree[Xg*2]++):f<=10?r.bl_tree[Zg*2]++:r.bl_tree[qg*2]++,f=0,a=o,h===0?(p=138,d=3):o===h?(p=6,d=3):(p=7,d=4))},av=(r,e,t)=>{let i,a=-1,o,h=e[0*2+1],f=0,p=7,d=4;for(h===0&&(p=138,d=3),i=0;i<=t;i++)if(o=h,h=e[(i+1)*2+1],!(++f<p&&o===h)){if(f<d)do bi(r,o,r.bl_tree);while(--f!=0);else o!==0?(o!==a&&(bi(r,o,r.bl_tree),f--),bi(r,Xg,r.bl_tree),Hn(r,f-3,2)):f<=10?(bi(r,Zg,r.bl_tree),Hn(r,f-3,3)):(bi(r,qg,r.bl_tree),Hn(r,f-11,7));f=0,a=o,h===0?(p=138,d=3):o===h?(p=6,d=3):(p=7,d=4)}},LE=r=>{let e;for(sv(r,r.dyn_ltree,r.l_desc.max_code),sv(r,r.dyn_dtree,r.d_desc.max_code),Kh(r,r.bl_desc),e=Gh-1;e>=3&&r.bl_tree[Yg[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},CE=(r,e,t,i)=>{let a;for(Hn(r,e-257,5),Hn(r,t-1,5),Hn(r,i-4,4),a=0;a<i;a++)Hn(r,r.bl_tree[Yg[a]*2+1],3);av(r,r.dyn_ltree,e-1),av(r,r.dyn_dtree,t-1)},RE=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return Ug;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return Wg;for(t=32;t<bo;t++)if(r.dyn_ltree[t*2]!==0)return Wg;return Ug};let ov=!1;const PE=r=>{ov||(EE(),ov=!0),r.l_desc=new jh(r.dyn_ltree,jg),r.d_desc=new jh(r.dyn_dtree,Jg),r.bl_desc=new jh(r.bl_tree,Kg),r.bi_buf=0,r.bi_valid=0,tv(r)},lv=(r,e,t,i)=>{Hn(r,(vE<<1)+(i?1:0),3),AE(r,e,t,!0)},DE=r=>{Hn(r,Gg<<1,3),bi(r,Xh,Hi),SE(r)},IE=(r,e,t,i)=>{let a,o,h=0;r.level>0?(r.strm.data_type===gE&&(r.strm.data_type=RE(r)),Kh(r,r.l_desc),Kh(r,r.d_desc),h=LE(r),a=r.opt_len+3+7>>>3,o=r.static_len+3+7>>>3,o<=a&&(a=o)):a=o=t+5,t+4<=a&&e!==-1?lv(r,e,t,i):r.strategy===mE||o===a?(Hn(r,(Gg<<1)+(i?1:0),3),rv(r,Hi,Mo)):(Hn(r,(xE<<1)+(i?1:0),3),CE(r,r.l_desc.max_code+1,r.d_desc.max_code+1,h+1),rv(r,r.dyn_ltree,r.dyn_dtree)),tv(r),i&&nv(r)},kE=(r,e,t)=>(r.pending_buf[r.d_buf+r.last_lit*2]=e>>>8&255,r.pending_buf[r.d_buf+r.last_lit*2+1]=e&255,r.pending_buf[r.l_buf+r.last_lit]=t&255,r.last_lit++,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(To[t]+bo+1)*2]++,r.dyn_dtree[Qg(e)*2]++),r.last_lit===r.lit_bufsize-1);var NE=PE,FE=lv,OE=IE,zE=kE,BE=DE,HE={_tr_init:NE,_tr_stored_block:FE,_tr_flush_block:OE,_tr_tally:zE,_tr_align:BE};const UE=(r,e,t,i)=>{let a=r&65535|0,o=r>>>16&65535|0,h=0;for(;t!==0;){h=t>2e3?2e3:t,t-=h;do a=a+e[i++]|0,o=o+a|0;while(--h);a%=65521,o%=65521}return a|o<<16|0};var Ao=UE;const WE=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var i=0;i<8;i++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},GE=new Uint32Array(WE()),VE=(r,e,t,i)=>{const a=GE,o=i+t;r^=-1;for(let h=i;h<o;h++)r=r>>>8^a[(r^e[h])&255];return r^-1};var hn=VE,Xr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Zr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:XE,_tr_stored_block:ZE,_tr_flush_block:qE,_tr_tally:vr,_tr_align:YE}=HE,{Z_NO_FLUSH:qr,Z_PARTIAL_FLUSH:jE,Z_FULL_FLUSH:JE,Z_FINISH:xr,Z_BLOCK:uv,Z_OK:wi,Z_STREAM_END:cv,Z_STREAM_ERROR:ei,Z_DATA_ERROR:KE,Z_BUF_ERROR:Qh,Z_DEFAULT_COMPRESSION:QE,Z_FILTERED:$E,Z_HUFFMAN_ONLY:mu,Z_RLE:eA,Z_FIXED:tA,Z_DEFAULT_STRATEGY:nA,Z_UNKNOWN:iA,Z_DEFLATED:gu}=Zr,rA=9,sA=15,aA=8,oA=29,lA=256,$h=lA+1+oA,uA=30,cA=19,hA=2*$h+1,fA=15,yt=3,yr=258,hi=yr+yt+1,dA=32,vu=42,ef=69,xu=73,yu=91,_u=103,Yr=113,Lo=666,sn=1,Co=2,jr=3,ca=4,pA=3,_r=(r,e)=>(r.msg=Xr[e],e),hv=r=>(r<<1)-(r>4?9:0),br=r=>{let e=r.length;for(;--e>=0;)r[e]=0};let mA=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,wr=mA;const Mr=r=>{const e=r.state;let t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},xn=(r,e)=>{qE(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,Mr(r.strm)},St=(r,e)=>{r.pending_buf[r.pending++]=e},Ro=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},gA=(r,e,t,i)=>{let a=r.avail_in;return a>i&&(a=i),a===0?0:(r.avail_in-=a,e.set(r.input.subarray(r.next_in,r.next_in+a),t),r.state.wrap===1?r.adler=Ao(r.adler,e,a,t):r.state.wrap===2&&(r.adler=hn(r.adler,e,a,t)),r.next_in+=a,r.total_in+=a,a)},fv=(r,e)=>{let t=r.max_chain_length,i=r.strstart,a,o,h=r.prev_length,f=r.nice_match;const p=r.strstart>r.w_size-hi?r.strstart-(r.w_size-hi):0,d=r.window,g=r.w_mask,y=r.prev,x=r.strstart+yr;let _=d[i+h-1],T=d[i+h];r.prev_length>=r.good_match&&(t>>=2),f>r.lookahead&&(f=r.lookahead);do if(a=e,!(d[a+h]!==T||d[a+h-1]!==_||d[a]!==d[i]||d[++a]!==d[i+1])){i+=2,a++;do;while(d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&i<x);if(o=yr-(x-i),i=x-yr,o>h){if(r.match_start=e,h=o,o>=f)break;_=d[i+h-1],T=d[i+h]}}while((e=y[e&g])>p&&--t!=0);return h<=r.lookahead?h:r.lookahead},Jr=r=>{const e=r.w_size;let t,i,a,o,h;do{if(o=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-hi)){r.window.set(r.window.subarray(e,e+e),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,i=r.hash_size,t=i;do a=r.head[--t],r.head[t]=a>=e?a-e:0;while(--i);i=e,t=i;do a=r.prev[--t],r.prev[t]=a>=e?a-e:0;while(--i);o+=e}if(r.strm.avail_in===0)break;if(i=gA(r.strm,r.window,r.strstart+r.lookahead,o),r.lookahead+=i,r.lookahead+r.insert>=yt)for(h=r.strstart-r.insert,r.ins_h=r.window[h],r.ins_h=wr(r,r.ins_h,r.window[h+1]);r.insert&&(r.ins_h=wr(r,r.ins_h,r.window[h+yt-1]),r.prev[h&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=h,h++,r.insert--,!(r.lookahead+r.insert<yt)););}while(r.lookahead<hi&&r.strm.avail_in!==0)},vA=(r,e)=>{let t=65535;for(t>r.pending_buf_size-5&&(t=r.pending_buf_size-5);;){if(r.lookahead<=1){if(Jr(r),r.lookahead===0&&e===qr)return sn;if(r.lookahead===0)break}r.strstart+=r.lookahead,r.lookahead=0;const i=r.block_start+t;if((r.strstart===0||r.strstart>=i)&&(r.lookahead=r.strstart-i,r.strstart=i,xn(r,!1),r.strm.avail_out===0)||r.strstart-r.block_start>=r.w_size-hi&&(xn(r,!1),r.strm.avail_out===0))return sn}return r.insert=0,e===xr?(xn(r,!0),r.strm.avail_out===0?jr:ca):(r.strstart>r.block_start&&(xn(r,!1),r.strm.avail_out===0),sn)},tf=(r,e)=>{let t,i;for(;;){if(r.lookahead<hi){if(Jr(r),r.lookahead<hi&&e===qr)return sn;if(r.lookahead===0)break}if(t=0,r.lookahead>=yt&&(r.ins_h=wr(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-hi&&(r.match_length=fv(r,t)),r.match_length>=yt)if(i=vr(r,r.strstart-r.match_start,r.match_length-yt),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=yt){r.match_length--;do r.strstart++,r.ins_h=wr(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!=0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=wr(r,r.ins_h,r.window[r.strstart+1]);else i=vr(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(i&&(xn(r,!1),r.strm.avail_out===0))return sn}return r.insert=r.strstart<yt-1?r.strstart:yt-1,e===xr?(xn(r,!0),r.strm.avail_out===0?jr:ca):r.last_lit&&(xn(r,!1),r.strm.avail_out===0)?sn:Co},ha=(r,e)=>{let t,i,a;for(;;){if(r.lookahead<hi){if(Jr(r),r.lookahead<hi&&e===qr)return sn;if(r.lookahead===0)break}if(t=0,r.lookahead>=yt&&(r.ins_h=wr(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=yt-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-hi&&(r.match_length=fv(r,t),r.match_length<=5&&(r.strategy===$E||r.match_length===yt&&r.strstart-r.match_start>4096)&&(r.match_length=yt-1)),r.prev_length>=yt&&r.match_length<=r.prev_length){a=r.strstart+r.lookahead-yt,i=vr(r,r.strstart-1-r.prev_match,r.prev_length-yt),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=a&&(r.ins_h=wr(r,r.ins_h,r.window[r.strstart+yt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!=0);if(r.match_available=0,r.match_length=yt-1,r.strstart++,i&&(xn(r,!1),r.strm.avail_out===0))return sn}else if(r.match_available){if(i=vr(r,0,r.window[r.strstart-1]),i&&xn(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return sn}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(i=vr(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<yt-1?r.strstart:yt-1,e===xr?(xn(r,!0),r.strm.avail_out===0?jr:ca):r.last_lit&&(xn(r,!1),r.strm.avail_out===0)?sn:Co},xA=(r,e)=>{let t,i,a,o;const h=r.window;for(;;){if(r.lookahead<=yr){if(Jr(r),r.lookahead<=yr&&e===qr)return sn;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=yt&&r.strstart>0&&(a=r.strstart-1,i=h[a],i===h[++a]&&i===h[++a]&&i===h[++a])){o=r.strstart+yr;do;while(i===h[++a]&&i===h[++a]&&i===h[++a]&&i===h[++a]&&i===h[++a]&&i===h[++a]&&i===h[++a]&&i===h[++a]&&a<o);r.match_length=yr-(o-a),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=yt?(t=vr(r,1,r.match_length-yt),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=vr(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(xn(r,!1),r.strm.avail_out===0))return sn}return r.insert=0,e===xr?(xn(r,!0),r.strm.avail_out===0?jr:ca):r.last_lit&&(xn(r,!1),r.strm.avail_out===0)?sn:Co},yA=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(Jr(r),r.lookahead===0)){if(e===qr)return sn;break}if(r.match_length=0,t=vr(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(xn(r,!1),r.strm.avail_out===0))return sn}return r.insert=0,e===xr?(xn(r,!0),r.strm.avail_out===0?jr:ca):r.last_lit&&(xn(r,!1),r.strm.avail_out===0)?sn:Co};function Mi(r,e,t,i,a){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=i,this.func=a}const Po=[new Mi(0,0,0,0,vA),new Mi(4,4,8,4,tf),new Mi(4,5,16,8,tf),new Mi(4,6,32,32,tf),new Mi(4,4,16,16,ha),new Mi(8,16,32,32,ha),new Mi(8,16,128,128,ha),new Mi(8,32,128,256,ha),new Mi(32,128,258,1024,ha),new Mi(32,258,258,4096,ha)],_A=r=>{r.window_size=2*r.w_size,br(r.head),r.max_lazy_match=Po[r.level].max_lazy,r.good_match=Po[r.level].good_length,r.nice_match=Po[r.level].nice_length,r.max_chain_length=Po[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=yt-1,r.match_available=0,r.ins_h=0};function bA(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=gu,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(hA*2),this.dyn_dtree=new Uint16Array((2*uA+1)*2),this.bl_tree=new Uint16Array((2*cA+1)*2),br(this.dyn_ltree),br(this.dyn_dtree),br(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(fA+1),this.heap=new Uint16Array(2*$h+1),br(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*$h+1),br(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dv=r=>{if(!r||!r.state)return _r(r,ei);r.total_in=r.total_out=0,r.data_type=iA;const e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?vu:Yr,r.adler=e.wrap===2?0:1,e.last_flush=qr,XE(e),wi},pv=r=>{const e=dv(r);return e===wi&&_A(r.state),e},wA=(r,e)=>!r||!r.state||r.state.wrap!==2?ei:(r.state.gzhead=e,wi),mv=(r,e,t,i,a,o)=>{if(!r)return ei;let h=1;if(e===QE&&(e=6),i<0?(h=0,i=-i):i>15&&(h=2,i-=16),a<1||a>rA||t!==gu||i<8||i>15||e<0||e>9||o<0||o>tA)return _r(r,ei);i===8&&(i=9);const f=new bA;return r.state=f,f.strm=r,f.wrap=h,f.gzhead=null,f.w_bits=i,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=a+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+yt-1)/yt),f.window=new Uint8Array(f.w_size*2),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<a+6,f.pending_buf_size=f.lit_bufsize*4,f.pending_buf=new Uint8Array(f.pending_buf_size),f.d_buf=1*f.lit_bufsize,f.l_buf=(1+2)*f.lit_bufsize,f.level=e,f.strategy=o,f.method=t,pv(r)},MA=(r,e)=>mv(r,e,gu,sA,aA,nA),SA=(r,e)=>{let t,i;if(!r||!r.state||e>uv||e<0)return r?_r(r,ei):ei;const a=r.state;if(!r.output||!r.input&&r.avail_in!==0||a.status===Lo&&e!==xr)return _r(r,r.avail_out===0?Qh:ei);a.strm=r;const o=a.last_flush;if(a.last_flush=e,a.status===vu)if(a.wrap===2)r.adler=0,St(a,31),St(a,139),St(a,8),a.gzhead?(St(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),St(a,a.gzhead.time&255),St(a,a.gzhead.time>>8&255),St(a,a.gzhead.time>>16&255),St(a,a.gzhead.time>>24&255),St(a,a.level===9?2:a.strategy>=mu||a.level<2?4:0),St(a,a.gzhead.os&255),a.gzhead.extra&&a.gzhead.extra.length&&(St(a,a.gzhead.extra.length&255),St(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(r.adler=hn(r.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=ef):(St(a,0),St(a,0),St(a,0),St(a,0),St(a,0),St(a,a.level===9?2:a.strategy>=mu||a.level<2?4:0),St(a,pA),a.status=Yr);else{let h=gu+(a.w_bits-8<<4)<<8,f=-1;a.strategy>=mu||a.level<2?f=0:a.level<6?f=1:a.level===6?f=2:f=3,h|=f<<6,a.strstart!==0&&(h|=dA),h+=31-h%31,a.status=Yr,Ro(a,h),a.strstart!==0&&(Ro(a,r.adler>>>16),Ro(a,r.adler&65535)),r.adler=1}if(a.status===ef)if(a.gzhead.extra){for(t=a.pending;a.gzindex<(a.gzhead.extra.length&65535)&&!(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>t&&(r.adler=hn(r.adler,a.pending_buf,a.pending-t,t)),Mr(r),t=a.pending,a.pending===a.pending_buf_size));)St(a,a.gzhead.extra[a.gzindex]&255),a.gzindex++;a.gzhead.hcrc&&a.pending>t&&(r.adler=hn(r.adler,a.pending_buf,a.pending-t,t)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=xu)}else a.status=xu;if(a.status===xu)if(a.gzhead.name){t=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>t&&(r.adler=hn(r.adler,a.pending_buf,a.pending-t,t)),Mr(r),t=a.pending,a.pending===a.pending_buf_size)){i=1;break}a.gzindex<a.gzhead.name.length?i=a.gzhead.name.charCodeAt(a.gzindex++)&255:i=0,St(a,i)}while(i!==0);a.gzhead.hcrc&&a.pending>t&&(r.adler=hn(r.adler,a.pending_buf,a.pending-t,t)),i===0&&(a.gzindex=0,a.status=yu)}else a.status=yu;if(a.status===yu)if(a.gzhead.comment){t=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>t&&(r.adler=hn(r.adler,a.pending_buf,a.pending-t,t)),Mr(r),t=a.pending,a.pending===a.pending_buf_size)){i=1;break}a.gzindex<a.gzhead.comment.length?i=a.gzhead.comment.charCodeAt(a.gzindex++)&255:i=0,St(a,i)}while(i!==0);a.gzhead.hcrc&&a.pending>t&&(r.adler=hn(r.adler,a.pending_buf,a.pending-t,t)),i===0&&(a.status=_u)}else a.status=_u;if(a.status===_u&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&Mr(r),a.pending+2<=a.pending_buf_size&&(St(a,r.adler&255),St(a,r.adler>>8&255),r.adler=0,a.status=Yr)):a.status=Yr),a.pending!==0){if(Mr(r),r.avail_out===0)return a.last_flush=-1,wi}else if(r.avail_in===0&&hv(e)<=hv(o)&&e!==xr)return _r(r,Qh);if(a.status===Lo&&r.avail_in!==0)return _r(r,Qh);if(r.avail_in!==0||a.lookahead!==0||e!==qr&&a.status!==Lo){let h=a.strategy===mu?yA(a,e):a.strategy===eA?xA(a,e):Po[a.level].func(a,e);if((h===jr||h===ca)&&(a.status=Lo),h===sn||h===jr)return r.avail_out===0&&(a.last_flush=-1),wi;if(h===Co&&(e===jE?YE(a):e!==uv&&(ZE(a,0,0,!1),e===JE&&(br(a.head),a.lookahead===0&&(a.strstart=0,a.block_start=0,a.insert=0))),Mr(r),r.avail_out===0))return a.last_flush=-1,wi}return e!==xr?wi:a.wrap<=0?cv:(a.wrap===2?(St(a,r.adler&255),St(a,r.adler>>8&255),St(a,r.adler>>16&255),St(a,r.adler>>24&255),St(a,r.total_in&255),St(a,r.total_in>>8&255),St(a,r.total_in>>16&255),St(a,r.total_in>>24&255)):(Ro(a,r.adler>>>16),Ro(a,r.adler&65535)),Mr(r),a.wrap>0&&(a.wrap=-a.wrap),a.pending!==0?wi:cv)},TA=r=>{if(!r||!r.state)return ei;const e=r.state.status;return e!==vu&&e!==ef&&e!==xu&&e!==yu&&e!==_u&&e!==Yr&&e!==Lo?_r(r,ei):(r.state=null,e===Yr?_r(r,KE):wi)},EA=(r,e)=>{let t=e.length;if(!r||!r.state)return ei;const i=r.state,a=i.wrap;if(a===2||a===1&&i.status!==vu||i.lookahead)return ei;if(a===1&&(r.adler=Ao(r.adler,e,t,0)),i.wrap=0,t>=i.w_size){a===0&&(br(i.head),i.strstart=0,i.block_start=0,i.insert=0);let p=new Uint8Array(i.w_size);p.set(e.subarray(t-i.w_size,t),0),e=p,t=i.w_size}const o=r.avail_in,h=r.next_in,f=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,Jr(i);i.lookahead>=yt;){let p=i.strstart,d=i.lookahead-(yt-1);do i.ins_h=wr(i,i.ins_h,i.window[p+yt-1]),i.prev[p&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=p,p++;while(--d);i.strstart=p,i.lookahead=yt-1,Jr(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=yt-1,i.match_available=0,r.next_in=h,r.input=f,r.avail_in=o,i.wrap=a,wi};var AA=MA,LA=mv,CA=pv,RA=dv,PA=wA,DA=SA,IA=TA,kA=EA,NA="pako deflate (from Nodeca project)",Do={deflateInit:AA,deflateInit2:LA,deflateReset:CA,deflateResetKeep:RA,deflateSetHeader:PA,deflate:DA,deflateEnd:IA,deflateSetDictionary:kA,deflateInfo:NA};const FA=(r,e)=>Object.prototype.hasOwnProperty.call(r,e);var OA=function(r){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)FA(t,i)&&(r[i]=t[i])}}return r},zA=r=>{let e=0;for(let i=0,a=r.length;i<a;i++)e+=r[i].length;const t=new Uint8Array(e);for(let i=0,a=0,o=r.length;i<o;i++){let h=r[i];t.set(h,a),a+=h.length}return t},bu={assign:OA,flattenChunks:zA};let gv=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{gv=!1}const Io=new Uint8Array(256);for(let r=0;r<256;r++)Io[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;Io[254]=Io[254]=1;var BA=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,i,a,o,h=r.length,f=0;for(a=0;a<h;a++)t=r.charCodeAt(a),(t&64512)==55296&&a+1<h&&(i=r.charCodeAt(a+1),(i&64512)==56320&&(t=65536+(t-55296<<10)+(i-56320),a++)),f+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(f),o=0,a=0;o<f;a++)t=r.charCodeAt(a),(t&64512)==55296&&a+1<h&&(i=r.charCodeAt(a+1),(i&64512)==56320&&(t=65536+(t-55296<<10)+(i-56320),a++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e};const HA=(r,e)=>{if(e<65534&&r.subarray&&gv)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(r[i]);return t};var UA=(r,e)=>{const t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let i,a;const o=new Array(t*2);for(a=0,i=0;i<t;){let h=r[i++];if(h<128){o[a++]=h;continue}let f=Io[h];if(f>4){o[a++]=65533,i+=f-1;continue}for(h&=f===2?31:f===3?15:7;f>1&&i<t;)h=h<<6|r[i++]&63,f--;if(f>1){o[a++]=65533;continue}h<65536?o[a++]=h:(h-=65536,o[a++]=55296|h>>10&1023,o[a++]=56320|h&1023)}return HA(o,a)},WA=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)==128;)t--;return t<0||t===0?e:t+Io[r[t]]>e?t:e},ko={string2buf:BA,buf2string:UA,utf8border:WA};function GA(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var vv=GA;const xv=Object.prototype.toString,{Z_NO_FLUSH:VA,Z_SYNC_FLUSH:XA,Z_FULL_FLUSH:ZA,Z_FINISH:qA,Z_OK:wu,Z_STREAM_END:YA,Z_DEFAULT_COMPRESSION:jA,Z_DEFAULT_STRATEGY:JA,Z_DEFLATED:KA}=Zr;function No(r){this.options=bu.assign({level:jA,method:KA,chunkSize:16384,windowBits:15,memLevel:8,strategy:JA},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new vv,this.strm.avail_out=0;let t=Do.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==wu)throw new Error(Xr[t]);if(e.header&&Do.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(typeof e.dictionary=="string"?i=ko.string2buf(e.dictionary):xv.call(e.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(e.dictionary):i=e.dictionary,t=Do.deflateSetDictionary(this.strm,i),t!==wu)throw new Error(Xr[t]);this._dict_set=!0}}No.prototype.push=function(r,e){const t=this.strm,i=this.options.chunkSize;let a,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?qA:VA,typeof r=="string"?t.input=ko.string2buf(r):xv.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(o===XA||o===ZA)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(a=Do.deflate(t,o),a===YA)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),a=Do.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===wu;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};No.prototype.onData=function(r){this.chunks.push(r)};No.prototype.onEnd=function(r){r===wu&&(this.result=bu.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function nf(r,e){const t=new No(e);if(t.push(r,!0),t.err)throw t.msg||Xr[t.err];return t.result}function QA(r,e){return e=e||{},e.raw=!0,nf(r,e)}function $A(r,e){return e=e||{},e.gzip=!0,nf(r,e)}var eL=No,tL=nf,nL=QA,iL=$A,rL=Zr,sL={Deflate:eL,deflate:tL,deflateRaw:nL,gzip:iL,constants:rL};const Mu=30,aL=12;var oL=function(e,t){let i,a,o,h,f,p,d,g,y,x,_,T,L,P,M,w,N,C,k,q,R,J,oe,Q;const X=e.state;i=e.next_in,oe=e.input,a=i+(e.avail_in-5),o=e.next_out,Q=e.output,h=o-(t-e.avail_out),f=o+(e.avail_out-257),p=X.dmax,d=X.wsize,g=X.whave,y=X.wnext,x=X.window,_=X.hold,T=X.bits,L=X.lencode,P=X.distcode,M=(1<<X.lenbits)-1,w=(1<<X.distbits)-1;e:do{T<15&&(_+=oe[i++]<<T,T+=8,_+=oe[i++]<<T,T+=8),N=L[_&M];t:for(;;){if(C=N>>>24,_>>>=C,T-=C,C=N>>>16&255,C===0)Q[o++]=N&65535;else if(C&16){k=N&65535,C&=15,C&&(T<C&&(_+=oe[i++]<<T,T+=8),k+=_&(1<<C)-1,_>>>=C,T-=C),T<15&&(_+=oe[i++]<<T,T+=8,_+=oe[i++]<<T,T+=8),N=P[_&w];n:for(;;){if(C=N>>>24,_>>>=C,T-=C,C=N>>>16&255,C&16){if(q=N&65535,C&=15,T<C&&(_+=oe[i++]<<T,T+=8,T<C&&(_+=oe[i++]<<T,T+=8)),q+=_&(1<<C)-1,q>p){e.msg="invalid distance too far back",X.mode=Mu;break e}if(_>>>=C,T-=C,C=o-h,q>C){if(C=q-C,C>g&&X.sane){e.msg="invalid distance too far back",X.mode=Mu;break e}if(R=0,J=x,y===0){if(R+=d-C,C<k){k-=C;do Q[o++]=x[R++];while(--C);R=o-q,J=Q}}else if(y<C){if(R+=d+y-C,C-=y,C<k){k-=C;do Q[o++]=x[R++];while(--C);if(R=0,y<k){C=y,k-=C;do Q[o++]=x[R++];while(--C);R=o-q,J=Q}}}else if(R+=y-C,C<k){k-=C;do Q[o++]=x[R++];while(--C);R=o-q,J=Q}for(;k>2;)Q[o++]=J[R++],Q[o++]=J[R++],Q[o++]=J[R++],k-=3;k&&(Q[o++]=J[R++],k>1&&(Q[o++]=J[R++]))}else{R=o-q;do Q[o++]=Q[R++],Q[o++]=Q[R++],Q[o++]=Q[R++],k-=3;while(k>2);k&&(Q[o++]=Q[R++],k>1&&(Q[o++]=Q[R++]))}}else if((C&64)==0){N=P[(N&65535)+(_&(1<<C)-1)];continue n}else{e.msg="invalid distance code",X.mode=Mu;break e}break}}else if((C&64)==0){N=L[(N&65535)+(_&(1<<C)-1)];continue t}else if(C&32){X.mode=aL;break e}else{e.msg="invalid literal/length code",X.mode=Mu;break e}break}}while(i<a&&o<f);k=T>>3,i-=k,T-=k<<3,_&=(1<<T)-1,e.next_in=i,e.next_out=o,e.avail_in=i<a?5+(a-i):5-(i-a),e.avail_out=o<f?257+(f-o):257-(o-f),X.hold=_,X.bits=T};const fa=15,yv=852,_v=592,bv=0,rf=1,wv=2,lL=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),uL=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),cL=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),hL=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),fL=(r,e,t,i,a,o,h,f)=>{const p=f.bits;let d=0,g=0,y=0,x=0,_=0,T=0,L=0,P=0,M=0,w=0,N,C,k,q,R,J=null,oe=0,Q;const X=new Uint16Array(fa+1),Se=new Uint16Array(fa+1);let H=null,W=0,D,ee,te;for(d=0;d<=fa;d++)X[d]=0;for(g=0;g<i;g++)X[e[t+g]]++;for(_=p,x=fa;x>=1&&X[x]===0;x--);if(_>x&&(_=x),x===0)return a[o++]=1<<24|64<<16|0,a[o++]=1<<24|64<<16|0,f.bits=1,0;for(y=1;y<x&&X[y]===0;y++);for(_<y&&(_=y),P=1,d=1;d<=fa;d++)if(P<<=1,P-=X[d],P<0)return-1;if(P>0&&(r===bv||x!==1))return-1;for(Se[1]=0,d=1;d<fa;d++)Se[d+1]=Se[d]+X[d];for(g=0;g<i;g++)e[t+g]!==0&&(h[Se[e[t+g]]++]=g);if(r===bv?(J=H=h,Q=19):r===rf?(J=lL,oe-=257,H=uL,W-=257,Q=256):(J=cL,H=hL,Q=-1),w=0,g=0,d=y,R=o,T=_,L=0,k=-1,M=1<<_,q=M-1,r===rf&&M>yv||r===wv&&M>_v)return 1;for(;;){D=d-L,h[g]<Q?(ee=0,te=h[g]):h[g]>Q?(ee=H[W+h[g]],te=J[oe+h[g]]):(ee=32+64,te=0),N=1<<d-L,C=1<<T,y=C;do C-=N,a[R+(w>>L)+C]=D<<24|ee<<16|te|0;while(C!==0);for(N=1<<d-1;w&N;)N>>=1;if(N!==0?(w&=N-1,w+=N):w=0,g++,--X[d]==0){if(d===x)break;d=e[t+h[g]]}if(d>_&&(w&q)!==k){for(L===0&&(L=_),R+=y,T=d-L,P=1<<T;T+L<x&&(P-=X[T+L],!(P<=0));)T++,P<<=1;if(M+=1<<T,r===rf&&M>yv||r===wv&&M>_v)return 1;k=w&q,a[k]=_<<24|T<<16|R-o|0}}return w!==0&&(a[R+w]=d-L<<24|64<<16|0),f.bits=_,0};var Fo=fL;const dL=0,Mv=1,Sv=2,{Z_FINISH:Tv,Z_BLOCK:pL,Z_TREES:Su,Z_OK:Kr,Z_STREAM_END:mL,Z_NEED_DICT:gL,Z_STREAM_ERROR:ti,Z_DATA_ERROR:Ev,Z_MEM_ERROR:Av,Z_BUF_ERROR:vL,Z_DEFLATED:Lv}=Zr,Cv=1,Rv=2,Pv=3,Dv=4,Iv=5,kv=6,Nv=7,Fv=8,Ov=9,zv=10,Tu=11,Ui=12,sf=13,Bv=14,af=15,Hv=16,Uv=17,Wv=18,Gv=19,Eu=20,Au=21,Vv=22,Xv=23,Zv=24,qv=25,Yv=26,of=27,jv=28,Jv=29,Ot=30,Kv=31,xL=32,yL=852,_L=592,bL=15,wL=bL,Qv=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function ML(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const $v=r=>{if(!r||!r.state)return ti;const e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=Cv,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(yL),e.distcode=e.distdyn=new Int32Array(_L),e.sane=1,e.back=-1,Kr},e0=r=>{if(!r||!r.state)return ti;const e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,$v(r)},t0=(r,e)=>{let t;if(!r||!r.state)return ti;const i=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?ti:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,e0(r))},n0=(r,e)=>{if(!r)return ti;const t=new ML;r.state=t,t.window=null;const i=t0(r,e);return i!==Kr&&(r.state=null),i},SL=r=>n0(r,wL);let i0=!0,lf,uf;const TL=r=>{if(i0){lf=new Int32Array(512),uf=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(Fo(Mv,r.lens,0,288,lf,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;Fo(Sv,r.lens,0,32,uf,0,r.work,{bits:5}),i0=!1}r.lencode=lf,r.lenbits=9,r.distcode=uf,r.distbits=5},r0=(r,e,t,i)=>{let a;const o=r.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(a=o.wsize-o.wnext,a>i&&(a=i),o.window.set(e.subarray(t-i,t-i+a),o.wnext),i-=a,i?(o.window.set(e.subarray(t-i,t),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0},EL=(r,e)=>{let t,i,a,o,h,f,p,d,g,y,x,_,T,L,P=0,M,w,N,C,k,q,R,J;const oe=new Uint8Array(4);let Q,X;const Se=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return ti;t=r.state,t.mode===Ui&&(t.mode=sf),h=r.next_out,a=r.output,p=r.avail_out,o=r.next_in,i=r.input,f=r.avail_in,d=t.hold,g=t.bits,y=f,x=p,J=Kr;e:for(;;)switch(t.mode){case Cv:if(t.wrap===0){t.mode=sf;break}for(;g<16;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(t.wrap&2&&d===35615){t.check=0,oe[0]=d&255,oe[1]=d>>>8&255,t.check=hn(t.check,oe,2,0),d=0,g=0,t.mode=Rv;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((d&255)<<8)+(d>>8))%31){r.msg="incorrect header check",t.mode=Ot;break}if((d&15)!==Lv){r.msg="unknown compression method",t.mode=Ot;break}if(d>>>=4,g-=4,R=(d&15)+8,t.wbits===0)t.wbits=R;else if(R>t.wbits){r.msg="invalid window size",t.mode=Ot;break}t.dmax=1<<t.wbits,r.adler=t.check=1,t.mode=d&512?zv:Ui,d=0,g=0;break;case Rv:for(;g<16;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(t.flags=d,(t.flags&255)!==Lv){r.msg="unknown compression method",t.mode=Ot;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=Ot;break}t.head&&(t.head.text=d>>8&1),t.flags&512&&(oe[0]=d&255,oe[1]=d>>>8&255,t.check=hn(t.check,oe,2,0)),d=0,g=0,t.mode=Pv;case Pv:for(;g<32;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}t.head&&(t.head.time=d),t.flags&512&&(oe[0]=d&255,oe[1]=d>>>8&255,oe[2]=d>>>16&255,oe[3]=d>>>24&255,t.check=hn(t.check,oe,4,0)),d=0,g=0,t.mode=Dv;case Dv:for(;g<16;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}t.head&&(t.head.xflags=d&255,t.head.os=d>>8),t.flags&512&&(oe[0]=d&255,oe[1]=d>>>8&255,t.check=hn(t.check,oe,2,0)),d=0,g=0,t.mode=Iv;case Iv:if(t.flags&1024){for(;g<16;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}t.length=d,t.head&&(t.head.extra_len=d),t.flags&512&&(oe[0]=d&255,oe[1]=d>>>8&255,t.check=hn(t.check,oe,2,0)),d=0,g=0}else t.head&&(t.head.extra=null);t.mode=kv;case kv:if(t.flags&1024&&(_=t.length,_>f&&(_=f),_&&(t.head&&(R=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(o,o+_),R)),t.flags&512&&(t.check=hn(t.check,i,_,o)),f-=_,o+=_,t.length-=_),t.length))break e;t.length=0,t.mode=Nv;case Nv:if(t.flags&2048){if(f===0)break e;_=0;do R=i[o+_++],t.head&&R&&t.length<65536&&(t.head.name+=String.fromCharCode(R));while(R&&_<f);if(t.flags&512&&(t.check=hn(t.check,i,_,o)),f-=_,o+=_,R)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=Fv;case Fv:if(t.flags&4096){if(f===0)break e;_=0;do R=i[o+_++],t.head&&R&&t.length<65536&&(t.head.comment+=String.fromCharCode(R));while(R&&_<f);if(t.flags&512&&(t.check=hn(t.check,i,_,o)),f-=_,o+=_,R)break e}else t.head&&(t.head.comment=null);t.mode=Ov;case Ov:if(t.flags&512){for(;g<16;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(d!==(t.check&65535)){r.msg="header crc mismatch",t.mode=Ot;break}d=0,g=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Ui;break;case zv:for(;g<32;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}r.adler=t.check=Qv(d),d=0,g=0,t.mode=Tu;case Tu:if(t.havedict===0)return r.next_out=h,r.avail_out=p,r.next_in=o,r.avail_in=f,t.hold=d,t.bits=g,gL;r.adler=t.check=1,t.mode=Ui;case Ui:if(e===pL||e===Su)break e;case sf:if(t.last){d>>>=g&7,g-=g&7,t.mode=of;break}for(;g<3;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}switch(t.last=d&1,d>>>=1,g-=1,d&3){case 0:t.mode=Bv;break;case 1:if(TL(t),t.mode=Eu,e===Su){d>>>=2,g-=2;break e}break;case 2:t.mode=Uv;break;case 3:r.msg="invalid block type",t.mode=Ot}d>>>=2,g-=2;break;case Bv:for(d>>>=g&7,g-=g&7;g<32;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if((d&65535)!=(d>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Ot;break}if(t.length=d&65535,d=0,g=0,t.mode=af,e===Su)break e;case af:t.mode=Hv;case Hv:if(_=t.length,_){if(_>f&&(_=f),_>p&&(_=p),_===0)break e;a.set(i.subarray(o,o+_),h),f-=_,o+=_,p-=_,h+=_,t.length-=_;break}t.mode=Ui;break;case Uv:for(;g<14;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(t.nlen=(d&31)+257,d>>>=5,g-=5,t.ndist=(d&31)+1,d>>>=5,g-=5,t.ncode=(d&15)+4,d>>>=4,g-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Ot;break}t.have=0,t.mode=Wv;case Wv:for(;t.have<t.ncode;){for(;g<3;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}t.lens[Se[t.have++]]=d&7,d>>>=3,g-=3}for(;t.have<19;)t.lens[Se[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,Q={bits:t.lenbits},J=Fo(dL,t.lens,0,19,t.lencode,0,t.work,Q),t.lenbits=Q.bits,J){r.msg="invalid code lengths set",t.mode=Ot;break}t.have=0,t.mode=Gv;case Gv:for(;t.have<t.nlen+t.ndist;){for(;P=t.lencode[d&(1<<t.lenbits)-1],M=P>>>24,w=P>>>16&255,N=P&65535,!(M<=g);){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(N<16)d>>>=M,g-=M,t.lens[t.have++]=N;else{if(N===16){for(X=M+2;g<X;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(d>>>=M,g-=M,t.have===0){r.msg="invalid bit length repeat",t.mode=Ot;break}R=t.lens[t.have-1],_=3+(d&3),d>>>=2,g-=2}else if(N===17){for(X=M+3;g<X;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}d>>>=M,g-=M,R=0,_=3+(d&7),d>>>=3,g-=3}else{for(X=M+7;g<X;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}d>>>=M,g-=M,R=0,_=11+(d&127),d>>>=7,g-=7}if(t.have+_>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Ot;break}for(;_--;)t.lens[t.have++]=R}}if(t.mode===Ot)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Ot;break}if(t.lenbits=9,Q={bits:t.lenbits},J=Fo(Mv,t.lens,0,t.nlen,t.lencode,0,t.work,Q),t.lenbits=Q.bits,J){r.msg="invalid literal/lengths set",t.mode=Ot;break}if(t.distbits=6,t.distcode=t.distdyn,Q={bits:t.distbits},J=Fo(Sv,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,Q),t.distbits=Q.bits,J){r.msg="invalid distances set",t.mode=Ot;break}if(t.mode=Eu,e===Su)break e;case Eu:t.mode=Au;case Au:if(f>=6&&p>=258){r.next_out=h,r.avail_out=p,r.next_in=o,r.avail_in=f,t.hold=d,t.bits=g,oL(r,x),h=r.next_out,a=r.output,p=r.avail_out,o=r.next_in,i=r.input,f=r.avail_in,d=t.hold,g=t.bits,t.mode===Ui&&(t.back=-1);break}for(t.back=0;P=t.lencode[d&(1<<t.lenbits)-1],M=P>>>24,w=P>>>16&255,N=P&65535,!(M<=g);){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(w&&(w&240)==0){for(C=M,k=w,q=N;P=t.lencode[q+((d&(1<<C+k)-1)>>C)],M=P>>>24,w=P>>>16&255,N=P&65535,!(C+M<=g);){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}d>>>=C,g-=C,t.back+=C}if(d>>>=M,g-=M,t.back+=M,t.length=N,w===0){t.mode=Yv;break}if(w&32){t.back=-1,t.mode=Ui;break}if(w&64){r.msg="invalid literal/length code",t.mode=Ot;break}t.extra=w&15,t.mode=Vv;case Vv:if(t.extra){for(X=t.extra;g<X;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,g-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Xv;case Xv:for(;P=t.distcode[d&(1<<t.distbits)-1],M=P>>>24,w=P>>>16&255,N=P&65535,!(M<=g);){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if((w&240)==0){for(C=M,k=w,q=N;P=t.distcode[q+((d&(1<<C+k)-1)>>C)],M=P>>>24,w=P>>>16&255,N=P&65535,!(C+M<=g);){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}d>>>=C,g-=C,t.back+=C}if(d>>>=M,g-=M,t.back+=M,w&64){r.msg="invalid distance code",t.mode=Ot;break}t.offset=N,t.extra=w&15,t.mode=Zv;case Zv:if(t.extra){for(X=t.extra;g<X;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,g-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Ot;break}t.mode=qv;case qv:if(p===0)break e;if(_=x-p,t.offset>_){if(_=t.offset-_,_>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Ot;break}_>t.wnext?(_-=t.wnext,T=t.wsize-_):T=t.wnext-_,_>t.length&&(_=t.length),L=t.window}else L=a,T=h-t.offset,_=t.length;_>p&&(_=p),p-=_,t.length-=_;do a[h++]=L[T++];while(--_);t.length===0&&(t.mode=Au);break;case Yv:if(p===0)break e;a[h++]=t.length,p--,t.mode=Au;break;case of:if(t.wrap){for(;g<32;){if(f===0)break e;f--,d|=i[o++]<<g,g+=8}if(x-=p,r.total_out+=x,t.total+=x,x&&(r.adler=t.check=t.flags?hn(t.check,a,x,h-x):Ao(t.check,a,x,h-x)),x=p,(t.flags?d:Qv(d))!==t.check){r.msg="incorrect data check",t.mode=Ot;break}d=0,g=0}t.mode=jv;case jv:if(t.wrap&&t.flags){for(;g<32;){if(f===0)break e;f--,d+=i[o++]<<g,g+=8}if(d!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=Ot;break}d=0,g=0}t.mode=Jv;case Jv:J=mL;break e;case Ot:J=Ev;break e;case Kv:return Av;case xL:default:return ti}return r.next_out=h,r.avail_out=p,r.next_in=o,r.avail_in=f,t.hold=d,t.bits=g,(t.wsize||x!==r.avail_out&&t.mode<Ot&&(t.mode<of||e!==Tv))&&r0(r,r.output,r.next_out,x-r.avail_out),y-=r.avail_in,x-=r.avail_out,r.total_in+=y,r.total_out+=x,t.total+=x,t.wrap&&x&&(r.adler=t.check=t.flags?hn(t.check,a,x,r.next_out-x):Ao(t.check,a,x,r.next_out-x)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Ui?128:0)+(t.mode===Eu||t.mode===af?256:0),(y===0&&x===0||e===Tv)&&J===Kr&&(J=vL),J},AL=r=>{if(!r||!r.state)return ti;let e=r.state;return e.window&&(e.window=null),r.state=null,Kr},LL=(r,e)=>{if(!r||!r.state)return ti;const t=r.state;return(t.wrap&2)==0?ti:(t.head=e,e.done=!1,Kr)},CL=(r,e)=>{const t=e.length;let i,a,o;return!r||!r.state||(i=r.state,i.wrap!==0&&i.mode!==Tu)?ti:i.mode===Tu&&(a=1,a=Ao(a,e,t,0),a!==i.check)?Ev:(o=r0(r,e,t,t),o?(i.mode=Kv,Av):(i.havedict=1,Kr))};var RL=e0,PL=t0,DL=$v,IL=SL,kL=n0,NL=EL,FL=AL,OL=LL,zL=CL,BL="pako inflate (from Nodeca project)",Wi={inflateReset:RL,inflateReset2:PL,inflateResetKeep:DL,inflateInit:IL,inflateInit2:kL,inflate:NL,inflateEnd:FL,inflateGetHeader:OL,inflateSetDictionary:zL,inflateInfo:BL};function HL(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var UL=HL;const s0=Object.prototype.toString,{Z_NO_FLUSH:WL,Z_FINISH:GL,Z_OK:Oo,Z_STREAM_END:cf,Z_NEED_DICT:hf,Z_STREAM_ERROR:VL,Z_DATA_ERROR:a0,Z_MEM_ERROR:XL}=Zr;function zo(r){this.options=bu.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new vv,this.strm.avail_out=0;let t=Wi.inflateInit2(this.strm,e.windowBits);if(t!==Oo)throw new Error(Xr[t]);if(this.header=new UL,Wi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ko.string2buf(e.dictionary):s0.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Wi.inflateSetDictionary(this.strm,e.dictionary),t!==Oo)))throw new Error(Xr[t])}zo.prototype.push=function(r,e){const t=this.strm,i=this.options.chunkSize,a=this.options.dictionary;let o,h,f;if(this.ended)return!1;for(e===~~e?h=e:h=e===!0?GL:WL,s0.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),o=Wi.inflate(t,h),o===hf&&a&&(o=Wi.inflateSetDictionary(t,a),o===Oo?o=Wi.inflate(t,h):o===a0&&(o=hf));t.avail_in>0&&o===cf&&t.state.wrap>0&&r[t.next_in]!==0;)Wi.inflateReset(t),o=Wi.inflate(t,h);switch(o){case VL:case a0:case hf:case XL:return this.onEnd(o),this.ended=!0,!1}if(f=t.avail_out,t.next_out&&(t.avail_out===0||o===cf))if(this.options.to==="string"){let p=ko.utf8border(t.output,t.next_out),d=t.next_out-p,g=ko.buf2string(t.output,p);t.next_out=d,t.avail_out=i-d,d&&t.output.set(t.output.subarray(p,p+d),0),this.onData(g)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===Oo&&f===0)){if(o===cf)return o=Wi.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};zo.prototype.onData=function(r){this.chunks.push(r)};zo.prototype.onEnd=function(r){r===Oo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=bu.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function ff(r,e){const t=new zo(e);if(t.push(r),t.err)throw t.msg||Xr[t.err];return t.result}function ZL(r,e){return e=e||{},e.raw=!0,ff(r,e)}var qL=zo,YL=ff,jL=ZL,JL=ff,KL=Zr,QL={Inflate:qL,inflate:YL,inflateRaw:jL,ungzip:JL,constants:KL};const{Deflate:$L,deflate:eC,deflateRaw:tC,gzip:nC}=sL,{Inflate:iC,inflate:rC,inflateRaw:sC,ungzip:aC}=QL;var oC=$L,lC=eC,uC=tC,cC=nC,hC=iC,fC=rC,dC=sC,pC=aC,mC=Zr,wC={Deflate:oC,deflate:lC,deflateRaw:uC,gzip:cC,Inflate:hC,inflate:fC,inflateRaw:dC,ungzip:pC,constants:mC};export{_C as A,oi as B,vC as C,wl as D,zs as E,Gl as F,pr as I,hE as L,xC as M,bC as O,Bn as P,Sn as Q,Fs as R,Vm as S,Yt as T,V,Ct as W,et as a,_o as b,yC as c,gn as d,ot as e,zi as f,Ns as g,Ng as h,ye as i,Rt as j,kt as k,jt as l,U1 as m,Hr as n,OT as o,vp as p,wC as q};
